<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>PostscriptGraphics.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.gui.visualize</a> &gt; <span class="el_source">PostscriptGraphics.java</span></div><h1>PostscriptGraphics.java</h1><pre class="source lang-java linenums">/*
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 *    PostscriptGraphics.java
 *    Copyright (C) 2003 University of Waikato, Hamilton, New Zealand
 *
 */

package weka.gui.visualize;

import java.awt.image.renderable.*;
import java.awt.*;
import java.awt.geom.*;
import java.awt.font.*;
import java.io.*;
import java.util.*;
import java.awt.image.*;
import java.text.*;


/** 
 * The PostscriptGraphics class extends the Graphics2D class to 
 * produce an encapsulated postscript file rather than on-screen display.
 * &lt;p&gt;
 * Currently only a small (but useful) subset of Graphics methods have been 
 * implemented. 
 * To handle the ability to Clone a Graphics object, the graphics state of the 
 * eps is set from the graphics state of the local PostscriptGraphics before output.
 * To use, create a PostscriptGraphics object, and pass it to the PaintComponent
 * method of a JComponent.
 * &lt;p&gt;
 * If necessary additional font replacements can be inserted, since some fonts 
 * might be displayed incorrectly.
 *
 * @see #addPSFontReplacement(String, String)
 * @see #m_PSFontReplacement
 * @author Dale Fletcher (dale@cs.waikato.ac.nz)
 * @author FracPete (fracpete at waikato dot ac dot nz)
 * @version $Revision: 7059 $
 */

<span class="fc" id="L56">public class PostscriptGraphics extends Graphics2D {</span>
  
  /**
   * This inner class is used to maintain the graphics states of the PostScript
   * file and graphics context.
   */
  private class GraphicsState {
    /** The current pen color */
    protected Color m_currentColor;
    
    /** The current Font */
    protected Font m_currentFont;
    
    /** The current Stroke (not yet used) */ 
    protected Stroke m_currentStroke;
    
    /** x,y Translation */
    protected int m_xOffset;
    protected int m_yOffset;
    
    /** the scale factors */
    protected double m_xScale;
    protected double m_yScale;
    
    /**
     * Create a new GraphicsState with default values.
     */
<span class="nc" id="L83">    GraphicsState(){</span>
<span class="nc" id="L84">      m_currentColor  = Color.white;</span>
<span class="nc" id="L85">      m_currentFont   = new Font (&quot;Courier&quot;, Font.PLAIN, 11);</span>
<span class="nc" id="L86">      m_currentStroke = new BasicStroke();</span>
<span class="nc" id="L87">      m_xOffset       = 0;</span>
<span class="nc" id="L88">      m_yOffset       = 0;</span>
<span class="nc" id="L89">      m_xScale        = 1.0;</span>
<span class="nc" id="L90">      m_yScale        = 1.0;</span>
<span class="nc" id="L91">    }</span>
    
    /**
     * Create a new cloned GraphicsState
     *
     * @param copy The GraphicsState to clone
     */
<span class="nc" id="L98">    GraphicsState(GraphicsState copy){</span>
<span class="nc" id="L99">      m_currentColor  = copy.m_currentColor;</span>
<span class="nc" id="L100">      m_currentFont   = copy.m_currentFont;</span>
<span class="nc" id="L101">      m_currentStroke = copy.m_currentStroke;</span>
<span class="nc" id="L102">      m_xOffset       = copy.m_xOffset;</span>
<span class="nc" id="L103">      m_yOffset       = copy.m_yOffset;</span>
<span class="nc" id="L104">      m_xScale        = copy.m_xScale;</span>
<span class="nc" id="L105">      m_yScale        = copy.m_yScale;</span>
<span class="nc" id="L106">    }</span>
    
    /* Stroke Methods */
    protected Stroke getStroke(){
<span class="nc" id="L110">      return m_currentStroke;</span>
    }
    
    protected void setStroke(Stroke s){
<span class="nc" id="L114">      m_currentStroke = s;</span>
<span class="nc" id="L115">    }</span>
    
    /* Font Methods */
    protected Font getFont(){
<span class="nc" id="L119">      return m_currentFont;</span>
    }
    
    protected void setFont(Font f){
<span class="nc" id="L123">      m_currentFont = f;</span>
<span class="nc" id="L124">    }</span>
    
    /* Color Methods */
    protected Color getColor(){
<span class="nc" id="L128">      return m_currentColor;</span>
    }
    
    protected void setColor(Color c){
<span class="nc" id="L132">      m_currentColor = c;</span>
<span class="nc" id="L133">    }</span>
    
    /* Translation methods */
    protected void setXOffset(int xo){
<span class="nc" id="L137">      m_xOffset = xo;</span>
<span class="nc" id="L138">    }</span>
    
    protected void setYOffset(int yo){
<span class="nc" id="L141">      m_yOffset = yo;</span>
<span class="nc" id="L142">    }</span>
    
    protected int getXOffset(){
<span class="nc" id="L145">      return m_xOffset;</span>
    }
    
    protected int getYOffset(){
<span class="nc" id="L149">      return m_yOffset;</span>
    }
    
    protected void setXScale(double x){
<span class="nc" id="L153">      m_xScale = x;</span>
<span class="nc" id="L154">    }</span>
    
    protected void setYScale(double y){
<span class="nc" id="L157">      m_yScale = y;</span>
<span class="nc" id="L158">    }</span>
    
    protected double getXScale(){
<span class="nc" id="L161">      return m_xScale;</span>
    }
    
    protected double getYScale(){
<span class="nc" id="L165">      return m_yScale;</span>
    }
  }
  
  /** The bounding box of the output */
  protected Rectangle m_extent;
  
  /** The output file */
  protected PrintStream m_printstream;
  
  /** The current global PostScript graphics state for all cloned objects */
  protected GraphicsState m_psGraphicsState;
  
  /** The current local graphics state for this PostscriptGraphics object */
  protected GraphicsState m_localGraphicsState;
  
  /** whether to print some debug information */
  protected final static boolean DEBUG = false;
  
  /** the font replacement */
  protected static Hashtable m_PSFontReplacement;
  
  /** output if we're in debug mode */
  static {
    if (DEBUG)
      System.err.println(PostscriptGraphics.class.getName() + Messages.getInstance().getString(&quot;PostscriptGraphics_Error_Text&quot;));
    
    // get font replacements
<span class="fc" id="L193">    m_PSFontReplacement = new Hashtable();</span>
<span class="fc" id="L194">    m_PSFontReplacement.put(&quot;SansSerif.plain&quot;, &quot;Helvetica.plain&quot;);   // SansSerif.plain is displayed as Courier in GV???</span>
<span class="fc" id="L195">    m_PSFontReplacement.put(&quot;Dialog.plain&quot;, &quot;Helvetica.plain&quot;);  // dialog is a Sans Serif font, but GV displays it as Courier???</span>
<span class="fc" id="L196">    m_PSFontReplacement.put(&quot;Microsoft Sans Serif&quot;, &quot;Helvetica.plain&quot;);  // MS Sans Serif is a Sans Serif font (hence the name!), but GV displays it as Courier???</span>
<span class="fc" id="L197">    m_PSFontReplacement.put(&quot;MicrosoftSansSerif&quot;, &quot;Helvetica.plain&quot;);  // MS Sans Serif is a Sans Serif font (hence the name!), but GV displays it as Courier???</span>
  }
  
  /** 
   * Constructor
   * Creates a new PostscriptGraphics object, given dimensions and 
   * output file.
   *
   * @param width The width of eps in points.
   * @param height The height of eps in points.
   * @param os File to send postscript to.
   */
<span class="nc" id="L209">  public PostscriptGraphics(int width, int height, OutputStream os ){</span>
    
<span class="nc" id="L211">    m_extent             = new Rectangle(0, 0, height, width);</span>
<span class="nc" id="L212">    m_printstream        = new PrintStream(os);</span>
<span class="nc" id="L213">    m_localGraphicsState = new GraphicsState();</span>
<span class="nc" id="L214">    m_psGraphicsState    = new GraphicsState();</span>
    
<span class="nc" id="L216">    Header();</span>
<span class="nc" id="L217">  }</span>
  
  /** 
   * Creates a new cloned PostscriptGraphics object.
   *
   * @param copy The PostscriptGraphics object to clone.
   */
<span class="nc" id="L224">  PostscriptGraphics(PostscriptGraphics copy){</span>
    
<span class="nc" id="L226">    m_extent             = new Rectangle(copy.m_extent);</span>
<span class="nc" id="L227">    m_printstream        = copy.m_printstream;</span>
<span class="nc" id="L228">    m_localGraphicsState = new GraphicsState(copy.m_localGraphicsState); // create a local copy of the current state</span>
<span class="nc" id="L229">    m_psGraphicsState    = copy.m_psGraphicsState; // link to global state of eps file</span>
<span class="nc" id="L230">  }</span>
  
  /**
   * Finalizes output file.
   */
  public void finished(){
<span class="nc" id="L236">    m_printstream.flush();</span>
<span class="nc" id="L237">  }</span>
  
  /**
   * Output postscript header to PrintStream, including helper macros.
   */
  private void Header(){
<span class="nc" id="L243">    m_printstream.println(&quot;%!PS-Adobe-3.0 EPSF-3.0&quot;);</span>
<span class="nc" id="L244">    m_printstream.println(&quot;%%BoundingBox: 0 0 &quot; + xScale(m_extent.width) + &quot; &quot; + yScale(m_extent.height));</span>
<span class="nc" id="L245">    m_printstream.println(&quot;%%CreationDate: &quot; + Calendar.getInstance().getTime());</span>
    
<span class="nc" id="L247">    m_printstream.println(&quot;/Oval { % x y w h filled&quot;);</span>
<span class="nc" id="L248">    m_printstream.println(&quot;gsave&quot;);</span>
<span class="nc" id="L249">    m_printstream.println(&quot;/filled exch def /h exch def /w exch def /y exch def /x exch def&quot;);</span>
<span class="nc" id="L250">    m_printstream.println(&quot;x w 2 div add y h 2 div sub translate&quot;);</span>
<span class="nc" id="L251">    m_printstream.println(&quot;1 h w div scale&quot;);</span>
<span class="nc" id="L252">    m_printstream.println(&quot;filled {0 0 moveto} if&quot;);</span>
<span class="nc" id="L253">    m_printstream.println(&quot;0 0 w 2 div 0 360 arc&quot;);</span>
<span class="nc" id="L254">    m_printstream.println(&quot;filled {closepath fill} {stroke} ifelse grestore} bind def&quot;);</span>
    
<span class="nc" id="L256">    m_printstream.println(&quot;/Rect { % x y w h filled&quot;);</span>
<span class="nc" id="L257">    m_printstream.println(&quot;/filled exch def /h exch def /w exch def /y exch def /x exch def&quot;);</span>
<span class="nc" id="L258">    m_printstream.println(&quot;newpath &quot;);</span>
<span class="nc" id="L259">    m_printstream.println(&quot;x y moveto&quot;);    </span>
<span class="nc" id="L260">    m_printstream.println(&quot;w 0 rlineto&quot;);</span>
<span class="nc" id="L261">    m_printstream.println(&quot;0 h neg rlineto&quot;);</span>
<span class="nc" id="L262">    m_printstream.println(&quot;w neg 0 rlineto&quot;);</span>
<span class="nc" id="L263">    m_printstream.println(&quot;closepath&quot;);</span>
<span class="nc" id="L264">    m_printstream.println(&quot;filled {fill} {stroke} ifelse} bind def&quot;);</span>
    
<span class="nc" id="L266">    m_printstream.println(&quot;%%BeginProlog\n%%EndProlog&quot;);</span>
<span class="nc" id="L267">    m_printstream.println(&quot;%%Page 1 1&quot;);</span>
<span class="nc" id="L268">    setFont(null); // set to default</span>
<span class="nc" id="L269">    setColor(null); // set to default</span>
<span class="nc" id="L270">    setStroke(null); // set to default</span>
<span class="nc" id="L271">  }</span>
  
  /**
   * adds the PS font name to replace and its replacement in the replacement
   * hashtable
   * 
   * @param replace       the PS font name to replace
   * @param with          the PS font name to replace the font with 
   */
  public static void addPSFontReplacement(String replace, String with) {
<span class="nc" id="L281">    m_PSFontReplacement.put(replace, with);</span>
<span class="nc" id="L282">  }</span>
  
  /**
   * Convert Java Y coordinate (0 = top) to PostScript (0 = bottom)
   * Also apply current Translation
   * @param y Java Y coordinate
   * @return translated Y to postscript
   */
  private int yTransform(int y){
<span class="nc" id="L291">    return (m_extent.height - (m_localGraphicsState.getYOffset() + y));</span>
  }
  
  /**
   * Apply current X Translation
   * @param x Java X coordinate
   * @return translated X to postscript
   */
  private int xTransform(int x){
<span class="nc" id="L300">    return (m_localGraphicsState.getXOffset() + x);</span>
  }
  
  /**
   * scales the given number with the provided scale factor
   */
  private int doScale(int number, double factor) {
<span class="nc" id="L307">    return (int) StrictMath.round(number * factor);</span>
  }
  
  /**
   * scales the given x value with current x scale factor
   */
  private int xScale(int x) {
<span class="nc" id="L314">    return doScale(x, m_localGraphicsState.getXScale());</span>
  }
  
  /**
   * scales the given y value with current y scale factor
   */
  private int yScale(int y) {
<span class="nc" id="L321">    return doScale(y, m_localGraphicsState.getYScale());</span>
  }
  
  /** Set the current eps graphics state to that of the local one
   */
  private void setStateToLocal(){
<span class="nc" id="L327">    setColor(this.getColor());</span>
<span class="nc" id="L328">    setFont(this.getFont());</span>
<span class="nc" id="L329">    setStroke(this.getStroke());</span>
<span class="nc" id="L330">  }</span>
  
  /**
   * returns a two hexadecimal representation of i, if shorter than 2 chars
   * then an additional &quot;0&quot; is put in front   
   */
  private String toHex(int i) {
    String      result;
    
<span class="nc" id="L339">    result = Integer.toHexString(i);</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">    if (result.length() &lt; 2)</span>
<span class="nc" id="L341">      result = &quot;0&quot; + result;</span>
    
<span class="nc" id="L343">    return result;</span>
  }

  /***** overridden Graphics methods *****/  
  
  /**
   * Draw a filled rectangle with the background color.
   *
   * @param x starting x coord
   * @param y starting y coord
   * @param width rectangle width
   * @param height rectangle height
   */
  public void clearRect(int x, int y, int width, int height) {
<span class="nc" id="L357">    setStateToLocal();</span>
<span class="nc" id="L358">    Color saveColor = getColor();</span>
<span class="nc" id="L359">    setColor(Color.white); // background color for page</span>
<span class="nc" id="L360">    m_printstream.println(xTransform(xScale(x)) + &quot; &quot; + yTransform(yScale(y)) + &quot; &quot; + xScale(width) + &quot; &quot; + yScale(height) + &quot; true Rect&quot;);</span>
<span class="nc" id="L361">    setColor(saveColor);</span>
<span class="nc" id="L362">  }</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L367">  public void clipRect(int x, int y, int width, int height) {}</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L372">  public void copyArea(int x, int y, int width, int height, int dx, int dy) {}</span>
  
  /**
   * Clone a PostscriptGraphics object
   */  
  public Graphics create() {
    if (DEBUG)
      m_printstream.println(&quot;%create&quot;);
<span class="nc" id="L380">    PostscriptGraphics psg = new PostscriptGraphics(this);</span>
<span class="nc" id="L381">    return(psg);</span>
  }
  
  /**
   * Not implemented
   */
<span class="nc" id="L387">  public void dispose(){}</span>
  
  /**
   * Draw an outlined rectangle with 3D effect in current pen color.
   * (Current implementation: draw simple outlined rectangle)
   *
   * @param x starting x coord
   * @param y starting y coord
   * @param width rectangle width
   * @param height rectangle height
   * @param raised True: appear raised, False: appear etched
   */
  public void draw3DRect(int x, int y, int width, int height, boolean raised){
<span class="nc" id="L400">    drawRect(x,y,width,height);</span>
<span class="nc" id="L401">  }</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L406">  public void drawArc(int x, int y, int width, int height, int startAngle, int arcAngle){}</span>
  
  /**
   * simply calls drawString(String,int,int)
   * 
   * @see #drawString(String,int,int)
   */
  public void drawBytes(byte[] data, int offset, int length, int x, int y) {
<span class="nc" id="L414">    drawString(new String(data, offset, length), x, y);</span>
<span class="nc" id="L415">  }</span>
  
  /**
   * simply calls drawString(String,int,int)
   * 
   * @see #drawString(String,int,int)
   */
  public void drawChars(char[] data, int offset, int length, int x, int y) {
<span class="nc" id="L423">    drawString(new String(data, offset, length), x, y);</span>
<span class="nc" id="L424">  }</span>
  
  /**
   * calls drawImage(Image,int,int,int,int,Color,ImageObserver)
   * 
   * @see #drawImage(Image,int,int,int,int,Color,ImageObserver)
   */
  public boolean drawImage(Image img, int x, int y, Color bgcolor, ImageObserver observer){
<span class="nc" id="L432">    return drawImage(img, x, y, img.getWidth(observer), img.getHeight(observer), bgcolor, observer);</span>
  }
  
  /**
   * calls drawImage(Image,int,int,Color,ImageObserver) with Color.WHITE as 
   * background color
   * 
   * @see #drawImage(Image,int,int,Color,ImageObserver)
   * @see Color#WHITE
   */
  public boolean drawImage(Image img, int x, int y, ImageObserver observer){
<span class="nc" id="L443">    return drawImage(img, x, y, Color.WHITE, observer);</span>
  }
  
  /**
   * PS see http://astronomy.swin.edu.au/~pbourke/geomformats/postscript/
   * Java http://show.docjava.com:8086/book/cgij/doc/ip/graphics/SimpleImageFrame.java.html
   */
  public boolean drawImage(Image img, int x, int y, int width, int height, Color bgcolor, ImageObserver observer){
    try {
      // get data from image
<span class="nc" id="L453">      int[] pixels = new int[width * height];</span>
<span class="nc" id="L454">      PixelGrabber grabber = new PixelGrabber(img, 0, 0, width, height, pixels, 0, width);</span>
<span class="nc" id="L455">      grabber.grabPixels();</span>
<span class="nc" id="L456">      ColorModel model = ColorModel.getRGBdefault();</span>
      
      // print data to ps
<span class="nc" id="L459">      m_printstream.println(&quot;gsave&quot;);</span>
<span class="nc" id="L460">      m_printstream.println(xTransform(xScale(x)) + &quot; &quot; + (yTransform(yScale(y)) - yScale(height)) + &quot; translate&quot;);</span>
<span class="nc" id="L461">      m_printstream.println(xScale(width) + &quot; &quot; + yScale(height) + &quot; scale&quot;);</span>
<span class="nc" id="L462">      m_printstream.println(width + &quot; &quot; + height + &quot; &quot; + &quot;8&quot; + &quot; [&quot; + width + &quot; 0 0 &quot; + (-height) + &quot; 0 &quot; + height + &quot;]&quot;);</span>
<span class="nc" id="L463">      m_printstream.println(&quot;{&lt;&quot;);</span>

      int index;
<span class="nc bnc" id="L466" title="All 2 branches missed.">      for (int i = 0; i &lt; height; i++) {</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">        for (int j = 0; j &lt; width; j++) {</span>
<span class="nc" id="L468">          index = i * width + j;</span>
<span class="nc" id="L469">          m_printstream.print(toHex(model.getRed(pixels[index])));</span>
<span class="nc" id="L470">          m_printstream.print(toHex(model.getGreen(pixels[index])));</span>
<span class="nc" id="L471">          m_printstream.print(toHex(model.getBlue(pixels[index])));</span>
        }
<span class="nc" id="L473">        m_printstream.println();</span>
      }
      
<span class="nc" id="L476">      m_printstream.println(&quot;&gt;}&quot;);</span>
<span class="nc" id="L477">      m_printstream.println(&quot;false 3 colorimage&quot;);</span>
<span class="nc" id="L478">      m_printstream.println(&quot;grestore&quot;);</span>
<span class="nc" id="L479">      return true;</span>
    }
<span class="nc" id="L481">    catch (Exception e) {</span>
<span class="nc" id="L482">      e.printStackTrace();</span>
<span class="nc" id="L483">      return false;</span>
    }
  }
  
  /**
   * calls drawImage(Image,int,int,int,int,Color,ImageObserver) with the color 
   * WHITE as background
   * 
   * @see #drawImage(Image,int,int,int,int,Color,ImageObserver)
   * @see Color#WHITE
   */
  public boolean drawImage(Image img, int x, int y, int width, int height, ImageObserver observer){
<span class="nc" id="L495">    return drawImage(img, x, y, width, height, Color.WHITE, observer);</span>
  }
  
  /**
   * Not implemented
   */
  public boolean drawImage(Image img, int dx1, int dy1, int dx2, int dy2, int sx1, int sy1, int sx2, int sy2, Color bgcolor, ImageObserver  observer){
<span class="nc" id="L502">    return false;</span>
  }
  
  /**
   * calls drawImage(Image,int,int,int,int,int,int,int,int,Color,ImageObserver)
   * with Color.WHITE as background color
   * 
   * @see #drawImage(Image,int,int,int,int,int,int,int,int,Color,ImageObserver)
   */
  public boolean drawImage(Image img, int dx1, int dy1, int dx2, int dy2, int sx1, int sy1, int sx2, int sy2, ImageObserver observer){
<span class="nc" id="L512">    return drawImage(img, dx1, dy1, dx2, dy2, sx1, sy1, sx2, sy2, Color.WHITE, observer);</span>
  }
  
  
  /**
   * Draw a line in current pen color.
   *
   * @param x1 starting x coord
   * @param y1 starting y coord
   * @param x2 ending x coord
   * @param y2 ending y coord
   */
  public void drawLine(int x1, int y1, int x2, int y2){
<span class="nc" id="L525">    setStateToLocal();</span>
<span class="nc" id="L526">    m_printstream.println(xTransform(xScale(x1)) + &quot; &quot; + yTransform(yScale(y1)) + &quot; moveto &quot; + xTransform(xScale(x2)) + &quot; &quot; + yTransform(yScale(y2)) + &quot; lineto stroke&quot;);</span>
<span class="nc" id="L527">  }</span>
  
  /**
   * Draw an Oval outline in current pen color.
   *
   * @param x x-axis center of oval
   * @param y y-axis center of oval
   * @param width oval width
   * @param height oval height
   */
  public void drawOval(int x, int y, int width, int height){
<span class="nc" id="L538">    setStateToLocal();</span>
<span class="nc" id="L539">    m_printstream.println(xTransform(xScale(x)) + &quot; &quot; + yTransform(yScale(y)) + &quot; &quot; + xScale(width) + &quot; &quot; + yScale(height) + &quot; false Oval&quot;);</span>
<span class="nc" id="L540">  }</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L545">  public void drawPolygon(int[] xPoints, int[] yPoints, int nPoints){}</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L550">  public void drawPolyline(int[] xPoints, int[] yPoints, int nPoints){}</span>
  
  /**
   * Draw an outlined rectangle in current pen color.
   *
   * @param x starting x coord
   * @param y starting y coord
   * @param width rectangle width
   * @param height rectangle height
   */
  public void drawRect(int x, int y, int width, int height){   
<span class="nc" id="L561">    setStateToLocal();</span>
<span class="nc" id="L562">    m_printstream.println(xTransform(xScale(x)) + &quot; &quot; + yTransform(yScale(y)) + &quot; &quot; + xScale(width) + &quot; &quot; + yScale(height) + &quot; false Rect&quot;);   </span>
<span class="nc" id="L563">  }</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L568">  public void drawRoundRect(int x, int y, int width, int height, int arcWidth, int arcHeight){}</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L573">  public void drawString(AttributedCharacterIterator iterator, int x, int y){}</span>
  
  /**
   * Escapes brackets in the string with backslashes.
   * 
   * @param s the string to escape
   * @return the escaped string
   */
  protected String escape(String s) {
    StringBuffer	result;
    int			i;
    
<span class="nc" id="L585">    result = new StringBuffer();</span>
    
<span class="nc bnc" id="L587" title="All 2 branches missed.">    for (i = 0; i &lt; s.length(); i++) {</span>
<span class="nc bnc" id="L588" title="All 4 branches missed.">      if ( (s.charAt(i) == '(') || (s.charAt(i) == ')') )</span>
<span class="nc" id="L589">	result.append('\\');</span>
<span class="nc" id="L590">      result.append(s.charAt(i));</span>
    }
    
<span class="nc" id="L593">    return result.toString();</span>
  }
  
  /**
   * Draw text in current pen color.
   *
   * @param str Text to output
   * @param x starting x coord
   * @param y starting y coord
   */
  public void drawString(String str, int x, int y){
<span class="nc" id="L604">    setStateToLocal();</span>
<span class="nc" id="L605">    m_printstream.println(xTransform(xScale(x)) + &quot; &quot; + yTransform(yScale(y)) + &quot; moveto&quot; + &quot; (&quot; + escape(str) + &quot;) show stroke&quot;);</span>
<span class="nc" id="L606">  }</span>
  
  /**
   * Draw a filled rectangle with 3D effect in current pen color.
   * (Current implementation: draw simple filled rectangle)
   *
   * @param x starting x coord
   * @param y starting y coord
   * @param width rectangle width
   * @param height rectangle height
   * @param raised True: appear raised, False: appear etched
   */
  public void fill3DRect(int x, int y, int width, int height, boolean raised){
<span class="nc" id="L619">    fillRect(x, y, width, height);</span>
<span class="nc" id="L620">  }</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L625">  public void fillArc(int x, int y, int width, int height, int startAngle, int arcAngle){}</span>
  
  /**
   * Draw a filled Oval in current pen color.
   *
   * @param x x-axis center of oval
   * @param y y-axis center of oval
   * @param width oval width
   * @param height oval height
   */
  public void fillOval(int x, int y, int width, int height){
<span class="nc" id="L636">    setStateToLocal();</span>
<span class="nc" id="L637">    m_printstream.println(xTransform(xScale(x)) + &quot; &quot; + yTransform(yScale(y)) + &quot; &quot; + xScale(width) + &quot; &quot; + yScale(height) + &quot; true Oval&quot;);</span>
<span class="nc" id="L638">  }</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L643">  public void fillPolygon(int[] xPoints, int[] yPoints, int nPoints){}</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L648">  public void fillPolygon(Polygon p){}</span>
  
  /**
   * Draw a filled rectangle in current pen color.
   *
   * @param x starting x coord
   * @param y starting y coord
   * @param width rectangle width
   * @param height rectangle height
   */
  
  public void fillRect(int x, int y, int width, int height){
<span class="nc bnc" id="L660" title="All 4 branches missed.">    if (width == m_extent.width &amp;&amp; height == m_extent.height) {</span>
<span class="nc" id="L661">      clearRect(x, y, width, height); // if we're painting the entire background, just make it white</span>
    } else {
      if (DEBUG)
        m_printstream.println(&quot;% fillRect&quot;);
<span class="nc" id="L665">      setStateToLocal();</span>
<span class="nc" id="L666">      m_printstream.println(xTransform(xScale(x)) + &quot; &quot; + yTransform(yScale(y)) + &quot; &quot; + xScale(width) + &quot; &quot; + yScale(height) + &quot; true Rect&quot;);</span>
    }
<span class="nc" id="L668">  }</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L673">  public void fillRoundRect(int x, int y, int width, int height, int arcWidth, int arcHeight){}</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L678">  public void finalize(){}</span>
  
  /**
   * Not implemented
   */
  public Shape getClip(){
<span class="nc" id="L684">    return(null);</span>
  }
  
  /**
   * This returns the full current drawing area
   * @return full drawing area
   */
  public Rectangle getClipBounds(){
<span class="nc" id="L692">    return(new Rectangle(0, 0, m_extent.width, m_extent.height));</span>
  }
  
  /**
   * This returns the full current drawing area
   * @return full drawing area
   */
  public Rectangle getClipBounds(Rectangle r) {
<span class="nc" id="L700">    r.setBounds(0, 0, m_extent.width, m_extent.height);</span>
<span class="nc" id="L701">    return r;</span>
  }
  
  /**
   * Not implemented
   */
<span class="nc" id="L707">  public Rectangle getClipRect() {return null;}</span>
  
  /**
   * Get current pen color.
   *
   * @return current pen color.
   */
  public Color getColor(){
<span class="nc" id="L715">    return (m_localGraphicsState.getColor());</span>
  }
  
  /**
   * Get current font.
   *
   * @return current font.
   */
  public Font getFont(){
<span class="nc" id="L724">    return (m_localGraphicsState.getFont());</span>
  }
  
  /**
   * Get Font metrics
   *
   * @param f Font 
   * @return Font metrics.
   */
  public FontMetrics getFontMetrics(Font f){
<span class="nc" id="L734">    return(Toolkit.getDefaultToolkit().getFontMetrics(f));  </span>
    
  }
  
  /**
   * Not implemented
   */
<span class="nc" id="L741">  public void setClip(int x, int y, int width, int height) {}</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L746">  public void setClip(Shape clip){}</span>
  
  /**
   * Set current pen color. Default to black if null.
   *
   * @param c new pen color.
   */
  public void setColor(Color c){
<span class="nc bnc" id="L754" title="All 2 branches missed.">    if (c != null){</span>
<span class="nc" id="L755">      m_localGraphicsState.setColor(c);</span>
<span class="nc bnc" id="L756" title="All 2 branches missed.">      if (m_psGraphicsState.getColor().equals(c)) {</span>
<span class="nc" id="L757">        return;</span>
      }
<span class="nc" id="L759">      m_psGraphicsState.setColor(c);</span>
    } else {
<span class="nc" id="L761">      m_localGraphicsState.setColor(Color.black);</span>
<span class="nc" id="L762">      m_psGraphicsState.setColor(getColor());</span>
    }
<span class="nc" id="L764">    m_printstream.print(getColor().getRed()/255.0);</span>
<span class="nc" id="L765">    m_printstream.print(&quot; &quot;);</span>
<span class="nc" id="L766">    m_printstream.print(getColor().getGreen()/255.0);</span>
<span class="nc" id="L767">    m_printstream.print(&quot; &quot;);</span>
<span class="nc" id="L768">    m_printstream.print(getColor().getBlue()/255.0);</span>
<span class="nc" id="L769">    m_printstream.println(&quot; setrgbcolor&quot;);</span>
<span class="nc" id="L770">  }</span>
  
  /**
   * replaces the font (PS name) if necessary and returns the new name
   */
  private static String replacePSFont(String font) {
    String      result;
    
<span class="nc" id="L778">    result = font;</span>
    
    // do we have to replace it? -&gt; same style, size
<span class="nc bnc" id="L781" title="All 2 branches missed.">    if (m_PSFontReplacement.containsKey(font)) {</span>
<span class="nc" id="L782">      result = m_PSFontReplacement.get(font).toString();</span>
      if (DEBUG)
        System.out.println(Messages.getInstance().getString(&quot;PostscriptGraphics_ReplacePSFont_Text_First&quot;) + font + Messages.getInstance().getString(&quot;PostscriptGraphics_ReplacePSFont_Text_Second&quot;) + result +  Messages.getInstance().getString(&quot;PostscriptGraphics_ReplacePSFont_Text_Third&quot;));
    }
    
<span class="nc" id="L787">    return result;</span>
  }
  
  /**
   * Set current font. Default to Plain Courier 11 if null.
   *
   * @param font new font.
   */
  public void setFont(Font font){
    
<span class="nc bnc" id="L797" title="All 2 branches missed.">    if (font != null){</span>
<span class="nc" id="L798">      m_localGraphicsState.setFont(font);</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">      if (   font.getName().equals(m_psGraphicsState.getFont().getName())</span>
<span class="nc bnc" id="L800" title="All 2 branches missed.">          &amp;&amp; (m_psGraphicsState.getFont().getStyle() == font.getStyle())</span>
<span class="nc bnc" id="L801" title="All 2 branches missed.">          &amp;&amp; (m_psGraphicsState.getFont().getSize() == yScale(font.getSize())))</span>
<span class="nc" id="L802">        return;</span>
<span class="nc" id="L803">      m_psGraphicsState.setFont(new Font(font.getName(), font.getStyle(), yScale(getFont().getSize())));</span>
    } 
    else {
<span class="nc" id="L806">      m_localGraphicsState.setFont(new Font (&quot;Courier&quot;, Font.PLAIN, 11));</span>
<span class="nc" id="L807">      m_psGraphicsState.setFont(getFont());</span>
    }
    
<span class="nc" id="L810">    m_printstream.println(&quot;/(&quot; + replacePSFont(getFont().getPSName()) + &quot;)&quot; + &quot; findfont&quot;);</span>
<span class="nc" id="L811">    m_printstream.println(yScale(getFont().getSize()) + &quot; scalefont setfont&quot;);        </span>
<span class="nc" id="L812">  }</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L817">  public void setPaintMode(){}</span>
  
  /**
   * Not implemented
   */
<span class="nc" id="L822">  public void setXORMode(Color c1){}</span>
  
  /**
   * Translates the origin of the graphics context to the point (x, y) in the 
   * current coordinate system. Modifies this graphics context so that its new 
   * origin corresponds to the point (x, y) in this graphics context's original 
   * coordinate system. All coordinates used in subsequent rendering operations 
   * on this graphics context will be relative to this new origin.
   * 
   * @param x the x coordinate.
   * @param y the y coordinate.
   */
  public void translate(int x, int y){
    if (DEBUG)
      System.out.println(Messages.getInstance().getString(&quot;PostscriptGraphics_Translate_Text_First&quot;) + x + Messages.getInstance().getString(&quot;PostscriptGraphics_Translate_Text_Second&quot;) + y);
<span class="nc" id="L837">    m_localGraphicsState.setXOffset(m_localGraphicsState.getXOffset() + xScale(x));</span>
<span class="nc" id="L838">    m_localGraphicsState.setYOffset(m_localGraphicsState.getYOffset() + yScale(y));</span>
<span class="nc" id="L839">    m_psGraphicsState.setXOffset(m_psGraphicsState.getXOffset() + xScale(x));</span>
<span class="nc" id="L840">    m_psGraphicsState.setYOffset(m_psGraphicsState.getYOffset() + yScale(y));</span>
<span class="nc" id="L841">  }</span>
  /***** END overridden Graphics methods *****/
  
  /***** START overridden Graphics2D methods *****/
  
  public FontRenderContext getFontRenderContext(){
<span class="nc" id="L847">    return (new FontRenderContext(null,true,true));</span>
  }
<span class="nc" id="L849">  public void clip(Shape s){}</span>
  public Stroke getStroke(){
<span class="nc" id="L851">    return(m_localGraphicsState.getStroke());</span>
  }
  
  public Color getBackground(){
<span class="nc" id="L855">    return(Color.white);</span>
  }
<span class="nc" id="L857">  public void setBackground(Color c){}</span>
  public Composite getComposite(){
<span class="nc" id="L859">    return(AlphaComposite.getInstance(AlphaComposite.SRC));</span>
  }
  public Paint getPaint(){
<span class="nc" id="L862">    return((Paint) (new Color(getColor().getRed(),getColor().getGreen(),getColor().getBlue())));</span>
  }
  public AffineTransform getTransform(){
<span class="nc" id="L865">    return(new AffineTransform());</span>
  }
<span class="nc" id="L867">  public void setTransform(AffineTransform at) {}</span>
<span class="nc" id="L868">  public void transform(AffineTransform at) {}</span>
<span class="nc" id="L869">  public void shear(double d1, double d2){}</span>
  public void scale(double d1, double d2) {
<span class="nc" id="L871">    m_localGraphicsState.setXScale(d1);</span>
<span class="nc" id="L872">    m_localGraphicsState.setYScale(d2);</span>
    if (DEBUG)
      System.err.println(Messages.getInstance().getString(&quot;PostscriptGraphics_Scale_Error_Text_First&quot;) + d1 + Messages.getInstance().getString(&quot;PostscriptGraphics_Scale_Error_Text_Second&quot;) + d2);
<span class="nc" id="L875">  }</span>
<span class="nc" id="L876">  public void rotate(double d1, double d2, double d3){}</span>
<span class="nc" id="L877">  public void rotate(double d1){}</span>
<span class="nc" id="L878">  public void translate(double d1, double d2) {}</span>
  public RenderingHints getRenderingHints(){
<span class="nc" id="L880">    return(new RenderingHints(null));</span>
  }
<span class="nc" id="L882">  public void addRenderingHints(Map m){}</span>
<span class="nc" id="L883">  public void setRenderingHints(Map m){}</span>
  public Object getRenderingHint(RenderingHints.Key key){
<span class="nc" id="L885">    return(null);</span>
  }
<span class="nc" id="L887">  public void setRenderingHint(RenderingHints.Key key, Object o){}</span>
  public void setStroke(Stroke s){
<span class="nc bnc" id="L889" title="All 2 branches missed.">    if (s != null){</span>
<span class="nc" id="L890">      m_localGraphicsState.setStroke(s);</span>
<span class="nc bnc" id="L891" title="All 2 branches missed.">      if (s.equals(m_psGraphicsState.getStroke())) {</span>
<span class="nc" id="L892">        return;</span>
      }
<span class="nc" id="L894">      m_psGraphicsState.setStroke(s); </span>
    } else {
<span class="nc" id="L896">      m_localGraphicsState.setStroke(new BasicStroke());</span>
<span class="nc" id="L897">      m_psGraphicsState.setStroke(getStroke());</span>
    }
    // ouput postscript here to set stroke.
<span class="nc" id="L900">  }</span>
  public void setPaint(Paint p){
<span class="nc" id="L902">  }</span>
<span class="nc" id="L903">  public void setComposite(Composite c){}</span>
  public GraphicsConfiguration getDeviceConfiguration(){
<span class="nc" id="L905">    GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();</span>
<span class="nc" id="L906">    GraphicsDevice gd = ge.getDefaultScreenDevice();</span>
<span class="nc" id="L907">    return(gd.getDefaultConfiguration()); </span>
  }
  public boolean hit(Rectangle r, Shape s, boolean onstroke){
<span class="nc" id="L910">    return(false);</span>
  }
<span class="nc" id="L912">  public void fill(Shape s){}</span>
<span class="nc" id="L913">  public void drawGlyphVector(GlyphVector gv, float f1, float f2){} </span>
<span class="nc" id="L914">  public void drawString(AttributedCharacterIterator aci, float f1, float f2){}</span>
  public void drawString(String str, float x, float y){
<span class="nc" id="L916">    drawString(str,(int)x, (int)y);</span>
<span class="nc" id="L917">  }</span>
<span class="nc" id="L918">  public void drawRenderableImage(RenderableImage ri, AffineTransform at){}</span>
<span class="nc" id="L919">  public void drawRenderedImage(RenderedImage ri, AffineTransform af){}</span>
<span class="nc" id="L920">  public void drawImage(BufferedImage bi, BufferedImageOp bio, int i1, int i2){}</span>
  public boolean drawImage(Image im, AffineTransform at, ImageObserver io){
<span class="nc" id="L922">    return(false);</span>
  }
<span class="nc" id="L924">  public void draw(Shape s){}</span>
  /***** END *****/
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>