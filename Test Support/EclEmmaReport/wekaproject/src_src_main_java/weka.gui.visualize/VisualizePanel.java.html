<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>VisualizePanel.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.gui.visualize</a> &gt; <span class="el_source">VisualizePanel.java</span></div><h1>VisualizePanel.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">/*</span>
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 *    VisualizePanel.java
 *    Copyright (C) 1999 University of Waikato, Hamilton, New Zealand
 *
 */

package weka.gui.visualize;

import weka.core.Attribute;
import weka.core.FastVector;
import weka.core.Instance;
import weka.core.Instances;
import weka.gui.ExtensionFileFilter;
import weka.gui.Logger;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.GridLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.InputEvent;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.MouseMotionAdapter;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.Writer;
import java.util.Random;

import javax.swing.BorderFactory;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JSlider;
import javax.swing.SwingConstants;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;
import javax.swing.filechooser.FileFilter;

/** 
 * This panel allows the user to visualize a dataset (and if provided) a
 * classifier's/clusterer's predictions in two dimensions.
 *
 * If the user selects a nominal attribute as the colouring attribute then
 * each point is drawn in a colour that corresponds to the discrete value
 * of that attribute for the instance. If the user selects a numeric
 * attribute to colour on, then the points are coloured using a spectrum
 * ranging from blue to red (low values to high).
 *
 * When a classifier's predictions are supplied they are plotted in one
 * of two ways (depending on whether the class is nominal or numeric).&lt;br&gt;
 * For nominal class: an error made by a classifier is plotted as a square
 * in the colour corresponding to the class it predicted.&lt;br&gt;
 * For numeric class: predictions are plotted as varying sized x's, where
 * the size of the x is related to the magnitude of the error.
 *
 * @author Mark Hall (mhall@cs.waikato.ac.nz)
 * @author Malcolm Ware (mfw4@cs.waikato.ac.nz)
 * @version $Revision: 7406 $
 */
public class VisualizePanel
  extends PrintablePanel {

  /** for serialization */
  private static final long serialVersionUID = 240108358588153943L;

  /** Inner class to handle plotting */
  protected class PlotPanel
    extends PrintablePanel
    implements Plot2DCompanion {

    /** for serialization */
    private static final long serialVersionUID = -4823674171136494204L;

    /** The actual generic plotting panel */
<span class="nc" id="L106">    protected Plot2D m_plot2D = new Plot2D();</span>

    /** The instances from the master plot */
<span class="nc" id="L109">    protected Instances m_plotInstances=null;</span>

    /** The master plot */
<span class="nc" id="L112">    protected PlotData2D m_originalPlot=null;</span>
    
    /** Indexes of the attributes to go on the x and y axis and the attribute
	to use for colouring and the current shape for drawing */
<span class="nc" id="L116">    protected int m_xIndex=0;</span>
<span class="nc" id="L117">    protected int m_yIndex=0;</span>
<span class="nc" id="L118">    protected int m_cIndex=0;</span>
<span class="nc" id="L119">    protected int m_sIndex=0;</span>

    /**the offsets of the axes once label metrics are calculated */
<span class="nc" id="L122">    private int m_XaxisStart=0;</span>
<span class="nc" id="L123">    private int m_YaxisStart=0;</span>
<span class="nc" id="L124">    private int m_XaxisEnd=0;</span>
<span class="nc" id="L125">    private int m_YaxisEnd=0;</span>

    /** True if the user is currently dragging a box. */
    private boolean m_createShape;
    
    /** contains all the shapes that have been drawn for these attribs */
    private FastVector m_shapes;

    /** contains the points of the shape currently being drawn. */
    private FastVector m_shapePoints;

    /** contains the position of the mouse (used for rubberbanding). */
    private Dimension m_newMousePos;

    /** Constructor */
<span class="nc" id="L140">    public PlotPanel() {</span>
<span class="nc" id="L141">      this.setBackground(m_plot2D.getBackground());</span>
<span class="nc" id="L142">      this.setLayout(new BorderLayout());</span>
<span class="nc" id="L143">      this.add(m_plot2D, BorderLayout.CENTER);</span>
<span class="nc" id="L144">      m_plot2D.setPlotCompanion(this);</span>

<span class="nc" id="L146">      m_createShape = false;        </span>
<span class="nc" id="L147">      m_shapes = null;////</span>
<span class="nc" id="L148">      m_shapePoints = null;</span>
<span class="nc" id="L149">      m_newMousePos = new Dimension();</span>

<span class="nc" id="L151">      this.addMouseListener(new MouseAdapter() {</span>
	  ///////      
	  public void mousePressed(MouseEvent e) {
<span class="nc bnc" id="L154" title="All 2 branches missed.">	    if ((e.getModifiers() &amp; MouseEvent.BUTTON1_MASK) == MouseEvent.BUTTON1_MASK) {</span>
	      //
<span class="nc bnc" id="L156" title="All 2 branches missed.">	      if (m_sIndex == 0) {</span>
		//do nothing it will get dealt to in the clicked method
	      }
<span class="nc bnc" id="L159" title="All 2 branches missed.">	      else if (m_sIndex == 1) {</span>
<span class="nc" id="L160">		m_createShape = true;</span>
<span class="nc" id="L161">		m_shapePoints = new FastVector(5);</span>
<span class="nc" id="L162">		m_shapePoints.addElement(new Double(m_sIndex));</span>
<span class="nc" id="L163">		m_shapePoints.addElement(new Double(e.getX()));</span>
<span class="nc" id="L164">		m_shapePoints.addElement(new Double(e.getY()));</span>
<span class="nc" id="L165">		m_shapePoints.addElement(new Double(e.getX()));</span>
<span class="nc" id="L166">		m_shapePoints.addElement(new Double(e.getY()));</span>
		//		Graphics g = PlotPanel.this.getGraphics();
<span class="nc" id="L168">		Graphics g = m_plot2D.getGraphics();</span>
<span class="nc" id="L169">		g.setColor(Color.black);</span>
<span class="nc" id="L170">		g.setXORMode(Color.white);</span>
<span class="nc" id="L171">		g.drawRect(((Double)m_shapePoints.elementAt(1)).intValue(),</span>
<span class="nc" id="L172">			   ((Double)m_shapePoints.elementAt(2)).intValue(),</span>
<span class="nc" id="L173">			   ((Double)m_shapePoints.elementAt(3)).intValue() -</span>
<span class="nc" id="L174">			   ((Double)m_shapePoints.elementAt(1)).intValue(), </span>
<span class="nc" id="L175">			   ((Double)m_shapePoints.elementAt(4)).intValue() -</span>
<span class="nc" id="L176">			   ((Double)m_shapePoints.elementAt(2)).intValue());</span>
<span class="nc" id="L177">		g.dispose();</span>
	      }
	      //System.out.println(&quot;clicked&quot;);
	    }
	    //System.out.println(&quot;clicked&quot;);
<span class="nc" id="L182">	  }</span>
	  //////
	  public void mouseClicked(MouseEvent e) {
	    
<span class="nc bnc" id="L186" title="All 4 branches missed.">	    if ((m_sIndex == 2 || m_sIndex == 3) &amp;&amp; </span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">		(m_createShape || </span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">		 (e.getModifiers() &amp; MouseEvent.BUTTON1_MASK) == MouseEvent.BUTTON1_MASK)) {</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">	      if (m_createShape) {</span>
		//then it has been started already.

<span class="nc" id="L192">		Graphics g = m_plot2D.getGraphics();</span>
<span class="nc" id="L193">		g.setColor(Color.black);</span>
<span class="nc" id="L194">		g.setXORMode(Color.white);</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">		if ((e.getModifiers() &amp; MouseEvent.BUTTON1_MASK) == MouseEvent.BUTTON1_MASK &amp;&amp;</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">                    !e.isAltDown()) {</span>
<span class="nc" id="L197">		  m_shapePoints.addElement(new </span>
<span class="nc" id="L198">		    Double(m_plot2D.convertToAttribX(e.getX())));</span>
		  
<span class="nc" id="L200">		  m_shapePoints.addElement(new </span>
<span class="nc" id="L201">		    Double(m_plot2D.convertToAttribY(e.getY())));</span>
		  
<span class="nc" id="L203">		  m_newMousePos.width = e.getX();</span>
<span class="nc" id="L204">		  m_newMousePos.height = e.getY();</span>
<span class="nc" id="L205">		  g.drawLine((int)Math.ceil</span>
<span class="nc" id="L206">			     (m_plot2D.convertToPanelX</span>
<span class="nc" id="L207">			      (((Double)m_shapePoints.</span>
<span class="nc" id="L208">				elementAt(m_shapePoints.size() - 2)).</span>
<span class="nc" id="L209">			       doubleValue())),</span>
			     
<span class="nc" id="L211">			     (int)Math.ceil</span>
<span class="nc" id="L212">			     (m_plot2D.convertToPanelY</span>
<span class="nc" id="L213">			      (((Double)m_shapePoints.</span>
<span class="nc" id="L214">				elementAt(m_shapePoints.size() - 1)).</span>
<span class="nc" id="L215">			       doubleValue())),</span>
<span class="nc" id="L216">			     m_newMousePos.width, m_newMousePos.height);</span>
		  
		}
<span class="nc bnc" id="L219" title="All 2 branches missed.">		else if (m_sIndex == 3) {</span>
		  //then extend the lines to infinity 
		  //(100000 or so should be enough).
		  //the area is selected by where the user right clicks 
		  //the mouse button
		  
<span class="nc" id="L225">		  m_createShape = false;</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">		  if (m_shapePoints.size() &gt;= 5) {</span>
<span class="nc" id="L227">		    double cx = Math.ceil</span>
<span class="nc" id="L228">		      (m_plot2D.convertToPanelX</span>
<span class="nc" id="L229">		       (((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L230">			 (m_shapePoints.size() - 4)).doubleValue()));</span>
		    
<span class="nc" id="L232">		    double cx2 = Math.ceil</span>
<span class="nc" id="L233">		      (m_plot2D.convertToPanelX</span>
<span class="nc" id="L234">		       (((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L235">			 (m_shapePoints.size() - 2)).doubleValue())) - </span>
<span class="nc" id="L236">		      cx;</span>
		    
<span class="nc" id="L238">		    cx2 *= 50000;</span>
		    
<span class="nc" id="L240">		    double cy = Math.ceil</span>
<span class="nc" id="L241">		      (m_plot2D.</span>
<span class="nc" id="L242">		       convertToPanelY(((Double)m_shapePoints.</span>
<span class="nc" id="L243">					elementAt(m_shapePoints.size() - 3)).</span>
<span class="nc" id="L244">				       doubleValue()));</span>
<span class="nc" id="L245">		    double cy2 = Math.ceil</span>
<span class="nc" id="L246">		      (m_plot2D.convertToPanelY(((Double)m_shapePoints.</span>
<span class="nc" id="L247">					  elementAt(m_shapePoints.size() - 1)).</span>
<span class="nc" id="L248">					  doubleValue())) - cy;</span>
<span class="nc" id="L249">		    cy2 *= 50000;</span>
			    
		    
<span class="nc" id="L252">		    double cxa = Math.ceil(m_plot2D.convertToPanelX</span>
<span class="nc" id="L253">					   (((Double)m_shapePoints.</span>
<span class="nc" id="L254">					     elementAt(3)).</span>
<span class="nc" id="L255">					    doubleValue()));</span>
<span class="nc" id="L256">		    double cxa2 = Math.ceil(m_plot2D.convertToPanelX</span>
<span class="nc" id="L257">					    (((Double)m_shapePoints.</span>
<span class="nc" id="L258">					      elementAt(1)).</span>
<span class="nc" id="L259">					     doubleValue())) - cxa;</span>
<span class="nc" id="L260">		    cxa2 *= 50000;</span>
		    
		    
<span class="nc" id="L263">		    double cya = Math.ceil</span>
<span class="nc" id="L264">		      (m_plot2D.convertToPanelY</span>
<span class="nc" id="L265">		       (((Double)m_shapePoints.elementAt(4)).</span>
<span class="nc" id="L266">			doubleValue()));</span>
<span class="nc" id="L267">		    double cya2 = Math.ceil</span>
<span class="nc" id="L268">		      (m_plot2D.convertToPanelY</span>
<span class="nc" id="L269">		       (((Double)m_shapePoints.elementAt(2)).</span>
<span class="nc" id="L270">			doubleValue())) - cya;</span>
		    
<span class="nc" id="L272">		    cya2 *= 50000;</span>
		    
<span class="nc" id="L274">		    m_shapePoints.setElementAt</span>
<span class="nc" id="L275">		      (new Double(m_plot2D.convertToAttribX(cxa2 + cxa)), 1);</span>
		    
<span class="nc" id="L277">		    m_shapePoints.setElementAt</span>
<span class="nc" id="L278">		      (new Double(m_plot2D.convertToAttribY(cy2 + cy)), </span>
<span class="nc" id="L279">		       m_shapePoints.size() - 1);</span>
		    
<span class="nc" id="L281">		    m_shapePoints.setElementAt</span>
<span class="nc" id="L282">		      (new Double(m_plot2D.convertToAttribX(cx2 + cx)), </span>
<span class="nc" id="L283">		       m_shapePoints.size() - 2);</span>
		    
<span class="nc" id="L285">		    m_shapePoints.setElementAt</span>
<span class="nc" id="L286">		      (new Double(m_plot2D.convertToAttribY(cya2 + cya)), 2);</span>
		    
		    
		    //determine how infinity line should be built
		    
<span class="nc" id="L291">		    cy = Double.POSITIVE_INFINITY;</span>
<span class="nc" id="L292">		    cy2 = Double.NEGATIVE_INFINITY;</span>
<span class="nc" id="L293">		    if (((Double)m_shapePoints.elementAt(1)).</span>
<span class="nc" id="L294">			doubleValue() &gt; </span>
<span class="nc" id="L295">			((Double)m_shapePoints.elementAt(3)).</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">			doubleValue()) {</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">		      if (((Double)m_shapePoints.elementAt(2)).</span>
<span class="nc" id="L298">			  doubleValue() == </span>
<span class="nc" id="L299">			  ((Double)m_shapePoints.elementAt(4)).</span>
<span class="nc" id="L300">			  doubleValue()) {</span>
<span class="nc" id="L301">			cy = ((Double)m_shapePoints.elementAt(2)).</span>
<span class="nc" id="L302">			  doubleValue();</span>
		      }
		    }
<span class="nc" id="L305">		    if (((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L306">			 (m_shapePoints.size() - 2)).doubleValue() &gt; </span>
<span class="nc" id="L307">			((Double)m_shapePoints.elementAt</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">			 (m_shapePoints.size() - 4)).doubleValue()) {</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">		      if (((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L310">			   (m_shapePoints.size() - 3)).</span>
<span class="nc" id="L311">			  doubleValue() == </span>
<span class="nc" id="L312">			  ((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L313">			   (m_shapePoints.size() - 1)).doubleValue()) {</span>
<span class="nc" id="L314">			cy2 = ((Double)m_shapePoints.lastElement()).</span>
<span class="nc" id="L315">			  doubleValue();</span>
		      }
		    }
<span class="nc" id="L318">		    m_shapePoints.addElement(new Double(cy));</span>
<span class="nc" id="L319">		    m_shapePoints.addElement(new Double(cy2));</span>
		    
<span class="nc bnc" id="L321" title="All 2 branches missed.">		    if (!inPolyline(m_shapePoints, m_plot2D.convertToAttribX</span>
<span class="nc" id="L322">				    (e.getX()), </span>
<span class="nc" id="L323">				    m_plot2D.convertToAttribY(e.getY()))) {</span>
<span class="nc" id="L324">		      Double tmp = (Double)m_shapePoints.</span>
<span class="nc" id="L325">			elementAt(m_shapePoints.size() - 2);</span>
<span class="nc" id="L326">		      m_shapePoints.setElementAt</span>
<span class="nc" id="L327">			(m_shapePoints.lastElement(), </span>
<span class="nc" id="L328">			 m_shapePoints.size() - 2);</span>
<span class="nc" id="L329">		      m_shapePoints.setElementAt</span>
<span class="nc" id="L330">			(tmp, m_shapePoints.size() - 1);</span>
		    }
		    
<span class="nc bnc" id="L333" title="All 2 branches missed.">		    if (m_shapes == null) {</span>
<span class="nc" id="L334">		      m_shapes = new FastVector(4);</span>
		    }
<span class="nc" id="L336">		    m_shapes.addElement(m_shapePoints);</span>

<span class="nc" id="L338">		    m_submit.setText(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_MouseClicked_Submit_SetText_Text_First&quot;));</span>
<span class="nc" id="L339">		    m_submit.setActionCommand(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_MouseClicked_Submit_SetActionCommand_Text_First&quot;));</span>
		    
<span class="nc" id="L341">		    m_submit.setEnabled(true);</span>
		  }
		  
<span class="nc" id="L344">		  m_shapePoints = null;</span>
<span class="nc" id="L345">		  PlotPanel.this.repaint();</span>
		  
		}
		else {
		  //then close the shape
<span class="nc" id="L350">		  m_createShape = false;</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">		  if (m_shapePoints.size() &gt;= 7) {</span>
<span class="nc" id="L352">		    m_shapePoints.addElement(m_shapePoints.elementAt(1));</span>
<span class="nc" id="L353">		    m_shapePoints.addElement(m_shapePoints.elementAt(2));</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">		    if (m_shapes == null) {</span>
<span class="nc" id="L355">		      m_shapes = new FastVector(4);</span>
		    }
<span class="nc" id="L357">		    m_shapes.addElement(m_shapePoints);</span>
			   
<span class="nc" id="L359">		    m_submit.setText(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_MouseClicked_Submit_SetText_Text_Second&quot;));</span>
<span class="nc" id="L360">		    m_submit.setActionCommand(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_MouseClicked_Submit_SetActionCommand_Text_Second&quot;));</span>
		    
<span class="nc" id="L362">		    m_submit.setEnabled(true);</span>
		  }
<span class="nc" id="L364">		  m_shapePoints = null;</span>
<span class="nc" id="L365">		  PlotPanel.this.repaint();</span>
		}
<span class="nc" id="L367">		g.dispose();</span>
		//repaint();
	      }
<span class="nc bnc" id="L370" title="All 2 branches missed.">	      else if ((e.getModifiers() &amp; MouseEvent.BUTTON1_MASK) == MouseEvent.BUTTON1_MASK) {</span>
		//then this is the first point
<span class="nc" id="L372">		m_createShape = true;</span>
<span class="nc" id="L373">		m_shapePoints = new FastVector(17);</span>
<span class="nc" id="L374">		m_shapePoints.addElement(new Double(m_sIndex));</span>
<span class="nc" id="L375">		m_shapePoints.addElement(new </span>
<span class="nc" id="L376">		  Double(m_plot2D.convertToAttribX(e.getX()))); //the new point</span>
<span class="nc" id="L377">		m_shapePoints.addElement(new </span>
<span class="nc" id="L378">		  Double(m_plot2D.convertToAttribY(e.getY())));</span>
<span class="nc" id="L379">		m_newMousePos.width = e.getX();      //the temp mouse point</span>
<span class="nc" id="L380">		m_newMousePos.height = e.getY();</span>

<span class="nc" id="L382">		Graphics g = m_plot2D.getGraphics();</span>
<span class="nc" id="L383">		g.setColor(Color.black);</span>
<span class="nc" id="L384">		g.setXORMode(Color.white);</span>
<span class="nc" id="L385">		g.drawLine((int)Math.ceil</span>
<span class="nc" id="L386">			   (m_plot2D.convertToPanelX(((Double)m_shapePoints.</span>
<span class="nc" id="L387">					     elementAt(1)).doubleValue())),</span>
<span class="nc" id="L388">			   (int)Math.ceil</span>
<span class="nc" id="L389">			   (m_plot2D.convertToPanelY(((Double)m_shapePoints.</span>
<span class="nc" id="L390">					     elementAt(2)).doubleValue())),</span>
<span class="nc" id="L391">			   m_newMousePos.width, m_newMousePos.height);</span>
<span class="nc" id="L392">		g.dispose();</span>
	      }
	    }
	    else {
<span class="nc bnc" id="L396" title="All 2 branches missed.">	      if ((e.getModifiers() &amp; InputEvent.BUTTON1_MASK) == </span>
<span class="nc" id="L397">		  InputEvent.BUTTON1_MASK) {</span>
		
<span class="nc" id="L399">		m_plot2D.searchPoints(e.getX(),e.getY(), false);</span>
	      } else {
<span class="nc" id="L401">		m_plot2D.searchPoints(e.getX(), e.getY(), true);</span>
	      }
	    }
<span class="nc" id="L404">	  }</span>
	  
	  /////////             
	  public void mouseReleased(MouseEvent e) {

<span class="nc bnc" id="L409" title="All 2 branches missed.">	    if (m_createShape) {</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">	      if (((Double)m_shapePoints.elementAt(0)).intValue() == 1) {</span>
<span class="nc" id="L411">		m_createShape = false;</span>
<span class="nc" id="L412">		Graphics g = m_plot2D.getGraphics();</span>
<span class="nc" id="L413">		g.setColor(Color.black);</span>
<span class="nc" id="L414">		g.setXORMode(Color.white);</span>
<span class="nc" id="L415">		g.drawRect(((Double)m_shapePoints.elementAt(1)).</span>
<span class="nc" id="L416">			   intValue(), </span>
<span class="nc" id="L417">			   ((Double)m_shapePoints.elementAt(2)).intValue(),</span>
<span class="nc" id="L418">			   ((Double)m_shapePoints.elementAt(3)).intValue() -</span>
<span class="nc" id="L419">			   ((Double)m_shapePoints.elementAt(1)).intValue(), </span>
<span class="nc" id="L420">			   ((Double)m_shapePoints.elementAt(4)).intValue() -</span>
<span class="nc" id="L421">			   ((Double)m_shapePoints.elementAt(2)).intValue());</span>
		
<span class="nc" id="L423">		g.dispose();</span>
<span class="nc bnc" id="L424" title="All 2 branches missed.">		if (checkPoints(((Double)m_shapePoints.elementAt(1)).</span>
<span class="nc" id="L425">				doubleValue(), </span>
<span class="nc" id="L426">				((Double)m_shapePoints.elementAt(2)).</span>
<span class="nc" id="L427">				doubleValue()) &amp;&amp;</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">		    checkPoints(((Double)m_shapePoints.elementAt(3)).</span>
<span class="nc" id="L429">				doubleValue(), </span>
<span class="nc" id="L430">				((Double)m_shapePoints.elementAt(4)).</span>
<span class="nc" id="L431">				doubleValue())) {</span>
		  //then the points all land on the screen
		  //now do special check for the rectangle
<span class="nc" id="L434">		  if (((Double)m_shapePoints.elementAt(1)).doubleValue() &lt;</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">		      ((Double)m_shapePoints.elementAt(3)).doubleValue() </span>
		      &amp;&amp;
<span class="nc" id="L437">		      ((Double)m_shapePoints.elementAt(2)).doubleValue() &lt;</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">		      ((Double)m_shapePoints.elementAt(4)).doubleValue()) {</span>
		    //then the rectangle is valid
<span class="nc bnc" id="L440" title="All 2 branches missed.">		    if (m_shapes == null) {</span>
<span class="nc" id="L441">		      m_shapes = new FastVector(2);</span>
		    }
<span class="nc" id="L443">		    m_shapePoints.setElementAt(new </span>
<span class="nc" id="L444">		      Double(m_plot2D.convertToAttribX(((Double)m_shapePoints.</span>
<span class="nc" id="L445">					       elementAt(1)).</span>
<span class="nc" id="L446">					      doubleValue())), 1);</span>
<span class="nc" id="L447">		    m_shapePoints.setElementAt(new </span>
<span class="nc" id="L448">		      Double(m_plot2D.convertToAttribY(((Double)m_shapePoints.</span>
<span class="nc" id="L449">					       elementAt(2)).</span>
<span class="nc" id="L450">					      doubleValue())), 2);</span>
<span class="nc" id="L451">		    m_shapePoints.setElementAt(new </span>
<span class="nc" id="L452">		      Double(m_plot2D.convertToAttribX(((Double)m_shapePoints.</span>
<span class="nc" id="L453">					       elementAt(3)).</span>
<span class="nc" id="L454">					      doubleValue())), 3);</span>
<span class="nc" id="L455">		    m_shapePoints.setElementAt(new </span>
<span class="nc" id="L456">		      Double(m_plot2D.convertToAttribY(((Double)m_shapePoints.</span>
<span class="nc" id="L457">					       elementAt(4)).</span>
<span class="nc" id="L458">					      doubleValue())), 4);</span>
		    
<span class="nc" id="L460">		    m_shapes.addElement(m_shapePoints);</span>
		    
<span class="nc" id="L462">		    m_submit.setText(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_MouseReleased_Submit_SetText_Text&quot;));</span>
<span class="nc" id="L463">		    m_submit.setActionCommand(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_MouseReleased_Submit_SetActionCommand_Text&quot;));</span>
		    
<span class="nc" id="L465">		    m_submit.setEnabled(true);</span>

<span class="nc" id="L467">		    PlotPanel.this.repaint();</span>
		  }
		}
<span class="nc" id="L470">		m_shapePoints = null;</span>
	      }
	    }
<span class="nc" id="L473">	  }</span>
	});
      
<span class="nc" id="L476">      this.addMouseMotionListener(new MouseMotionAdapter() {</span>
	  public void mouseDragged(MouseEvent e) {
	    //check if the user is dragging a box
<span class="nc bnc" id="L479" title="All 2 branches missed.">	    if (m_createShape) {</span>
<span class="nc bnc" id="L480" title="All 2 branches missed.">	      if (((Double)m_shapePoints.elementAt(0)).intValue() == 1) {</span>
<span class="nc" id="L481">		Graphics g = m_plot2D.getGraphics();</span>
<span class="nc" id="L482">		g.setColor(Color.black);</span>
<span class="nc" id="L483">		g.setXORMode(Color.white);</span>
<span class="nc" id="L484">		g.drawRect(((Double)m_shapePoints.elementAt(1)).intValue(), </span>
<span class="nc" id="L485">			   ((Double)m_shapePoints.elementAt(2)).intValue(),</span>
<span class="nc" id="L486">			   ((Double)m_shapePoints.elementAt(3)).intValue() -</span>
<span class="nc" id="L487">			   ((Double)m_shapePoints.elementAt(1)).intValue(), </span>
<span class="nc" id="L488">			   ((Double)m_shapePoints.elementAt(4)).intValue() -</span>
<span class="nc" id="L489">			   ((Double)m_shapePoints.elementAt(2)).intValue());</span>
		
<span class="nc" id="L491">		m_shapePoints.setElementAt(new Double(e.getX()), 3);</span>
<span class="nc" id="L492">		m_shapePoints.setElementAt(new Double(e.getY()), 4);</span>
		
<span class="nc" id="L494">		g.drawRect(((Double)m_shapePoints.elementAt(1)).intValue(), </span>
<span class="nc" id="L495">			   ((Double)m_shapePoints.elementAt(2)).intValue(),</span>
<span class="nc" id="L496">			   ((Double)m_shapePoints.elementAt(3)).intValue() -</span>
<span class="nc" id="L497">			   ((Double)m_shapePoints.elementAt(1)).intValue(), </span>
<span class="nc" id="L498">			   ((Double)m_shapePoints.elementAt(4)).intValue() -</span>
<span class="nc" id="L499">			   ((Double)m_shapePoints.elementAt(2)).intValue());</span>
<span class="nc" id="L500">		g.dispose();</span>
	      }
	    }
<span class="nc" id="L503">	  }</span>
	  
	  public void mouseMoved(MouseEvent e) {
<span class="nc bnc" id="L506" title="All 2 branches missed.">	    if (m_createShape) {</span>
<span class="nc bnc" id="L507" title="All 2 branches missed.">	      if (((Double)m_shapePoints.elementAt(0)).intValue() == 2 || </span>
<span class="nc bnc" id="L508" title="All 2 branches missed.">		  ((Double)m_shapePoints.elementAt(0)).intValue() == 3) {</span>
<span class="nc" id="L509">		Graphics g = m_plot2D.getGraphics();</span>
<span class="nc" id="L510">		g.setColor(Color.black);</span>
<span class="nc" id="L511">		g.setXORMode(Color.white);</span>
<span class="nc" id="L512">		g.drawLine((int)Math.ceil(m_plot2D.convertToPanelX</span>
<span class="nc" id="L513">					  (((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L514">					    (m_shapePoints.size() - 2)).</span>
<span class="nc" id="L515">					   doubleValue())),</span>
<span class="nc" id="L516">			   (int)Math.ceil(m_plot2D.convertToPanelY</span>
<span class="nc" id="L517">					  (((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L518">					    (m_shapePoints.size() - 1)).</span>
<span class="nc" id="L519">					   doubleValue())),</span>
<span class="nc" id="L520">			   m_newMousePos.width, m_newMousePos.height);</span>
		
<span class="nc" id="L522">		m_newMousePos.width = e.getX();</span>
<span class="nc" id="L523">		m_newMousePos.height = e.getY();</span>
		
<span class="nc" id="L525">		g.drawLine((int)Math.ceil(m_plot2D.convertToPanelX</span>
<span class="nc" id="L526">					  (((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L527">					    (m_shapePoints.size() - 2)).</span>
<span class="nc" id="L528">					   doubleValue())),</span>
<span class="nc" id="L529">			   (int)Math.ceil(m_plot2D.convertToPanelY</span>
<span class="nc" id="L530">					  (((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L531">					    (m_shapePoints.size() - 1)).</span>
<span class="nc" id="L532">					   doubleValue())),</span>
<span class="nc" id="L533">			   m_newMousePos.width, m_newMousePos.height);</span>
<span class="nc" id="L534">		g.dispose();</span>
	      }
	    }
<span class="nc" id="L537">	  }</span>
	});
      
<span class="nc" id="L540">      m_submit.addActionListener(new ActionListener() {</span>
	  public void actionPerformed(ActionEvent e) {
	 
<span class="nc bnc" id="L543" title="All 2 branches missed.">	    if (e.getActionCommand().equals(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_ActionPerformed_Submit_ActionCommand_Text&quot;))) {</span>
<span class="nc bnc" id="L544" title="All 4 branches missed.">	      if (m_splitListener != null &amp;&amp; m_shapes != null) {</span>
		//then send the split to the listener
<span class="nc" id="L546">		Instances sub_set1 = new Instances(m_plot2D.getMasterPlot().</span>
<span class="nc" id="L547">						   m_plotInstances, 500);</span>
<span class="nc" id="L548">		Instances sub_set2 = new Instances(m_plot2D.getMasterPlot().</span>
<span class="nc" id="L549">						   m_plotInstances, 500);</span>
		
<span class="nc bnc" id="L551" title="All 2 branches missed.">		if (m_plot2D.getMasterPlot().</span>
<span class="nc" id="L552">		    m_plotInstances != null) {</span>
		  
<span class="nc" id="L554">		  for (int noa = 0 ; noa &lt; m_plot2D.getMasterPlot().</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">			 m_plotInstances.numInstances(); noa++) {</span>
<span class="nc" id="L556">		    if (!m_plot2D.getMasterPlot().</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">			m_plotInstances.instance(noa).isMissing(m_xIndex) &amp;&amp;</span>
<span class="nc" id="L558">			!m_plot2D.getMasterPlot().</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">			m_plotInstances.instance(noa).isMissing(m_yIndex)){</span>
		      
<span class="nc bnc" id="L561" title="All 2 branches missed.">		      if (inSplit(m_plot2D.getMasterPlot().</span>
<span class="nc" id="L562">				  m_plotInstances.instance(noa))) {</span>
<span class="nc" id="L563">			sub_set1.add(m_plot2D.getMasterPlot().</span>
<span class="nc" id="L564">				     m_plotInstances.instance(noa));</span>
		      }
		      else {
<span class="nc" id="L567">			sub_set2.add(m_plot2D.getMasterPlot().</span>
<span class="nc" id="L568">				     m_plotInstances.instance(noa));</span>
		      }
		    }
		  }
<span class="nc" id="L572">		  FastVector tmp = m_shapes;</span>
<span class="nc" id="L573">		  cancelShapes();</span>
<span class="nc" id="L574">		  m_splitListener.userDataEvent(new </span>
<span class="nc" id="L575">		    VisualizePanelEvent(tmp, sub_set1, sub_set2, m_xIndex, </span>
<span class="nc" id="L576">					m_yIndex));</span>
		}
	      }
<span class="nc bnc" id="L579" title="All 2 branches missed.">	      else if (m_shapes != null &amp;&amp; </span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">		       m_plot2D.getMasterPlot().m_plotInstances != null) { </span>
<span class="nc" id="L581">		Instances sub_set1 = new Instances(m_plot2D.getMasterPlot().</span>
<span class="nc" id="L582">						   m_plotInstances, 500);</span>
<span class="nc" id="L583">		int count = 0;</span>
<span class="nc" id="L584">		for (int noa = 0 ; noa &lt; m_plot2D.getMasterPlot().</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">		       m_plotInstances.numInstances(); noa++) {</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">		  if (inSplit(m_plot2D.getMasterPlot().</span>
<span class="nc" id="L587">			      m_plotInstances.instance(noa))) {</span>
<span class="nc" id="L588">		    sub_set1.add(m_plot2D.getMasterPlot().</span>
<span class="nc" id="L589">				 m_plotInstances.instance(noa));</span>
<span class="nc" id="L590">		    count++;</span>
		  }
		  
		}

<span class="nc" id="L595">		int [] nSizes = null;</span>
<span class="nc" id="L596">		int [] nTypes = null;</span>
<span class="nc" id="L597">		int x = m_xIndex;</span>
<span class="nc" id="L598">		int y = m_yIndex;</span>

<span class="nc bnc" id="L600" title="All 2 branches missed.">		if (m_originalPlot == null) {</span>
		  //this sets these instances as the instances 
		  //to go back to.
<span class="nc" id="L603">		  m_originalPlot = m_plot2D.getMasterPlot();</span>
		}

<span class="nc bnc" id="L606" title="All 2 branches missed.">		if (count &gt; 0) {</span>
<span class="nc" id="L607">		  nTypes = new int[count];</span>
<span class="nc" id="L608">		  nSizes = new int[count];</span>
<span class="nc" id="L609">		  count = 0;</span>
<span class="nc" id="L610">		  for (int noa = 0; noa &lt; m_plot2D.getMasterPlot().</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">			 m_plotInstances.numInstances(); </span>
<span class="nc" id="L612">		       noa++) {</span>
<span class="nc bnc" id="L613" title="All 2 branches missed.">		    if (inSplit(m_plot2D.getMasterPlot().</span>
<span class="nc" id="L614">				m_plotInstances.instance(noa))) {</span>

<span class="nc" id="L616">		      nTypes[count] = m_plot2D.getMasterPlot().</span>
<span class="nc" id="L617">			m_shapeType[noa];</span>
<span class="nc" id="L618">		      nSizes[count] = m_plot2D.getMasterPlot().</span>
<span class="nc" id="L619">			m_shapeSize[noa];</span>
<span class="nc" id="L620">		      count++;</span>
		    }
		  }
		}
<span class="nc" id="L624">		cancelShapes();</span>

<span class="nc" id="L626">		PlotData2D newPlot = new PlotData2D(sub_set1);</span>

		try {
<span class="nc" id="L629">		  newPlot.setShapeSize(nSizes);</span>
<span class="nc" id="L630">		  newPlot.setShapeType(nTypes);</span>
		
<span class="nc" id="L632">		  m_plot2D.removeAllPlots();</span>
		  
<span class="nc" id="L634">		  VisualizePanel.this.addPlot(newPlot);</span>
<span class="nc" id="L635">		} catch (Exception ex) {</span>
<span class="nc" id="L636">		  System.err.println(ex);</span>
<span class="nc" id="L637">		  ex.printStackTrace();</span>
		}

		try {
<span class="nc" id="L641">		  VisualizePanel.this.setXIndex(x);</span>
<span class="nc" id="L642">		  VisualizePanel.this.setYIndex(y);</span>
<span class="nc" id="L643">		} catch(Exception er) {</span>
<span class="nc" id="L644">		  System.out.println(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_ActionPerformed_Error_Text_First&quot;) + er);</span>
		  //  System.out.println(&quot;Part of user input so had to&quot; +
		  //		 &quot; catch here&quot;);
		}
	      }
	    }
<span class="nc bnc" id="L650" title="All 2 branches missed.">	    else if (e.getActionCommand().equals(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_ActionPerformed_Reset_ActionCommand_Text&quot;))) {</span>
<span class="nc" id="L651">	      int x = m_xIndex;</span>
<span class="nc" id="L652">	      int y = m_yIndex;</span>

<span class="nc" id="L654">	      m_plot2D.removeAllPlots();</span>
	      try {
<span class="nc" id="L656">		VisualizePanel.this.addPlot(m_originalPlot);</span>
<span class="nc" id="L657">	      } catch (Exception ex) {</span>
<span class="nc" id="L658">		System.err.println(ex);</span>
<span class="nc" id="L659">		ex.printStackTrace();</span>
	      }

	      try {
<span class="nc" id="L663">		VisualizePanel.this.setXIndex(x);</span>
<span class="nc" id="L664">		VisualizePanel.this.setYIndex(y);</span>
<span class="nc" id="L665">	      } catch(Exception er) {</span>
<span class="nc" id="L666">		System.out.println(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_ActionPerformed_Error_Text_Second&quot;) + er);</span>
	      }
	    }
<span class="nc" id="L669">	  }  </span>
	});

<span class="nc" id="L672">      m_cancel.addActionListener(new ActionListener() {</span>
	  public void actionPerformed(ActionEvent e) {
<span class="nc" id="L674">	    cancelShapes();</span>
<span class="nc" id="L675">	    PlotPanel.this.repaint();</span>
<span class="nc" id="L676">	  }</span>
	});
      ////////////
<span class="nc" id="L679">    }</span>

    /**
     * Removes all the plots.
     */
    public void removeAllPlots() {
<span class="nc" id="L685">      m_plot2D.removeAllPlots();</span>
<span class="nc" id="L686">      m_legendPanel.setPlotList(m_plot2D.getPlots());</span>
<span class="nc" id="L687">    }</span>
    
    /**
     * @return The FastVector containing all the shapes.
     */
    public FastVector getShapes() {
      
<span class="nc" id="L694">      return m_shapes;</span>
    }
    
    /**
     * Sets the list of shapes to empty and also cancels
     * the current shape being drawn (if applicable).
     */
    public void cancelShapes() {
       
<span class="nc bnc" id="L703" title="All 2 branches missed.">      if (m_splitListener == null) {</span>
<span class="nc" id="L704">	m_submit.setText(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_CancelShapes_Submit_SetText_Text&quot;));</span>
<span class="nc" id="L705">	m_submit.setActionCommand(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_CancelShapes_Submit_SetActionCommand_Text&quot;));</span>

<span class="nc bnc" id="L707" title="All 2 branches missed.">	if (m_originalPlot == null || </span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">	    m_originalPlot.m_plotInstances == m_plotInstances) {</span>
<span class="nc" id="L709">	  m_submit.setEnabled(false);</span>
	}
	else {
<span class="nc" id="L712">	  m_submit.setEnabled(true);</span>
	}
      }
      else {
<span class="nc" id="L716">	m_submit.setEnabled(false);</span>
      }
      
<span class="nc" id="L719">      m_createShape = false;</span>
<span class="nc" id="L720">      m_shapePoints = null;</span>
<span class="nc" id="L721">      m_shapes = null;</span>
<span class="nc" id="L722">      this.repaint();</span>
<span class="nc" id="L723">    }</span>

    /**
     * This can be used to set the shapes that should appear.
     * @param v The list of shapes.
     */
    public void setShapes(FastVector v) {
      //note that this method should be fine for doubles,
      //but anything else that uses something other than doubles 
      //(or uneditable objects) could have unsafe copies.
<span class="nc bnc" id="L733" title="All 2 branches missed.">      if (v != null) {</span>
	FastVector temp;
<span class="nc" id="L735">	m_shapes = new FastVector(v.size());</span>
<span class="nc bnc" id="L736" title="All 2 branches missed.">	for (int noa = 0; noa &lt; v.size(); noa++) {</span>
<span class="nc" id="L737">	  temp = new FastVector(((FastVector)v.elementAt(noa)).size());</span>
<span class="nc" id="L738">	  m_shapes.addElement(temp);</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">	  for (int nob = 0; nob &lt; ((FastVector)v.elementAt(noa)).size()</span>
<span class="nc" id="L740">		 ; nob++) {</span>
	    
<span class="nc" id="L742">	    temp.addElement(((FastVector)v.elementAt(noa)).elementAt(nob));</span>
	    
	  }
	}
      }
      else {
<span class="nc" id="L748">	m_shapes = null;</span>
      }
<span class="nc" id="L750">      this.repaint();</span>
<span class="nc" id="L751">    }</span>
    
    /** 
     * This will check the values of the screen points passed and make sure 
     * that they land on the screen
     * @param x1 The x coord.
     * @param y1 The y coord.
     * @return true if the point would land on the screen
     */
    private boolean checkPoints(double x1, double y1) {
<span class="nc bnc" id="L761" title="All 6 branches missed.">      if (x1 &lt; 0 || x1 &gt; this.getSize().width || y1 &lt; 0 </span>
<span class="nc bnc" id="L762" title="All 2 branches missed.">	  || y1 &gt; this.getSize().height) {</span>
<span class="nc" id="L763">	return false;</span>
      }
<span class="nc" id="L765">      return true;</span>
    }
    
    /**
     * This will check if an instance is inside or outside of the current
     * shapes.
     * @param i The instance to check.
     * @return True if 'i' falls inside the shapes, false otherwise.
     */
    public boolean inSplit(Instance i) {
      //this will check if the instance lies inside the shapes or not
      
<span class="nc bnc" id="L777" title="All 2 branches missed.">      if (m_shapes != null) {</span>
	FastVector stmp;
	double x1, y1, x2, y2;
<span class="nc bnc" id="L780" title="All 2 branches missed.">	for (int noa = 0; noa &lt; m_shapes.size(); noa++) {</span>
<span class="nc" id="L781">	  stmp = (FastVector)m_shapes.elementAt(noa);</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">	  if (((Double)stmp.elementAt(0)).intValue() == 1) {</span>
	    //then rectangle
<span class="nc" id="L784">	    x1 = ((Double)stmp.elementAt(1)).doubleValue();</span>
<span class="nc" id="L785">	    y1 = ((Double)stmp.elementAt(2)).doubleValue();</span>
<span class="nc" id="L786">	    x2 = ((Double)stmp.elementAt(3)).doubleValue();</span>
<span class="nc" id="L787">	    y2 = ((Double)stmp.elementAt(4)).doubleValue();</span>
<span class="nc bnc" id="L788" title="All 4 branches missed.">	    if (i.value(m_xIndex) &gt;= x1 &amp;&amp; i.value(m_xIndex) &lt;= x2 &amp;&amp;</span>
<span class="nc bnc" id="L789" title="All 4 branches missed.">		i.value(m_yIndex) &lt;= y1 &amp;&amp; i.value(m_yIndex) &gt;= y2) {</span>
	      //then is inside split so return true;
<span class="nc" id="L791">	      return true;</span>
	    }
	  }
<span class="nc bnc" id="L794" title="All 2 branches missed.">	  else if (((Double)stmp.elementAt(0)).intValue() == 2) {</span>
	    //then polygon
<span class="nc bnc" id="L796" title="All 2 branches missed.">	    if (inPoly(stmp, i.value(m_xIndex), i.value(m_yIndex))) {</span>
<span class="nc" id="L797">	      return true;</span>
	    }
	  }
<span class="nc bnc" id="L800" title="All 2 branches missed.">	  else if (((Double)stmp.elementAt(0)).intValue() == 3) {</span>
	    //then polyline
<span class="nc bnc" id="L802" title="All 2 branches missed.">	    if (inPolyline(stmp, i.value(m_xIndex), i.value(m_yIndex))) {</span>
<span class="nc" id="L803">	      return true;</span>
	    }
	  }
	}
      }
<span class="nc" id="L808">      return false;</span>
    }
    
    /**
     * Checks to see if the coordinate passed is inside the ployline
     * passed, Note that this is done using attribute values and not there
     * respective screen values.
     * @param ob The polyline.
     * @param x The x coord.
     * @param y The y coord.
     * @return True if it falls inside the polyline, false otherwise.
     */
    private boolean inPolyline(FastVector ob, double x, double y) {
      //this works similar to the inPoly below except that
      //the first and last lines are treated as extending infinite in one 
      //direction and 
      //then infinitly in the x dirction their is a line that will 
      //normaly be infinite but
      //can be finite in one or both directions
      
<span class="nc" id="L828">      int countx = 0;</span>
      double vecx, vecy;
      double change;
      double x1, y1, x2, y2;
      
<span class="nc bnc" id="L833" title="All 2 branches missed.">      for (int noa = 1; noa &lt; ob.size() - 4; noa+= 2) {</span>
<span class="nc" id="L834">	y1 = ((Double)ob.elementAt(noa+1)).doubleValue();</span>
<span class="nc" id="L835">	y2 = ((Double)ob.elementAt(noa+3)).doubleValue();</span>
<span class="nc" id="L836">	x1 = ((Double)ob.elementAt(noa)).doubleValue();</span>
<span class="nc" id="L837">	x2 = ((Double)ob.elementAt(noa+2)).doubleValue();</span>
	
	//System.err.println(y1 + &quot; &quot; + y2 + &quot; &quot; + x1 + &quot; &quot; + x2);
<span class="nc" id="L840">	vecy = y2 - y1;</span>
<span class="nc" id="L841">	vecx = x2 - x1;</span>
<span class="nc bnc" id="L842" title="All 4 branches missed.">	if (noa == 1 &amp;&amp; noa == ob.size() - 6) {</span>
	  //then do special test first and last edge
<span class="nc bnc" id="L844" title="All 2 branches missed.">	  if (vecy != 0) {</span>
<span class="nc" id="L845">	    change = (y - y1) / vecy;</span>
<span class="nc bnc" id="L846" title="All 2 branches missed.">	    if (vecx * change + x1 &gt;= x) {</span>
	      //then intersection
<span class="nc" id="L848">	      countx++;</span>
	    }
	  }
	}
<span class="nc bnc" id="L852" title="All 2 branches missed.">	else if (noa == 1) {</span>
<span class="nc bnc" id="L853" title="All 8 branches missed.">	  if ((y &lt; y2 &amp;&amp; vecy &gt; 0) || (y &gt; y2 &amp;&amp; vecy &lt; 0)) {</span>
	    //now just determine intersection or not
<span class="nc" id="L855">	    change = (y - y1) / vecy;</span>
<span class="nc bnc" id="L856" title="All 2 branches missed.">	    if (vecx * change + x1 &gt;= x) {</span>
	      //then intersection on horiz
<span class="nc" id="L858">	      countx++;</span>
	    }
	  }
	}
<span class="nc bnc" id="L862" title="All 2 branches missed.">	else if (noa == ob.size() - 6) {</span>
	  //then do special test on last edge
<span class="nc bnc" id="L864" title="All 8 branches missed.">	  if ((y &lt;= y1 &amp;&amp; vecy &lt; 0) || (y &gt;= y1 &amp;&amp; vecy &gt; 0)) {</span>
<span class="nc" id="L865">	    change = (y - y1) / vecy;</span>
<span class="nc bnc" id="L866" title="All 2 branches missed.">	    if (vecx * change + x1 &gt;= x) {</span>
<span class="nc" id="L867">	      countx++;</span>
	    }
	  }
	}
<span class="nc bnc" id="L871" title="All 8 branches missed.">	else if ((y1 &lt;= y &amp;&amp; y &lt; y2) || (y2 &lt; y &amp;&amp; y &lt;= y1)) {</span>
	  //then continue tests.
<span class="nc bnc" id="L873" title="All 2 branches missed.">	  if (vecy == 0) {</span>
	    //then lines are parallel stop tests in 
	    //ofcourse it should never make it this far
	  }
	  else {
<span class="nc" id="L878">	    change = (y - y1) / vecy;</span>
<span class="nc bnc" id="L879" title="All 2 branches missed.">	    if (vecx * change + x1 &gt;= x) {</span>
	      //then intersects on horiz
<span class="nc" id="L881">	      countx++;</span>
	    }
	  }
	}
      }
      
      //now check for intersection with the infinity line
<span class="nc" id="L888">      y1 = ((Double)ob.elementAt(ob.size() - 2)).doubleValue();</span>
<span class="nc" id="L889">      y2 = ((Double)ob.elementAt(ob.size() - 1)).doubleValue();</span>
      
<span class="nc bnc" id="L891" title="All 2 branches missed.">      if (y1 &gt; y2) {</span>
	//then normal line
<span class="nc bnc" id="L893" title="All 4 branches missed.">	if (y1 &gt;= y &amp;&amp; y &gt; y2) {</span>
<span class="nc" id="L894">	  countx++;</span>
	}
      }
      else {
	//then the line segment is inverted
<span class="nc bnc" id="L899" title="All 4 branches missed.">	if (y1 &gt;= y || y &gt; y2) {</span>
<span class="nc" id="L900">	  countx++;</span>
	}
      }
      
<span class="nc bnc" id="L904" title="All 2 branches missed.">      if ((countx % 2) == 1) {</span>
<span class="nc" id="L905">	return true;</span>
      }
      else {
<span class="nc" id="L908">	return false;</span>
      }
    }


    /**
     * This checks to see if The coordinate passed is inside
     * the polygon that was passed.
     * @param ob The polygon.
     * @param x The x coord.
     * @param y The y coord.
     * @return True if the coordinate is in the polygon, false otherwise.
     */
    private boolean inPoly(FastVector ob, double x, double y) {
      //brief on how this works
      //it draws a line horizontally from the point to the right (infinitly)
      //it then sees how many lines of the polygon intersect this, 
      //if it is even then the point is
      // outside the polygon if it's odd then it's inside the polygon
<span class="nc" id="L927">      int count = 0;</span>
      double vecx, vecy;
      double change;
      double x1, y1, x2, y2;
<span class="nc bnc" id="L931" title="All 2 branches missed.">      for (int noa = 1; noa &lt; ob.size() - 2; noa += 2) {</span>
<span class="nc" id="L932">	y1 = ((Double)ob.elementAt(noa+1)).doubleValue();</span>
<span class="nc" id="L933">	y2 = ((Double)ob.elementAt(noa+3)).doubleValue();</span>
<span class="nc bnc" id="L934" title="All 8 branches missed.">	if ((y1 &lt;= y &amp;&amp; y &lt; y2) || (y2 &lt; y &amp;&amp; y &lt;= y1)) {</span>
	  //then continue tests.
<span class="nc" id="L936">	  vecy = y2 - y1;</span>
<span class="nc bnc" id="L937" title="All 2 branches missed.">	  if (vecy == 0) {</span>
	    //then lines are parallel stop tests for this line
	  }
	  else {
<span class="nc" id="L941">	    x1 = ((Double)ob.elementAt(noa)).doubleValue();</span>
<span class="nc" id="L942">	    x2 = ((Double)ob.elementAt(noa+2)).doubleValue();</span>
<span class="nc" id="L943">	    vecx = x2 - x1;</span>
<span class="nc" id="L944">	    change = (y - y1) / vecy;</span>
<span class="nc bnc" id="L945" title="All 2 branches missed.">	    if (vecx * change + x1 &gt;= x) {</span>
	      //then add to count as an intersected line
<span class="nc" id="L947">	      count++;</span>
	    }
	  }
	}
      }
<span class="nc bnc" id="L952" title="All 2 branches missed.">      if ((count % 2) == 1) {</span>
	//then lies inside polygon
	//System.out.println(&quot;in&quot;);
<span class="nc" id="L955">	return true;</span>
      }
      else {
	//System.out.println(&quot;out&quot;);
<span class="nc" id="L959">	return false;</span>
      }
      //System.out.println(&quot;WHAT?!?!?!?!!?!??!?!&quot;);
      //return false;
    }

    /**
     * Set level of jitter and repaint the plot using the new jitter value
     * @param j the level of jitter
     */
    public void setJitter(int j) {
<span class="nc" id="L970">      m_plot2D.setJitter(j);</span>
<span class="nc" id="L971">    }</span>

    /**
     * Set the index of the attribute to go on the x axis
     * @param x the index of the attribute to use on the x axis
     */
    public void setXindex(int x) {

      // this just ensures that the shapes get disposed of 
      //if the attribs change
<span class="nc bnc" id="L981" title="All 2 branches missed.">      if (x != m_xIndex) {</span>
<span class="nc" id="L982">	cancelShapes();</span>
      }
<span class="nc" id="L984">      m_xIndex = x;</span>
<span class="nc" id="L985">      m_plot2D.setXindex(x);</span>
<span class="nc bnc" id="L986" title="All 2 branches missed.">      if (m_showAttBars) {</span>
<span class="nc" id="L987">	m_attrib.setX(x);</span>
      }
      //      this.repaint();
<span class="nc" id="L990">    }</span>
    
    /**
     * Set the index of the attribute to go on the y axis
     * @param y the index of the attribute to use on the y axis
     */
    public void setYindex(int y) {
    
      // this just ensures that the shapes get disposed of 
      //if the attribs change
<span class="nc bnc" id="L1000" title="All 2 branches missed.">      if (y != m_yIndex) {</span>
<span class="nc" id="L1001">	cancelShapes();</span>
      }
<span class="nc" id="L1003">      m_yIndex = y;</span>
<span class="nc" id="L1004">      m_plot2D.setYindex(y);</span>
<span class="nc bnc" id="L1005" title="All 2 branches missed.">      if (m_showAttBars) {</span>
<span class="nc" id="L1006">	m_attrib.setY(y);</span>
      }
      //      this.repaint();
<span class="nc" id="L1009">    }</span>

    /**
     * Set the index of the attribute to use for colouring
     * @param c the index of the attribute to use for colouring
     */
    public void setCindex(int c) {
<span class="nc" id="L1016">      m_cIndex = c;</span>
<span class="nc" id="L1017">      m_plot2D.setCindex(c);</span>
<span class="nc bnc" id="L1018" title="All 2 branches missed.">      if (m_showAttBars) {</span>
<span class="nc" id="L1019">	m_attrib.setCindex(c, m_plot2D.getMaxC(), m_plot2D.getMinC());</span>
      }
<span class="nc" id="L1021">      m_classPanel.setCindex(c);</span>
<span class="nc" id="L1022">      this.repaint();</span>
<span class="nc" id="L1023">    }</span>

    /**
     * Set the index of the attribute to use for the shape.
     * @param s the index of the attribute to use for the shape
     */
    public void setSindex(int s) {
<span class="nc bnc" id="L1030" title="All 2 branches missed.">      if (s != m_sIndex) {</span>
<span class="nc" id="L1031">	m_shapePoints = null;</span>
<span class="nc" id="L1032">	m_createShape = false;</span>
      }
<span class="nc" id="L1034">      m_sIndex = s;</span>
<span class="nc" id="L1035">      this.repaint();</span>
<span class="nc" id="L1036">    }</span>
    
    /**
     * Clears all existing plots and sets a new master plot
     * @param newPlot the new master plot
     * @exception Exception if plot could not be added
     */
    public void setMasterPlot(PlotData2D newPlot) throws Exception {
<span class="nc" id="L1044">      m_plot2D.removeAllPlots();</span>
<span class="nc" id="L1045">      this.addPlot(newPlot);</span>
<span class="nc" id="L1046">    }</span>

    /**
     * Adds a plot. If there are no plots so far this plot becomes
     * the master plot and, if it has a custom colour defined then
     * the class panel is removed.
     * @param newPlot the plot to add.
     * @exception Exception if plot could not be added
     */
    public void addPlot(PlotData2D newPlot) throws Exception {
<span class="nc bnc" id="L1056" title="All 2 branches missed.">      if (m_plot2D.getPlots().size() == 0) {</span>
<span class="nc" id="L1057">	m_plot2D.addPlot(newPlot);</span>
<span class="nc bnc" id="L1058" title="All 2 branches missed.">	if (m_plotSurround.getComponentCount() &gt; 1 &amp;&amp; </span>
<span class="nc bnc" id="L1059" title="All 2 branches missed.">	    m_plotSurround.getComponent(1) == m_attrib &amp;&amp;</span>
<span class="nc bnc" id="L1060" title="All 2 branches missed.">	    m_showAttBars) {</span>
	  try {
<span class="nc" id="L1062">	    m_attrib.setInstances(newPlot.m_plotInstances);</span>
<span class="nc" id="L1063">	    m_attrib.setCindex(0);m_attrib.setX(0); m_attrib.setY(0);</span>
<span class="nc" id="L1064">	  } catch (Exception ex) {</span>
	    // more attributes than the panel can handle?
	    // Due to hard coded constraints in GridBagLayout
<span class="nc" id="L1067">	    m_plotSurround.remove(m_attrib);</span>
<span class="nc" id="L1068">	    System.err.println(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_Error_Text_First&quot;));</span>
<span class="nc bnc" id="L1069" title="All 2 branches missed.">	    if (m_Log != null) {</span>
<span class="nc" id="L1070">	      m_Log.logMessage(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_Log_LogMessage_Text_First&quot;));</span>
	    }
	  }
<span class="nc bnc" id="L1073" title="All 2 branches missed.">	} else if (m_showAttBars) {</span>
	  try {
<span class="nc" id="L1075">	    m_attrib.setInstances(newPlot.m_plotInstances);</span>
<span class="nc" id="L1076">	    m_attrib.setCindex(0);m_attrib.setX(0); m_attrib.setY(0);</span>
<span class="nc" id="L1077">	    GridBagConstraints constraints = new GridBagConstraints();</span>
<span class="nc" id="L1078">	    constraints.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L1079">	    constraints.insets = new Insets(0, 0, 0, 0);</span>
<span class="nc" id="L1080">	    constraints.gridx=4;constraints.gridy=0;constraints.weightx=1;</span>
<span class="nc" id="L1081">	    constraints.gridwidth=1;constraints.gridheight=1;</span>
<span class="nc" id="L1082">	    constraints.weighty=5;</span>
<span class="nc" id="L1083">	    m_plotSurround.add(m_attrib, constraints);</span>
<span class="nc" id="L1084">	  } catch (Exception ex) {</span>
<span class="nc" id="L1085">	    System.err.println(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_Error_Text_Second&quot;));</span>
<span class="nc bnc" id="L1086" title="All 2 branches missed.">	    if (m_Log != null) {</span>
<span class="nc" id="L1087">	      m_Log.logMessage(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_Log_LogMessage_Text_Second&quot;));</span>
	    }
	  }
	}
<span class="nc" id="L1091">	m_classPanel.setInstances(newPlot.m_plotInstances);</span>

<span class="nc" id="L1093">	plotReset(newPlot.m_plotInstances, newPlot.getCindex());</span>
<span class="nc bnc" id="L1094" title="All 4 branches missed.">	if (newPlot.m_useCustomColour &amp;&amp; m_showClassPanel) {</span>
<span class="nc" id="L1095">	  VisualizePanel.this.remove(m_classSurround);</span>
<span class="nc" id="L1096">	  switchToLegend();</span>
<span class="nc" id="L1097">	  m_legendPanel.setPlotList(m_plot2D.getPlots());</span>
<span class="nc" id="L1098">	  m_ColourCombo.setEnabled(false);</span>
	}
      } else  {
<span class="nc bnc" id="L1101" title="All 4 branches missed.">	if (!newPlot.m_useCustomColour &amp;&amp; m_showClassPanel) {</span>
<span class="nc" id="L1102">	  VisualizePanel.this.add(m_classSurround, BorderLayout.SOUTH);</span>
<span class="nc" id="L1103">	  m_ColourCombo.setEnabled(true);</span>
	}
<span class="nc bnc" id="L1105" title="All 2 branches missed.">	if (m_plot2D.getPlots().size() == 1) {</span>
<span class="nc" id="L1106">	  switchToLegend();</span>
	}
<span class="nc" id="L1108">	m_plot2D.addPlot(newPlot);</span>
<span class="nc" id="L1109">	m_legendPanel.setPlotList(m_plot2D.getPlots());</span>
      }
<span class="nc" id="L1111">    }</span>

    /**
     * Remove the attibute panel and replace it with the legend panel
     */
    protected void switchToLegend() {

<span class="nc bnc" id="L1118" title="All 2 branches missed.">      if (m_plotSurround.getComponentCount() &gt; 1 &amp;&amp; </span>
<span class="nc bnc" id="L1119" title="All 2 branches missed.">	  m_plotSurround.getComponent(1) == m_attrib) {</span>
<span class="nc" id="L1120">	m_plotSurround.remove(m_attrib);</span>
      }
	
<span class="nc bnc" id="L1123" title="All 2 branches missed.">      if (m_plotSurround.getComponentCount() &gt; 1 &amp;&amp;</span>
<span class="nc bnc" id="L1124" title="All 2 branches missed.">	  m_plotSurround.getComponent(1) == m_legendPanel) {</span>
<span class="nc" id="L1125">	return;</span>
      }

<span class="nc" id="L1128">      GridBagConstraints constraints = new GridBagConstraints();</span>
<span class="nc" id="L1129">      constraints.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L1130">      constraints.insets = new Insets(0, 0, 0, 0);</span>
<span class="nc" id="L1131">      constraints.gridx=4;constraints.gridy=0;constraints.weightx=1;</span>
<span class="nc" id="L1132">      constraints.gridwidth=1;constraints.gridheight=1;</span>
<span class="nc" id="L1133">      constraints.weighty=5;</span>
<span class="nc" id="L1134">      m_plotSurround.add(m_legendPanel, constraints);</span>
<span class="nc" id="L1135">      setSindex(0);</span>
<span class="nc" id="L1136">      m_ShapeCombo.setEnabled(false);</span>
<span class="nc" id="L1137">    }</span>
    
    protected void switchToBars() {
<span class="nc bnc" id="L1140" title="All 2 branches missed.">      if (m_plotSurround.getComponentCount() &gt; 1 &amp;&amp; </span>
<span class="nc bnc" id="L1141" title="All 2 branches missed.">          m_plotSurround.getComponent(1) == m_legendPanel) {</span>
<span class="nc" id="L1142">        m_plotSurround.remove(m_legendPanel);</span>
      }
      
<span class="nc bnc" id="L1145" title="All 2 branches missed.">      if (m_plotSurround.getComponentCount() &gt; 1 &amp;&amp;</span>
<span class="nc bnc" id="L1146" title="All 2 branches missed.">          m_plotSurround.getComponent(1) == m_attrib) {</span>
<span class="nc" id="L1147">        return;</span>
      }
      
<span class="nc bnc" id="L1150" title="All 2 branches missed.">      if (m_showAttBars) {</span>
        try {
<span class="nc" id="L1152">          m_attrib.setInstances(m_plot2D.getMasterPlot().m_plotInstances);</span>
<span class="nc" id="L1153">          m_attrib.setCindex(0);m_attrib.setX(0); m_attrib.setY(0);</span>
<span class="nc" id="L1154">          GridBagConstraints constraints = new GridBagConstraints();</span>
<span class="nc" id="L1155">          constraints.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L1156">          constraints.insets = new Insets(0, 0, 0, 0);</span>
<span class="nc" id="L1157">          constraints.gridx=4;constraints.gridy=0;constraints.weightx=1;</span>
<span class="nc" id="L1158">          constraints.gridwidth=1;constraints.gridheight=1;</span>
<span class="nc" id="L1159">          constraints.weighty=5;</span>
<span class="nc" id="L1160">          m_plotSurround.add(m_attrib, constraints);</span>
<span class="nc" id="L1161">        } catch (Exception ex) {</span>
<span class="nc" id="L1162">          System.err.println(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_SwitchToBars_Error_Text&quot;));</span>
<span class="nc bnc" id="L1163" title="All 2 branches missed.">          if (m_Log != null) {</span>
<span class="nc" id="L1164">            m_Log.logMessage(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_SwitchToBars_Log_LogMessage_Text&quot;));</span>
          }
        }
      }
<span class="nc" id="L1168">    }</span>

    /**
     * Reset the visualize panel's buttons and the plot panels instances
     * 
     * @param inst	the data
     * @param cIndex	the color index
     */
    private void plotReset(Instances inst, int cIndex) {
<span class="nc bnc" id="L1177" title="All 2 branches missed.">      if (m_splitListener == null) {</span>
<span class="nc" id="L1178">	m_submit.setText(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_PlotReset_Submit_SetText_Text&quot;));</span>
<span class="nc" id="L1179">	m_submit.setActionCommand(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_PlotReset_Submit_SetActionCommand_Text&quot;));</span>
	//if (m_origInstances == null || m_origInstances == inst) {
<span class="nc bnc" id="L1181" title="All 4 branches missed.">	if (m_originalPlot == null || m_originalPlot.m_plotInstances == inst) {</span>
<span class="nc" id="L1182">	  m_submit.setEnabled(false);</span>
	}
	else {
<span class="nc" id="L1185">	  m_submit.setEnabled(true);</span>
	}
      } 
      else {
<span class="nc" id="L1189">	m_submit.setEnabled(false);</span>
      }

<span class="nc" id="L1192">      m_plotInstances = inst;</span>
<span class="nc bnc" id="L1193" title="All 2 branches missed.">      if (m_splitListener != null) {</span>
<span class="nc" id="L1194">	m_plotInstances.randomize(new Random());</span>
      }
<span class="nc" id="L1196">      m_xIndex=0;</span>
<span class="nc" id="L1197">      m_yIndex=0;</span>
<span class="nc" id="L1198">      m_cIndex=cIndex;</span>
<span class="nc" id="L1199">      cancelShapes();</span>
<span class="nc" id="L1200">    }</span>

    /**
     * Set a list of colours to use for plotting points
     * @param cols a list of java.awt.Colors
     */
    public void setColours(FastVector cols) {
<span class="nc" id="L1207">      m_plot2D.setColours(cols);</span>
<span class="nc" id="L1208">      m_colorList = cols;</span>
<span class="nc" id="L1209">    }</span>
    
    /**
     * This will draw the shapes created onto the panel.
     * For best visual, this should be the first thing to be drawn
     * (and it currently is).
     * @param gx The graphics context.
     */
    private void drawShapes(Graphics gx) {
      //FastVector tmp = m_plot.getShapes();
      
<span class="nc bnc" id="L1220" title="All 2 branches missed.">      if (m_shapes != null) {</span>
	FastVector stmp;
	int x1, y1, x2, y2;
<span class="nc bnc" id="L1223" title="All 2 branches missed.">	for (int noa = 0; noa &lt; m_shapes.size(); noa++) {</span>
<span class="nc" id="L1224">	  stmp = (FastVector)m_shapes.elementAt(noa);</span>
<span class="nc bnc" id="L1225" title="All 2 branches missed.">	  if (((Double)stmp.elementAt(0)).intValue() == 1) {</span>
	    //then rectangle
<span class="nc" id="L1227">	    x1 = (int)m_plot2D.convertToPanelX(((Double)stmp.elementAt(1)).</span>
<span class="nc" id="L1228">				      doubleValue());</span>
<span class="nc" id="L1229">	    y1 = (int)m_plot2D.convertToPanelY(((Double)stmp.elementAt(2)).</span>
<span class="nc" id="L1230">				      doubleValue());</span>
<span class="nc" id="L1231">	    x2 = (int)m_plot2D.convertToPanelX(((Double)stmp.elementAt(3)).</span>
<span class="nc" id="L1232">				      doubleValue());</span>
<span class="nc" id="L1233">	    y2 = (int)m_plot2D.convertToPanelY(((Double)stmp.elementAt(4)).</span>
<span class="nc" id="L1234">				      doubleValue());</span>
	    
<span class="nc" id="L1236">	    gx.setColor(Color.gray);</span>
<span class="nc" id="L1237">	    gx.fillRect(x1, y1, x2 - x1, y2 - y1);</span>
<span class="nc" id="L1238">	    gx.setColor(Color.black);</span>
<span class="nc" id="L1239">	    gx.drawRect(x1, y1, x2 - x1, y2 - y1);</span>
	    
	  }
<span class="nc bnc" id="L1242" title="All 2 branches missed.">	  else if (((Double)stmp.elementAt(0)).intValue() == 2) {</span>
	    //then polygon
	    int[] ar1, ar2;
<span class="nc" id="L1245">	    ar1 = getXCoords(stmp);</span>
<span class="nc" id="L1246">	    ar2 = getYCoords(stmp);</span>
<span class="nc" id="L1247">	    gx.setColor(Color.gray);</span>
<span class="nc" id="L1248">	    gx.fillPolygon(ar1, ar2, (stmp.size() - 1) / 2); </span>
<span class="nc" id="L1249">	    gx.setColor(Color.black);</span>
<span class="nc" id="L1250">	    gx.drawPolyline(ar1, ar2, (stmp.size() - 1) / 2);</span>
	  }
<span class="nc bnc" id="L1252" title="All 2 branches missed.">	  else if (((Double)stmp.elementAt(0)).intValue() == 3) {</span>
	    //then polyline
	    int[] ar1, ar2;
<span class="nc" id="L1255">	    FastVector tmp = makePolygon(stmp);</span>
<span class="nc" id="L1256">	    ar1 = getXCoords(tmp);</span>
<span class="nc" id="L1257">	    ar2 = getYCoords(tmp);</span>
	    
<span class="nc" id="L1259">	    gx.setColor(Color.gray);</span>
<span class="nc" id="L1260">	    gx.fillPolygon(ar1, ar2, (tmp.size() - 1) / 2);</span>
<span class="nc" id="L1261">	    gx.setColor(Color.black);</span>
<span class="nc" id="L1262">	    gx.drawPolyline(ar1, ar2, (tmp.size() - 1) / 2);</span>
	  }
	}
      }
      
<span class="nc bnc" id="L1267" title="All 2 branches missed.">      if (m_shapePoints != null) {</span>
	//then the current image needs to be refreshed
<span class="nc bnc" id="L1269" title="All 2 branches missed.">	if (((Double)m_shapePoints.elementAt(0)).intValue() == 2 ||</span>
<span class="nc bnc" id="L1270" title="All 2 branches missed.">	    ((Double)m_shapePoints.elementAt(0)).intValue() == 3) {</span>
<span class="nc" id="L1271">	  gx.setColor(Color.black);</span>
<span class="nc" id="L1272">	  gx.setXORMode(Color.white);</span>
	  int[] ar1, ar2;
<span class="nc" id="L1274">	  ar1 = getXCoords(m_shapePoints);</span>
<span class="nc" id="L1275">	  ar2 = getYCoords(m_shapePoints);</span>
<span class="nc" id="L1276">	  gx.drawPolyline(ar1, ar2, (m_shapePoints.size() - 1) / 2);</span>
<span class="nc" id="L1277">	  m_newMousePos.width = (int)Math.ceil</span>
<span class="nc" id="L1278">	    (m_plot2D.convertToPanelX(((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L1279">			      (m_shapePoints.size() - 2)).doubleValue()));</span>
	  
<span class="nc" id="L1281">	  m_newMousePos.height = (int)Math.ceil</span>
<span class="nc" id="L1282">	    (m_plot2D.convertToPanelY(((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L1283">			      (m_shapePoints.size() - 1)).doubleValue()));</span>
	  
<span class="nc" id="L1285">	  gx.drawLine((int)Math.ceil</span>
<span class="nc" id="L1286">		     (m_plot2D.convertToPanelX(((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L1287">						(m_shapePoints.size() - 2)).</span>
<span class="nc" id="L1288">					       doubleValue())),</span>
<span class="nc" id="L1289">		      (int)Math.ceil(m_plot2D.convertToPanelY</span>
<span class="nc" id="L1290">				     (((Double)m_shapePoints.elementAt</span>
<span class="nc" id="L1291">				       (m_shapePoints.size() - 1)).</span>
<span class="nc" id="L1292">				      doubleValue())),</span>
<span class="nc" id="L1293">		      m_newMousePos.width, m_newMousePos.height);</span>
<span class="nc" id="L1294">	  gx.setPaintMode();</span>
	}
      }
<span class="nc" id="L1297">    }</span>
    
    /**
     * This is called for polylines to see where there two lines that
     * extend to infinity cut the border of the view.
     * @param x1 an x point along the line
     * @param y1 the accompanying y point.
     * @param x2 The x coord of the end point of the line.
     * @param y2 The y coord of the end point of the line.
     * @param x 0 or the width of the border line if it has one.
     * @param y 0 or the height of the border line if it has one.
     * @param offset The offset for the border line (either for x or y
     * dependant on which one doesn't change).
     * @return double array that contains the coordinate for the point 
     * that the polyline cuts the border (which ever side that may be).
     */
    private double[] lineIntersect(double x1, double y1, double x2, double y2, 
				   double x, double y, double offset) {
      //the first 4 params are thestart and end points of a line
      //the next param is either 0 for no change in x or change in x, 
      //the next param is the same for y
      //the final 1 is the offset for either x or y (which ever has no change)
      double xval;
      double yval;
<span class="nc" id="L1321">      double xn = -100, yn = -100;</span>
      double change;
<span class="nc bnc" id="L1323" title="All 2 branches missed.">      if (x == 0) {</span>
<span class="nc bnc" id="L1324" title="All 8 branches missed.">	if ((x1 &lt;= offset &amp;&amp; offset &lt; x2) || (x1 &gt;= offset &amp;&amp; offset &gt; x2)) {</span>
	  //then continue
<span class="nc" id="L1326">	  xval = x1 - x2;</span>
<span class="nc" id="L1327">	  change = (offset - x2) / xval;</span>
<span class="nc" id="L1328">	  yn = (y1 - y2) * change + y2;</span>
<span class="nc bnc" id="L1329" title="All 4 branches missed.">	  if (0 &lt;= yn &amp;&amp; yn &lt;= y) {</span>
	    //then good
<span class="nc" id="L1331">	    xn = offset;</span>
	  }
	  else {
	    //no intersect
<span class="nc" id="L1335">	    xn = -100;</span>
	  }
	}
      }
<span class="nc bnc" id="L1339" title="All 2 branches missed.">      else if (y == 0) {</span>
<span class="nc bnc" id="L1340" title="All 8 branches missed.">	if ((y1 &lt;= offset &amp;&amp; offset &lt; y2) || (y1 &gt;= offset &amp;&amp; offset &gt; y2)) {</span>
	  //the continue
<span class="nc" id="L1342">	  yval = (y1 - y2);</span>
<span class="nc" id="L1343">	  change = (offset - y2) / yval;</span>
<span class="nc" id="L1344">	  xn = (x1 - x2) * change + x2;</span>
<span class="nc bnc" id="L1345" title="All 4 branches missed.">	  if (0 &lt;= xn &amp;&amp; xn &lt;= x) {</span>
	    //then good
<span class="nc" id="L1347">	    yn = offset;</span>
	  }
	  else {
<span class="nc" id="L1350">	    xn = -100;</span>
	  }
	}
      }
<span class="nc" id="L1354">      double[] ret = new double[2];</span>
<span class="nc" id="L1355">      ret[0] = xn;</span>
<span class="nc" id="L1356">      ret[1] = yn;</span>
<span class="nc" id="L1357">      return ret;</span>
    }


    /**
     * This will convert a polyline to a polygon for drawing purposes
     * So that I can simply use the polygon drawing function.
     * @param v The polyline to convert.
     * @return A FastVector containing the polygon.
     */
    private FastVector makePolygon(FastVector v) {
<span class="nc" id="L1368">      FastVector building = new FastVector(v.size() + 10);</span>
      double x1, y1, x2, y2;
<span class="nc" id="L1370">      int edge1 = 0, edge2 = 0;</span>
<span class="nc bnc" id="L1371" title="All 2 branches missed.">      for (int noa = 0; noa &lt; v.size() - 2; noa++) {</span>
<span class="nc" id="L1372">	building.addElement(new Double(((Double)v.elementAt(noa)).</span>
<span class="nc" id="L1373">				       doubleValue()));</span>
      }
      
      //now clip the lines
      double[] new_coords;
      //note lineIntersect , expects the values to have been converted to 
      //screen coords
      //note the first point passed is the one that gets shifted.
<span class="nc" id="L1381">      x1 = m_plot2D.convertToPanelX(((Double)v.elementAt(1)).doubleValue());</span>
<span class="nc" id="L1382">      y1 = m_plot2D.convertToPanelY(((Double)v.elementAt(2)).doubleValue());</span>
<span class="nc" id="L1383">      x2 = m_plot2D.convertToPanelX(((Double)v.elementAt(3)).doubleValue());</span>
<span class="nc" id="L1384">      y2 = m_plot2D.convertToPanelY(((Double)v.elementAt(4)).doubleValue());</span>

<span class="nc bnc" id="L1386" title="All 2 branches missed.">      if (x1 &lt; 0) {</span>
	//test left
<span class="nc" id="L1388">	new_coords = lineIntersect(x1, y1, x2, y2, 0, this.getHeight(), 0);</span>
<span class="nc" id="L1389">	edge1 = 0;</span>
<span class="nc bnc" id="L1390" title="All 2 branches missed.">	if (new_coords[0] &lt; 0) {</span>
	  //then not left
<span class="nc bnc" id="L1392" title="All 2 branches missed.">	  if (y1 &lt; 0) {</span>
	    //test top
<span class="nc" id="L1394">	    new_coords = lineIntersect(x1, y1, x2, y2, this.getWidth(), 0, 0);</span>
<span class="nc" id="L1395">	    edge1 = 1;</span>
	  }
	  else {
	    //test bottom
<span class="nc" id="L1399">	    new_coords = lineIntersect(x1, y1, x2, y2, this.getWidth(), 0, </span>
<span class="nc" id="L1400">				       this.getHeight());</span>
<span class="nc" id="L1401">	    edge1 = 3;</span>
	  }
	}
      }
<span class="nc bnc" id="L1405" title="All 2 branches missed.">      else if (x1 &gt; this.getWidth()) {</span>
	//test right
<span class="nc" id="L1407">	new_coords = lineIntersect(x1, y1, x2, y2, 0, this.getHeight(), </span>
<span class="nc" id="L1408">				   this.getWidth());</span>
<span class="nc" id="L1409">	edge1 = 2;</span>
<span class="nc bnc" id="L1410" title="All 2 branches missed.">	if (new_coords[0] &lt; 0) {</span>
	  //then not right
<span class="nc bnc" id="L1412" title="All 2 branches missed.">	  if (y1 &lt; 0) {</span>
	    //test top
<span class="nc" id="L1414">	    new_coords = lineIntersect(x1, y1, x2, y2, this.getWidth(), 0, 0);</span>
<span class="nc" id="L1415">	    edge1 = 1;</span>
	  }
	  else {
	    //test bottom
<span class="nc" id="L1419">	    new_coords = lineIntersect(x1, y1, x2, y2, this.getWidth(), 0, </span>
<span class="nc" id="L1420">				       this.getHeight());</span>
<span class="nc" id="L1421">	    edge1 = 3;</span>
	  }
	}
      }
<span class="nc bnc" id="L1425" title="All 2 branches missed.">      else if (y1 &lt; 0) {</span>
	//test top
<span class="nc" id="L1427">	new_coords = lineIntersect(x1, y1, x2, y2, this.getWidth(), 0, 0);</span>
<span class="nc" id="L1428">	edge1 = 1;</span>
      }
      else {
	//test bottom
<span class="nc" id="L1432">	new_coords = lineIntersect(x1, y1, x2, y2, this.getWidth(), 0, </span>
<span class="nc" id="L1433">				   this.getHeight());</span>
<span class="nc" id="L1434">	edge1 = 3;</span>
      }
      
<span class="nc" id="L1437">      building.setElementAt(new </span>
<span class="nc" id="L1438">	Double(m_plot2D.convertToAttribX(new_coords[0])), 1);</span>
<span class="nc" id="L1439">      building.setElementAt(new </span>
<span class="nc" id="L1440">	Double(m_plot2D.convertToAttribY(new_coords[1])), 2);</span>

<span class="nc" id="L1442">      x1 = m_plot2D.convertToPanelX(((Double)v.elementAt(v.size() - 4)).</span>
<span class="nc" id="L1443">				    doubleValue());</span>
<span class="nc" id="L1444">      y1 = m_plot2D.convertToPanelY(((Double)v.elementAt(v.size() - 3)).</span>
<span class="nc" id="L1445">				    doubleValue());</span>
<span class="nc" id="L1446">      x2 = m_plot2D.convertToPanelX(((Double)v.elementAt(v.size() - 6)).</span>
<span class="nc" id="L1447">				    doubleValue());</span>
<span class="nc" id="L1448">      y2 = m_plot2D.convertToPanelY(((Double)v.elementAt(v.size() - 5)).</span>
<span class="nc" id="L1449">				    doubleValue());</span>
      
<span class="nc bnc" id="L1451" title="All 2 branches missed.">      if (x1 &lt; 0) {</span>
	//test left
<span class="nc" id="L1453">	new_coords = lineIntersect(x1, y1, x2, y2, 0, this.getHeight(), 0);</span>
<span class="nc" id="L1454">	edge2 = 0;</span>
<span class="nc bnc" id="L1455" title="All 2 branches missed.">	if (new_coords[0] &lt; 0) {</span>
	  //then not left
<span class="nc bnc" id="L1457" title="All 2 branches missed.">	  if (y1 &lt; 0) {</span>
	    //test top
<span class="nc" id="L1459">	    new_coords = lineIntersect(x1, y1, x2, y2, this.getWidth(), 0, 0);</span>
<span class="nc" id="L1460">	    edge2 = 1;</span>
	  }
	  else {
	    //test bottom
<span class="nc" id="L1464">	    new_coords = lineIntersect(x1, y1, x2, y2, this.getWidth(), 0, </span>
<span class="nc" id="L1465">				       this.getHeight());</span>
<span class="nc" id="L1466">	    edge2 = 3;</span>
	  }
	}
      }
<span class="nc bnc" id="L1470" title="All 2 branches missed.">      else if (x1 &gt; this.getWidth()) {</span>
	//test right
<span class="nc" id="L1472">	new_coords = lineIntersect(x1, y1, x2, y2, 0, this.getHeight(), </span>
<span class="nc" id="L1473">				   this.getWidth());</span>
<span class="nc" id="L1474">	edge2 = 2;</span>
<span class="nc bnc" id="L1475" title="All 2 branches missed.">	if (new_coords[0] &lt; 0) {</span>
	  //then not right
<span class="nc bnc" id="L1477" title="All 2 branches missed.">	  if (y1 &lt; 0) {</span>
	    //test top
<span class="nc" id="L1479">	    new_coords = lineIntersect(x1, y1, x2, y2, this.getWidth(), 0, 0);</span>
<span class="nc" id="L1480">	    edge2 = 1;</span>
	  }
	  else {
	    //test bottom
<span class="nc" id="L1484">	    new_coords = lineIntersect(x1, y1, x2, y2, this.getWidth(), 0, </span>
<span class="nc" id="L1485">				       this.getHeight());</span>
<span class="nc" id="L1486">	    edge2 = 3;</span>
	  }
	}
      }
<span class="nc bnc" id="L1490" title="All 2 branches missed.">      else if (y1 &lt; 0) {</span>
	//test top
<span class="nc" id="L1492">	new_coords = lineIntersect(x1, y1, x2, y2, this.getWidth(), 0, 0);</span>
<span class="nc" id="L1493">	edge2 = 1;</span>
      }
      else {
	//test bottom
<span class="nc" id="L1497">	new_coords = lineIntersect(x1, y1, x2, y2, this.getWidth(), 0, </span>
<span class="nc" id="L1498">				   this.getHeight());</span>
<span class="nc" id="L1499">	edge2 = 3;</span>
      }
      
<span class="nc" id="L1502">      building.setElementAt(new </span>
<span class="nc" id="L1503">	Double(m_plot2D.convertToAttribX(new_coords[0])), building.size() - 2);</span>
<span class="nc" id="L1504">      building.setElementAt(new </span>
<span class="nc" id="L1505">	Double(m_plot2D.convertToAttribY(new_coords[1])), building.size() - 1);</span>
      

      //trust me this complicated piece of code will
      //determine what points on the boundary of the view to add to the polygon
      int xp, yp;

<span class="nc" id="L1512">      xp = this.getWidth() * ((edge2 &amp; 1) ^ ((edge2 &amp; 2) / 2));</span>
<span class="nc" id="L1513">      yp = this.getHeight() * ((edge2 &amp; 2) / 2);</span>
      //System.out.println(((-1 + 4) % 4) + &quot; hoi&quot;);
      
<span class="nc bnc" id="L1516" title="All 2 branches missed.">      if (inPolyline(v, m_plot2D.convertToAttribX(xp), </span>
<span class="nc" id="L1517">		     m_plot2D.convertToAttribY(yp))) {</span>
	//then add points in a clockwise direction
<span class="nc" id="L1519">	building.addElement(new Double(m_plot2D.convertToAttribX(xp)));</span>
<span class="nc" id="L1520">	building.addElement(new Double(m_plot2D.convertToAttribY(yp)));</span>
<span class="nc bnc" id="L1521" title="All 2 branches missed.">	for (int noa = (edge2 + 1) % 4; noa != edge1; noa = (noa + 1) % 4) {</span>
<span class="nc" id="L1522">	  xp = this.getWidth() * ((noa &amp; 1) ^ ((noa &amp; 2) / 2));</span>
<span class="nc" id="L1523">	  yp = this.getHeight() * ((noa &amp; 2) / 2);</span>
<span class="nc" id="L1524">	  building.addElement(new Double(m_plot2D.convertToAttribX(xp)));</span>
<span class="nc" id="L1525">	  building.addElement(new Double(m_plot2D.convertToAttribY(yp)));</span>
	}
      }
      else {
<span class="nc" id="L1529">	xp = this.getWidth() * ((edge2 &amp; 2) / 2);</span>
<span class="nc" id="L1530">	yp = this.getHeight() * (1 &amp; ~((edge2 &amp; 1) ^ ((edge2 &amp; 2) / 2)));</span>
<span class="nc bnc" id="L1531" title="All 2 branches missed.">	if (inPolyline(v, m_plot2D.convertToAttribX(xp), </span>
<span class="nc" id="L1532">		       m_plot2D.convertToAttribY(yp))) {</span>
	  //then add points in anticlockwise direction
<span class="nc" id="L1534">	  building.addElement(new Double(m_plot2D.convertToAttribX(xp)));</span>
<span class="nc" id="L1535">	  building.addElement(new Double(m_plot2D.convertToAttribY(yp)));</span>
<span class="nc bnc" id="L1536" title="All 2 branches missed.">	  for (int noa = (edge2 + 3) % 4; noa != edge1; noa = (noa + 3) % 4) {</span>
<span class="nc" id="L1537">	    xp = this.getWidth() * ((noa &amp; 2) / 2);</span>
<span class="nc" id="L1538">	    yp = this.getHeight() * (1 &amp; ~((noa &amp; 1) ^ ((noa &amp; 2) / 2)));</span>
<span class="nc" id="L1539">	    building.addElement(new Double(m_plot2D.convertToAttribX(xp)));</span>
<span class="nc" id="L1540">	    building.addElement(new Double(m_plot2D.convertToAttribY(yp)));</span>
	  }
	}
      }
<span class="nc" id="L1544">      return building;</span>
    }

    /**
     * This will extract from a polygon shape its x coodrdinates
     * so that an awt.Polygon can be created.
     * @param v The polygon shape.
     * @return an int array containing the screen x coords for the polygon.
     */
    private int[] getXCoords(FastVector v) {
<span class="nc" id="L1554">      int cach = (v.size() - 1) / 2;</span>
<span class="nc" id="L1555">      int[] ar = new int[cach];</span>
<span class="nc bnc" id="L1556" title="All 2 branches missed.">      for (int noa = 0; noa &lt; cach; noa ++) {</span>
<span class="nc" id="L1557">	ar[noa] = (int)m_plot2D.convertToPanelX(((Double)v.elementAt(noa * 2 +</span>
<span class="nc" id="L1558">						1)).doubleValue());</span>
      }
<span class="nc" id="L1560">      return ar;</span>
    }

    /**
     * This will extract from a polygon shape its y coordinates
     * so that an awt.Polygon can be created.
     * @param v The polygon shape.
     * @return an int array containing the screen y coords for the polygon.
     */
    private int[] getYCoords(FastVector v) {
<span class="nc" id="L1570">      int cach = (v.size() - 1) / 2;</span>
<span class="nc" id="L1571">      int[] ar = new int[cach];</span>
<span class="nc bnc" id="L1572" title="All 2 branches missed.">      for (int noa = 0; noa &lt; cach; noa ++) {</span>
<span class="nc" id="L1573">	ar[noa] = (int)m_plot2D.</span>
<span class="nc" id="L1574">	  convertToPanelY(((Double)v.elementAt(noa * 2 + 2)).</span>
<span class="nc" id="L1575">			  doubleValue());</span>
      }
<span class="nc" id="L1577">      return ar;</span>
    }
    
    /**
     * Renders the polygons if necessary
     * @param gx the graphics context
     */
    public void prePlot(Graphics gx) {
<span class="nc" id="L1585">      super.paintComponent(gx);</span>
<span class="nc bnc" id="L1586" title="All 2 branches missed.">      if (m_plotInstances != null) {</span>
<span class="nc" id="L1587">	drawShapes(gx); // will be in paintComponent of ShapePlot2D</span>
      }
<span class="nc" id="L1589">    }</span>
  }



  /** default colours for colouring discrete class */
<span class="nc" id="L1595">  protected Color [] m_DefaultColors = {Color.blue,</span>
<span class="nc" id="L1596">					Color.red,</span>
<span class="nc" id="L1597">					Color.green,</span>
<span class="nc" id="L1598">					Color.cyan,</span>
<span class="nc" id="L1599">					Color.pink,</span>
<span class="nc" id="L1600">					new Color(255, 0, 255),</span>
<span class="nc" id="L1601">					Color.orange,</span>
<span class="nc" id="L1602">					new Color(255, 0, 0),</span>
<span class="nc" id="L1603">					new Color(0, 255, 0),</span>
<span class="nc" id="L1604">					Color.white};</span>
  
  /** Lets the user select the attribute for the x axis */
<span class="nc" id="L1607">  protected JComboBox m_XCombo = new JComboBox();</span>

  /** Lets the user select the attribute for the y axis */
<span class="nc" id="L1610">  protected JComboBox m_YCombo = new JComboBox();</span>

  /** Lets the user select the attribute to use for colouring */
<span class="nc" id="L1613">  protected JComboBox m_ColourCombo = new JComboBox();</span>
  
  /** Lets the user select the shape they want to create for instance 
   * selection. */
<span class="nc" id="L1617">  protected JComboBox m_ShapeCombo = new JComboBox();</span>

  /** Button for the user to enter the splits. */
<span class="nc" id="L1620">  protected JButton m_submit = new JButton(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_Submit_JButton_Text&quot;));</span>
  
  /** Button for the user to remove all splits. */
<span class="nc" id="L1623">  protected JButton m_cancel = new JButton(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_Cancel_JButton_Text&quot;));</span>

  /** Button for the user to open the visualized set of instances */
<span class="nc" id="L1626">  protected JButton m_openBut = new JButton(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_OpenBut_JButton_Text&quot;));</span>

  /** Button for the user to save the visualized set of instances */
<span class="nc" id="L1629">  protected JButton m_saveBut = new JButton(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_SaveBut_JButton_Text&quot;));</span>

  /** Stop the combos from growing out of control */
<span class="nc" id="L1632">  private Dimension COMBO_SIZE = new Dimension(250, m_saveBut</span>
<span class="nc" id="L1633">					       .getPreferredSize().height);</span>

  /** file chooser for saving instances */
<span class="nc" id="L1636">  protected JFileChooser m_FileChooser </span>
<span class="nc" id="L1637">    = new JFileChooser(new File(System.getProperty(&quot;user.dir&quot;)));</span>

  /** Filter to ensure only arff files are selected */  
<span class="nc" id="L1640">  protected FileFilter m_ArffFilter =</span>
<span class="nc" id="L1641">    new ExtensionFileFilter(Instances.FILE_EXTENSION, Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_ArffFilter_FileFilter_Text&quot;));</span>

  /** Label for the jitter slider */
<span class="nc" id="L1644">  protected JLabel m_JitterLab= new JLabel(Messages.getInstance().getString(&quot;VisualizePanel_PlotPanel_JitterLab_JLabel_Text&quot;),SwingConstants.RIGHT);</span>

  /** The jitter slider */
<span class="nc" id="L1647">  protected JSlider m_Jitter = new JSlider(0,50,0);</span>

  /** The panel that displays the plot */
<span class="nc" id="L1650">  protected PlotPanel m_plot = new PlotPanel();</span>

  /** The panel that displays the attributes , using color to represent 
   * another attribute. */
<span class="nc" id="L1654">  protected AttributePanel m_attrib = </span>
<span class="nc" id="L1655">    new AttributePanel(m_plot.m_plot2D.getBackground());</span>

  /** The panel that displays legend info if there is more than one plot */
<span class="nc" id="L1658">  protected LegendPanel m_legendPanel = new LegendPanel();</span>

  /** Panel that surrounds the plot panel with a titled border */
<span class="nc" id="L1661">  protected JPanel m_plotSurround = new JPanel();</span>

  /** Panel that surrounds the class panel with a titled border */
<span class="nc" id="L1664">  protected JPanel m_classSurround = new JPanel();</span>

  /** An optional listener that we will inform when ComboBox selections
      change */
<span class="nc" id="L1668">  protected ActionListener listener = null;</span>

  /** An optional listener that we will inform when the user creates a 
   * split to seperate instances. */
<span class="nc" id="L1672">  protected VisualizePanelListener m_splitListener = null;</span>

  /** The name of the plot (not currently displayed, but can be used
      in the containing Frame or Panel) */
<span class="nc" id="L1676">  protected String m_plotName = &quot;&quot;;</span>

  /** The panel that displays the legend for the colouring attribute */
<span class="nc" id="L1679">  protected ClassPanel m_classPanel = </span>
<span class="nc" id="L1680">    new ClassPanel(m_plot.m_plot2D.getBackground());</span>
  
  /** The list of the colors used */
  protected FastVector m_colorList;

  /** These hold the names of preferred columns to visualize on---if the
      user has defined them in the Visualize.props file */
<span class="nc" id="L1687">  protected String m_preferredXDimension = null;</span>
<span class="nc" id="L1688">  protected String m_preferredYDimension = null;</span>
<span class="nc" id="L1689">  protected String m_preferredColourDimension = null;</span>

  /** Show the attribute bar panel */
<span class="nc" id="L1692">  protected boolean m_showAttBars = true;</span>
  
  /** Show the class panel **/
<span class="nc" id="L1695">  protected boolean m_showClassPanel = true;</span>

  /** the logger */
  protected Logger m_Log;
  
  /**
   * Sets the Logger to receive informational messages
   *
   * @param newLog the Logger that will now get info messages
   */
  public void setLog(Logger newLog) {
<span class="nc" id="L1706">    m_Log = newLog;</span>
<span class="nc" id="L1707">  }</span>
  
  /**
   * Set whether the attribute bars should be shown or not.
   * If turned off via this method then any setting in the
   * properties file (if exists) is ignored.
   * 
   * @param sab false if attribute bars are not to be displayed.
   */
  public void setShowAttBars(boolean sab) {
<span class="nc bnc" id="L1717" title="All 4 branches missed.">    if (!sab &amp;&amp; m_showAttBars) {</span>
<span class="nc" id="L1718">      m_plotSurround.remove(m_attrib);</span>
<span class="nc bnc" id="L1719" title="All 4 branches missed.">    } else if (sab &amp;&amp; !m_showAttBars) {</span>
<span class="nc" id="L1720">      GridBagConstraints constraints = new GridBagConstraints();</span>
<span class="nc" id="L1721">      constraints.insets = new Insets(0, 0, 0, 0);</span>
<span class="nc" id="L1722">      constraints.gridx=4;constraints.gridy=0;constraints.weightx=1;</span>
<span class="nc" id="L1723">      constraints.gridwidth=1;constraints.gridheight=1;constraints.weighty=5;</span>
<span class="nc" id="L1724">      m_plotSurround.add(m_attrib, constraints);</span>
    }
<span class="nc" id="L1726">    m_showAttBars = sab;</span>
<span class="nc" id="L1727">    repaint();</span>
<span class="nc" id="L1728">  }</span>
  
  /**
   * Gets whether or not attribute bars are being displayed.
   * 
   * @return true if attribute bars are being displayed.
   */
  public boolean getShowAttBars() {
<span class="nc" id="L1736">    return m_showAttBars;</span>
  }
  
  /**
   * Set whether the class panel should be shown or not.
   * 
   * @param scp false if class panel is not to be displayed
   */
  public void setShowClassPanel(boolean scp) {
<span class="nc bnc" id="L1745" title="All 4 branches missed.">    if (!scp &amp;&amp; m_showClassPanel) {</span>
<span class="nc" id="L1746">      remove(m_classSurround);</span>
<span class="nc bnc" id="L1747" title="All 4 branches missed.">    } else if (scp &amp;&amp; !m_showClassPanel) {</span>
<span class="nc" id="L1748">      add(m_classSurround, BorderLayout.SOUTH);</span>
    }
<span class="nc" id="L1750">    m_showClassPanel = scp;</span>
<span class="nc" id="L1751">    repaint();</span>
<span class="nc" id="L1752">  }</span>
  
  /**
   * Gets whether or not the class panel is being displayed.
   * 
   * @return true if the class panel is being displayed.
   */
  public boolean getShowClassPanel() {
<span class="nc" id="L1760">    return m_showClassPanel;</span>
  }

  /** 
   * This constructor allows a VisualizePanelListener to be set. 
   * 
   * @param ls		the listener to use
   */
  public VisualizePanel(VisualizePanelListener ls) {
<span class="nc" id="L1769">    this();</span>
<span class="nc" id="L1770">    m_splitListener = ls;</span>
<span class="nc" id="L1771">  }</span>

  /**
   * Set the properties for the VisualizePanel
   * 
   * @param relationName	the name of the relation, can be null
   */
  private void setProperties(String relationName) {
<span class="nc bnc" id="L1779" title="All 2 branches missed.">    if (VisualizeUtils.VISUALIZE_PROPERTIES != null) {</span>
<span class="nc" id="L1780">      String thisClass = this.getClass().getName();</span>
<span class="nc bnc" id="L1781" title="All 2 branches missed.">      if (relationName == null) {</span>
	
<span class="nc" id="L1783">	String showAttBars = thisClass+&quot;.displayAttributeBars&quot;;</span>

<span class="nc" id="L1785">	String val = VisualizeUtils.VISUALIZE_PROPERTIES.</span>
<span class="nc" id="L1786">	  getProperty(showAttBars);</span>
<span class="nc bnc" id="L1787" title="All 2 branches missed.">	if (val == null) {</span>
	  //System.err.println(&quot;Displaying attribute bars &quot;);
//	  m_showAttBars = true;
	} else {
	  // only check if this hasn't been turned off programatically 
<span class="nc bnc" id="L1792" title="All 2 branches missed.">	  if (m_showAttBars) {</span>
<span class="nc bnc" id="L1793" title="All 4 branches missed.">	    if (val.compareTo(&quot;true&quot;) == 0 || val.compareTo(&quot;on&quot;) == 0) {</span>
	      //System.err.println(&quot;Displaying attribute bars &quot;);
<span class="nc" id="L1795">	      m_showAttBars = true;</span>
	    } else {
<span class="nc" id="L1797">	      m_showAttBars = false;</span>
	    }
	  }
	}
      } else {
	/*
	System.err.println(&quot;Looking for preferred visualization dimensions for &quot;
			   +relationName);
	*/
<span class="nc" id="L1806">	String xcolKey = thisClass+&quot;.&quot;+relationName+&quot;.XDimension&quot;;</span>
<span class="nc" id="L1807">	String ycolKey = thisClass+&quot;.&quot;+relationName+&quot;.YDimension&quot;;</span>
<span class="nc" id="L1808">	String ccolKey = thisClass+&quot;.&quot;+relationName+&quot;.ColourDimension&quot;;</span>
      
<span class="nc" id="L1810">	m_preferredXDimension = VisualizeUtils.VISUALIZE_PROPERTIES.</span>
<span class="nc" id="L1811">	  getProperty(xcolKey);</span>
	/*
	if (m_preferredXDimension == null) {
	  System.err.println(&quot;No preferred X dimension found in &quot;
			     +VisualizeUtils.PROPERTY_FILE
			     +&quot; for &quot;+xcolKey);
	} else {
	  System.err.println(&quot;Setting preferred X dimension to &quot;
			     +m_preferredXDimension);
			     }*/
<span class="nc" id="L1821">	m_preferredYDimension = VisualizeUtils.VISUALIZE_PROPERTIES.</span>
<span class="nc" id="L1822">	  getProperty(ycolKey);</span>
	/*
	if (m_preferredYDimension == null) {
	  System.err.println(&quot;No preferred Y dimension found in &quot;
			     +VisualizeUtils.PROPERTY_FILE
			     +&quot; for &quot;+ycolKey);
	} else {
	  System.err.println(&quot;Setting preferred dimension Y to &quot;
			     +m_preferredYDimension);
			     }*/
<span class="nc" id="L1832">	m_preferredColourDimension = VisualizeUtils.VISUALIZE_PROPERTIES.</span>
<span class="nc" id="L1833">	  getProperty(ccolKey);</span>
	/*
	if (m_preferredColourDimension == null) {
	  System.err.println(&quot;No preferred Colour dimension found in &quot;
			     +VisualizeUtils.PROPERTY_FILE
			     +&quot; for &quot;+ycolKey);
	} else {
	  System.err.println(&quot;Setting preferred Colour dimension to &quot;
			     +m_preferredColourDimension);
			     }*/
      }
    }
<span class="nc" id="L1845">  }</span>

  /**
   * Constructor
   */
  public VisualizePanel() {
<span class="nc" id="L1851">    super();</span>
<span class="nc" id="L1852">    setProperties(null);</span>
<span class="nc" id="L1853">    m_FileChooser.setFileFilter(m_ArffFilter);</span>
<span class="nc" id="L1854">    m_FileChooser.setFileSelectionMode(JFileChooser.FILES_ONLY);</span>

<span class="nc" id="L1856">    m_XCombo.setToolTipText(Messages.getInstance().getString(&quot;VisualizePanel_XCombo_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L1857">    m_YCombo.setToolTipText(Messages.getInstance().getString(&quot;VisualizePanel_YCombo_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L1858">    m_ColourCombo.setToolTipText(Messages.getInstance().getString(&quot;VisualizePanel_ColourCombo_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L1859">    m_ShapeCombo.setToolTipText(Messages.getInstance().getString(&quot;VisualizePanel_ShapeCombo_SetToolTipText_Text&quot;)); </span>

<span class="nc" id="L1861">    m_XCombo.setPreferredSize(COMBO_SIZE);</span>
<span class="nc" id="L1862">    m_YCombo.setPreferredSize(COMBO_SIZE);</span>
<span class="nc" id="L1863">    m_ColourCombo.setPreferredSize(COMBO_SIZE);</span>
<span class="nc" id="L1864">    m_ShapeCombo.setPreferredSize(COMBO_SIZE);</span>

<span class="nc" id="L1866">    m_XCombo.setMaximumSize(COMBO_SIZE);</span>
<span class="nc" id="L1867">    m_YCombo.setMaximumSize(COMBO_SIZE);</span>
<span class="nc" id="L1868">    m_ColourCombo.setMaximumSize(COMBO_SIZE);</span>
<span class="nc" id="L1869">    m_ShapeCombo.setMaximumSize(COMBO_SIZE);</span>
    
<span class="nc" id="L1871">    m_XCombo.setMinimumSize(COMBO_SIZE);</span>
<span class="nc" id="L1872">    m_YCombo.setMinimumSize(COMBO_SIZE);</span>
<span class="nc" id="L1873">    m_ColourCombo.setMinimumSize(COMBO_SIZE);</span>
<span class="nc" id="L1874">    m_ShapeCombo.setMinimumSize(COMBO_SIZE);</span>
    //////////
<span class="nc" id="L1876">    m_XCombo.setEnabled(false);</span>
<span class="nc" id="L1877">    m_YCombo.setEnabled(false);</span>
<span class="nc" id="L1878">    m_ColourCombo.setEnabled(false);</span>
<span class="nc" id="L1879">    m_ShapeCombo.setEnabled(false);</span>

    // tell the class panel and the legend panel that we want to know when 
    // colours change
<span class="nc" id="L1883">    m_classPanel.addRepaintNotify(this);</span>
<span class="nc" id="L1884">    m_legendPanel.addRepaintNotify(this);</span>
    
    // Check the default colours against the background colour of the
    // plot panel. If any are equal to the background colour then
    // change them (so they are visible :-)
<span class="nc bnc" id="L1889" title="All 2 branches missed.">    for (int i = 0; i &lt; m_DefaultColors.length; i++) {</span>
<span class="nc" id="L1890">      Color c = m_DefaultColors[i];</span>
<span class="nc bnc" id="L1891" title="All 2 branches missed.">      if (c.equals(m_plot.m_plot2D.getBackground())) {</span>
<span class="nc" id="L1892">        int red = c.getRed();</span>
<span class="nc" id="L1893">        int blue = c.getBlue();</span>
<span class="nc" id="L1894">        int green = c.getGreen();</span>
<span class="nc bnc" id="L1895" title="All 2 branches missed.">        red += (red &lt; 128) ? (255 - red) / 2 : -(red / 2);</span>
<span class="nc bnc" id="L1896" title="All 2 branches missed.">        blue += (blue &lt; 128) ? (blue - red) / 2 : -(blue / 2);</span>
<span class="nc bnc" id="L1897" title="All 2 branches missed.">        green += (green&lt; 128) ? (255 - green) / 2 : -(green / 2);</span>
<span class="nc" id="L1898">        m_DefaultColors[i] = new Color(red, green, blue);</span>
      }
    }
<span class="nc" id="L1901">    m_classPanel.setDefaultColourList(m_DefaultColors);</span>
<span class="nc" id="L1902">    m_attrib.setDefaultColourList(m_DefaultColors);</span>

<span class="nc" id="L1904">    m_colorList = new FastVector(10);</span>
<span class="nc bnc" id="L1905" title="All 2 branches missed.">    for (int noa = m_colorList.size(); noa &lt; 10; noa++) {</span>
<span class="nc" id="L1906">      Color pc = m_DefaultColors[noa % 10];</span>
<span class="nc" id="L1907">      int ija =  noa / 10;</span>
<span class="nc" id="L1908">      ija *= 2; </span>
<span class="nc bnc" id="L1909" title="All 2 branches missed.">      for (int j=0;j&lt;ija;j++) {</span>
<span class="nc" id="L1910">	pc = pc.darker();</span>
      }
      
<span class="nc" id="L1913">      m_colorList.addElement(pc);</span>
    }
<span class="nc" id="L1915">    m_plot.setColours(m_colorList);</span>
<span class="nc" id="L1916">    m_classPanel.setColours(m_colorList);</span>
<span class="nc" id="L1917">    m_attrib.setColours(m_colorList);</span>
<span class="nc" id="L1918">    m_attrib.addAttributePanelListener(new AttributePanelListener() {</span>
	public void attributeSelectionChange(AttributePanelEvent e) {
<span class="nc bnc" id="L1920" title="All 2 branches missed.">	  if (e.m_xChange) {</span>
<span class="nc" id="L1921">	    m_XCombo.setSelectedIndex(e.m_indexVal);</span>
	  } else {
<span class="nc" id="L1923">	    m_YCombo.setSelectedIndex(e.m_indexVal);</span>
	  }
<span class="nc" id="L1925">	}</span>
      });
    
<span class="nc" id="L1928">    m_XCombo.addActionListener(new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1930">	  int selected = m_XCombo.getSelectedIndex();</span>
<span class="nc bnc" id="L1931" title="All 2 branches missed.">	  if (selected &lt; 0) {</span>
<span class="nc" id="L1932">	    selected = 0;</span>
	  }
<span class="nc" id="L1934">	  m_plot.setXindex(selected);</span>
	 
	  // try sending on the event if anyone is listening
<span class="nc bnc" id="L1937" title="All 2 branches missed.">	  if (listener != null) {</span>
<span class="nc" id="L1938">	    listener.actionPerformed(e);</span>
	  }
<span class="nc" id="L1940">	}</span>
      });

<span class="nc" id="L1943">    m_YCombo.addActionListener(new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1945">	  int selected = m_YCombo.getSelectedIndex();</span>
<span class="nc bnc" id="L1946" title="All 2 branches missed.">	  if (selected &lt; 0) {</span>
<span class="nc" id="L1947">	    selected = 0;</span>
	  }
<span class="nc" id="L1949">	  m_plot.setYindex(selected);</span>
	 
	  // try sending on the event if anyone is listening
<span class="nc bnc" id="L1952" title="All 2 branches missed.">	  if (listener != null) {</span>
<span class="nc" id="L1953">	    listener.actionPerformed(e);</span>
	  }
<span class="nc" id="L1955">	}</span>
      });

<span class="nc" id="L1958">    m_ColourCombo.addActionListener(new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1960">	  int selected = m_ColourCombo.getSelectedIndex();</span>
<span class="nc bnc" id="L1961" title="All 2 branches missed.">	  if (selected &lt; 0) {</span>
<span class="nc" id="L1962">	    selected = 0;</span>
	  }
<span class="nc" id="L1964">	  m_plot.setCindex(selected);</span>

<span class="nc bnc" id="L1966" title="All 2 branches missed.">	  if (listener != null) {</span>
<span class="nc" id="L1967">	    listener.actionPerformed(e);</span>
	  }
<span class="nc" id="L1969">	}</span>
      });
    
    ///////
<span class="nc" id="L1973">    m_ShapeCombo.addActionListener(new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1975">	  int selected = m_ShapeCombo.getSelectedIndex();</span>
<span class="nc bnc" id="L1976" title="All 2 branches missed.">	  if (selected &lt; 0) {</span>
<span class="nc" id="L1977">	    selected = 0;</span>
	  }
<span class="nc" id="L1979">	  m_plot.setSindex(selected);</span>
	  // try sending on the event if anyone is listening
<span class="nc bnc" id="L1981" title="All 2 branches missed.">	  if (listener != null) {</span>
<span class="nc" id="L1982">	    listener.actionPerformed(e);</span>
	  }
<span class="nc" id="L1984">	}</span>
      });


    ///////////////////////////////////////

<span class="nc" id="L1990">    m_Jitter.addChangeListener(new ChangeListener() {</span>
	public void stateChanged(ChangeEvent e) {
<span class="nc" id="L1992">	  m_plot.setJitter(m_Jitter.getValue());</span>
<span class="nc" id="L1993">	}</span>
      });

<span class="nc" id="L1996">    m_openBut.setToolTipText(Messages.getInstance().getString(&quot;VisualizePanel_OpenBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L1997">    m_openBut.addActionListener(new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1999">	  openVisibleInstances();</span>
<span class="nc" id="L2000">	}</span>
      });
    
<span class="nc" id="L2003">    m_saveBut.setEnabled(false);</span>
<span class="nc" id="L2004">    m_saveBut.setToolTipText(Messages.getInstance().getString(&quot;VisualizePanel_SaveBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L2005">    m_saveBut.addActionListener(new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2007">	  saveVisibleInstances();</span>
<span class="nc" id="L2008">	}</span>
      });
    
<span class="nc" id="L2011">    JPanel combos = new JPanel();</span>
<span class="nc" id="L2012">    GridBagLayout gb = new GridBagLayout();</span>
<span class="nc" id="L2013">    GridBagConstraints constraints = new GridBagConstraints();</span>


<span class="nc" id="L2016">    m_XCombo.setLightWeightPopupEnabled(false);</span>
<span class="nc" id="L2017">    m_YCombo.setLightWeightPopupEnabled(false);</span>
<span class="nc" id="L2018">    m_ColourCombo.setLightWeightPopupEnabled(false);</span>
<span class="nc" id="L2019">    m_ShapeCombo.setLightWeightPopupEnabled(false);</span>
<span class="nc" id="L2020">    combos.setBorder(BorderFactory.createEmptyBorder(10, 5, 10, 5));</span>

<span class="nc" id="L2022">    combos.setLayout(gb);</span>
<span class="nc" id="L2023">    constraints.gridx=0;constraints.gridy=0;constraints.weightx=5;</span>
<span class="nc" id="L2024">    constraints.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L2025">    constraints.gridwidth=2;constraints.gridheight=1;</span>
<span class="nc" id="L2026">    constraints.insets = new Insets(0,2,0,2);</span>
<span class="nc" id="L2027">    combos.add(m_XCombo,constraints);</span>
<span class="nc" id="L2028">    constraints.gridx=2;constraints.gridy=0;constraints.weightx=5;</span>
<span class="nc" id="L2029">    constraints.gridwidth=2;constraints.gridheight=1;</span>
<span class="nc" id="L2030">    combos.add(m_YCombo,constraints);</span>
<span class="nc" id="L2031">    constraints.gridx=0;constraints.gridy=1;constraints.weightx=5;</span>
<span class="nc" id="L2032">    constraints.gridwidth=2;constraints.gridheight=1;</span>
<span class="nc" id="L2033">    combos.add(m_ColourCombo,constraints);</span>
    //
<span class="nc" id="L2035">    constraints.gridx=2;constraints.gridy=1;constraints.weightx=5;</span>
<span class="nc" id="L2036">    constraints.gridwidth=2;constraints.gridheight=1;</span>
<span class="nc" id="L2037">    combos.add(m_ShapeCombo,constraints);</span>

   
<span class="nc" id="L2040">    JPanel mbts = new JPanel();</span>
<span class="nc" id="L2041">    mbts.setLayout(new GridLayout(1,4));</span>
<span class="nc" id="L2042">    mbts.add(m_submit); mbts.add(m_cancel); mbts.add(m_openBut); mbts.add(m_saveBut);</span>

<span class="nc" id="L2044">    constraints.gridx=0;constraints.gridy=2;constraints.weightx=5;</span>
<span class="nc" id="L2045">    constraints.gridwidth=2;constraints.gridheight=1;</span>
<span class="nc" id="L2046">    combos.add(mbts, constraints);</span>

    ////////////////////////////////
<span class="nc" id="L2049">    constraints.gridx=2;constraints.gridy=2;constraints.weightx=5;</span>
<span class="nc" id="L2050">    constraints.gridwidth=1;constraints.gridheight=1;</span>
<span class="nc" id="L2051">    constraints.insets = new Insets(10,0,0,5);</span>
<span class="nc" id="L2052">    combos.add(m_JitterLab,constraints);</span>
<span class="nc" id="L2053">    constraints.gridx=3;constraints.gridy=2;</span>
<span class="nc" id="L2054">    constraints.weightx=5;</span>
<span class="nc" id="L2055">    constraints.insets = new Insets(10,0,0,0);</span>
<span class="nc" id="L2056">    combos.add(m_Jitter,constraints);</span>

<span class="nc" id="L2058">    m_classSurround = new JPanel();</span>
<span class="nc" id="L2059">    m_classSurround.</span>
<span class="nc" id="L2060">      setBorder(BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;VisualizePanel_ClassSurround_BorderFactoryCreateTitledBorder_Text&quot;))); </span>
<span class="nc" id="L2061">    m_classSurround.setLayout(new BorderLayout());</span>

<span class="nc" id="L2063">    m_classPanel.setBorder(BorderFactory.createEmptyBorder(15,10,10,10));</span>
<span class="nc" id="L2064">    m_classSurround.add(m_classPanel, BorderLayout.CENTER);</span>

<span class="nc" id="L2066">    GridBagLayout gb2 = new GridBagLayout();</span>
<span class="nc" id="L2067">    m_plotSurround.setBorder(BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;VisualizePanel_PlotSurround_BorderFactoryCreateTitledBorder_Text&quot;)));</span>
<span class="nc" id="L2068">    m_plotSurround.setLayout(gb2);</span>

<span class="nc" id="L2070">    constraints.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L2071">    constraints.insets = new Insets(0, 0, 0, 10);</span>
<span class="nc" id="L2072">    constraints.gridx=0;constraints.gridy=0;constraints.weightx=3;</span>
<span class="nc" id="L2073">    constraints.gridwidth=4;constraints.gridheight=1;constraints.weighty=5;</span>
<span class="nc" id="L2074">    m_plotSurround.add(m_plot, constraints);</span>
    
<span class="nc bnc" id="L2076" title="All 2 branches missed.">    if (m_showAttBars) {</span>
<span class="nc" id="L2077">      constraints.insets = new Insets(0, 0, 0, 0);</span>
<span class="nc" id="L2078">      constraints.gridx=4;constraints.gridy=0;constraints.weightx=1;</span>
<span class="nc" id="L2079">      constraints.gridwidth=1;constraints.gridheight=1;constraints.weighty=5;</span>
<span class="nc" id="L2080">      m_plotSurround.add(m_attrib, constraints);</span>
    }

<span class="nc" id="L2083">    setLayout(new BorderLayout());</span>
<span class="nc" id="L2084">    add(combos, BorderLayout.NORTH);</span>
<span class="nc" id="L2085">    add(m_plotSurround, BorderLayout.CENTER);</span>
<span class="nc" id="L2086">    add(m_classSurround, BorderLayout.SOUTH);</span>
    
<span class="nc" id="L2088">    String [] SNames = new String [4];</span>
<span class="nc" id="L2089">    SNames[0] = Messages.getInstance().getString(&quot;VisualizePanel_SNames_0_Text&quot;);</span>
<span class="nc" id="L2090">    SNames[1] = Messages.getInstance().getString(&quot;VisualizePanel_SNames_1_Text&quot;);</span>
<span class="nc" id="L2091">    SNames[2] = Messages.getInstance().getString(&quot;VisualizePanel_SNames_2_Text&quot;);</span>
<span class="nc" id="L2092">    SNames[3] = Messages.getInstance().getString(&quot;VisualizePanel_SNames_3_Text&quot;);</span>

<span class="nc" id="L2094">    m_ShapeCombo.setModel(new DefaultComboBoxModel(SNames));</span>
<span class="nc" id="L2095">    m_ShapeCombo.setEnabled(true);</span>
<span class="nc" id="L2096">  }</span>

  /**
   * displays the previously saved instances
   * 
   * @param insts	the instances to display
   * @throws Exception	if display is not possible
   */
  protected void openVisibleInstances(Instances insts) throws Exception {
<span class="nc" id="L2105">    PlotData2D tempd = new PlotData2D(insts);</span>
<span class="nc" id="L2106">    tempd.setPlotName(insts.relationName());</span>
<span class="nc" id="L2107">    tempd.addInstanceNumberAttribute();</span>
<span class="nc" id="L2108">    m_plot.m_plot2D.removeAllPlots();</span>
<span class="nc" id="L2109">    addPlot(tempd);</span>
    
    // modify title
<span class="nc" id="L2112">    Component parent = getParent();</span>
<span class="nc bnc" id="L2113" title="All 2 branches missed.">    while (parent != null) {</span>
<span class="nc bnc" id="L2114" title="All 2 branches missed.">      if (parent instanceof JFrame) {</span>
<span class="nc" id="L2115">	((JFrame) parent).setTitle(</span>
<span class="nc" id="L2116">			Messages.getInstance().getString(&quot;VisualizePanel_OpenVisibleInstances_JFrame_Text_First&quot;) </span>
<span class="nc" id="L2117">	    + insts.relationName() </span>
<span class="nc" id="L2118">	    + Messages.getInstance().getString(&quot;VisualizePanel_OpenVisibleInstances_JFrame_Text_Second&quot;));</span>
<span class="nc" id="L2119">	break;</span>
      }
      else {
<span class="nc" id="L2122">	parent = parent.getParent();</span>
      }
    }
<span class="nc" id="L2125">  }</span>
  
  /**
   * Loads previously saved instances from a file
   */
  protected void openVisibleInstances() {
    try {
<span class="nc" id="L2132">      int returnVal = m_FileChooser.showOpenDialog(this);</span>
<span class="nc bnc" id="L2133" title="All 2 branches missed.">      if (returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L2134">	File sFile = m_FileChooser.getSelectedFile();</span>
<span class="nc" id="L2135">	if (!sFile.getName().toLowerCase().</span>
<span class="nc bnc" id="L2136" title="All 2 branches missed.">	    endsWith(Instances.FILE_EXTENSION)) {</span>
<span class="nc" id="L2137">	  sFile = new File(sFile.getParent(), sFile.getName() + Instances.FILE_EXTENSION);</span>
	}
<span class="nc" id="L2139">	File selected = sFile;</span>
<span class="nc" id="L2140">	Instances insts = new Instances(new BufferedReader(new FileReader(selected)));</span>
<span class="nc" id="L2141">	openVisibleInstances(insts);</span>
      }
<span class="nc" id="L2143">    } catch (Exception ex) {</span>
<span class="nc" id="L2144">      ex.printStackTrace();</span>
<span class="nc" id="L2145">      m_plot.m_plot2D.removeAllPlots();</span>
<span class="nc" id="L2146">      JOptionPane.showMessageDialog(</span>
<span class="nc" id="L2147">	  this, </span>
<span class="nc" id="L2148">	  ex.getMessage(), </span>
<span class="nc" id="L2149">	  Messages.getInstance().getString(&quot;VisualizePanel_OpenVisibleInstances_JOptionPane.showMessageDialog_Text&quot;), </span>
<span class="nc" id="L2150">	  JOptionPane.ERROR_MESSAGE);</span>
    }
<span class="nc" id="L2152">  }</span>

  /**
   * Save the currently visible set of instances to a file
   */
  private void saveVisibleInstances() {
<span class="nc" id="L2158">    FastVector plots = m_plot.m_plot2D.getPlots();</span>
<span class="nc bnc" id="L2159" title="All 2 branches missed.">    if (plots != null) {</span>
<span class="nc" id="L2160">      PlotData2D master = (PlotData2D)plots.elementAt(0);</span>
<span class="nc" id="L2161">      Instances saveInsts = new Instances(master.getPlotInstances());</span>
<span class="nc bnc" id="L2162" title="All 2 branches missed.">      for (int i = 1; i &lt; plots.size(); i++) {</span>
<span class="nc" id="L2163">	PlotData2D temp = (PlotData2D)plots.elementAt(i);</span>
<span class="nc" id="L2164">	Instances addInsts = temp.getPlotInstances();</span>
<span class="nc bnc" id="L2165" title="All 2 branches missed.">	for (int j = 0; j &lt; addInsts.numInstances(); j++) {</span>
<span class="nc" id="L2166">	  saveInsts.add(addInsts.instance(j));</span>
	}
      }
      try {
<span class="nc" id="L2170">	int returnVal = m_FileChooser.showSaveDialog(this);</span>
<span class="nc bnc" id="L2171" title="All 2 branches missed.">	if (returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L2172">	  File sFile = m_FileChooser.getSelectedFile();</span>
<span class="nc" id="L2173">	  if (!sFile.getName().toLowerCase().</span>
<span class="nc bnc" id="L2174" title="All 2 branches missed.">	      endsWith(Instances.FILE_EXTENSION)) {</span>
<span class="nc" id="L2175">	    sFile = new File(sFile.getParent(), sFile.getName() </span>
<span class="nc" id="L2176">			     + Instances.FILE_EXTENSION);</span>
	  }
<span class="nc" id="L2178">	  File selected = sFile;</span>
<span class="nc" id="L2179">	  Writer w = new BufferedWriter(new FileWriter(selected));</span>
<span class="nc" id="L2180">	  w.write(saveInsts.toString());</span>
<span class="nc" id="L2181">	  w.close();</span>
	}
<span class="nc" id="L2183">      } catch (Exception ex) {</span>
<span class="nc" id="L2184">	ex.printStackTrace();</span>
      }
    }
<span class="nc" id="L2187">  }</span>


  /**
   * Sets the index used for colouring. If this method is called then
   * the supplied index is used and the combo box for selecting colouring
   * attribute is disabled.
   * @param index the index of the attribute to use for colouring
   */
  public void setColourIndex(int index) {
<span class="nc bnc" id="L2197" title="All 2 branches missed.">    if (index &gt;= 0) {</span>
<span class="nc" id="L2198">      m_ColourCombo.setSelectedIndex(index);</span>
    } else {
<span class="nc" id="L2200">      m_ColourCombo.setSelectedIndex(0);</span>
    }
<span class="nc" id="L2202">    m_ColourCombo.setEnabled(false);</span>
<span class="nc" id="L2203">  }</span>
  
  
  /**
   * Set the index of the attribute for the x axis 
   * @param index the index for the x axis
   * @exception Exception if index is out of range.
   */
  public void setXIndex(int index) throws Exception {
<span class="nc bnc" id="L2212" title="All 4 branches missed.">    if (index &gt;= 0 &amp;&amp; index &lt; m_XCombo.getItemCount()) {</span>
<span class="nc" id="L2213">      m_XCombo.setSelectedIndex(index);</span>
    } else {
<span class="nc" id="L2215">      throw new Exception(Messages.getInstance().getString(&quot;VisualizePanel_SetXIndex_Text&quot;));</span>
    }
<span class="nc" id="L2217">  }</span>

  /**
   * Get the index of the attribute on the x axis
   * @return the index of the attribute on the x axis
   */
  public int getXIndex() {
<span class="nc" id="L2224">    return m_XCombo.getSelectedIndex();</span>
  }

  /**
   * Set the index of the attribute for the y axis 
   * @param index the index for the y axis
   * @exception Exception if index is out of range.
   */
  public void setYIndex(int index) throws Exception {
<span class="nc bnc" id="L2233" title="All 4 branches missed.">    if (index &gt;= 0 &amp;&amp; index &lt; m_YCombo.getItemCount()) {</span>
<span class="nc" id="L2234">      m_YCombo.setSelectedIndex(index);</span>
    } else {
<span class="nc" id="L2236">      throw new Exception(Messages.getInstance().getString(&quot;VisualizePanel_SetYIndex_Text&quot;));</span>
    }
<span class="nc" id="L2238">  }</span>
  
  /**
   * Get the index of the attribute on the y axis
   * @return the index of the attribute on the x axis
   */
  public int getYIndex() {
<span class="nc" id="L2245">    return m_YCombo.getSelectedIndex();</span>
  }

  /**
   * Get the index of the attribute selected for coloring
   * @return the index of the attribute on the x axis
   */
  public int getCIndex() {
<span class="nc" id="L2253">    return m_ColourCombo.getSelectedIndex();</span>
  }

  /**
   * Get the index of the shape selected for creating splits.
   * @return The index of the shape.
   */
  public int getSIndex() {
<span class="nc" id="L2261">    return m_ShapeCombo.getSelectedIndex();</span>
  }
  
  /** 
   * Set the shape for creating splits.
   * @param index The index of the shape.
   * @exception Exception if index is out of range.
   */
  public void setSIndex(int index) throws Exception {
<span class="nc bnc" id="L2270" title="All 4 branches missed.">    if (index &gt;= 0 &amp;&amp; index &lt; m_ShapeCombo.getItemCount()) {</span>
<span class="nc" id="L2271">      m_ShapeCombo.setSelectedIndex(index);</span>
    }
    else {
<span class="nc" id="L2274">      throw new Exception(Messages.getInstance().getString(&quot;VisualizePanel_SetSIndex_Text&quot;));</span>
    }
<span class="nc" id="L2276">  }</span>

  /**
   * Add a listener for this visualize panel
   * @param act an ActionListener
   */
  public void addActionListener(ActionListener act) {
<span class="nc" id="L2283">    listener = act;</span>
<span class="nc" id="L2284">  }</span>

  /**
   * Set a name for this plot
   * @param plotName the name for the plot
   */
  public void setName(String plotName) {
<span class="nc" id="L2291">    m_plotName = plotName;</span>
<span class="nc" id="L2292">  }</span>

  /**
   * Returns the name associated with this plot. &quot;&quot; is returned if no
   * name is set.
   * @return the name of the plot
   */
  public String getName() {
<span class="nc" id="L2300">    return m_plotName;</span>
  }

  /**
   * Get the master plot's instances
   * @return the master plot's instances
   */
  public Instances getInstances() {
<span class="nc" id="L2308">    return m_plot.m_plotInstances;</span>
  }

  /**
   * Sets the Colors in use for a different attrib
   * if it is not a nominal attrib and or does not have
   * more possible values then this will do nothing.
   * otherwise it will add default colors to see that
   * there is a color for the attrib to begin with.
   * @param a The index of the attribute to color.
   * @param i The instances object that contains the attribute.
   */
  protected void newColorAttribute(int a, Instances i) {
<span class="nc bnc" id="L2321" title="All 2 branches missed.">    if (i.attribute(a).isNominal()) {</span>
<span class="nc bnc" id="L2322" title="All 2 branches missed.">      for (int noa = m_colorList.size(); noa &lt; i.attribute(a).numValues();</span>
<span class="nc" id="L2323">	   noa++) {</span>
<span class="nc" id="L2324">	Color pc = m_DefaultColors[noa % 10];</span>
<span class="nc" id="L2325">	int ija =  noa / 10;</span>
<span class="nc" id="L2326">	ija *= 2; </span>
<span class="nc bnc" id="L2327" title="All 2 branches missed.">	for (int j=0;j&lt;ija;j++) {</span>
<span class="nc" id="L2328">	  pc = pc.brighter();</span>
	}
	
<span class="nc" id="L2331">	m_colorList.addElement(pc);</span>
      }
<span class="nc" id="L2333">      m_plot.setColours(m_colorList);</span>
<span class="nc" id="L2334">      m_attrib.setColours(m_colorList);</span>
<span class="nc" id="L2335">      m_classPanel.setColours(m_colorList);</span>
    }
<span class="nc" id="L2337">  }</span>


  /**
   * This will set the shapes for the instances.
   * @param l A list of the shapes, providing that
   * the objects in the lists are non editable the data will be
   * kept intact.
   */
  public void setShapes(FastVector l) {
<span class="nc" id="L2347">    m_plot.setShapes(l);</span>
<span class="nc" id="L2348">  }</span>

  /**
   * Tells the panel to use a new set of instances.
   * @param inst a set of Instances
   */
  public void setInstances(Instances inst) {
<span class="nc bnc" id="L2355" title="All 4 branches missed.">    if (inst.numAttributes() &gt; 0 &amp;&amp; inst.numInstances() &gt; 0) {</span>
<span class="nc" id="L2356">      newColorAttribute(inst.numAttributes()-1, inst);</span>
    }

<span class="nc" id="L2359">    PlotData2D temp = new PlotData2D(inst);</span>
<span class="nc" id="L2360">    temp.setPlotName(inst.relationName());</span>
    
    try {
<span class="nc" id="L2363">      setMasterPlot(temp);</span>
<span class="nc" id="L2364">    } catch (Exception ex) {</span>
<span class="nc" id="L2365">      System.err.println(ex);</span>
<span class="nc" id="L2366">      ex.printStackTrace();</span>
    } 
<span class="nc" id="L2368">  }</span>

  /**
   * initializes the comboboxes based on the data
   * 
   * @param inst	the data to base the combobox-setup on
   */
  public void setUpComboBoxes(Instances inst) {
<span class="nc" id="L2376">    setProperties(inst.relationName());</span>
<span class="nc" id="L2377">    int prefX = -1;</span>
<span class="nc" id="L2378">    int prefY = -1;</span>
<span class="nc bnc" id="L2379" title="All 2 branches missed.">    if (inst.numAttributes() &gt; 1) {</span>
<span class="nc" id="L2380">      prefY = 1;</span>
    }
<span class="nc" id="L2382">    int prefC = -1;</span>
<span class="nc" id="L2383">    String [] XNames = new String [inst.numAttributes()];</span>
<span class="nc" id="L2384">    String [] YNames = new String [inst.numAttributes()];</span>
<span class="nc" id="L2385">    String [] CNames = new String [inst.numAttributes()];</span>
<span class="nc bnc" id="L2386" title="All 2 branches missed.">    for (int i = 0; i &lt; XNames.length; i++) {</span>
<span class="nc" id="L2387">      String type = &quot; &quot;;</span>
<span class="nc bnc" id="L2388" title="All 6 branches missed.">      switch (inst.attribute(i).type()) {</span>
      case Attribute.NOMINAL:
<span class="nc" id="L2390">	type += Messages.getInstance().getString(&quot;VisualizePanel_SetUpComboBoxes_AttributeNOMINAL_Text&quot;);</span>
<span class="nc" id="L2391">	break;</span>
      case Attribute.NUMERIC:
<span class="nc" id="L2393">	type += Messages.getInstance().getString(&quot;VisualizePanel_SetUpComboBoxes_AttributeNUMERIC_Text&quot;);</span>
<span class="nc" id="L2394">	break;</span>
      case Attribute.STRING:
<span class="nc" id="L2396">	type += Messages.getInstance().getString(&quot;VisualizePanel_SetUpComboBoxes_AttributeSTRING_Text&quot;);</span>
<span class="nc" id="L2397">	break;</span>
      case Attribute.DATE:
<span class="nc" id="L2399">	type += Messages.getInstance().getString(&quot;VisualizePanel_SetUpComboBoxes_AttributeDATE_Text&quot;);</span>
<span class="nc" id="L2400">	break;</span>
      case Attribute.RELATIONAL:
<span class="nc" id="L2402">	type += Messages.getInstance().getString(&quot;VisualizePanel_SetUpComboBoxes_AttributeRELATIONAL_Text&quot;);</span>
<span class="nc" id="L2403">	break;</span>
      default:
<span class="nc" id="L2405">	type += Messages.getInstance().getString(&quot;VisualizePanel_SetUpComboBoxes_AttributeDEFAULT_Text&quot;);</span>
      }
<span class="nc" id="L2407">      XNames[i] = Messages.getInstance().getString(&quot;VisualizePanel_SetUpComboBoxes_XNames_Text&quot;) + &quot; &quot; + inst.attribute(i).name()+type;</span>
<span class="nc" id="L2408">      YNames[i] = Messages.getInstance().getString(&quot;VisualizePanel_SetUpComboBoxes_YNames_Text&quot;) + &quot; &quot; + inst.attribute(i).name()+type;</span>
<span class="nc" id="L2409">      CNames[i] = Messages.getInstance().getString(&quot;VisualizePanel_SetUpComboBoxes_CNames_Text&quot;) + &quot; &quot; + inst.attribute(i).name()+type;</span>
<span class="nc bnc" id="L2410" title="All 2 branches missed.">      if (m_preferredXDimension != null) {</span>
<span class="nc bnc" id="L2411" title="All 2 branches missed.">	if (m_preferredXDimension.compareTo(inst.attribute(i).name()) == 0) {</span>
<span class="nc" id="L2412">	  prefX = i;</span>
	  //System.err.println(&quot;Found preferred X dimension&quot;);
	}
      }
<span class="nc bnc" id="L2416" title="All 2 branches missed.">      if (m_preferredYDimension != null) {</span>
<span class="nc bnc" id="L2417" title="All 2 branches missed.">	if (m_preferredYDimension.compareTo(inst.attribute(i).name()) == 0) {</span>
<span class="nc" id="L2418">	  prefY = i;</span>
	  //System.err.println(&quot;Found preferred Y dimension&quot;);
	}
      }
<span class="nc bnc" id="L2422" title="All 2 branches missed.">      if (m_preferredColourDimension != null) {</span>
<span class="nc bnc" id="L2423" title="All 2 branches missed.">	if (m_preferredColourDimension.</span>
<span class="nc" id="L2424">	    compareTo(inst.attribute(i).name()) == 0) {</span>
<span class="nc" id="L2425">	  prefC = i;</span>
	  //System.err.println(&quot;Found preferred Colour dimension&quot;);
	}
      }
    }
<span class="nc" id="L2430">    m_XCombo.setModel(new DefaultComboBoxModel(XNames));</span>
<span class="nc" id="L2431">    m_YCombo.setModel(new DefaultComboBoxModel(YNames));</span>

<span class="nc" id="L2433">    m_ColourCombo.setModel(new DefaultComboBoxModel(CNames));</span>
    //m_ShapeCombo.setModel(new DefaultComboBoxModel(SNames));
    //m_ShapeCombo.setEnabled(true);
<span class="nc" id="L2436">    m_XCombo.setEnabled(true);</span>
<span class="nc" id="L2437">    m_YCombo.setEnabled(true);</span>
    
<span class="nc bnc" id="L2439" title="All 2 branches missed.">    if (m_splitListener == null) {</span>
<span class="nc" id="L2440">      m_ColourCombo.setEnabled(true);</span>
<span class="nc" id="L2441">      m_ColourCombo.setSelectedIndex(inst.numAttributes()-1);</span>
    }
<span class="nc" id="L2443">    m_plotSurround.setBorder((BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;VisualizePanel_SetUpComboBoxes_PlotSurround_BorderFactoryCreateTitledBorder_Text&quot;)</span>
<span class="nc" id="L2444">			      +inst.relationName())));</span>
    try {
<span class="nc bnc" id="L2446" title="All 2 branches missed.">      if (prefX != -1) {</span>
<span class="nc" id="L2447">	setXIndex(prefX);</span>
      }
<span class="nc bnc" id="L2449" title="All 2 branches missed.">      if (prefY != -1) {</span>
<span class="nc" id="L2450">	setYIndex(prefY);</span>
      }
<span class="nc bnc" id="L2452" title="All 2 branches missed.">      if (prefC != -1) {</span>
<span class="nc" id="L2453">	m_ColourCombo.setSelectedIndex(prefC);</span>
      }
<span class="nc" id="L2455">    } catch (Exception ex) {</span>
<span class="nc" id="L2456">      System.err.println(Messages.getInstance().getString(&quot;VisualizePanel_SetUpComboBoxes_Error_Text&quot;));</span>
    }
<span class="nc" id="L2458">  }</span>

  /**
   * Removes all the plots.
   */
  public void removeAllPlots() {
<span class="nc" id="L2464">    m_plot.removeAllPlots();</span>
<span class="nc" id="L2465">  }</span>
  
  /**
   * Set the master plot for the visualize panel
   * @param newPlot the new master plot
   * @exception Exception if the master plot could not be set
   */
  public void setMasterPlot(PlotData2D newPlot) throws Exception {
<span class="nc" id="L2473">    m_plot.setMasterPlot(newPlot);</span>
<span class="nc" id="L2474">    setUpComboBoxes(newPlot.m_plotInstances);</span>
<span class="nc" id="L2475">    m_saveBut.setEnabled(true);</span>
<span class="nc" id="L2476">    repaint();</span>
<span class="nc" id="L2477">  }</span>

  /**
   * Set a new plot to the visualize panel
   * @param newPlot the new plot to add
   * @exception Exception if the plot could not be added
   */
  public void addPlot(PlotData2D newPlot) throws Exception {
<span class="nc" id="L2485">    m_plot.addPlot(newPlot);</span>
<span class="nc bnc" id="L2486" title="All 2 branches missed.">    if (m_plot.m_plot2D.getMasterPlot() != null) {</span>
<span class="nc" id="L2487">      setUpComboBoxes(newPlot.m_plotInstances);</span>
    }
<span class="nc" id="L2489">    m_saveBut.setEnabled(true);</span>
<span class="nc" id="L2490">    repaint();</span>
<span class="nc" id="L2491">  }</span>
  
  /**
   * Returns the underlying plot panel.
   * 
   * @return		the plot panel
   */
  public PlotPanel getPlotPanel() {
<span class="nc" id="L2499">    return m_plot;</span>
  }

  /**
   * Main method for testing this class
   * 
   * @param args	the commandline parameters
   */
  public static void main(String [] args) {
    try {
<span class="nc bnc" id="L2509" title="All 2 branches missed.">      if (args.length &lt; 1) {</span>
<span class="nc" id="L2510">	System.err.println(Messages.getInstance().getString(&quot;VisualizePanel_Main_Error_Text_First&quot;));</span>
<span class="nc" id="L2511">	System.exit(1);</span>
      }

<span class="nc" id="L2514">      weka.core.logging.Logger.log(weka.core.logging.Logger.Level.INFO, Messages.getInstance().getString(&quot;VisualizePanel_Main_Logger_Text&quot;));</span>
<span class="nc" id="L2515">      final javax.swing.JFrame jf = </span>
<span class="nc" id="L2516">	new javax.swing.JFrame(Messages.getInstance().getString(&quot;VisualizePanel_Main_JFrame_Text&quot;));</span>
<span class="nc" id="L2517">      jf.setSize(500,400);</span>
<span class="nc" id="L2518">      jf.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L2519">      final VisualizePanel sp = new VisualizePanel();</span>
      
<span class="nc" id="L2521">      jf.getContentPane().add(sp, BorderLayout.CENTER);</span>
<span class="nc" id="L2522">      jf.addWindowListener(new java.awt.event.WindowAdapter() {</span>
	public void windowClosing(java.awt.event.WindowEvent e) {
<span class="nc" id="L2524">	  jf.dispose();</span>
<span class="nc" id="L2525">	  System.exit(0);</span>
<span class="nc" id="L2526">	}</span>
      });

<span class="nc" id="L2529">      jf.setVisible(true);</span>
<span class="nc bnc" id="L2530" title="All 2 branches missed.">      if (args.length &gt;= 1) {</span>
<span class="nc bnc" id="L2531" title="All 2 branches missed.">	for (int j = 0; j &lt; args.length; j++) {</span>
<span class="nc" id="L2532">	  System.err.println(Messages.getInstance().getString(&quot;VisualizePanel_Main_Error_Text_Second&quot;) + args[j]);</span>
<span class="nc" id="L2533">	  java.io.Reader r = new java.io.BufferedReader(</span>
<span class="nc" id="L2534">			     new java.io.FileReader(args[j]));</span>
<span class="nc" id="L2535">	  Instances i = new Instances(r);</span>
<span class="nc" id="L2536">	  i.setClassIndex(i.numAttributes()-1);</span>
<span class="nc" id="L2537">	  PlotData2D pd1 = new PlotData2D(i);</span>
	  
<span class="nc bnc" id="L2539" title="All 2 branches missed.">	  if (j == 0) {</span>
<span class="nc" id="L2540">	    pd1.setPlotName(Messages.getInstance().getString(&quot;VisualizePanel_Main_Pd1_SetPlotName_Text_First&quot;));</span>
<span class="nc" id="L2541">	    sp.setMasterPlot(pd1);</span>
	  } else {
<span class="nc" id="L2543">	    pd1.setPlotName(Messages.getInstance().getString(&quot;VisualizePanel_Main_Pd1_SetPlotName_Text_Second&quot;)+(j+1));</span>
<span class="nc" id="L2544">	    pd1.m_useCustomColour = true;</span>
<span class="nc bnc" id="L2545" title="All 2 branches missed.">	    pd1.m_customColour = (j % 2 == 0) ? Color.red : Color.blue; </span>
<span class="nc" id="L2546">	    sp.addPlot(pd1);</span>
	  }
	}
      }
<span class="nc" id="L2550">    } catch (Exception ex) {</span>
<span class="nc" id="L2551">      ex.printStackTrace();</span>
<span class="nc" id="L2552">      System.err.println(ex.getMessage());</span>
    }
<span class="nc" id="L2554">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>