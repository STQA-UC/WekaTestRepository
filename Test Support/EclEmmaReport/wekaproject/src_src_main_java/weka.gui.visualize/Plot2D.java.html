<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>Plot2D.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.gui.visualize</a> &gt; <span class="el_source">Plot2D.java</span></div><h1>Plot2D.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">/*</span>
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 *    Plot2D.java
 *    Copyright (C) 2000 University of Waikato, Hamilton, New Zealand
 *
 */

package weka.gui.visualize;

import weka.core.FastVector;
import weka.core.Instances;
import weka.core.Utils;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Font;
import java.awt.FontMetrics;
import java.awt.Graphics;
import java.awt.event.InputEvent;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.util.Random;

import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;

/**
 * This class plots datasets in two dimensions. It can also plot
 * classifier errors and clusterer predictions.
 * 
 * @author Mark Hall (mhall@cs.waikato.ac.nz)
 * @version $Revision: 7059 $
 */
public class Plot2D
  extends JPanel {

  /** for serialization */
  private static final long serialVersionUID = -1673162410856660442L;  

  /* constants for shape types */
  public static final int MAX_SHAPES = 5;
  public static final int ERROR_SHAPE = 1000;
  public static final int MISSING_SHAPE = 2000;
  public static final int CONST_AUTOMATIC_SHAPE = -1;
  public static final int X_SHAPE = 0;
  public static final int PLUS_SHAPE = 1;
  public static final int DIAMOND_SHAPE = 2;
  public static final int TRIANGLEUP_SHAPE = 3;
  public static final int TRIANGLEDOWN_SHAPE = 4;
  public static final int DEFAULT_SHAPE_SIZE = 2;

  /** Default colour for the axis */
<span class="nc" id="L72">  protected Color m_axisColour = Color.green;</span>

  /** Default colour for the plot background */
<span class="nc" id="L75">  protected Color m_backgroundColour = Color.black;</span>

  /** The plots to display */
<span class="nc" id="L78">  protected FastVector m_plots = new FastVector();</span>

  /** The master plot */
<span class="nc" id="L81">  protected PlotData2D m_masterPlot = null;</span>

  /** The name of the master plot */
<span class="nc" id="L84">  protected String m_masterName = Messages.getInstance().getString(&quot;Plot2D_MasterName_Text&quot;);</span>

  /** The instances to be plotted */
<span class="nc" id="L87">  protected Instances m_plotInstances=null;</span>

  /** An optional &quot;compainion&quot; of the panel. If specified, this
      class will get to do its thing with our graphics context
      before we do any drawing. Eg. the visualize panel may need
      to draw polygons etc. before we draw plot axis and data points */
<span class="nc" id="L93">  protected Plot2DCompanion m_plotCompanion=null;</span>

  /** For popping up text info on data points */
<span class="nc" id="L96">  protected JFrame m_InstanceInfo = null;</span>
<span class="nc" id="L97">  protected JTextArea m_InstanceInfoText = new JTextArea();</span>

  /** The list of the colors used */
  protected FastVector m_colorList;

  /** default colours for colouring discrete class */
<span class="nc" id="L103">  protected Color [] m_DefaultColors = {Color.blue,</span>
<span class="nc" id="L104">					Color.red,</span>
<span class="nc" id="L105">					Color.green,</span>
<span class="nc" id="L106">					Color.cyan,</span>
<span class="nc" id="L107">					Color.pink,</span>
<span class="nc" id="L108">					new Color(255, 0, 255),</span>
<span class="nc" id="L109">					Color.orange,</span>
<span class="nc" id="L110">					new Color(255, 0, 0),</span>
<span class="nc" id="L111">					new Color(0, 255, 0),</span>
<span class="nc" id="L112">					Color.white};</span>

  /** Indexes of the attributes to go on the x and y axis and the attribute
      to use for colouring and the current shape for drawing */
<span class="nc" id="L116">  protected int m_xIndex=0;</span>
<span class="nc" id="L117">  protected int m_yIndex=0;</span>
<span class="nc" id="L118">  protected int m_cIndex=0;</span>
<span class="nc" id="L119">  protected int m_sIndex=0;</span>

  /** Holds the min and max values of the x, y and colouring attributes 
   over all plots */
  protected double m_maxX;
  protected double m_minX;
  protected double m_maxY;
  protected double m_minY;
  protected double m_maxC;
  protected double m_minC;
    
  /** Axis padding */
<span class="nc" id="L131">  protected final int m_axisPad = 5;</span>

  /** Tick size */
<span class="nc" id="L134">  protected final int m_tickSize = 5;</span>

  /**the offsets of the axes once label metrics are calculated */
<span class="nc" id="L137">  protected int m_XaxisStart=0;</span>
<span class="nc" id="L138">  protected int m_YaxisStart=0;</span>
<span class="nc" id="L139">  protected int m_XaxisEnd=0;</span>
<span class="nc" id="L140">  protected int m_YaxisEnd=0;</span>

  /** if the user resizes the window, or the attributes selected for
      the attributes change, then the lookup table for points needs
      to be recalculated */
<span class="nc" id="L145">  protected boolean m_plotResize = true;</span>
  
  /** if the user changes attribute assigned to an axis */
<span class="nc" id="L148">  protected boolean m_axisChanged = false;</span>

  /** An array used to show if a point is hidden or not.
   * This is used for speeding up the drawing of the plot panel
   * although I am not sure how much performance this grants over
   * not having it.
   */
  protected int[][] m_drawnPoints;

  /** Font for labels */
  protected Font m_labelFont;
<span class="nc" id="L159">  protected FontMetrics m_labelMetrics=null; </span>

  /** the level of jitter */
<span class="nc" id="L162">  protected int m_JitterVal=0;</span>

  /** random values for perterbing the data points */
<span class="nc" id="L165">  protected Random m_JRand = new Random(0);</span>

  /** lookup table for plotted points */
<span class="nc" id="L168">  protected double [][] m_pointLookup=null;</span>

  /** Constructor */
  public Plot2D() {
<span class="nc" id="L172">    super();</span>
<span class="nc" id="L173">    setProperties();</span>
<span class="nc" id="L174">    this.setBackground(m_backgroundColour);</span>
<span class="nc" id="L175">    m_InstanceInfoText.setFont(new Font(&quot;Monospaced&quot;, Font.PLAIN,12));</span>
<span class="nc" id="L176">    m_InstanceInfoText.setEditable(false);</span>

<span class="nc" id="L178">    m_drawnPoints = new int[this.getWidth()][this.getHeight()];</span>

    /** Set up some default colours */
<span class="nc" id="L181">    m_colorList = new FastVector(10);</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">    for (int noa = m_colorList.size(); noa &lt; 10; noa++) {</span>
<span class="nc" id="L183">      Color pc = m_DefaultColors[noa % 10];</span>
<span class="nc" id="L184">      int ija =  noa / 10;</span>
<span class="nc" id="L185">      ija *= 2; </span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">      for (int j=0;j&lt;ija;j++) {</span>
<span class="nc" id="L187">	pc = pc.darker();</span>
      }
      
<span class="nc" id="L190">      m_colorList.addElement(pc);</span>
    }
<span class="nc" id="L192">  }</span>

  /**
   * Set the properties for Plot2D
   */
  private void setProperties() {
<span class="nc bnc" id="L198" title="All 2 branches missed.">    if (VisualizeUtils.VISUALIZE_PROPERTIES != null) {</span>
<span class="nc" id="L199">      String thisClass = this.getClass().getName();</span>
<span class="nc" id="L200">      String axisKey = thisClass+&quot;.axisColour&quot;;</span>
<span class="nc" id="L201">      String backgroundKey = thisClass+&quot;.backgroundColour&quot;;</span>

<span class="nc" id="L203">      String axisColour = VisualizeUtils.VISUALIZE_PROPERTIES.</span>
<span class="nc" id="L204">	getProperty(axisKey);</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">      if (axisColour == null) {</span>
	/*
	System.err.println(&quot;Warning: no configuration property found in &quot;
			   +VisualizeUtils.PROPERTY_FILE
			   +&quot; for &quot;+axisKey);*/
      } else {
	//System.err.println(&quot;Setting axis colour to: &quot;+axisColour);
<span class="nc" id="L212">	m_axisColour = VisualizeUtils.processColour(axisColour, m_axisColour);</span>
      }

<span class="nc" id="L215">      String backgroundColour = </span>
<span class="nc" id="L216">	VisualizeUtils.VISUALIZE_PROPERTIES.getProperty(backgroundKey);</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">      if (backgroundColour == null) {</span>
	/*
	System.err.println(&quot;Warning: no configuration property found in &quot;
			   +VisualizeUtils.PROPERTY_FILE
			   +&quot; for &quot;+backgroundKey);*/
      } else {
	//System.err.println(&quot;Setting background colour to: &quot;+backgroundColour);
<span class="nc" id="L224">	m_backgroundColour = VisualizeUtils.processColour(backgroundColour, </span>
<span class="nc" id="L225">							  m_backgroundColour);</span>
      }
    }
<span class="nc" id="L228">  }</span>

  /** 
   * This will check the values of the screen points passed and make sure 
   * that they land on the screen
   * @param x1 The x coord.
   * @param y1 The y coord.
   */
  private boolean checkPoints(double x1, double y1) {
<span class="nc bnc" id="L237" title="All 6 branches missed.">    if (x1 &lt; 0 || x1 &gt; this.getSize().width || y1 &lt; 0 </span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">	|| y1 &gt; this.getSize().height) {</span>
<span class="nc" id="L239">      return false;</span>
    }
<span class="nc" id="L241">    return true;</span>
  }

  /**
   * Set a companion class. This is a class that might want
   * to render something on the plot before we do our thing. Eg,
   * Malcolm's shape drawing stuff needs to happen before we plot
   * axis and points
   * @param p a companion class
   */
  public void setPlotCompanion(Plot2DCompanion p) {
<span class="nc" id="L252">    m_plotCompanion = p;</span>
<span class="nc" id="L253">  }</span>

  /**
   * Set level of jitter and repaint the plot using the new jitter value
   * @param j the level of jitter
   */
  public void setJitter(int j) {
<span class="nc bnc" id="L260" title="All 2 branches missed.">    if (m_plotInstances.numAttributes() &gt; 0 </span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">	&amp;&amp; m_plotInstances.numInstances() &gt; 0) {</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">      if (j &gt;= 0) {</span>
<span class="nc" id="L263">	m_JitterVal = j;</span>
<span class="nc" id="L264">	m_JRand = new Random(m_JitterVal);</span>
	//      if (m_pointLookup != null) {
<span class="nc" id="L266">	m_drawnPoints = new int[m_XaxisEnd - m_XaxisStart + 1]</span>
<span class="nc" id="L267">	  [m_YaxisEnd - m_YaxisStart + 1];</span>
<span class="nc" id="L268">	updatePturb();</span>
	//      }
<span class="nc" id="L270">	this.repaint();</span>
      }
    }
<span class="nc" id="L273">  }</span>

  /**
   * Set a list of colours to use when colouring points according
   * to class values or cluster numbers
   * @param cols the list of colours to use
   */
  public void setColours (FastVector cols) {
<span class="nc" id="L281">    m_colorList = cols;</span>
<span class="nc" id="L282">  }</span>

  /**
   * Set the index of the attribute to go on the x axis
   * @param x the index of the attribute to use on the x axis
   */
  public void setXindex(int x) {
<span class="nc" id="L289">    m_xIndex = x;</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">    for (int i=0;i&lt;m_plots.size();i++) {</span>
<span class="nc" id="L291">      ((PlotData2D)m_plots.elementAt(i)).setXindex(m_xIndex);</span>
    }
<span class="nc" id="L293">    determineBounds();</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">    if (m_JitterVal != 0) {</span>
<span class="nc" id="L295">      updatePturb();</span>
    }
<span class="nc" id="L297">    m_axisChanged = true;</span>
<span class="nc" id="L298">    this.repaint();</span>
<span class="nc" id="L299">  }</span>
    
  /**
   * Set the index of the attribute to go on the y axis
   * @param y the index of the attribute to use on the y axis
   */
  public void setYindex(int y) {
<span class="nc" id="L306">    m_yIndex = y;</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">    for (int i=0;i&lt;m_plots.size();i++) {</span>
<span class="nc" id="L308">      ((PlotData2D)m_plots.elementAt(i)).setYindex(m_yIndex);</span>
    }
<span class="nc" id="L310">    determineBounds();</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">    if (m_JitterVal != 0) {</span>
<span class="nc" id="L312">      updatePturb();</span>
    }
<span class="nc" id="L314">    m_axisChanged = true;</span>
<span class="nc" id="L315">    this.repaint();</span>
<span class="nc" id="L316">  }</span>

  /**
   * Set the index of the attribute to use for colouring
   * @param c the index of the attribute to use for colouring
   */
  public void setCindex(int c) {
<span class="nc" id="L323">    m_cIndex = c;</span>
<span class="nc bnc" id="L324" title="All 2 branches missed.">    for (int i=0;i&lt;m_plots.size();i++) {</span>
<span class="nc" id="L325">      ((PlotData2D)m_plots.elementAt(i)).setCindex(m_cIndex);</span>
    }
<span class="nc" id="L327">    determineBounds();</span>
<span class="nc" id="L328">    m_axisChanged = true;</span>
<span class="nc" id="L329">    this.repaint();</span>
<span class="nc" id="L330">  }</span>

  /**
   * Return the list of plots
   * @return the list of plots
   */
  public FastVector getPlots() {
<span class="nc" id="L337">    return m_plots;</span>
  }

  /**
   * Get the master plot
   * @return the master plot
   */
  public PlotData2D getMasterPlot() {
<span class="nc" id="L345">    return m_masterPlot;</span>
  }

  /** 
   * Return the current max value of the attribute plotted on the x axis
   * @return the max x value
   */
  public double getMaxX() {
<span class="nc" id="L353">    return m_maxX;</span>
  }

  /** 
   * Return the current max value of the attribute plotted on the y axis
   * @return the max y value
   */
  public double getMaxY() {
<span class="nc" id="L361">    return m_maxY;</span>
  }

  /** 
   * Return the current min value of the attribute plotted on the x axis
   * @return the min x value
   */
  public double getMinX() {
<span class="nc" id="L369">    return m_minX;</span>
  }
  
  /** 
   * Return the current min value of the attribute plotted on the y axis
   * @return the min y value
   */
  public double getMinY() {
<span class="nc" id="L377">    return m_minY;</span>
  }

  /** 
   * Return the current max value of the colouring attribute
   * @return the max colour value
   */
  public double getMaxC() {
<span class="nc" id="L385">    return m_maxC;</span>
  }
  
  /** 
   * Return the current min value of the colouring attribute
   * @return the min colour value
   */
  public double getMinC() {
<span class="nc" id="L393">    return m_minC;</span>
  }
    
  /**
   * Sets the master plot from a set of instances
   * @param inst the instances
   * @exception Exception if instances could not be set
   */
  public void setInstances(Instances inst) throws Exception {
    //System.err.println(&quot;Setting Instances&quot;);
<span class="nc" id="L403">    PlotData2D tempPlot = new PlotData2D(inst);</span>
<span class="nc" id="L404">    tempPlot.setPlotName(Messages.getInstance().getString(&quot;Plot2D_SetInstances_TempPlot_SetPlotName_Text&quot;));</span>
<span class="nc" id="L405">    setMasterPlot(tempPlot);</span>
<span class="nc" id="L406">  }</span>

  /**
   * Set the master plot.
   * @param master the plot to make the master plot
   * @exception Exception if the plot could not be set.
   */
  public void setMasterPlot(PlotData2D master) throws Exception {
<span class="nc bnc" id="L414" title="All 2 branches missed.">    if (master.m_plotInstances == null) {</span>
<span class="nc" id="L415">      throw new Exception(Messages.getInstance().getString(&quot;Plot2D_SetMasterPlot_Exception_Text&quot;));</span>
    }
<span class="nc" id="L417">    removeAllPlots();</span>
<span class="nc" id="L418">    m_masterPlot = master;</span>
<span class="nc" id="L419">    m_plots.addElement(m_masterPlot);</span>
<span class="nc" id="L420">    m_plotInstances = m_masterPlot.m_plotInstances;</span>
    
<span class="nc" id="L422">    m_xIndex=0;</span>
<span class="nc" id="L423">    m_yIndex=0;</span>
<span class="nc" id="L424">    m_cIndex=0;</span>
    
<span class="nc" id="L426">    determineBounds();</span>
<span class="nc" id="L427">  }</span>

  /**
   * Clears all plots
   */
  public void removeAllPlots() {
<span class="nc" id="L433">    m_masterPlot = null;</span>
<span class="nc" id="L434">    m_plotInstances = null;</span>
<span class="nc" id="L435">    m_plots = new FastVector();</span>
<span class="nc" id="L436">    m_xIndex = 0; m_yIndex = 0; m_cIndex = 0;</span>
<span class="nc" id="L437">  }</span>

  /**
   * Add a plot to the list of plots to display
   * @param newPlot the new plot to add
   * @exception Exception if the plot could not be added
   */
  public void addPlot(PlotData2D newPlot) throws Exception {
<span class="nc bnc" id="L445" title="All 2 branches missed.">    if (newPlot.m_plotInstances == null) {</span>
<span class="nc" id="L446">      throw new Exception(Messages.getInstance().getString(&quot;Plot2D_AddPlot_Exception_Text_First&quot;));</span>
    }

<span class="nc bnc" id="L449" title="All 2 branches missed.">    if (m_masterPlot != null) {</span>
<span class="nc" id="L450">      if (m_masterPlot.m_plotInstances.</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">	  equalHeaders(newPlot.m_plotInstances) == false) {</span>
<span class="nc" id="L452">	throw new Exception(Messages.getInstance().getString(&quot;Plot2D_AddPlot_Exception_Text_Second&quot;));</span>
      }
    } else {
<span class="nc" id="L455">      m_masterPlot = newPlot;</span>
<span class="nc" id="L456">      m_plotInstances = m_masterPlot.m_plotInstances;</span>
    }
<span class="nc" id="L458">    m_plots.addElement(newPlot);</span>
<span class="nc" id="L459">    setXindex(m_xIndex);</span>
<span class="nc" id="L460">    setYindex(m_yIndex);</span>
<span class="nc" id="L461">    setCindex(m_cIndex);</span>
<span class="nc" id="L462">  }</span>

  /**
   * Set up fonts and font metrics
   * @param gx the graphics context
   */
  private void setFonts(Graphics gx) {
<span class="nc bnc" id="L469" title="All 2 branches missed.">    if (m_labelMetrics == null) {</span>
<span class="nc" id="L470">      m_labelFont = new Font(&quot;Monospaced&quot;, Font.PLAIN, 12);</span>
<span class="nc" id="L471">      m_labelMetrics = gx.getFontMetrics(m_labelFont);</span>
    }
<span class="nc" id="L473">    gx.setFont(m_labelFont);</span>
<span class="nc" id="L474">  }</span>

  /**
   * Pops up a window displaying attribute information on any instances
   * at a point+-plotting_point_size (in panel coordinates)
   *
   * @param x the x value of the clicked point
   * @param y the y value of the clicked point
   * @param newFrame true if instance info is to be displayed in a
   * new frame.
   */
  public void searchPoints(int x, int y, final boolean newFrame) {
<span class="nc bnc" id="L486" title="All 2 branches missed.">    if (m_masterPlot.m_plotInstances != null) {</span>
<span class="nc" id="L487">      int longest=0;</span>
<span class="nc bnc" id="L488" title="All 2 branches missed.">      for (int j=0;j&lt;m_masterPlot.m_plotInstances.numAttributes();j++) {</span>
<span class="nc" id="L489">	if (m_masterPlot.m_plotInstances.attribute(j).name().length() &gt; </span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">	    longest) {</span>
<span class="nc" id="L491">	  longest = m_masterPlot.m_plotInstances.attribute(j).name().length();</span>
	}
      }

<span class="nc" id="L495">      StringBuffer insts = new StringBuffer(); </span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">      for (int jj=0;jj&lt;m_plots.size();jj++) {</span>
<span class="nc" id="L497">	PlotData2D temp_plot = (PlotData2D)(m_plots.elementAt(jj));</span>
	
<span class="nc bnc" id="L499" title="All 2 branches missed.">	for (int i=0;i&lt;temp_plot.m_plotInstances.numInstances();i++) {</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">	  if (temp_plot.m_pointLookup[i][0] != Double.NEGATIVE_INFINITY) {</span>
<span class="nc" id="L501">	    double px = temp_plot.m_pointLookup[i][0] + </span>
<span class="nc" id="L502">	      temp_plot.m_pointLookup[i][2];</span>
<span class="nc" id="L503">	    double py = temp_plot.m_pointLookup[i][1] + </span>
<span class="nc" id="L504">	      temp_plot.m_pointLookup[i][3];</span>
	    //	    double size = temp_plot.m_pointLookup[i][2];
<span class="nc" id="L506">	    double size = temp_plot.m_shapeSize[i];</span>
<span class="nc bnc" id="L507" title="All 4 branches missed.">	    if ((x &gt;= px-size) &amp;&amp; (x &lt;= px+size) &amp;&amp;</span>
<span class="nc bnc" id="L508" title="All 4 branches missed.">		(y &gt;= py-size) &amp;&amp; (y &lt;= py+size)) {</span>
	      {
<span class="nc" id="L510">		insts.append(Messages.getInstance().getString(&quot;Plot2D_SearchPoints_Text_First&quot;) + temp_plot.m_plotName</span>
<span class="nc" id="L511">			     + Messages.getInstance().getString(&quot;Plot2D_SearchPoints_Text_Second&quot;) + (i + 1 ) + Messages.getInstance().getString(&quot;Plot2D_SearchPoints_Text_Third&quot;));</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">		for (int j=0;j&lt;temp_plot.m_plotInstances.numAttributes();j++) {</span>
<span class="nc" id="L513">		  for (int k = 0;k &lt; </span>
<span class="nc bnc" id="L514" title="All 2 branches missed.">			 (longest-temp_plot.m_plotInstances.</span>
<span class="nc" id="L515">			  attribute(j).name().length()); k++) {</span>
<span class="nc" id="L516">		    insts.append(&quot; &quot;);</span>
		  }
<span class="nc" id="L518">		  insts.append(temp_plot.m_plotInstances.attribute(j).name());  </span>
<span class="nc" id="L519">		  insts.append(Messages.getInstance().getString(&quot;Plot2D_SearchPoints_Text_Fourth&quot;));</span>
		  
<span class="nc bnc" id="L521" title="All 2 branches missed.">		  if (temp_plot.m_plotInstances.instance(i).isMissing(j)) {</span>
<span class="nc" id="L522">		    insts.append(Messages.getInstance().getString(&quot;Plot2D_SearchPoints_Text_Fifth&quot;));</span>
<span class="nc" id="L523">		  } else if (temp_plot.m_plotInstances.attribute(j).</span>
<span class="nc bnc" id="L524" title="All 2 branches missed.">			     isNominal()) {</span>
<span class="nc" id="L525">		    insts.append(temp_plot.m_plotInstances.</span>
<span class="nc" id="L526">				 attribute(j).</span>
<span class="nc" id="L527">				 value((int)temp_plot.m_plotInstances.</span>
<span class="nc" id="L528">				       instance(i).value(j)));</span>
		  } else {
<span class="nc" id="L530">		    insts.append(temp_plot.m_plotInstances.</span>
<span class="nc" id="L531">				 instance(i).value(j));</span>
		  }
<span class="nc" id="L533">		  insts.append(Messages.getInstance().getString(&quot;Plot2D_SearchPoints_Text_Sixth&quot;));</span>
		}
	      }
	    }
	  }
	}
      }

<span class="nc bnc" id="L541" title="All 2 branches missed.">      if (insts.length() &gt; 0) {</span>
	// Pop up a new frame
<span class="nc bnc" id="L543" title="All 4 branches missed.">	if (newFrame || m_InstanceInfo == null) {</span>
<span class="nc" id="L544">	  JTextArea jt = new JTextArea();</span>
<span class="nc" id="L545">	  jt.setFont(new Font(&quot;Monospaced&quot;, Font.PLAIN,12));</span>
<span class="nc" id="L546">	  jt.setEditable(false);</span>
<span class="nc" id="L547">	  jt.setText(insts.toString());</span>
<span class="nc" id="L548">	  final JFrame jf = new JFrame(Messages.getInstance().getString(&quot;Plot2D_SearchPoints_JFrame_Text&quot;));</span>
<span class="nc" id="L549">	  final JFrame testf = m_InstanceInfo;</span>
<span class="nc" id="L550">	  jf.addWindowListener(new WindowAdapter() {</span>
	      public void windowClosing(WindowEvent e) {
<span class="nc bnc" id="L552" title="All 4 branches missed.">		if (!newFrame || testf == null) {</span>
<span class="nc" id="L553">		  m_InstanceInfo = null;</span>
		}
<span class="nc" id="L555">		jf.dispose();</span>
<span class="nc" id="L556">	      }</span>
	    });
<span class="nc" id="L558">	  jf.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L559">	  jf.getContentPane().add(new JScrollPane(jt), BorderLayout.CENTER);</span>
<span class="nc" id="L560">	  jf.pack();</span>
<span class="nc" id="L561">	  jf.setSize(320, 400);</span>
<span class="nc" id="L562">	  jf.setVisible(true);</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">	  if (m_InstanceInfo == null) {</span>
<span class="nc" id="L564">	    m_InstanceInfo = jf;</span>
<span class="nc" id="L565">	    m_InstanceInfoText = jt;</span>
	  }
	}  else {
	  // Overwrite info in existing frame	  
<span class="nc" id="L569">	  m_InstanceInfoText.setText(insts.toString());</span>
	}
      }
    }
<span class="nc" id="L573">  }</span>
  

  /**
   * Determine the min and max values for axis and colouring attributes
   */
  public void determineBounds() {
    double value,min,max;
    
    // find maximums minimums over all plots
<span class="nc" id="L583">    m_minX = ((PlotData2D)m_plots.elementAt(0)).m_minX;</span>
<span class="nc" id="L584">    m_maxX = ((PlotData2D)m_plots.elementAt(0)).m_maxX;</span>
<span class="nc" id="L585">    m_minY = ((PlotData2D)m_plots.elementAt(0)).m_minY;</span>
<span class="nc" id="L586">    m_maxY = ((PlotData2D)m_plots.elementAt(0)).m_maxY;</span>
<span class="nc" id="L587">    m_minC = ((PlotData2D)m_plots.elementAt(0)).m_minC;</span>
<span class="nc" id="L588">    m_maxC = ((PlotData2D)m_plots.elementAt(0)).m_maxC;</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">    for (int i=1;i&lt;m_plots.size();i++) {</span>
<span class="nc" id="L590">      value = ((PlotData2D)m_plots.elementAt(i)).m_minX;</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">      if (value &lt; m_minX) {</span>
<span class="nc" id="L592">	m_minX = value;</span>
      }
<span class="nc" id="L594">      value = ((PlotData2D)m_plots.elementAt(i)).m_maxX;</span>
<span class="nc bnc" id="L595" title="All 2 branches missed.">      if (value &gt; m_maxX) {</span>
<span class="nc" id="L596">	m_maxX = value;</span>
      }
<span class="nc" id="L598">      value = ((PlotData2D)m_plots.elementAt(i)).m_minY;</span>
<span class="nc bnc" id="L599" title="All 2 branches missed.">      if (value &lt; m_minY) {</span>
<span class="nc" id="L600">	m_minY= value;</span>
      }
<span class="nc" id="L602">      value = ((PlotData2D)m_plots.elementAt(i)).m_maxY;</span>
<span class="nc bnc" id="L603" title="All 2 branches missed.">      if (value &gt; m_maxY) {</span>
<span class="nc" id="L604">	m_maxY = value;</span>
      }
<span class="nc" id="L606">      value = ((PlotData2D)m_plots.elementAt(i)).m_minC;</span>
<span class="nc bnc" id="L607" title="All 2 branches missed.">      if (value &lt; m_minC) {</span>
<span class="nc" id="L608">	m_minC = value;</span>
      }
<span class="nc" id="L610">      value = ((PlotData2D)m_plots.elementAt(i)).m_maxC;</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">      if (value &gt; m_maxC) {</span>
<span class="nc" id="L612">	m_maxC = value;</span>
      }
    }

<span class="nc" id="L616">    fillLookup();</span>
<span class="nc" id="L617">    this.repaint();</span>
<span class="nc" id="L618">  }</span>

    
  //to convert screen coords to attrib values
  // note that I use a double to avoid accuracy 
  //headaches with ints
  /**
   * convert a Panel x coordinate to a raw x value.
   * @param scx The Panel x coordinate
   * @return A raw x value.
   */
  public double convertToAttribX(double scx) {
<span class="nc" id="L630">    double temp = m_XaxisEnd - m_XaxisStart;</span>
<span class="nc" id="L631">    double temp2 = ((scx - m_XaxisStart) * (m_maxX - m_minX)) / temp;</span>
      
<span class="nc" id="L633">    temp2 = temp2 + m_minX;</span>
      
<span class="nc" id="L635">    return temp2;</span>
  }
    
  /**
   * convert a Panel y coordinate to a raw y value.
   * @param scy The Panel y coordinate
   * @return A raw y value.
   */
  public double convertToAttribY(double scy) {
<span class="nc" id="L644">    double temp = m_YaxisEnd - m_YaxisStart;</span>
<span class="nc" id="L645">    double temp2 = ((scy - m_YaxisEnd) * (m_maxY - m_minY)) / temp;</span>
      
<span class="nc" id="L647">    temp2 = -(temp2 - m_minY);</span>
      
<span class="nc" id="L649">    return temp2;</span>
  }
  //////
    
  /**
   * returns a value by which an x value can be peturbed. Makes sure
   * that the x value+pturb stays within the plot bounds
   * @param xvalP the x coordinate to be peturbed
   * @param xj a random number to use in calculating a peturb value
   * @return a peturb value
   */
  int pturbX(double xvalP, double xj) {
<span class="nc" id="L661">    int xpturb = 0;</span>
<span class="nc bnc" id="L662" title="All 2 branches missed.">    if (m_JitterVal &gt; 0) {</span>
<span class="nc" id="L663">      xpturb = (int)((double)m_JitterVal * (xj / 2.0));</span>
<span class="nc bnc" id="L664" title="All 2 branches missed.">      if (((xvalP + xpturb) &lt; m_XaxisStart) || </span>
<span class="nc bnc" id="L665" title="All 2 branches missed.">	  ((xvalP + xpturb) &gt; m_XaxisEnd)) {</span>
<span class="nc" id="L666">	xpturb *= -1;</span>
      }
    }
<span class="nc" id="L669">    return xpturb;</span>
  }

  /**
   * Convert an raw x value to Panel x coordinate.
   * @param xval the raw x value
   * @return an x value for plotting in the panel.
   */
  public double convertToPanelX(double xval) {
<span class="nc" id="L678">    double temp = (xval - m_minX)/(m_maxX - m_minX);</span>
<span class="nc" id="L679">    double temp2 = temp * (m_XaxisEnd - m_XaxisStart);</span>
      
<span class="nc" id="L681">    temp2 = temp2 + m_XaxisStart;</span>
	
<span class="nc" id="L683">    return temp2;</span>
  }

  /**
   * returns a value by which a y value can be peturbed. Makes sure
   * that the y value+pturb stays within the plot bounds
   * @param yvalP the y coordinate to be peturbed
   * @param yj a random number to use in calculating a peturb value
   * @return a peturb value
   */
  int pturbY(double yvalP, double yj) {
<span class="nc" id="L694">    int ypturb = 0;</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">    if (m_JitterVal &gt; 0) {</span>
<span class="nc" id="L696">      ypturb = (int)((double)m_JitterVal * (yj / 2.0));</span>
<span class="nc bnc" id="L697" title="All 2 branches missed.">      if (((yvalP + ypturb) &lt; m_YaxisStart) || </span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">	  ((yvalP + ypturb) &gt; m_YaxisEnd)) {</span>
<span class="nc" id="L699">	ypturb *= -1;</span>
      }
    }
<span class="nc" id="L702">    return ypturb;</span>
  }

  /**
   * Convert an raw y value to Panel y coordinate.
   * @param yval the raw y value
   * @return an y value for plotting in the panel.
   */
  public double convertToPanelY(double yval) {
<span class="nc" id="L711">    double temp = (yval - m_minY)/(m_maxY - m_minY);</span>
<span class="nc" id="L712">    double temp2 = temp * (m_YaxisEnd - m_YaxisStart);</span>
      
<span class="nc" id="L714">    temp2 = m_YaxisEnd - temp2;</span>

<span class="nc" id="L716">    return temp2;</span>
  }

  /**
   * Draws an X.
   * @param gx the graphics context
   * @param x the x coord
   * @param y the y coord
   * @param size the size of the shape
   */
  private static void drawX(Graphics gx, double x, double y, int size) {
<span class="nc" id="L727">     gx.drawLine((int)(x-size),(int)(y-size),</span>
<span class="nc" id="L728">		  (int)(x+size),(int)(y+size));</span>
     
<span class="nc" id="L730">      gx.drawLine((int)(x+size),(int)(y-size),</span>
<span class="nc" id="L731">		  (int)(x-size),(int)(y+size));     </span>
<span class="nc" id="L732">  }</span>

  /**
   * Draws a plus.
   * @param gx the graphics context
   * @param x the x coord
   * @param y the y coord
   * @param size the size of the shape
   */
  private static void drawPlus(Graphics gx, double x, double y, int size) {
<span class="nc" id="L742">     gx.drawLine((int)(x-size),(int)(y),</span>
<span class="nc" id="L743">		  (int)(x+size),(int)(y));</span>
     
<span class="nc" id="L745">      gx.drawLine((int)(x),(int)(y-size),</span>
<span class="nc" id="L746">		  (int)(x),(int)(y+size));     </span>
<span class="nc" id="L747">  }</span>

  /**
   * Draws a diamond.
   * @param gx the graphics context
   * @param x the x coord
   * @param y the y coord
   * @param size the size of the shape
   */
  private static void drawDiamond(Graphics gx, double x, double y, int size) {
<span class="nc" id="L757">    gx.drawLine((int)(x-size),(int)(y),</span>
<span class="nc" id="L758">		(int)(x),(int)(y-size));</span>
    
<span class="nc" id="L760">    gx.drawLine((int)(x),(int)(y-size),</span>
<span class="nc" id="L761">		  (int)(x+size),(int)(y));</span>

<span class="nc" id="L763">    gx.drawLine((int)(x+size),(int)(y),</span>
<span class="nc" id="L764">		  (int)(x),(int)(y+size));</span>

<span class="nc" id="L766">     gx.drawLine((int)(x),(int)(y+size),</span>
<span class="nc" id="L767">		  (int)(x-size),(int)(y));</span>
<span class="nc" id="L768">  }</span>

  /**
   * Draws an triangle (point at top).
   * @param gx the graphics context
   * @param x the x coord
   * @param y the y coord
   * @param size the size of the shape
   */
  private static void drawTriangleUp(Graphics gx, double x, 
				     double y, int size) {
<span class="nc" id="L779">    gx.drawLine((int)(x),(int)(y-size),</span>
<span class="nc" id="L780">		(int)(x-size),(int)(y+size));</span>

<span class="nc" id="L782">    gx.drawLine((int)(x-size),(int)(y+size),</span>
<span class="nc" id="L783">		(int)(x+size),(int)(y+size));</span>

<span class="nc" id="L785">    gx.drawLine((int)(x+size),(int)(y+size),</span>
<span class="nc" id="L786">		(int)(x),(int)(y-size));</span>

<span class="nc" id="L788">  }</span>

  /**
   * Draws an triangle (point at bottom).
   * @param gx the graphics context
   * @param x the x coord
   * @param y the y coord
   * @param size the size of the shape
   */
  private static void drawTriangleDown(Graphics gx, double x, 
				       double y, int size) {
<span class="nc" id="L799">    gx.drawLine((int)(x),(int)(y+size),</span>
<span class="nc" id="L800">		(int)(x-size),(int)(y-size));</span>

<span class="nc" id="L802">    gx.drawLine((int)(x-size),(int)(y-size),</span>
<span class="nc" id="L803">		(int)(x+size),(int)(y-size));</span>

<span class="nc" id="L805">    gx.drawLine((int)(x+size),(int)(y-size),</span>
<span class="nc" id="L806">		(int)(x),(int)(y+size));</span>

<span class="nc" id="L808">  }</span>

  /**
   * Draws a data point at a given set of panel coordinates at a given
   * size and connects a line to the previous point.
   * @param x the x coord
   * @param y the y coord
   * @param xprev the x coord of the previous point
   * @param yprev the y coord of the previous point
   * @param size the size of the point
   * @param shape the shape of the data point (square is reserved for nominal
   * error data points). Shapes: 0=x, 1=plus, 2=diamond, 3=triangle(up),
   * 4 = triangle (down).
   * @param gx the graphics context
   */
  protected static void drawDataPoint(double x, 
			       double y,
			       double xprev,
			       double yprev,
			       int size,
			       int shape,
			       Graphics gx) {

<span class="nc" id="L831">    drawDataPoint(x,y,size,shape,gx);</span>

    // connect a line to the previous point
<span class="nc" id="L834">    gx.drawLine((int)x, (int)y, (int)xprev, (int)yprev);</span>
<span class="nc" id="L835">  }</span>

  /**
   * Draws a data point at a given set of panel coordinates at a given
   * size.
   * @param x the x coord
   * @param y the y coord
   * @param size the size of the point
   * @param shape the shape of the data point (square is reserved for nominal
   * error data points). Shapes: 0=x, 1=plus, 2=diamond, 3=triangle(up),
   * 4 = triangle (down).
   * @param gx the graphics context
   */
  protected static void drawDataPoint(double x, 
				      double y,
				      int size,
				      int shape,
				      Graphics gx) {

<span class="nc" id="L854">    Font lf = new Font(&quot;Monospaced&quot;, Font.PLAIN, 12);</span>
<span class="nc" id="L855">    FontMetrics fm = gx.getFontMetrics(lf);</span>

<span class="nc bnc" id="L857" title="All 2 branches missed.">    if (size == 0) {</span>
<span class="nc" id="L858">      size = 1;</span>
    }

<span class="nc bnc" id="L861" title="All 4 branches missed.">    if (shape != ERROR_SHAPE &amp;&amp; shape != MISSING_SHAPE) {</span>
<span class="nc" id="L862">      shape = shape % 5;</span>
    }

<span class="nc bnc" id="L865" title="All 8 branches missed.">    switch (shape) {</span>
    case X_SHAPE:
<span class="nc" id="L867">      drawX(gx, x, y, size);</span>
<span class="nc" id="L868">      break;      </span>
    case PLUS_SHAPE:
<span class="nc" id="L870">      drawPlus(gx, x, y, size);</span>
<span class="nc" id="L871">      break;</span>
    case DIAMOND_SHAPE:
<span class="nc" id="L873">      drawDiamond(gx, x, y, size);</span>
<span class="nc" id="L874">      break;</span>
    case TRIANGLEUP_SHAPE:
<span class="nc" id="L876">      drawTriangleUp(gx, x, y, size);</span>
<span class="nc" id="L877">      break;</span>
    case TRIANGLEDOWN_SHAPE:
<span class="nc" id="L879">      drawTriangleDown(gx, x, y, size);</span>
<span class="nc" id="L880">      break;</span>
    case ERROR_SHAPE: // draws the nominal error shape 
<span class="nc" id="L882">      gx.drawRect((int)(x-size),(int)(y-size),(size*2),(size*2));</span>
<span class="nc" id="L883">      break;</span>
    case MISSING_SHAPE:
<span class="nc" id="L885">      int hf = fm.getAscent();</span>
<span class="nc" id="L886">      int width = fm.stringWidth(&quot;M&quot;);</span>
<span class="nc" id="L887">      gx.drawString(&quot;M&quot;,(int)(x-(width / 2)), (int)(y+(hf / 2)));</span>
      break;
    }
<span class="nc" id="L890">  }</span>

  /**
   * Updates the perturbed values for the plots when the jitter value is
   * changed
   */
  private void updatePturb() {
<span class="nc" id="L897">    double xj=0;</span>
<span class="nc" id="L898">    double yj=0;</span>
<span class="nc bnc" id="L899" title="All 2 branches missed.">    for (int j=0;j&lt;m_plots.size();j++) {</span>
<span class="nc" id="L900">      PlotData2D temp_plot = (PlotData2D)(m_plots.elementAt(j));</span>
<span class="nc bnc" id="L901" title="All 2 branches missed.">      for (int i=0;i&lt;temp_plot.m_plotInstances.numInstances();i++) {</span>
<span class="nc bnc" id="L902" title="All 2 branches missed.">	if (temp_plot.m_plotInstances.instance(i).isMissing(m_xIndex) ||</span>
<span class="nc bnc" id="L903" title="All 2 branches missed.">	    temp_plot.m_plotInstances.instance(i).isMissing(m_yIndex)) {</span>
	} else {
<span class="nc bnc" id="L905" title="All 2 branches missed.">	  if (m_JitterVal &gt; 0) {</span>
<span class="nc" id="L906">	    xj = m_JRand.nextGaussian();</span>
<span class="nc" id="L907">	    yj = m_JRand.nextGaussian();</span>
	  }
<span class="nc" id="L909">	  temp_plot.m_pointLookup[i][2] = </span>
<span class="nc" id="L910">	    pturbX(temp_plot.m_pointLookup[i][0],xj);</span>
<span class="nc" id="L911">	  temp_plot.m_pointLookup[i][3] = </span>
<span class="nc" id="L912">	    pturbY(temp_plot.m_pointLookup[i][1],yj);</span>
	}
      }
    }
<span class="nc" id="L916">  }</span>

  /**
   * Fills the lookup caches for the plots. Also calculates errors for
   * numeric predictions (if any) in plots
   */
  private void fillLookup() {

<span class="nc bnc" id="L924" title="All 2 branches missed.">    for (int j=0;j&lt;m_plots.size();j++) {</span>
<span class="nc" id="L925">      PlotData2D temp_plot = (PlotData2D)(m_plots.elementAt(j));</span>

<span class="nc bnc" id="L927" title="All 2 branches missed.">      if (temp_plot.m_plotInstances.numInstances() &gt; 0 &amp;&amp;</span>
<span class="nc bnc" id="L928" title="All 2 branches missed.">	  temp_plot.m_plotInstances.numAttributes() &gt; 0) {</span>
<span class="nc bnc" id="L929" title="All 2 branches missed.">	for (int i=0;i&lt;temp_plot.m_plotInstances.numInstances();i++) {</span>
<span class="nc bnc" id="L930" title="All 2 branches missed.">	  if (temp_plot.m_plotInstances.instance(i).isMissing(m_xIndex) ||</span>
<span class="nc bnc" id="L931" title="All 2 branches missed.">	      temp_plot.m_plotInstances.instance(i).isMissing(m_yIndex)) {</span>
<span class="nc" id="L932">	    temp_plot.m_pointLookup[i][0] = Double.NEGATIVE_INFINITY;</span>
<span class="nc" id="L933">	    temp_plot.m_pointLookup[i][1] = Double.NEGATIVE_INFINITY;</span>
	  } else {
<span class="nc" id="L935">	    double x = convertToPanelX(temp_plot.m_plotInstances.</span>
<span class="nc" id="L936">				       instance(i).value(m_xIndex));</span>
<span class="nc" id="L937">	    double y = convertToPanelY(temp_plot.m_plotInstances.</span>
<span class="nc" id="L938">				       instance(i).value(m_yIndex));</span>
<span class="nc" id="L939">	    temp_plot.m_pointLookup[i][0] = x;</span>
<span class="nc" id="L940">	    temp_plot.m_pointLookup[i][1] = y;</span>
	  }
	}
      }
    }
<span class="nc" id="L945">  }</span>
    
  /**
   * Draws the data points and predictions (if provided).
   * @param gx the graphics context
   */
  private void paintData(Graphics gx) {

<span class="nc bnc" id="L953" title="All 2 branches missed.">    for (int j=0;j&lt;m_plots.size();j++) {</span>
<span class="nc" id="L954">      PlotData2D temp_plot = (PlotData2D)(m_plots.elementAt(j));</span>

<span class="nc bnc" id="L956" title="All 2 branches missed.">      for (int i=0;i&lt;temp_plot.m_plotInstances.numInstances();i++) {</span>
<span class="nc bnc" id="L957" title="All 2 branches missed.">	if (temp_plot.m_plotInstances.instance(i).isMissing(m_xIndex) ||</span>
<span class="nc bnc" id="L958" title="All 2 branches missed.">	    temp_plot.m_plotInstances.instance(i).isMissing(m_yIndex)) {</span>
	} else {
<span class="nc" id="L960">	  double x = (temp_plot.m_pointLookup[i][0] + </span>
<span class="nc" id="L961">		      temp_plot.m_pointLookup[i][2]);</span>
<span class="nc" id="L962">	  double y = (temp_plot.m_pointLookup[i][1] + </span>
<span class="nc" id="L963">		      temp_plot.m_pointLookup[i][3]);</span>

<span class="nc" id="L965">	  double prevx = 0;</span>
<span class="nc" id="L966">	  double prevy = 0;</span>
<span class="nc bnc" id="L967" title="All 2 branches missed.">	  if (i &gt; 0) {</span>
<span class="nc" id="L968">	    prevx = (temp_plot.m_pointLookup[i - 1][0] + </span>
<span class="nc" id="L969">			temp_plot.m_pointLookup[i - 1][2]);</span>
<span class="nc" id="L970">	    prevy = (temp_plot.m_pointLookup[i - 1][1] + </span>
<span class="nc" id="L971">			temp_plot.m_pointLookup[i - 1][3]);</span>
	  }

<span class="nc" id="L974">	  int x_range = (int)x - m_XaxisStart;</span>
<span class="nc" id="L975">	  int y_range = (int)y - m_YaxisStart;</span>

<span class="nc bnc" id="L977" title="All 4 branches missed.">	  if (x_range &gt;= 0 &amp;&amp; y_range &gt;= 0) {</span>
<span class="nc bnc" id="L978" title="All 2 branches missed.">	    if (m_drawnPoints[x_range][y_range] == i </span>
<span class="nc bnc" id="L979" title="All 2 branches missed.">		|| m_drawnPoints[x_range][y_range] == 0</span>
<span class="nc bnc" id="L980" title="All 2 branches missed.">		|| temp_plot.m_shapeSize[i] == temp_plot.m_alwaysDisplayPointsOfThisSize</span>
<span class="nc bnc" id="L981" title="All 2 branches missed.">		|| temp_plot.m_displayAllPoints == true) {</span>
<span class="nc" id="L982">	      m_drawnPoints[x_range][y_range] = i;</span>
<span class="nc bnc" id="L983" title="All 2 branches missed.">	      if (temp_plot.m_plotInstances.attribute(m_cIndex).isNominal()) {</span>
<span class="nc" id="L984">		if (temp_plot.m_plotInstances.attribute(m_cIndex).numValues() &gt;</span>
<span class="nc bnc" id="L985" title="All 2 branches missed.">		    m_colorList.size() &amp;&amp; </span>
<span class="nc bnc" id="L986" title="All 2 branches missed.">		    !temp_plot.m_useCustomColour) {</span>
<span class="nc" id="L987">		  extendColourMap(temp_plot.m_plotInstances.</span>
<span class="nc" id="L988">				  attribute(m_cIndex).numValues());</span>
		}

		Color ci;
<span class="nc" id="L992">		if (temp_plot.m_plotInstances.instance(i).</span>
<span class="nc bnc" id="L993" title="All 2 branches missed.">		    isMissing(m_cIndex)) {</span>
<span class="nc" id="L994">		  ci = Color.gray;</span>
		} else {
<span class="nc" id="L996">		  int ind = (int)temp_plot.m_plotInstances.instance(i).</span>
<span class="nc" id="L997">		    value(m_cIndex);</span>
<span class="nc" id="L998">		  ci = (Color)m_colorList.elementAt(ind);</span>
		}

<span class="nc bnc" id="L1001" title="All 2 branches missed.">		if (!temp_plot.m_useCustomColour) {</span>
<span class="nc" id="L1002">		  gx.setColor(ci);	    </span>
		} else {
<span class="nc" id="L1004">		  gx.setColor(temp_plot.m_customColour);</span>
		}

<span class="nc" id="L1007">		if (temp_plot.m_plotInstances.instance(i).</span>
<span class="nc bnc" id="L1008" title="All 2 branches missed.">		    isMissing(m_cIndex)) {</span>
<span class="nc bnc" id="L1009" title="All 2 branches missed.">		  if (temp_plot.m_connectPoints[i] == true) {</span>
<span class="nc" id="L1010">		    drawDataPoint(x,y,prevx,prevy,temp_plot.m_shapeSize[i],</span>
<span class="nc" id="L1011">				  MISSING_SHAPE,gx);</span>
		  } else {
<span class="nc" id="L1013">		    drawDataPoint(x,y,temp_plot.m_shapeSize[i],</span>
<span class="nc" id="L1014">				  MISSING_SHAPE,gx);</span>
		  }
		} else {
<span class="nc bnc" id="L1017" title="All 2 branches missed.">		  if (temp_plot.m_shapeType[i] == CONST_AUTOMATIC_SHAPE) {</span>
<span class="nc bnc" id="L1018" title="All 2 branches missed.">		    if (temp_plot.m_connectPoints[i] == true) {</span>
<span class="nc" id="L1019">		      drawDataPoint(x,y,prevx,prevy,</span>
<span class="nc" id="L1020">				    temp_plot.m_shapeSize[i],j,gx);</span>
		    } else {
<span class="nc" id="L1022">		      drawDataPoint(x,y,temp_plot.m_shapeSize[i],j,gx);</span>
		    }
		  } else {
<span class="nc bnc" id="L1025" title="All 2 branches missed.">		    if (temp_plot.m_connectPoints[i] == true) {</span>
<span class="nc" id="L1026">		       drawDataPoint(x,y,prevx,prevy,temp_plot.m_shapeSize[i],</span>
<span class="nc" id="L1027">				     temp_plot.m_shapeType[i],gx);</span>
		    } else {
<span class="nc" id="L1029">		      drawDataPoint(x,y,temp_plot.m_shapeSize[i],</span>
<span class="nc" id="L1030">				    temp_plot.m_shapeType[i],gx);</span>
		    }
		  }
		}
	      } else {
		double r;
<span class="nc" id="L1036">		Color ci = null;</span>
<span class="nc" id="L1037">		if (!temp_plot.m_plotInstances.instance(i).</span>
<span class="nc bnc" id="L1038" title="All 2 branches missed.">		    isMissing(m_cIndex)) {</span>
<span class="nc" id="L1039">		  r = (temp_plot.m_plotInstances.instance(i).</span>
<span class="nc" id="L1040">		       value(m_cIndex) - m_minC) / (m_maxC - m_minC);</span>
<span class="nc" id="L1041">		  r = (r * 240) + 15;</span>
<span class="nc" id="L1042">		  ci = new Color((int)r,150,(int)(255-r));</span>
		} else {
<span class="nc" id="L1044">		  ci = Color.gray;</span>
		}
<span class="nc bnc" id="L1046" title="All 2 branches missed.">		if (!temp_plot.m_useCustomColour) {</span>
<span class="nc" id="L1047">		  gx.setColor(ci);</span>
		} else {
<span class="nc" id="L1049">		  gx.setColor(temp_plot.m_customColour);</span>
		}
<span class="nc" id="L1051">		if (temp_plot.m_plotInstances.instance(i).</span>
<span class="nc bnc" id="L1052" title="All 2 branches missed.">		    isMissing(m_cIndex)) {</span>
<span class="nc bnc" id="L1053" title="All 2 branches missed.">		  if (temp_plot.m_connectPoints[i] == true) {</span>
<span class="nc" id="L1054">		    drawDataPoint(x,y,prevx,prevy,temp_plot.m_shapeSize[i],</span>
<span class="nc" id="L1055">				  MISSING_SHAPE,gx);</span>
		  } else {
<span class="nc" id="L1057">		    drawDataPoint(x,y,temp_plot.m_shapeSize[i],</span>
<span class="nc" id="L1058">				  MISSING_SHAPE,gx);</span>
		  }
		} else {
<span class="nc bnc" id="L1061" title="All 2 branches missed.">		  if (temp_plot.m_shapeType[i] == CONST_AUTOMATIC_SHAPE) {</span>
<span class="nc bnc" id="L1062" title="All 2 branches missed.">		    if (temp_plot.m_connectPoints[i] == true) {</span>
<span class="nc" id="L1063">		      drawDataPoint(x,y,prevx,prevy,</span>
<span class="nc" id="L1064">				    temp_plot.m_shapeSize[i],j,gx);</span>
		    } else {
<span class="nc" id="L1066">		      drawDataPoint(x,y,temp_plot.m_shapeSize[i],j,gx);</span>
		    }
		  } else {
<span class="nc bnc" id="L1069" title="All 2 branches missed.">		    if (temp_plot.m_connectPoints[i] == true) {</span>
<span class="nc" id="L1070">		      drawDataPoint(x,y,prevx,prevy,temp_plot.m_shapeSize[i],</span>
<span class="nc" id="L1071">				    temp_plot.m_shapeType[i],gx);</span>
		    } else {
<span class="nc" id="L1073">		      drawDataPoint(x,y,temp_plot.m_shapeSize[i],</span>
<span class="nc" id="L1074">				    temp_plot.m_shapeType[i],gx);</span>
		    }
		  }
		}
	      }
	    }
	  }
	}
      }
    }
<span class="nc" id="L1084">  }</span>

  /*
  public void determineAxisPositions(Graphics gx) {
    setFonts(gx);
    int mxs = m_XaxisStart;
    int mxe = m_XaxisEnd;
    int mys = m_YaxisStart;
    int mye = m_YaxisEnd;
    m_axisChanged = false;

    int h = this.getHeight();
    int w = this.getWidth();
    int hf = m_labelMetrics.getAscent();
    int mswx=0;
    int mswy=0;

    //      determineBounds();
    int fieldWidthX = (int)((Math.log(m_maxX)/Math.log(10)))+1;
    int precisionX = 1;
    if ((Math.abs(m_maxX-m_minX) &lt; 1) &amp;&amp; ((m_maxY-m_minX) != 0)) {
      precisionX = (int)Math.abs(((Math.log(Math.abs(m_maxX-m_minX)) / 
				   Math.log(10))))+1;
    }
    String maxStringX = Utils.doubleToString(m_maxX,
					     fieldWidthX+1+precisionX
					     ,precisionX);
    mswx = m_labelMetrics.stringWidth(maxStringX);
    int fieldWidthY = (int)((Math.log(m_maxY)/Math.log(10)))+1;
    int precisionY = 1;
    if (Math.abs((m_maxY-m_minY)) &lt; 1 &amp;&amp; ((m_maxY-m_minY) != 0)) {
      precisionY = (int)Math.abs(((Math.log(Math.abs(m_maxY-m_minY)) / 
				   Math.log(10))))+1;
    }
    String maxStringY = Utils.doubleToString(m_maxY,
					     fieldWidthY+1+precisionY
					     ,precisionY);
    String minStringY = Utils.doubleToString(m_minY,
					     fieldWidthY+1+precisionY
					     ,precisionY);

    if (m_plotInstances.attribute(m_yIndex).isNumeric()) {
      mswy = (m_labelMetrics.stringWidth(maxStringY) &gt; 
	      m_labelMetrics.stringWidth(minStringY))
	? m_labelMetrics.stringWidth(maxStringY)
	: m_labelMetrics.stringWidth(minStringY);
    } else {
      mswy = m_labelMetrics.stringWidth(&quot;MM&quot;);
    }

    m_YaxisStart = m_axisPad;
    m_XaxisStart = 0+m_axisPad+m_tickSize+mswy;

    m_XaxisEnd = w-m_axisPad-(mswx/2);
      
    m_YaxisEnd = h-m_axisPad-(2 * hf)-m_tickSize;
    } */

  /**
   * Draws the axis and a spectrum if the colouring attribute is numeric
   * @param gx the graphics context
   */
  private void paintAxis(Graphics gx) {
<span class="nc" id="L1147">    setFonts(gx);</span>
<span class="nc" id="L1148">    int mxs = m_XaxisStart;</span>
<span class="nc" id="L1149">    int mxe = m_XaxisEnd;</span>
<span class="nc" id="L1150">    int mys = m_YaxisStart;</span>
<span class="nc" id="L1151">    int mye = m_YaxisEnd;</span>
<span class="nc" id="L1152">    m_plotResize = false;</span>

<span class="nc" id="L1154">    int h = this.getHeight();</span>
<span class="nc" id="L1155">    int w = this.getWidth();</span>
<span class="nc" id="L1156">    int hf = m_labelMetrics.getAscent();</span>
<span class="nc" id="L1157">    int mswx=0;</span>
<span class="nc" id="L1158">    int mswy=0;</span>

    //      determineBounds();
<span class="nc" id="L1161">    int precisionXmax = 1;</span>
<span class="nc" id="L1162">    int precisionXmin = 1;</span>
<span class="nc" id="L1163">    int precisionXmid = 1;</span>
    /*if ((Math.abs(m_maxX-m_minX) &lt; 1) &amp;&amp; ((m_maxY-m_minX) != 0)) {
      precisionX = (int)Math.abs(((Math.log(Math.abs(m_maxX-m_minX)) / 
				   Math.log(10))))+1;
				   } */
<span class="nc" id="L1168">    int whole = (int)Math.abs(m_maxX);</span>
<span class="nc" id="L1169">    double decimal = Math.abs(m_maxX) - whole;</span>
    int nondecimal;
<span class="nc bnc" id="L1171" title="All 2 branches missed.">    nondecimal = (whole &gt; 0) </span>
<span class="nc" id="L1172">      ? (int)(Math.log(whole) / Math.log(10))</span>
<span class="nc" id="L1173">      : 1;</span>
    
<span class="nc bnc" id="L1175" title="All 2 branches missed.">    precisionXmax = (decimal &gt; 0) </span>
<span class="nc" id="L1176">      ? (int)Math.abs(((Math.log(Math.abs(m_maxX)) / </span>
<span class="nc" id="L1177">				      Math.log(10))))+2</span>
<span class="nc" id="L1178">      : 1;</span>
<span class="nc bnc" id="L1179" title="All 2 branches missed.">    if (precisionXmax &gt; VisualizeUtils.MAX_PRECISION) {</span>
<span class="nc" id="L1180">      precisionXmax = 1;</span>
    }

<span class="nc" id="L1183">    String maxStringX = Utils.doubleToString(m_maxX,</span>
<span class="nc" id="L1184">					     nondecimal+1+precisionXmax</span>
<span class="nc" id="L1185">					     ,precisionXmax);</span>

<span class="nc" id="L1187">    whole = (int)Math.abs(m_minX);</span>
<span class="nc" id="L1188">    decimal = Math.abs(m_minX) - whole;</span>
<span class="nc bnc" id="L1189" title="All 2 branches missed.">    nondecimal = (whole &gt; 0) </span>
<span class="nc" id="L1190">      ? (int)(Math.log(whole) / Math.log(10))</span>
<span class="nc" id="L1191">      : 1;</span>
<span class="nc bnc" id="L1192" title="All 2 branches missed.">    precisionXmin = (decimal &gt; 0) </span>
<span class="nc" id="L1193">      ? (int)Math.abs(((Math.log(Math.abs(m_minX)) / </span>
<span class="nc" id="L1194">				      Math.log(10))))+2</span>
<span class="nc" id="L1195">      : 1;</span>
<span class="nc bnc" id="L1196" title="All 2 branches missed.">    if (precisionXmin &gt; VisualizeUtils.MAX_PRECISION) {</span>
<span class="nc" id="L1197">      precisionXmin = 1;</span>
    }
   
<span class="nc" id="L1200">    String minStringX = Utils.doubleToString(m_minX,</span>
<span class="nc" id="L1201">					     nondecimal+1+precisionXmin,</span>
<span class="nc" id="L1202">					     precisionXmin);</span>

<span class="nc" id="L1204">    mswx = m_labelMetrics.stringWidth(maxStringX);</span>

<span class="nc" id="L1206">    int precisionYmax = 1;</span>
<span class="nc" id="L1207">    int precisionYmin = 1;</span>
<span class="nc" id="L1208">    int precisionYmid = 1;</span>
<span class="nc" id="L1209">    whole = (int)Math.abs(m_maxY);</span>
<span class="nc" id="L1210">    decimal = Math.abs(m_maxY) - whole;</span>
<span class="nc bnc" id="L1211" title="All 2 branches missed.">    nondecimal = (whole &gt; 0) </span>
<span class="nc" id="L1212">      ? (int)(Math.log(whole) / Math.log(10))</span>
<span class="nc" id="L1213">      : 1;</span>
<span class="nc bnc" id="L1214" title="All 2 branches missed.">    precisionYmax = (decimal &gt; 0) </span>
<span class="nc" id="L1215">      ? (int)Math.abs(((Math.log(Math.abs(m_maxY)) / </span>
<span class="nc" id="L1216">				      Math.log(10))))+2</span>
<span class="nc" id="L1217">      : 1;</span>
<span class="nc bnc" id="L1218" title="All 2 branches missed.">    if (precisionYmax &gt; VisualizeUtils.MAX_PRECISION) {</span>
<span class="nc" id="L1219">      precisionYmax = 1;</span>
    }
    
<span class="nc" id="L1222">    String maxStringY = Utils.doubleToString(m_maxY,</span>
<span class="nc" id="L1223">					     nondecimal+1+precisionYmax</span>
<span class="nc" id="L1224">					     ,precisionYmax);</span>


<span class="nc" id="L1227">    whole = (int)Math.abs(m_minY);</span>
<span class="nc" id="L1228">    decimal = Math.abs(m_minY) - whole;</span>
<span class="nc bnc" id="L1229" title="All 2 branches missed.">    nondecimal = (whole &gt; 0) </span>
<span class="nc" id="L1230">      ? (int)(Math.log(whole) / Math.log(10))</span>
<span class="nc" id="L1231">      : 1;</span>
<span class="nc bnc" id="L1232" title="All 2 branches missed.">    precisionYmin = (decimal &gt; 0) </span>
<span class="nc" id="L1233">      ? (int)Math.abs(((Math.log(Math.abs(m_minY)) / </span>
<span class="nc" id="L1234">				      Math.log(10))))+2</span>
<span class="nc" id="L1235">      : 1;</span>
<span class="nc bnc" id="L1236" title="All 2 branches missed.">    if (precisionYmin &gt; VisualizeUtils.MAX_PRECISION) {</span>
<span class="nc" id="L1237">      precisionYmin = 1;</span>
    }
   
<span class="nc" id="L1240">    String minStringY = Utils.doubleToString(m_minY,</span>
<span class="nc" id="L1241">					     nondecimal+1+precisionYmin</span>
<span class="nc" id="L1242">					     ,precisionYmin);</span>

<span class="nc bnc" id="L1244" title="All 2 branches missed.">    if (m_plotInstances.attribute(m_yIndex).isNumeric()) {</span>
<span class="nc" id="L1245">      mswy = (m_labelMetrics.stringWidth(maxStringY) &gt; </span>
<span class="nc bnc" id="L1246" title="All 2 branches missed.">	      m_labelMetrics.stringWidth(minStringY))</span>
<span class="nc" id="L1247">	? m_labelMetrics.stringWidth(maxStringY)</span>
<span class="nc" id="L1248">	: m_labelMetrics.stringWidth(minStringY);</span>
<span class="nc" id="L1249">      mswy += m_labelMetrics.stringWidth(&quot;M&quot;);</span>
    } else {
<span class="nc" id="L1251">      mswy = m_labelMetrics.stringWidth(&quot;MM&quot;);</span>
    }

<span class="nc" id="L1254">    m_YaxisStart = m_axisPad;</span>
<span class="nc" id="L1255">    m_XaxisStart = 0+m_axisPad+m_tickSize+mswy;</span>

<span class="nc" id="L1257">    m_XaxisEnd = w-m_axisPad-(mswx/2);</span>
      
<span class="nc" id="L1259">    m_YaxisEnd = h-m_axisPad-(2 * hf)-m_tickSize;</span>

    // draw axis
<span class="nc" id="L1262">    gx.setColor(m_axisColour);</span>
<span class="nc bnc" id="L1263" title="All 2 branches missed.">    if (m_plotInstances.attribute(m_xIndex).isNumeric()) {</span>
<span class="nc bnc" id="L1264" title="All 2 branches missed.">      if (w &gt; (2 * mswx)) {</span>
	
<span class="nc" id="L1266">	gx.drawString(maxStringX, </span>
<span class="nc" id="L1267">		      m_XaxisEnd-(mswx/2),</span>
<span class="nc" id="L1268">		      m_YaxisEnd+hf+m_tickSize);</span>
	
<span class="nc" id="L1270">	mswx = m_labelMetrics.stringWidth(minStringX);</span>
<span class="nc" id="L1271">	gx.drawString(minStringX,</span>
<span class="nc" id="L1272">		      (m_XaxisStart-(mswx/2)),</span>
<span class="nc" id="L1273">		      m_YaxisEnd+hf+m_tickSize);</span>

	// draw the middle value
<span class="nc bnc" id="L1276" title="All 2 branches missed.">	if (w &gt; (3 * mswx) &amp;&amp; </span>
<span class="nc bnc" id="L1277" title="All 2 branches missed.">	    (m_plotInstances.attribute(m_xIndex).isNumeric())) {</span>
<span class="nc" id="L1278">	  double mid = m_minX+((m_maxX-m_minX)/2.0);</span>
<span class="nc" id="L1279">	   whole = (int)Math.abs(mid);</span>
<span class="nc" id="L1280">	   decimal = Math.abs(mid) - whole;</span>
<span class="nc bnc" id="L1281" title="All 2 branches missed.">	   nondecimal = (whole &gt; 0) </span>
<span class="nc" id="L1282">	     ? (int)(Math.log(whole) / Math.log(10))</span>
<span class="nc" id="L1283">	     : 1;</span>
<span class="nc bnc" id="L1284" title="All 2 branches missed.">	   precisionXmid = (decimal &gt; 0) </span>
<span class="nc" id="L1285">	     ? (int)Math.abs(((Math.log(Math.abs(mid)) / </span>
<span class="nc" id="L1286">			       Math.log(10))))+2</span>
<span class="nc" id="L1287">	     : 1;</span>
<span class="nc bnc" id="L1288" title="All 2 branches missed.">	   if (precisionXmid &gt; VisualizeUtils.MAX_PRECISION) {</span>
<span class="nc" id="L1289">	     precisionXmid = 1;</span>
	   }
	  
<span class="nc" id="L1292">	  String maxString = Utils.doubleToString(mid,</span>
<span class="nc" id="L1293">						  nondecimal+1+precisionXmid,</span>
<span class="nc" id="L1294">						  precisionXmid);</span>
<span class="nc" id="L1295">	  int sw = m_labelMetrics.stringWidth(maxString);</span>
<span class="nc" id="L1296">	  double mx = m_XaxisStart+((double)(m_XaxisEnd-m_XaxisStart)/2.0);</span>
<span class="nc" id="L1297">	  gx.drawString(maxString,</span>
<span class="nc" id="L1298">			(int)(mx-(((double)sw)/2.0)),</span>
<span class="nc" id="L1299">			m_YaxisEnd+hf+m_tickSize);</span>
<span class="nc" id="L1300">	  gx.drawLine((int)mx,m_YaxisEnd,(int)mx,m_YaxisEnd+m_tickSize);</span>
	}
      }
    } else {
<span class="nc" id="L1304">      int numValues = m_plotInstances.attribute(m_xIndex).numValues();</span>
<span class="nc bnc" id="L1305" title="All 2 branches missed.">      int div = (numValues % 2 &gt; 0) ? (numValues/2)+1 : (numValues/2);</span>
<span class="nc" id="L1306">      int maxXStringWidth = (m_XaxisEnd - m_XaxisStart) / numValues;</span>

<span class="nc bnc" id="L1308" title="All 2 branches missed.">      for (int i=0;i&lt;numValues;i++) {</span>
<span class="nc" id="L1309">	String val = m_plotInstances.attribute(m_xIndex).value(i);</span>
<span class="nc" id="L1310">	int sw = m_labelMetrics.stringWidth(val);</span>
	int rm;
	// truncate string if necessary
<span class="nc bnc" id="L1313" title="All 2 branches missed.">	if (sw &gt; maxXStringWidth) {</span>
<span class="nc" id="L1314">	  int incr = (sw / val.length());</span>
<span class="nc" id="L1315">	  rm = (sw - maxXStringWidth) / incr;</span>
<span class="nc bnc" id="L1316" title="All 2 branches missed.">	  if (rm == 0) {</span>
<span class="nc" id="L1317">	    rm = 1;</span>
	  }
<span class="nc" id="L1319">	  val = val.substring(0,val.length()-rm);</span>
<span class="nc" id="L1320">	  sw = m_labelMetrics.stringWidth(val);</span>
	}
<span class="nc bnc" id="L1322" title="All 2 branches missed.">	if (i == 0) {</span>
<span class="nc" id="L1323">	  gx.drawString(val,(int)convertToPanelX(i),</span>
<span class="nc" id="L1324">			m_YaxisEnd+hf+m_tickSize);</span>
<span class="nc bnc" id="L1325" title="All 2 branches missed.">	} else if (i == numValues -1) {</span>
<span class="nc bnc" id="L1326" title="All 2 branches missed.">	  if ((i % 2) == 0) {</span>
<span class="nc" id="L1327">	    gx.drawString(val,</span>
<span class="nc" id="L1328">			  m_XaxisEnd-sw,</span>
<span class="nc" id="L1329">			  m_YaxisEnd+hf+m_tickSize);</span>
	  } else {
<span class="nc" id="L1331">	    gx.drawString(val,</span>
<span class="nc" id="L1332">			  m_XaxisEnd-sw,</span>
<span class="nc" id="L1333">			  m_YaxisEnd+(2*hf)+m_tickSize);</span>
	  }
	} else {
<span class="nc bnc" id="L1336" title="All 2 branches missed.">	  if ((i % 2) == 0) {</span>
<span class="nc" id="L1337">	    gx.drawString(val,</span>
<span class="nc" id="L1338">			  (int)convertToPanelX(i)-(sw/2),</span>
<span class="nc" id="L1339">			  m_YaxisEnd+hf+m_tickSize);</span>
	  } else {
<span class="nc" id="L1341">	    gx.drawString(val,</span>
<span class="nc" id="L1342">			  (int)convertToPanelX(i)-(sw/2),</span>
<span class="nc" id="L1343">			  m_YaxisEnd+(2*hf)+m_tickSize);</span>
	  }
	}
<span class="nc" id="L1346">	gx.drawLine((int)convertToPanelX(i),</span>
<span class="nc" id="L1347">		    m_YaxisEnd,</span>
<span class="nc" id="L1348">		    (int)convertToPanelX(i),</span>
<span class="nc" id="L1349">		    m_YaxisEnd+m_tickSize);</span>
      }
	
    }

    // draw the y axis
<span class="nc bnc" id="L1355" title="All 2 branches missed.">    if (m_plotInstances.attribute(m_yIndex).isNumeric()) {</span>
<span class="nc bnc" id="L1356" title="All 2 branches missed.">      if (h &gt; (2 * hf)) {</span>
<span class="nc" id="L1357">	gx.drawString(maxStringY, </span>
<span class="nc" id="L1358">		      m_XaxisStart-mswy-m_tickSize,</span>
<span class="nc" id="L1359">		      m_YaxisStart+(hf));</span>

<span class="nc" id="L1361">	gx.drawString(minStringY,</span>
<span class="nc" id="L1362">		      (m_XaxisStart-mswy-m_tickSize),</span>
<span class="nc" id="L1363">		      m_YaxisEnd);</span>

	// draw the middle value
<span class="nc bnc" id="L1366" title="All 2 branches missed.">	if (w &gt; (3 * hf) &amp;&amp; </span>
<span class="nc bnc" id="L1367" title="All 2 branches missed.">	    (m_plotInstances.attribute(m_yIndex).isNumeric())) {</span>
<span class="nc" id="L1368">	  double mid = m_minY+((m_maxY-m_minY)/2.0);</span>
<span class="nc" id="L1369">	  whole = (int)Math.abs(mid);</span>
<span class="nc" id="L1370">	  decimal = Math.abs(mid) - whole;</span>
<span class="nc bnc" id="L1371" title="All 2 branches missed.">	  nondecimal = (whole &gt; 0) </span>
<span class="nc" id="L1372">	    ? (int)(Math.log(whole) / Math.log(10))</span>
<span class="nc" id="L1373">	    : 1;</span>
<span class="nc bnc" id="L1374" title="All 2 branches missed.">	  precisionYmid = (decimal &gt; 0) </span>
<span class="nc" id="L1375">	    ? (int)Math.abs(((Math.log(Math.abs(mid)) / </span>
<span class="nc" id="L1376">			      Math.log(10))))+2</span>
<span class="nc" id="L1377">	    : 1;</span>
<span class="nc bnc" id="L1378" title="All 2 branches missed.">	  if (precisionYmid &gt; VisualizeUtils.MAX_PRECISION) {</span>
<span class="nc" id="L1379">	    precisionYmid = 1;</span>
	  }
	 
<span class="nc" id="L1382">	  String maxString = Utils.doubleToString(mid,</span>
<span class="nc" id="L1383">						  nondecimal+1+precisionYmid,</span>
<span class="nc" id="L1384">						  precisionYmid);</span>
<span class="nc" id="L1385">	  int sw = m_labelMetrics.stringWidth(maxString);</span>
<span class="nc" id="L1386">	  double mx = m_YaxisStart+((double)(m_YaxisEnd-m_YaxisStart)/2.0);</span>
<span class="nc" id="L1387">	  gx.drawString(maxString,</span>
<span class="nc" id="L1388">			m_XaxisStart-sw-m_tickSize-1,</span>
<span class="nc" id="L1389">			(int)(mx+(((double)hf)/2.0)));</span>
<span class="nc" id="L1390">	  gx.drawLine(m_XaxisStart-m_tickSize,(int)mx,m_XaxisStart,(int)mx);</span>
	}
      }
    } else {
<span class="nc" id="L1394">      int numValues = m_plotInstances.attribute(m_yIndex).numValues();</span>
<span class="nc bnc" id="L1395" title="All 2 branches missed.">      int div = ((numValues % 2) == 0) ? (numValues/2) : (numValues/2+1);</span>
<span class="nc" id="L1396">      int maxYStringHeight = (m_YaxisEnd - m_XaxisStart) / div;</span>
<span class="nc" id="L1397">      int sw = m_labelMetrics.stringWidth(&quot;M&quot;);</span>
<span class="nc bnc" id="L1398" title="All 2 branches missed.">      for (int i=0;i&lt;numValues;i++) {</span>
	// can we at least print 2 characters
<span class="nc bnc" id="L1400" title="All 2 branches missed.">	if (maxYStringHeight &gt;= (2*hf)) {</span>
<span class="nc" id="L1401">	  String val = m_plotInstances.attribute(m_yIndex).value(i);</span>
<span class="nc bnc" id="L1402" title="All 2 branches missed.">	  int numPrint = ((maxYStringHeight/hf) &gt; val.length()) ?</span>
<span class="nc" id="L1403">	    val.length() :</span>
<span class="nc" id="L1404">	    (maxYStringHeight/hf);</span>
	    
<span class="nc bnc" id="L1406" title="All 2 branches missed.">	  for (int j=0;j&lt;numPrint;j++) {</span>
<span class="nc" id="L1407">	    String ll = val.substring(j,j+1);</span>
<span class="nc bnc" id="L1408" title="All 4 branches missed.">	    if (val.charAt(j) == '_' || val.charAt(j) == '-') {</span>
<span class="nc" id="L1409">	      ll = &quot;|&quot;;</span>
	    }
<span class="nc bnc" id="L1411" title="All 2 branches missed.">	    if (i == 0) {</span>
<span class="nc" id="L1412">	      gx.drawString(ll,m_XaxisStart-sw-m_tickSize-1,</span>
<span class="nc" id="L1413">			    (int)convertToPanelY(i)</span>
<span class="nc" id="L1414">			    -((numPrint-1)*hf)</span>
<span class="nc" id="L1415">			    +(j*hf)</span>
<span class="nc" id="L1416">			    +(hf/2));</span>
<span class="nc bnc" id="L1417" title="All 2 branches missed.">	    } else if (i == (numValues-1)) {</span>
<span class="nc bnc" id="L1418" title="All 2 branches missed.">	      if ((i % 2) == 0) {</span>
<span class="nc" id="L1419">		gx.drawString(ll,m_XaxisStart-sw-m_tickSize-1,</span>
<span class="nc" id="L1420">			      (int)convertToPanelY(i)</span>
<span class="nc" id="L1421">			      +(j*hf)</span>
<span class="nc" id="L1422">			      +(hf/2));</span>
	      } else {
<span class="nc" id="L1424">		gx.drawString(ll,m_XaxisStart-(2*sw)-m_tickSize-1,</span>
<span class="nc" id="L1425">			      (int)convertToPanelY(i)</span>
<span class="nc" id="L1426">			      +(j*hf)</span>
<span class="nc" id="L1427">			      +(hf/2));</span>
	      }
	    } else {
<span class="nc bnc" id="L1430" title="All 2 branches missed.">	      if ((i % 2) == 0) {</span>
<span class="nc" id="L1431">		gx.drawString(ll,m_XaxisStart-sw-m_tickSize-1,</span>
<span class="nc" id="L1432">			      (int)convertToPanelY(i)</span>
<span class="nc" id="L1433">			      -(((numPrint-1)*hf)/2)</span>
<span class="nc" id="L1434">			      +(j*hf)</span>
<span class="nc" id="L1435">			      +(hf/2));</span>
	      } else {
<span class="nc" id="L1437">		gx.drawString(ll,m_XaxisStart-(2*sw)-m_tickSize-1,</span>
<span class="nc" id="L1438">			      (int)convertToPanelY(i)</span>
<span class="nc" id="L1439">			      -(((numPrint-1)*hf)/2)</span>
<span class="nc" id="L1440">			      +(j*hf)</span>
<span class="nc" id="L1441">			      +(hf/2));</span>
	      }
	    }
	  }
	}
<span class="nc" id="L1446">	gx.drawLine(m_XaxisStart-m_tickSize,</span>
<span class="nc" id="L1447">		    (int)convertToPanelY(i),</span>
<span class="nc" id="L1448">		    m_XaxisStart,</span>
<span class="nc" id="L1449">		    (int)convertToPanelY(i));</span>
      }
    }

<span class="nc" id="L1453">    gx.drawLine(m_XaxisStart,</span>
<span class="nc" id="L1454">		m_YaxisStart,</span>
<span class="nc" id="L1455">		m_XaxisStart,</span>
<span class="nc" id="L1456">		m_YaxisEnd);</span>
<span class="nc" id="L1457">    gx.drawLine(m_XaxisStart,</span>
<span class="nc" id="L1458">		m_YaxisEnd,</span>
<span class="nc" id="L1459">		m_XaxisEnd,</span>
<span class="nc" id="L1460">		m_YaxisEnd);</span>

<span class="nc bnc" id="L1462" title="All 4 branches missed.">    if (m_XaxisStart != mxs || m_XaxisEnd != mxe ||</span>
<span class="nc bnc" id="L1463" title="All 4 branches missed.">	m_YaxisStart != mys || m_YaxisEnd != mye) {</span>
<span class="nc" id="L1464">      m_plotResize = true;</span>
    }
<span class="nc" id="L1466">  }</span>

  /**
   * Add more colours to the colour map
   */
  private void extendColourMap(int highest) {
    //System.err.println(&quot;Extending colour map&quot;);
<span class="nc bnc" id="L1473" title="All 2 branches missed.">    for (int i = m_colorList.size(); i &lt; highest; i++) {</span>
<span class="nc" id="L1474">      Color pc = m_DefaultColors[i % 10];</span>
<span class="nc" id="L1475">      int ija =  i / 10;</span>
<span class="nc" id="L1476">      ija *= 2; </span>
<span class="nc bnc" id="L1477" title="All 2 branches missed.">      for (int j=0;j&lt;ija;j++) {</span>
<span class="nc" id="L1478">	pc = pc.brighter();</span>
      }
      
<span class="nc" id="L1481">      m_colorList.addElement(pc);</span>
    }
<span class="nc" id="L1483">  }</span>

  /**
   * Renders this component
   * @param gx the graphics context
   */
  public void paintComponent(Graphics gx) {
<span class="nc" id="L1490">    super.paintComponent(gx);</span>
<span class="nc bnc" id="L1491" title="All 2 branches missed.">    if (m_plotInstances != null </span>
<span class="nc bnc" id="L1492" title="All 2 branches missed.">	&amp;&amp; m_plotInstances.numInstances() &gt; 0</span>
<span class="nc bnc" id="L1493" title="All 2 branches missed.">	&amp;&amp; m_plotInstances.numAttributes() &gt; 0) {</span>
<span class="nc bnc" id="L1494" title="All 2 branches missed.">      if (m_plotCompanion != null) {</span>
<span class="nc" id="L1495">	m_plotCompanion.prePlot(gx);</span>
      }

<span class="nc" id="L1498">      m_JRand = new Random(m_JitterVal);</span>
<span class="nc" id="L1499">      paintAxis(gx);</span>
<span class="nc bnc" id="L1500" title="All 4 branches missed.">      if (m_axisChanged || m_plotResize) {</span>
<span class="nc" id="L1501">	int x_range = m_XaxisEnd - m_XaxisStart;</span>
<span class="nc" id="L1502">	int y_range = m_YaxisEnd - m_YaxisStart;</span>
<span class="nc bnc" id="L1503" title="All 2 branches missed.">	if (x_range &lt; 10) {</span>
<span class="nc" id="L1504">	  x_range = 10;</span>
	}
<span class="nc bnc" id="L1506" title="All 2 branches missed.">	if (y_range &lt; 10) {</span>
<span class="nc" id="L1507">	  y_range = 10;</span>
	}

<span class="nc" id="L1510">	m_drawnPoints = new int[x_range + 1][y_range + 1];</span>
<span class="nc" id="L1511">	fillLookup();</span>
<span class="nc" id="L1512">	m_plotResize = false;</span>
<span class="nc" id="L1513">	m_axisChanged = false;</span>
      }
<span class="nc" id="L1515">      paintData(gx);</span>
    }
<span class="nc" id="L1517">  }</span>

  protected static Color checkAgainstBackground(Color c, Color background) {
<span class="nc bnc" id="L1520" title="All 2 branches missed.">    if (background == null) {</span>
<span class="nc" id="L1521">      return c;</span>
    }
    
<span class="nc bnc" id="L1524" title="All 2 branches missed.">    if (c.equals(background)) {</span>
<span class="nc" id="L1525">      int red = c.getRed();</span>
<span class="nc" id="L1526">      int blue = c.getBlue();</span>
<span class="nc" id="L1527">      int green = c.getGreen();</span>
<span class="nc bnc" id="L1528" title="All 2 branches missed.">      red += (red &lt; 128) ? (255 - red) / 2 : -(red / 2);</span>
<span class="nc bnc" id="L1529" title="All 2 branches missed.">      blue += (blue &lt; 128) ? (blue - red) / 2 : -(blue / 2);</span>
<span class="nc bnc" id="L1530" title="All 2 branches missed.">      green += (green&lt; 128) ? (255 - green) / 2 : -(green / 2);</span>
<span class="nc" id="L1531">      c = new Color(red, green, blue);</span>
    }
<span class="nc" id="L1533">    return c;</span>
  }

  /**
   * Main method for testing this class
   * @param args arguments
   */
  public static void main(String [] args) {
    try {
<span class="nc bnc" id="L1542" title="All 2 branches missed.">      if (args.length &lt; 1) {</span>
<span class="nc" id="L1543">	System.err.println(Messages.getInstance().getString(&quot;Plot2D_Main_Error_Text_First&quot;));</span>
<span class="nc" id="L1544">	System.exit(1);</span>
      }

<span class="nc" id="L1547">      final javax.swing.JFrame jf = </span>
<span class="nc" id="L1548">	new javax.swing.JFrame(Messages.getInstance().getString(&quot;Plot2D_Main_JFrame_Text&quot;));</span>
<span class="nc" id="L1549">      jf.setSize(500,400);</span>
<span class="nc" id="L1550">      jf.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L1551">      final Plot2D p2 = new Plot2D();</span>
<span class="nc" id="L1552">      jf.getContentPane().add(p2, BorderLayout.CENTER);</span>
<span class="nc" id="L1553">      jf.addWindowListener(new java.awt.event.WindowAdapter() {</span>
	  public void windowClosing(java.awt.event.WindowEvent e) {
<span class="nc" id="L1555">	    jf.dispose();</span>
<span class="nc" id="L1556">	    System.exit(0);</span>
<span class="nc" id="L1557">	  }</span>
	});
      
<span class="nc" id="L1560">      p2.addMouseListener(new MouseAdapter() {</span>
	  public void mouseClicked(MouseEvent e) {
<span class="nc bnc" id="L1562" title="All 2 branches missed.">	    if ((e.getModifiers() &amp; InputEvent.BUTTON1_MASK) ==</span>
<span class="nc" id="L1563">		InputEvent.BUTTON1_MASK) {</span>
<span class="nc" id="L1564">	      p2.searchPoints(e.getX(), e.getY(), false);</span>
	    } else {
<span class="nc" id="L1566">	      p2.searchPoints(e.getX(), e.getY(), true);</span>
	    }
<span class="nc" id="L1568">	  }</span>
	});

<span class="nc" id="L1571">      jf.setVisible(true);</span>
<span class="nc bnc" id="L1572" title="All 2 branches missed.">      if (args.length &gt;= 1) {</span>
<span class="nc bnc" id="L1573" title="All 2 branches missed.">	for (int j = 0; j &lt; args.length; j++) {</span>
<span class="nc" id="L1574">	  System.err.println(Messages.getInstance().getString(&quot;Plot2D_Main_Error_Text_Second&quot;) + args[j]);</span>
<span class="nc" id="L1575">	  java.io.Reader r = new java.io.BufferedReader(</span>
<span class="nc" id="L1576">			     new java.io.FileReader(args[j]));</span>
<span class="nc" id="L1577">	  Instances i = new Instances(r);</span>
<span class="nc" id="L1578">	  i.setClassIndex(i.numAttributes()-1);</span>
<span class="nc" id="L1579">	  PlotData2D pd1 = new PlotData2D(i);</span>

<span class="nc bnc" id="L1581" title="All 2 branches missed.">	  if (j == 0) {</span>
<span class="nc" id="L1582">	    pd1.setPlotName(Messages.getInstance().getString(&quot;Plot2D_Main_Pd1_SetPlotName_Text_First&quot;));</span>
<span class="nc" id="L1583">	    p2.setMasterPlot(pd1);</span>
<span class="nc" id="L1584">	    p2.setXindex(2);</span>
<span class="nc" id="L1585">	    p2.setYindex(3);</span>
<span class="nc" id="L1586">	    p2.setCindex(i.classIndex());</span>
	  } else {
<span class="nc" id="L1588">	    pd1.setPlotName(Messages.getInstance().getString(&quot;Plot2D_Main_Pd1_SetPlotName_Text_Second&quot;) + (j+1));</span>
<span class="nc" id="L1589">	    pd1.m_useCustomColour = true;</span>
<span class="nc bnc" id="L1590" title="All 2 branches missed.">	    pd1.m_customColour = (j % 2 == 0) ? Color.red : Color.blue; </span>
<span class="nc" id="L1591">	    p2.addPlot(pd1);</span>
	  }
	}
      }
<span class="nc" id="L1595">    } catch (Exception ex) {</span>
<span class="nc" id="L1596">      ex.printStackTrace();</span>
<span class="nc" id="L1597">      System.err.println(ex.getMessage());</span>
    }
<span class="nc" id="L1599">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>