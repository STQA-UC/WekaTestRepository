<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>MatrixPanel.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.gui.visualize</a> &gt; <span class="el_source">MatrixPanel.java</span></div><h1>MatrixPanel.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">/*</span>
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 *    MatrixPanel.java
 *    Copyright (C) 2002 University of Waikato, Hamilton, New Zealand
 *
 */

package weka.gui.visualize;

import weka.core.Attribute;
import weka.core.FastVector;
import weka.core.Instances;
import weka.gui.ExtensionFileFilter;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Dialog.ModalityType;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.ComponentAdapter;
import java.awt.event.ComponentEvent;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.awt.event.MouseMotionListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.Random;

import javax.swing.BorderFactory;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JDialog;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSlider;
import javax.swing.JSplitPane;
import javax.swing.JTextField;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;

/**
 * This panel displays a plot matrix of the user selected attributes
 * of a given data set.
 *
 * The datapoints are coloured using a discrete colouring set if the
 * user has selected a nominal attribute for colouring. If the user
 * has selected a numeric attribute then the datapoints are coloured
 * using a colour spectrum ranging from blue to red (low values to
 * high). Datapoints missing a class value are displayed in black.
 *
 * @author Ashraf M. Kibriya (amk14@cs.waikato.ac.nz)
 * @version $Revision: 7899 $
 */
<span class="fc" id="L81">public class MatrixPanel</span>
  extends JPanel{

  /** for serialization */
  private static final long serialVersionUID = -1232642719869188740L;

  /** The that panel contains the actual matrix */
  private final Plot m_plotsPanel;

  /** The panel that displays the legend of the colouring attribute */
<span class="nc" id="L91">  protected final ClassPanel m_cp = new ClassPanel();</span>

  /** The panel that contains all the buttons and tools, i.e. resize, jitter bars and sub-sampling buttons etc
      on the bottom of the panel */
  protected JPanel optionsPanel;

  /** Split pane for splitting the matrix and the buttons and bars */
  protected JSplitPane jp;
  /** The button that updates the display to reflect the changes made by the user.
      E.g. changed attribute set for the matrix    */
<span class="nc" id="L101">  protected JButton m_updateBt = new JButton(Messages.getInstance().getString(&quot;MatrixPanel_UpdateBt_JButton_Text&quot;));</span>

  /** The button to display a window to select attributes */
<span class="nc" id="L104">  protected JButton m_selAttrib = new JButton(Messages.getInstance().getString(&quot;MatrixPanel_SelAttrib_JButton_Text&quot;));</span>

  /** The dataset for which this panel will display the plot matrix for  */
<span class="nc" id="L107">  protected Instances m_data=null;</span>

  /** The list for selecting the attributes to display the plot matrix */
<span class="nc" id="L110">  protected JList m_attribList = new JList();</span>

  /** The scroll pane to scrolling the matrix */
<span class="nc" id="L113">  protected final JScrollPane m_js = new JScrollPane();</span>

  /** The combo box to allow user to select the colouring attribute */
<span class="nc" id="L116">  protected JComboBox m_classAttrib = new JComboBox();</span>

  /** The slider to adjust the size of the cells in the matrix  */
<span class="nc" id="L119">  protected JSlider m_plotSize = new JSlider(50, 500, 100);</span>

  /** The slider to adjust the size of the datapoints  */
<span class="nc" id="L122">  protected JSlider m_pointSize = new JSlider(1, 10, 1);</span>

  /** The slider to add jitter to the plots */
<span class="nc" id="L125">  protected JSlider m_jitter = new JSlider(0, 20, 0);</span>

  /** For adding random jitter */
<span class="nc" id="L128">  private Random rnd = new Random();</span>

  /** Array containing precalculated jitter values */
  private int jitterVals[][];

  /** This stores the size of the datapoint */
<span class="nc" id="L134">  private int datapointSize=1;</span>

  /** The text area for percentage to resample data */
<span class="nc" id="L137">  protected JTextField m_resamplePercent = new JTextField(5);</span>

  /** The label for resample percentage */
<span class="nc" id="L140">  protected JButton m_resampleBt =  new JButton(Messages.getInstance().getString(&quot;MatrixPanel_ResampleBt_JButton_Text&quot;));</span>

  /** Random seed for random subsample */
<span class="nc" id="L143">  protected JTextField m_rseed = new JTextField(5);</span>

  /** Displays the current size beside the slider bar for cell size */
<span class="nc" id="L146">  private final JLabel m_plotSizeLb = new JLabel(Messages.getInstance().getString(&quot;MatrixPanel_PlotSizeLb_JLabel_Text&quot;));</span>

  /** Displays the current size beside the slider bar for point size */
<span class="nc" id="L149">  private final JLabel m_pointSizeLb = new JLabel(Messages.getInstance().getString(&quot;MatrixPanel_PointSizeLb_JLabel_Text&quot;));</span>

  /** This array contains the indices of the attributes currently selected  */
  private int [] m_selectedAttribs;

  /** This contains the index of the currently selected colouring attribute  */
  private int m_classIndex;

  /** This is a local array cache for all the instance values for faster rendering */
  private int [][] m_points;

  /** This is an array cache for the colour of each of the instances depending on the
      colouring attribute. If the colouring attribute is nominal then it contains the
      index of the colour in our colour list. Otherwise, for numeric colouring attribute,
      it contains the precalculated red component for each instance's colour */
  private int [] m_pointColors;

  /** Contains true for each attribute value (only the selected attributes+class attribute)
      that is  missing, for each instance.
      m_missing[i][j] == true if m_selectedAttribs[j] is missing in instance i.
      m_missing[i][m_missing[].length-1] == true  if class value is missing in instance i. */
  private boolean [][] m_missing;

  /** This array contains for the classAttribute: &lt;br&gt;
      m_type[0] = [type of attribute, nominal, string or numeric]&lt;br&gt;
      m_type[1] = [number of discrete values of nominal or string attribute &lt;br&gt;
      or same as m_type[0] for numeric attribute] */
  private int [] m_type;

  /** Stores the maximum size for PlotSize label to keep it's size constant */
  private Dimension m_plotLBSizeD;

  /** Stores the maximum size for PointSize label to keep it's size constant */
  private Dimension m_pointLBSizeD;

  /** Contains discrete colours for colouring for nominal attributes */
<span class="nc" id="L185">  private FastVector m_colorList = new FastVector();</span>

  /** default colour list */
<span class="fc" id="L188">  private static final Color [] m_defaultColors = {Color.blue,</span>
<span class="fc" id="L189">		 				   Color.red,</span>
<span class="fc" id="L190">						   Color.cyan,</span>
<span class="fc" id="L191">						   new Color(75, 123, 130),</span>
<span class="fc" id="L192">						   Color.pink,</span>
<span class="fc" id="L193">						   Color.green,</span>
<span class="fc" id="L194">						   Color.orange,</span>
<span class="fc" id="L195">						   new Color(255, 0, 255),</span>
<span class="fc" id="L196">						   new Color(255, 0, 0),</span>
<span class="fc" id="L197">						   new Color(0, 255, 0),</span>
<span class="fc" id="L198">						   Color.black};</span>

  /** color for the font used in column and row names */
<span class="nc" id="L201">  private final Color fontColor = new Color(98, 101, 156);</span>

  /** font used in column and row names */
<span class="nc" id="L204">  private final java.awt.Font f = new java.awt.Font(&quot;Dialog&quot;, java.awt.Font.BOLD, 11);</span>



  /**
   * Constructor
   */
<span class="nc" id="L211">  public MatrixPanel() {</span>
<span class="nc" id="L212">    m_rseed.setText(&quot;1&quot;);</span>

    /** Setting up GUI **/
<span class="nc" id="L215">    m_selAttrib.addActionListener( new ActionListener() {</span>
	public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L217">	  final JDialog jd = new JDialog((JFrame) MatrixPanel.this.getTopLevelAncestor(),</span>
<span class="nc" id="L218">			  Messages.getInstance().getString(&quot;MatrixPanel_Jd_JDialog_Text&quot;),</span>
<span class="nc" id="L219">			  ModalityType.DOCUMENT_MODAL);</span>

<span class="nc" id="L221">	  JPanel jp = new JPanel();</span>
<span class="nc" id="L222">	  JScrollPane js = new JScrollPane(m_attribList);</span>
<span class="nc" id="L223">	  JButton okBt = new JButton(Messages.getInstance().getString(&quot;MatrixPanel_OkBt_JButton_Text&quot;));</span>
<span class="nc" id="L224">	  JButton cancelBt = new JButton(Messages.getInstance().getString(&quot;MatrixPanel_CancelBt_JButton_Text&quot;));</span>
<span class="nc" id="L225">	  final int [] savedSelection = m_attribList.getSelectedIndices();</span>

<span class="nc" id="L227">	  okBt.addActionListener( new ActionListener() {</span>
	      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L229">		jd.dispose(); }</span>
	    } );

<span class="nc" id="L232">	  cancelBt.addActionListener( new ActionListener() {</span>
	      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L234">		m_attribList.setSelectedIndices(savedSelection);</span>
<span class="nc" id="L235">		jd.dispose();}</span>
	    });
<span class="nc" id="L237">	  jd.addWindowListener( new WindowAdapter() {</span>
	      public void windowClosing(WindowEvent e) {
<span class="nc" id="L239">		m_attribList.setSelectedIndices(savedSelection);</span>
<span class="nc" id="L240">		jd.dispose();}</span>
	    });
<span class="nc" id="L242">	  jp.add(okBt);</span>
<span class="nc" id="L243">	  jp.add(cancelBt);</span>

<span class="nc" id="L245">	  jd.getContentPane().add(js, BorderLayout.CENTER);</span>
<span class="nc" id="L246">	  jd.getContentPane().add(jp, BorderLayout.SOUTH);</span>

<span class="nc bnc" id="L248" title="All 2 branches missed.">	  if(js.getPreferredSize().width &lt; 200)</span>
<span class="nc" id="L249">	    jd.setSize( 250, 250 );</span>
	  else
<span class="nc" id="L251">	    jd.setSize( (int) js.getPreferredSize().width+10, 250);</span>

<span class="nc" id="L253">	  jd.setLocation( m_selAttrib.getLocationOnScreen().x,</span>
<span class="nc" id="L254">			  m_selAttrib.getLocationOnScreen().y-jd.getHeight() );</span>
<span class="nc" id="L255">	  jd.setVisible(true);</span>
<span class="nc" id="L256">	}</span>
      });

<span class="nc" id="L259">    m_updateBt.addActionListener( new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {
	    //m_selectedAttribs = m_attribList.getSelectedIndices();
<span class="nc" id="L262">	  initInternalFields();</span>

<span class="nc" id="L264">	  Plot a = m_plotsPanel;</span>
<span class="nc" id="L265">	  a.setCellSize( m_plotSize.getValue() );</span>
<span class="nc" id="L266">	  Dimension d = new Dimension((m_selectedAttribs.length)*(a.cellSize+a.extpad)+2,</span>
<span class="nc" id="L267">				      (m_selectedAttribs.length)*(a.cellSize+a.extpad)+2</span>
				     );
	  //System.out.println(&quot;Size: &quot;+a.cellSize+&quot; Extpad: &quot;+
	  //		   a.extpad+&quot; selected: &quot;+
	  //		   m_selectedAttribs.length+' '+d);
<span class="nc" id="L272">	  a.setPreferredSize(d);</span>
<span class="nc" id="L273">	  a.setSize( a.getPreferredSize() );</span>
<span class="nc" id="L274">	  a.setJitter( m_jitter.getValue() );</span>

<span class="nc" id="L276">	  m_js.revalidate();</span>
<span class="nc" id="L277">	  m_cp.setColours(m_colorList);</span>
<span class="nc" id="L278">	  m_cp.setCindex(m_classIndex);</span>

<span class="nc" id="L280">	  repaint();</span>
<span class="nc" id="L281">	}</span>
      });
<span class="nc" id="L283">    m_updateBt.setPreferredSize( m_selAttrib.getPreferredSize() );</span>

<span class="nc" id="L285">    m_plotSize.addChangeListener( new ChangeListener() {</span>
	public void stateChanged(ChangeEvent ce) {
<span class="nc" id="L287">	  m_plotSizeLb.setText(Messages.getInstance().getString(&quot;MatrixPanel_StateChanged_PlotSizeLb_Text_First&quot;) + m_plotSize.getValue() + Messages.getInstance().getString(&quot;MatrixPanel_StateChanged_PlotSizeLb_Text_Second&quot;));</span>
<span class="nc" id="L288">	  m_plotSizeLb.setPreferredSize( m_plotLBSizeD );</span>
<span class="nc" id="L289">	  m_jitter.setMaximum( m_plotSize.getValue()/5 ); //20% of cell Size</span>
<span class="nc" id="L290">	}</span>
      });

<span class="nc" id="L293">    m_pointSize.addChangeListener( new ChangeListener() {</span>
	public void stateChanged(ChangeEvent ce) {
<span class="nc" id="L295">	  m_pointSizeLb.setText(Messages.getInstance().getString(&quot;MatrixPanel_StateChanged_PointSizeLb_Text_First&quot;) + m_pointSize.getValue() + Messages.getInstance().getString(&quot;MatrixPanel_StateChanged_PointSizeLb_Text_Second&quot;));</span>
<span class="nc" id="L296">	  m_pointSizeLb.setPreferredSize( m_pointLBSizeD );</span>
<span class="nc" id="L297">	  datapointSize = m_pointSize.getValue();</span>
<span class="nc" id="L298">	}</span>
      });

<span class="nc" id="L301">    m_resampleBt.addActionListener( new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {
<span class="nc" id="L303">	  JLabel rseedLb = new JLabel(Messages.getInstance().getString(&quot;MatrixPanel_ActionPerformed_RseedLb_JLabel_Text&quot;));</span>
<span class="nc" id="L304">	  JTextField rseedTxt = m_rseed;</span>
<span class="nc" id="L305">	  JLabel percentLb = new JLabel(Messages.getInstance().getString(&quot;MatrixPanel_ActionPerformed_PercentLb_JLabel_Text&quot;));</span>
<span class="nc" id="L306">	  JLabel percent2Lb = new JLabel(Messages.getInstance().getString(&quot;MatrixPanel_ActionPerformed_Percent2Lb_JLabel_Text&quot;));</span>
<span class="nc" id="L307">	  final JTextField percentTxt = new JTextField(5);</span>
<span class="nc" id="L308">	  percentTxt.setText( m_resamplePercent.getText() );</span>
<span class="nc" id="L309">	  JButton doneBt = new JButton(Messages.getInstance().getString(&quot;MatrixPanel_ActionPerformed_DoneBt_JButton_Text&quot;));</span>

<span class="nc" id="L311">	  final JDialog jd = new JDialog((JFrame) MatrixPanel.this.getTopLevelAncestor(),</span>
<span class="nc" id="L312">			  Messages.getInstance().getString(&quot;MatrixPanel_ActionPerformed_Jd_JDialog_Text&quot;),</span>
<span class="nc" id="L313">			  ModalityType.DOCUMENT_MODAL) {</span>
	      private static final long serialVersionUID = -269823533147146296L;

	      public void dispose() {
<span class="nc" id="L317">		m_resamplePercent.setText(percentTxt.getText());</span>
<span class="nc" id="L318">		super.dispose();</span>
<span class="nc" id="L319">	      }</span>
	    };
<span class="nc" id="L321">	  jd.setDefaultCloseOperation( JDialog.DISPOSE_ON_CLOSE );</span>

<span class="nc" id="L323">	  doneBt.addActionListener( new ActionListener(){</span>
	      public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L325">		jd.dispose();</span>
<span class="nc" id="L326">	      }</span>
	    });
<span class="nc" id="L328">	  GridBagLayout gbl = new GridBagLayout();</span>
<span class="nc" id="L329">	  GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="nc" id="L330">	  JPanel p1 = new JPanel( gbl );</span>
<span class="nc" id="L331">	  gbc.anchor = GridBagConstraints.WEST; gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L332">	  gbc.insets = new Insets(0,2,2,2);</span>
<span class="nc" id="L333">	  gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L334">	  p1.add(rseedLb, gbc); gbc.weightx = 0;</span>
<span class="nc" id="L335">	  gbc.gridwidth = GridBagConstraints.REMAINDER; gbc.weightx=1;</span>
<span class="nc" id="L336">	  p1.add(rseedTxt, gbc);</span>
<span class="nc" id="L337">	  gbc.insets = new Insets(8,2,0,2); gbc.weightx=0;</span>
<span class="nc" id="L338">	  p1.add(percentLb, gbc);</span>
<span class="nc" id="L339">	  gbc.insets = new Insets(0,2,2,2); gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L340">	  p1.add(percent2Lb, gbc);</span>
<span class="nc" id="L341">	  gbc.gridwidth = GridBagConstraints.REMAINDER; gbc.weightx=1;</span>
<span class="nc" id="L342">	  p1.add(percentTxt, gbc);</span>
<span class="nc" id="L343">	  gbc.insets = new Insets(8,2,2,2);</span>

<span class="nc" id="L345">	  JPanel p3 = new JPanel( gbl );</span>
<span class="nc" id="L346">	  gbc.fill = GridBagConstraints.HORIZONTAL; gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L347">	  gbc.weightx = 1;  gbc.weighty = 0;</span>
<span class="nc" id="L348">	  p3.add(p1, gbc);</span>
<span class="nc" id="L349">	  gbc.insets = new Insets(8,4,8,4);</span>
<span class="nc" id="L350">	  p3.add(doneBt, gbc);</span>

<span class="nc" id="L352">	  jd.getContentPane().setLayout( new BorderLayout() );</span>
<span class="nc" id="L353">	  jd.getContentPane().add(p3, BorderLayout.NORTH);</span>
<span class="nc" id="L354">	  jd.pack();</span>
<span class="nc" id="L355">	  jd.setLocation( m_resampleBt.getLocationOnScreen().x,</span>
<span class="nc" id="L356">			  m_resampleBt.getLocationOnScreen().y-jd.getHeight() );</span>
<span class="nc" id="L357">	  jd.setVisible(true);</span>
<span class="nc" id="L358">	}</span>
      });

<span class="nc" id="L361">    optionsPanel = new JPanel( new GridBagLayout() ); //all the rest of the panels are in here.</span>
<span class="nc" id="L362">    final JPanel p2 = new JPanel( new BorderLayout() );  //this has class colour panel</span>
<span class="nc" id="L363">    final JPanel p3 = new JPanel( new GridBagLayout() ); //this has update and select buttons</span>
<span class="nc" id="L364">    final JPanel p4 = new JPanel( new GridBagLayout() ); //this has the slider bars and combobox</span>
<span class="nc" id="L365">    GridBagConstraints gbc = new GridBagConstraints();</span>

<span class="nc" id="L367">    m_plotLBSizeD = m_plotSizeLb.getPreferredSize();</span>
<span class="nc" id="L368">    m_pointLBSizeD = m_pointSizeLb.getPreferredSize();</span>
<span class="nc" id="L369">    m_pointSizeLb.setText(Messages.getInstance().getString(&quot;MatrixPanel_ActionPerformed_PointSizeLb_Text&quot;));</span>
<span class="nc" id="L370">    m_pointSizeLb.setPreferredSize( m_pointLBSizeD );</span>
<span class="nc" id="L371">    m_resampleBt.setPreferredSize( m_selAttrib.getPreferredSize() );</span>

<span class="nc" id="L373">    gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L374">    gbc.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L375">    gbc.insets = new Insets(2,2,2,2);</span>
<span class="nc" id="L376">    p4.add(m_plotSizeLb, gbc);</span>
<span class="nc" id="L377">    gbc.weightx=1; gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L378">    p4.add(m_plotSize, gbc);</span>
<span class="nc" id="L379">    gbc.weightx=0; gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L380">    p4.add(m_pointSizeLb, gbc);</span>
<span class="nc" id="L381">    gbc.weightx=1; gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L382">    p4.add(m_pointSize, gbc);</span>
<span class="nc" id="L383">    gbc.weightx=0; gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L384">    p4.add( new JLabel(Messages.getInstance().getString(&quot;MatrixPanel_ActionPerformed_P4_Text&quot;)), gbc);</span>
<span class="nc" id="L385">    gbc.weightx=1; gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L386">    p4.add(m_jitter, gbc);</span>
<span class="nc" id="L387">    p4.add(m_classAttrib, gbc);</span>

<span class="nc" id="L389">    gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L390">    gbc.weightx=1;</span>
<span class="nc" id="L391">    gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L392">    p3.add(m_updateBt, gbc);</span>
<span class="nc" id="L393">    p3.add(m_selAttrib, gbc);</span>
<span class="nc" id="L394">    gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L395">    gbc.weightx = 0;</span>
<span class="nc" id="L396">    gbc.fill = GridBagConstraints.VERTICAL;</span>
<span class="nc" id="L397">    gbc.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L398">    p3.add(m_resampleBt, gbc);</span>
<span class="nc" id="L399">    gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L400">    p3.add(m_resamplePercent, gbc);</span>

<span class="nc" id="L402">    p2.setBorder(BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;MatrixPanel_ActionPerformed_P2_BorderFactoryCreateTitledBorder_Text&quot;)));</span>
<span class="nc" id="L403">    p2.add(m_cp, BorderLayout.SOUTH);</span>

<span class="nc" id="L405">    gbc.insets = new Insets(8,5,2,5);</span>
<span class="nc" id="L406">    gbc.anchor = GridBagConstraints.SOUTHWEST; gbc.fill = GridBagConstraints.HORIZONTAL; gbc.weightx=1;</span>
<span class="nc" id="L407">    gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L408">    optionsPanel.add(p4, gbc);</span>
<span class="nc" id="L409">    gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L410">    optionsPanel.add(p3, gbc);</span>
<span class="nc" id="L411">    optionsPanel.add(p2, gbc);</span>

<span class="nc" id="L413">    this.addComponentListener( new ComponentAdapter() {</span>
	public void componentResized(ComponentEvent cv) {
<span class="nc" id="L415">	  m_js.setMinimumSize( new Dimension(MatrixPanel.this.getWidth(),</span>
<span class="nc" id="L416">					     MatrixPanel.this.getHeight()</span>
<span class="nc" id="L417">					     -optionsPanel.getPreferredSize().height-10));</span>
<span class="nc" id="L418">	  jp.setDividerLocation( MatrixPanel.this.getHeight()-optionsPanel.getPreferredSize().height-10 );</span>
<span class="nc" id="L419">	}</span>
      });

<span class="nc" id="L422">    optionsPanel.setMinimumSize( new Dimension(0,0) );</span>
<span class="nc" id="L423">    jp = new JSplitPane(JSplitPane.VERTICAL_SPLIT, m_js, optionsPanel);</span>
<span class="nc" id="L424">    jp.setOneTouchExpandable(true);</span>
<span class="nc" id="L425">    jp.setResizeWeight(1);</span>
<span class="nc" id="L426">    this.setLayout( new BorderLayout() );</span>
<span class="nc" id="L427">    this.add(jp, BorderLayout.CENTER);</span>

    /** Setting up the initial color list **/
<span class="nc bnc" id="L430" title="All 2 branches missed.">    for(int i=0; i&lt;m_defaultColors.length-1; i++)</span>
<span class="nc" id="L431">      m_colorList.addElement(m_defaultColors[i]);</span>

    /** Initializing internal fields and components **/
<span class="nc" id="L434">    m_selectedAttribs = m_attribList.getSelectedIndices();</span>
<span class="nc" id="L435">    m_plotsPanel = new Plot();</span>
<span class="nc" id="L436">    m_plotsPanel.setLayout(null);</span>
<span class="nc" id="L437">    m_js.getHorizontalScrollBar().setUnitIncrement( 10 );</span>
<span class="nc" id="L438">    m_js.getVerticalScrollBar().setUnitIncrement( 10 );</span>
<span class="nc" id="L439">    m_js.setViewportView( m_plotsPanel );</span>
<span class="nc" id="L440">    m_js.setColumnHeaderView( m_plotsPanel.getColHeader() );</span>
<span class="nc" id="L441">    m_js.setRowHeaderView( m_plotsPanel.getRowHeader() );</span>
<span class="nc" id="L442">    final JLabel lb = new JLabel(Messages.getInstance().getString(&quot;MatrixPanel_ActionPerformed_Lb_JLabel_Text&quot;));</span>
<span class="nc" id="L443">    lb.setFont(f); lb.setForeground(fontColor);</span>
<span class="nc" id="L444">    lb.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);</span>
<span class="nc" id="L445">    m_js.setCorner(JScrollPane.UPPER_LEFT_CORNER, lb);</span>
<span class="nc" id="L446">    m_cp.setInstances(m_data);</span>
<span class="nc" id="L447">    m_cp.setBorder(BorderFactory.createEmptyBorder(15,10,10,10));</span>
<span class="nc" id="L448">    m_cp.addRepaintNotify(m_plotsPanel);</span>
    //m_updateBt.doClick(); //not until setting up the instances
<span class="nc" id="L450">  }</span>



  /** Initializes internal data fields, i.e. data values, type, missing and color cache arrays
   */
  public void initInternalFields() {
<span class="nc" id="L457">    Instances inst = m_data;</span>
<span class="nc" id="L458">    m_classIndex = m_classAttrib.getSelectedIndex();</span>
<span class="nc" id="L459">    m_selectedAttribs = m_attribList.getSelectedIndices();</span>
<span class="nc" id="L460">    double minC=0, maxC=0;</span>

    /** Resampling  **/
<span class="nc bnc" id="L463" title="All 2 branches missed.">    if(Double.parseDouble(m_resamplePercent.getText())&lt;100) {</span>
<span class="nc" id="L464">        inst = new Instances(m_data, 0, m_data.numInstances());</span>
<span class="nc" id="L465">        inst.randomize( new Random(Integer.parseInt(m_rseed.getText())) );</span>

        //System.err.println(&quot;gettingPercent: &quot; +
        //                   Math.round(
        //                     Double.parseDouble(m_resamplePercent.getText())
        //                     / 100D * m_data.numInstances()
        //                             )
        //                  );

<span class="nc" id="L474">        inst = new Instances(inst,</span>
<span class="nc" id="L475">                 0,</span>
<span class="nc" id="L476">                 (int)Math.round(Double.parseDouble(m_resamplePercent.getText())</span>
<span class="nc" id="L477">                 / 100D*inst.numInstances())</span>
                            );
    }

<span class="nc" id="L481">    m_points = new int[inst.numInstances()][m_selectedAttribs.length]; //changed</span>
<span class="nc" id="L482">    m_pointColors = new int[inst.numInstances()];</span>
<span class="nc" id="L483">    m_missing = new boolean[inst.numInstances()][m_selectedAttribs.length+1]; //changed</span>
<span class="nc" id="L484">    m_type = new int[2]; //[m_selectedAttribs.length]; //changed</span>
<span class="nc" id="L485">    jitterVals = new int[inst.numInstances()][2];</span>

    /** Setting up the color list for non-numeric attribute as well as jittervals**/
<span class="nc bnc" id="L488" title="All 2 branches missed.">    if(!(inst.attribute(m_classIndex).isNumeric())) {</span>

<span class="nc bnc" id="L490" title="All 2 branches missed.">      for(int i=m_colorList.size(); i&lt;inst.attribute(m_classIndex).numValues()+1; i++) {</span>
<span class="nc" id="L491">	Color pc = m_defaultColors[i % 10];</span>
<span class="nc" id="L492">	int ija =  i / 10;</span>
<span class="nc" id="L493">	ija *= 2;</span>
<span class="nc bnc" id="L494" title="All 2 branches missed.">	for (int j=0;j&lt;ija;j++) {</span>
<span class="nc" id="L495">	    pc = pc.darker();</span>
	}
<span class="nc" id="L497">	m_colorList.addElement(pc);</span>
      }

<span class="nc bnc" id="L500" title="All 2 branches missed.">      for(int i=0; i&lt;inst.numInstances(); i++) {</span>
	//set to black for missing class value which is last colour is default list
<span class="nc bnc" id="L502" title="All 2 branches missed.">	if(inst.instance(i).isMissing(m_classIndex))</span>
<span class="nc" id="L503">	  m_pointColors[i] =  m_defaultColors.length-1;</span>
	else
<span class="nc" id="L505">	  m_pointColors[i] = (int) inst.instance(i).value(m_classIndex);</span>

<span class="nc" id="L507">	jitterVals[i][0] = rnd.nextInt(m_jitter.getValue()+1)</span>
<span class="nc" id="L508">	  - m_jitter.getValue()/2;</span>
<span class="nc" id="L509">	jitterVals[i][1] = rnd.nextInt(m_jitter.getValue()+1)</span>
<span class="nc" id="L510">	  - m_jitter.getValue()/2;</span>

      }
    }
    /** Setting up color variations for numeric attribute as well as jittervals **/
    else {
<span class="nc bnc" id="L516" title="All 2 branches missed.">      for(int i=0; i&lt;inst.numInstances(); i++) {</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">	if(!(inst.instance(i).isMissing(m_classIndex))) {</span>
<span class="nc" id="L518">	  minC = maxC = inst.instance(i).value(m_classIndex);</span>
<span class="nc" id="L519">	  break;</span>
	}
      }

<span class="nc bnc" id="L523" title="All 2 branches missed.">      for(int i=1; i&lt;inst.numInstances(); i++) {</span>
<span class="nc bnc" id="L524" title="All 2 branches missed.">	if(!(inst.instance(i).isMissing(m_classIndex))) {</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">	  if(minC &gt; inst.instance(i).value(m_classIndex))</span>
<span class="nc" id="L526">	    minC = inst.instance(i).value(m_classIndex);</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">	  if(maxC &lt; inst.instance(i).value(m_classIndex))</span>
<span class="nc" id="L528">	    maxC = inst.instance(i).value(m_classIndex);</span>
	}
      }

<span class="nc bnc" id="L532" title="All 2 branches missed.">      for(int i=0; i&lt;inst.numInstances(); i++) {</span>
<span class="nc" id="L533">	double r = (inst.instance(i).value(m_classIndex) - minC) / (maxC - minC);</span>
<span class="nc" id="L534">	r = (r * 240) + 15;</span>
<span class="nc" id="L535">	m_pointColors[i] = (int)r;</span>

<span class="nc" id="L537">	jitterVals[i][0] = rnd.nextInt(m_jitter.getValue()+1)</span>
<span class="nc" id="L538">	  - m_jitter.getValue()/2;</span>
<span class="nc" id="L539">	jitterVals[i][1] = rnd.nextInt(m_jitter.getValue()+1)</span>
<span class="nc" id="L540">	  - m_jitter.getValue()/2;</span>
      }
    }

    /** Creating local cache of the data values **/
<span class="nc" id="L545">    double min[]=new double[m_selectedAttribs.length], max=0;  //changed</span>
<span class="nc" id="L546">    double ratio[] = new double[m_selectedAttribs.length];     //changed</span>
<span class="nc" id="L547">    double cellSize = m_plotSize.getValue(), temp1=0, temp2=0;</span>

<span class="nc bnc" id="L549" title="All 2 branches missed.">    for(int j=0; j&lt;m_selectedAttribs.length; j++) {</span>
      int i;
<span class="nc bnc" id="L551" title="All 2 branches missed.">      for(i=0; i&lt;inst.numInstances(); i++) {</span>
<span class="nc" id="L552">	min[j] = max = 0;</span>
<span class="nc bnc" id="L553" title="All 2 branches missed.">	if(!(inst.instance(i).isMissing(m_selectedAttribs[j]))) {</span>
<span class="nc" id="L554">	  min[j] = max = inst.instance(i).value(m_selectedAttribs[j]);</span>
<span class="nc" id="L555">	  break;</span>
	}
      }
<span class="nc bnc" id="L558" title="All 2 branches missed.">      for( i=i; i&lt;inst.numInstances(); i++ ) {</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">	if(!(inst.instance(i).isMissing(m_selectedAttribs[j]))) {</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">	  if(inst.instance(i).value(m_selectedAttribs[j]) &lt; min[j])</span>
<span class="nc" id="L561">	    min[j] = inst.instance(i).value(m_selectedAttribs[j]);</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">	  if(inst.instance(i).value(m_selectedAttribs[j]) &gt; max)</span>
<span class="nc" id="L563">	    max = inst.instance(i).value(m_selectedAttribs[j]);</span>
	}
      }
<span class="nc" id="L566">      ratio[j] =  cellSize / (max - min[j]);</span>
    }

<span class="nc" id="L569">    boolean classIndexProcessed=false;</span>
<span class="nc bnc" id="L570" title="All 2 branches missed.">    for(int j=0; j&lt;m_selectedAttribs.length; j++) {</span>
<span class="nc bnc" id="L571" title="All 4 branches missed.">      if(inst.attribute(m_selectedAttribs[j]).isNominal() || inst.attribute(m_selectedAttribs[j]).isString()) {</span>
	  //m_type[0][j] = 1;  m_type[1][j] = inst.attribute(m_selectedAttribs[j]).numValues();

<span class="nc" id="L574">	temp1 = cellSize/(double)inst.attribute(m_selectedAttribs[j]).numValues(); //m_type[1][j];</span>
<span class="nc" id="L575">	temp2 = temp1/2;</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">	for(int i=0; i&lt;inst.numInstances(); i++) {</span>
<span class="nc" id="L577">	  m_points[i][j] = (int) Math.round(temp2+temp1*inst.instance(i).value(m_selectedAttribs[j]));</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">	  if(inst.instance(i).isMissing(m_selectedAttribs[j])) {</span>
<span class="nc" id="L579">	    m_missing[i][j] = true;    //represents missing value</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">	    if(m_selectedAttribs[j]==m_classIndex) {</span>
<span class="nc" id="L581">		m_missing[i][m_missing[0].length-1] = true;</span>
<span class="nc" id="L582">		classIndexProcessed = true;</span>
	    }
	  }
	}
      }
      else {
	  //m_type[0][j] = m_type[1][j] = 0;
<span class="nc bnc" id="L589" title="All 2 branches missed.">	for(int i=0; i&lt;inst.numInstances(); i++) {</span>
<span class="nc" id="L590">	  m_points[i][j] = (int) Math.round((inst.instance(i).value(m_selectedAttribs[j])</span>
<span class="nc" id="L591">					     -min[j])*ratio[j]);</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">	  if(inst.instance(i).isMissing(m_selectedAttribs[j])) {</span>
<span class="nc" id="L593">	    m_missing[i][j] = true;    //represents missing value</span>
<span class="nc bnc" id="L594" title="All 2 branches missed.">	    if(m_selectedAttribs[j]==m_classIndex) {</span>
<span class="nc" id="L595">		m_missing[i][m_missing[0].length-1] = true;</span>
<span class="nc" id="L596">		classIndexProcessed = true;</span>
	    }
	  }
	}
      }
    }

<span class="nc bnc" id="L603" title="All 4 branches missed.">    if(inst.attribute(m_classIndex).isNominal() || inst.attribute(m_classIndex).isString()) {</span>
<span class="nc" id="L604">	m_type[0] = 1; m_type[1] = inst.attribute(m_classIndex).numValues();</span>
    }
    else
<span class="nc" id="L607">	m_type[0] = m_type[1] = 0;</span>

<span class="nc bnc" id="L609" title="All 2 branches missed.">    if(classIndexProcessed==false) {  //class Index has not been processed as class index is not among the selected attribs</span>
<span class="nc bnc" id="L610" title="All 2 branches missed.">	for(int i=0; i&lt;inst.numInstances(); i++) {</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">	    if(inst.instance(i).isMissing(m_classIndex))</span>
<span class="nc" id="L612">		m_missing[i][m_missing[0].length-1] = true;</span>
	}
    }

<span class="nc" id="L616">    m_cp.setColours(m_colorList);</span>
<span class="nc" id="L617">  }</span>

  /** Sets up the UI's attributes lists
   */
  public void setupAttribLists() {
<span class="nc" id="L622">    String [] tempAttribNames = new String[m_data.numAttributes()];</span>
    String type;

<span class="nc" id="L625">    m_classAttrib.removeAllItems();</span>
<span class="nc bnc" id="L626" title="All 2 branches missed.">    for(int i=0; i&lt;tempAttribNames.length; i++) {</span>
<span class="nc bnc" id="L627" title="All 6 branches missed.">      switch (m_data.attribute(i).type()) {</span>
      case Attribute.NOMINAL:
<span class="nc" id="L629">	type = Messages.getInstance().getString(&quot;MatrixPanel_SetupAttribLists_Type_AttributeNOMINAL_Text&quot;);</span>
<span class="nc" id="L630">	break;</span>
      case Attribute.NUMERIC:
<span class="nc" id="L632">	type = Messages.getInstance().getString(&quot;MatrixPanel_SetupAttribLists_Type_AttributeNUMERIC_Text&quot;);</span>
<span class="nc" id="L633">	break;</span>
      case Attribute.STRING:
<span class="nc" id="L635">	type = Messages.getInstance().getString(&quot;MatrixPanel_SetupAttribLists_Type_AttributeSTRING_Text&quot;);</span>
<span class="nc" id="L636">	break;</span>
      case Attribute.DATE:
<span class="nc" id="L638">	type = Messages.getInstance().getString(&quot;MatrixPanel_SetupAttribLists_Type_AttributeDATE_Text&quot;);</span>
<span class="nc" id="L639">	break;</span>
      case Attribute.RELATIONAL:
<span class="nc" id="L641">	type = Messages.getInstance().getString(&quot;MatrixPanel_SetupAttribLists_Type_AttributeRELATIONAL_Text&quot;);</span>
<span class="nc" id="L642">	break;</span>
      default:
<span class="nc" id="L644">	type = Messages.getInstance().getString(&quot;MatrixPanel_SetupAttribLists_Type_AttributeDEFAULT_Text&quot;);</span>
      }
<span class="nc" id="L646">      tempAttribNames[i] = new String(Messages.getInstance().getString(&quot;MatrixPanel_SetupAttribLists_Text_First&quot;) + m_data.attribute(i).name()+&quot; &quot;+type);</span>
<span class="nc" id="L647">      m_classAttrib.addItem(tempAttribNames[i]);</span>
    }
<span class="nc bnc" id="L649" title="All 2 branches missed.">    if (m_data.classIndex() == -1)</span>
<span class="nc" id="L650">      m_classAttrib.setSelectedIndex(tempAttribNames.length - 1);</span>
    else
<span class="nc" id="L652">      m_classAttrib.setSelectedIndex(m_data.classIndex());</span>
<span class="nc" id="L653">    m_attribList.setListData(tempAttribNames);</span>
<span class="nc" id="L654">    m_attribList.setSelectionInterval(0, tempAttribNames.length-1);</span>
<span class="nc" id="L655">  }</span>

  /** Calculates the percentage to resample
   */
  public void setPercent() {
<span class="nc bnc" id="L660" title="All 2 branches missed.">    if(m_data.numInstances() &gt; 700) {</span>
<span class="nc" id="L661">      double percnt = 500D/m_data.numInstances()*100;</span>
<span class="nc" id="L662">      percnt *= 100;</span>
<span class="nc" id="L663">      percnt = Math.round(percnt);</span>
<span class="nc" id="L664">      percnt /= 100;</span>

<span class="nc" id="L666">      m_resamplePercent.setText(&quot;&quot;+percnt);</span>
    }
    else
<span class="nc" id="L669">      m_resamplePercent.setText(Messages.getInstance().getString(&quot;MatrixPanel_SetPercent_Text_First&quot;));</span>
<span class="nc" id="L670">  }</span>


  /** This method changes the Instances object of this class to a new one. It also does all the necessary
      initializations for displaying the panel. This must be called before trying to display the panel.
      @param newInst The new set of Instances
  */
  public void setInstances(Instances newInst) {

<span class="nc" id="L679">    m_data = newInst;</span>
<span class="nc" id="L680">    setPercent();</span>
<span class="nc" id="L681">    setupAttribLists();</span>
<span class="nc" id="L682">    m_rseed.setText(&quot;1&quot;);</span>
<span class="nc" id="L683">    initInternalFields();</span>
<span class="nc" id="L684">    m_cp.setInstances(m_data);</span>
<span class="nc" id="L685">    m_cp.setCindex(m_classIndex);</span>
<span class="nc" id="L686">    m_updateBt.doClick();</span>
<span class="nc" id="L687">  }</span>


  /**
     Main method for testing this class
  */
  public static void main(String [] args)  {
<span class="nc" id="L694">    final JFrame jf = new JFrame(Messages.getInstance().getString(&quot;MatrixPanel_Main_JFRame_Text&quot;));</span>
<span class="nc" id="L695">    final JButton setBt = new JButton(Messages.getInstance().getString(&quot;MatrixPanel_Main_SetBt_JButton_Text&quot;));</span>
<span class="nc" id="L696">    Instances data = null;</span>
    try {
<span class="nc bnc" id="L698" title="All 2 branches missed.">      if(args.length==1)</span>
<span class="nc" id="L699">	data = new Instances( new BufferedReader( new FileReader(args[0])) );</span>
      else {
<span class="nc" id="L701">	System.out.println(Messages.getInstance().getString(&quot;MatrixPanel_Main_Text&quot;));</span>
<span class="nc" id="L702">	System.exit(-1);</span>
      }
<span class="nc" id="L704">    } catch(IOException ex) { ex.printStackTrace(); System.exit(-1); }</span>

<span class="nc" id="L706">    final MatrixPanel mp = new MatrixPanel();</span>
<span class="nc" id="L707">    mp.setInstances(data);</span>
<span class="nc" id="L708">    setBt.addActionListener( new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {
<span class="nc" id="L710">	  JFileChooser chooser = new JFileChooser(new java.io.File(System.getProperty(&quot;user.dir&quot;)));</span>
<span class="nc" id="L711">	  ExtensionFileFilter myfilter = new ExtensionFileFilter(Messages.getInstance().getString(&quot;MatrixPanel_Main_ActionPerformed_ExtensionFileFilter_Text_First&quot;), Messages.getInstance().getString(&quot;MatrixPanel_Main_ActionPerformed_ExtensionFileFilter_Text_Second&quot;));</span>
<span class="nc" id="L712">	  chooser.setFileFilter(myfilter);</span>
<span class="nc" id="L713">	  int returnVal = chooser.showOpenDialog(jf);</span>

<span class="nc bnc" id="L715" title="All 2 branches missed.">	  if(returnVal == JFileChooser.APPROVE_OPTION)</span>
	    {
	      try{
<span class="nc" id="L718">		System.out.println(Messages.getInstance().getString(&quot;MatrixPanel_Main_ActionPerformed_Text_First&quot;) + chooser.getSelectedFile().getName());</span>
<span class="nc" id="L719">		Instances in = new Instances ( new FileReader(chooser.getSelectedFile().getAbsolutePath()) );</span>
<span class="nc" id="L720">		mp.setInstances(in);</span>
	      }
<span class="nc" id="L722">	      catch(Exception ex) { ex.printStackTrace(); }</span>
	    }
<span class="nc" id="L724">	}</span>
      });
    //System.out.println(&quot;Loaded: &quot;+args[0]+&quot;\nRelation: &quot;+data.relationName()+&quot;\nAttributes: &quot;+data.numAttributes());
    //System.out.println(&quot;The attributes are: &quot;);
    //for(int i=0; i&lt;data.numAttributes(); i++)
    //  System.out.println(data.attribute(i).name());

    //RepaintManager.currentManager(jf.getRootPane()).setDoubleBufferingEnabled(false);
<span class="nc" id="L732">    jf.getContentPane().setLayout( new BorderLayout() );</span>
<span class="nc" id="L733">    jf.getContentPane().add(mp, BorderLayout.CENTER);</span>
<span class="nc" id="L734">    jf.getContentPane().add(setBt, BorderLayout.SOUTH);</span>
<span class="nc" id="L735">    jf.getContentPane().setFont( new java.awt.Font( &quot;SansSerif&quot;, java.awt.Font.PLAIN, 11) );</span>
<span class="nc" id="L736">    jf.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="nc" id="L737">    jf.setSize(800, 600);</span>
<span class="nc" id="L738">    jf.setVisible(true);</span>
<span class="nc" id="L739">    jf.repaint();</span>
<span class="nc" id="L740">  }</span>


  /**
     Internal class responsible for displaying the actual matrix
     Requires the internal data fields of the parent class to be properly initialized
     before being created
  */
  private class Plot
    extends JPanel
    implements MouseMotionListener, MouseListener {

    /** for serialization */
    private static final long serialVersionUID = -1721245738439420882L;

<span class="nc" id="L755">    int extpad=3, intpad=4, cellSize=100, cellRange=100, lastx=0, lasty=0, jitter=0;</span>
    java.awt.Rectangle r;
    java.awt.FontMetrics fm;
    int lastxpos, lastypos;
    JPanel jPlColHeader, jPlRowHeader;


    /** Constructor
     */
    public Plot() {
<span class="nc" id="L765">      super();</span>
<span class="nc" id="L766">      this.setToolTipText(Messages.getInstance().getString(&quot;MatrixPanel_Plot_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L767">      this.addMouseMotionListener( this );</span>
<span class="nc" id="L768">      this.addMouseListener( this );</span>
<span class="nc" id="L769">      initialize();</span>
<span class="nc" id="L770">    }</span>

    /** Initializes the internal fields */
    public void initialize() {
<span class="nc" id="L774">      lastxpos = lastypos = 0;</span>
<span class="nc" id="L775">      cellRange = cellSize; cellSize = cellRange + 2*intpad;</span>

<span class="nc" id="L777">      jPlColHeader = new JPanel() {</span>
	private static final long serialVersionUID = -9098547751937467506L;
        java.awt.Rectangle r;
        public void paint(Graphics g) {
<span class="nc" id="L781">          r = g.getClipBounds();</span>
<span class="nc" id="L782">          g.setColor(this.getBackground());</span>
<span class="nc" id="L783">          g.fillRect(r.x, r.y, r.width, r.height);</span>
<span class="nc" id="L784">          g.setFont( f );</span>
<span class="nc" id="L785">          fm = g.getFontMetrics();</span>
<span class="nc" id="L786">          int xpos = 0, ypos = 0, attribWidth=0;</span>

<span class="nc" id="L788">          g.setColor(fontColor);</span>
<span class="nc" id="L789">          xpos = extpad;</span>
<span class="nc" id="L790">          ypos=extpad+fm.getHeight();</span>

<span class="nc bnc" id="L792" title="All 2 branches missed.">          for(int i=0; i&lt;m_selectedAttribs.length; i++) {</span>
<span class="nc bnc" id="L793" title="All 2 branches missed.">            if( xpos+cellSize &lt; r.x)</span>
<span class="nc" id="L794">            { xpos += cellSize+extpad; continue; }</span>
<span class="nc bnc" id="L795" title="All 2 branches missed.">            else if(xpos &gt; r.x+r.width)</span>
<span class="nc" id="L796">            { break; }</span>
            else {
<span class="nc" id="L798">              attribWidth = fm.stringWidth(m_data.attribute(m_selectedAttribs[i]).name());</span>
<span class="nc" id="L799">              g.drawString(m_data.attribute(m_selectedAttribs[i]).name(),</span>
<span class="nc bnc" id="L800" title="All 2 branches missed.">              (attribWidth&lt;cellSize) ? (xpos + (cellSize/2 - attribWidth/2)):xpos,</span>
<span class="nc" id="L801">              ypos);</span>
            }
<span class="nc" id="L803">            xpos += cellSize+extpad;</span>
          }
<span class="nc" id="L805">          fm = null; r=null;</span>
<span class="nc" id="L806">        }</span>

        public Dimension getPreferredSize() {
<span class="nc" id="L809">          fm = this.getFontMetrics(this.getFont());</span>
<span class="nc" id="L810">          return new Dimension( m_selectedAttribs.length*(cellSize+extpad),</span>
<span class="nc" id="L811">          2*extpad + fm.getHeight() );</span>
        }
      };

<span class="nc" id="L815">      jPlRowHeader = new JPanel() {</span>
	private static final long serialVersionUID = 8474957069309552844L;

        java.awt.Rectangle r;
        public void paint(Graphics g) {
<span class="nc" id="L820">          r = g.getClipBounds();</span>
<span class="nc" id="L821">          g.setColor(this.getBackground());</span>
<span class="nc" id="L822">          g.fillRect(r.x, r.y, r.width, r.height);</span>
<span class="nc" id="L823">          g.setFont( f );</span>
<span class="nc" id="L824">          fm = g.getFontMetrics();</span>
<span class="nc" id="L825">          int xpos = 0, ypos = 0;</span>

<span class="nc" id="L827">          g.setColor(fontColor);</span>
<span class="nc" id="L828">          xpos = extpad;</span>
<span class="nc" id="L829">          ypos=extpad;</span>

<span class="nc bnc" id="L831" title="All 2 branches missed.">          for(int j=m_selectedAttribs.length-1; j&gt;=0; j--) {</span>
<span class="nc bnc" id="L832" title="All 2 branches missed.">            if( ypos+cellSize &lt; r.y )</span>
<span class="nc" id="L833">            { ypos += cellSize+extpad;  continue; }</span>
<span class="nc bnc" id="L834" title="All 2 branches missed.">            else if( ypos &gt; r.y+r.height )</span>
<span class="nc" id="L835">              break;</span>
            else {
<span class="nc" id="L837">              g.drawString(m_data.attribute(m_selectedAttribs[j]).name(), xpos+extpad, ypos+cellSize/2);</span>
            }
<span class="nc" id="L839">            xpos = extpad;</span>
<span class="nc" id="L840">            ypos += cellSize+extpad;</span>
          }
<span class="nc" id="L842">          r=null;</span>
<span class="nc" id="L843">        }</span>

        public Dimension getPreferredSize() {
<span class="nc" id="L846">          return new Dimension( 100+extpad,</span>
<span class="nc" id="L847">          m_selectedAttribs.length*(cellSize+extpad)</span>
          );
        }
      };
<span class="nc" id="L851">      jPlColHeader.setFont(f);</span>
<span class="nc" id="L852">      jPlRowHeader.setFont(f);</span>
<span class="nc" id="L853">      this.setFont(f);</span>
<span class="nc" id="L854">    }</span>

    public JPanel getRowHeader() {
<span class="nc" id="L857">	  return jPlRowHeader;</span>
    }

    public JPanel getColHeader() {
<span class="nc" id="L861">	return jPlColHeader;</span>
    }

    public void mouseMoved(MouseEvent e) {
<span class="nc" id="L865">      Graphics g = this.getGraphics();</span>
<span class="nc" id="L866">      int xpos=extpad, ypos=extpad;</span>

<span class="nc bnc" id="L868" title="All 2 branches missed.">      for(int j=m_selectedAttribs.length-1; j&gt;=0; j--) {</span>
<span class="nc bnc" id="L869" title="All 2 branches missed.">	for(int i=0; i&lt;m_selectedAttribs.length; i++) {</span>
<span class="nc bnc" id="L870" title="All 4 branches missed.">	  if(e.getX()&gt;=xpos &amp;&amp; e.getX()&lt;=xpos+cellSize+extpad)</span>
<span class="nc bnc" id="L871" title="All 4 branches missed.">	    if(e.getY()&gt;=ypos &amp;&amp; e.getY()&lt;=ypos+cellSize+extpad) {</span>
<span class="nc bnc" id="L872" title="All 4 branches missed.">	      if(xpos!=lastxpos || ypos!=lastypos) {</span>
<span class="nc" id="L873">		g.setColor( Color.red );</span>
<span class="nc" id="L874">		g.drawRect(xpos-1, ypos-1, cellSize+1, cellSize+1);</span>
<span class="nc bnc" id="L875" title="All 4 branches missed.">		if(lastxpos!=0 &amp;&amp; lastypos!=0) {</span>
<span class="nc" id="L876">		  g.setColor( this.getBackground().darker() );</span>
<span class="nc" id="L877">		  g.drawRect(lastxpos-1, lastypos-1, cellSize+1, cellSize+1); }</span>
<span class="nc" id="L878">		lastxpos = xpos; lastypos = ypos;</span>
	      }
<span class="nc" id="L880">	      return;</span>
	    }
<span class="nc" id="L882">	  xpos+=cellSize+extpad;</span>
	}
<span class="nc" id="L884">	xpos=extpad;</span>
<span class="nc" id="L885">	ypos+=cellSize+extpad;</span>
      }
<span class="nc bnc" id="L887" title="All 4 branches missed.">      if(lastxpos!=0 &amp;&amp; lastypos!=0) {</span>
<span class="nc" id="L888">	g.setColor( this.getBackground().darker() );</span>
<span class="nc" id="L889">	g.drawRect(lastxpos-1, lastypos-1, cellSize+1, cellSize+1); }</span>
<span class="nc" id="L890">      lastxpos=lastypos=0;</span>
<span class="nc" id="L891">    }</span>

<span class="nc" id="L893">    public void mouseDragged(MouseEvent e){ }</span>

    public void mouseClicked(MouseEvent e) {
<span class="nc" id="L896">      int i=0, j=0, found=0;</span>

<span class="nc" id="L898">      int xpos=extpad, ypos=extpad;</span>
<span class="nc bnc" id="L899" title="All 2 branches missed.">      for(j=m_selectedAttribs.length-1; j&gt;=0; j--) {</span>
<span class="nc bnc" id="L900" title="All 2 branches missed.">	for(i=0; i&lt;m_selectedAttribs.length; i++) {</span>
<span class="nc bnc" id="L901" title="All 4 branches missed.">	  if(e.getX()&gt;=xpos &amp;&amp; e.getX()&lt;=xpos+cellSize+extpad)</span>
<span class="nc bnc" id="L902" title="All 4 branches missed.">	    if(e.getY()&gt;=ypos &amp;&amp; e.getY()&lt;=ypos+cellSize+extpad) {</span>
<span class="nc" id="L903">	      found=1; break;</span>
	    }
<span class="nc" id="L905">	  xpos+=cellSize+extpad;</span>
	}
<span class="nc bnc" id="L907" title="All 2 branches missed.">	if(found==1)</span>
<span class="nc" id="L908">	  break;</span>
<span class="nc" id="L909">	xpos=extpad;</span>
<span class="nc" id="L910">	ypos+=cellSize+extpad;</span>
      }
<span class="nc bnc" id="L912" title="All 2 branches missed.">      if(found==0)</span>
<span class="nc" id="L913">	return;</span>

<span class="nc" id="L915">      JFrame jf = new JFrame(Messages.getInstance().getString(&quot;MatrixPanel_Plot_JFrame_Text&quot;) + m_data.relationName() );</span>
<span class="nc" id="L916">      VisualizePanel vp = new VisualizePanel();</span>
      try {
<span class="nc" id="L918">	PlotData2D pd = new PlotData2D(m_data);</span>
<span class="nc" id="L919">	pd.setPlotName(Messages.getInstance().getString(&quot;MatrixPanel_Plot_Pd_SetPlotName_Text&quot;));</span>
<span class="nc" id="L920">	vp.setMasterPlot(pd);</span>
	//System.out.println(&quot;x: &quot;+i+&quot; y: &quot;+j);
<span class="nc" id="L922">	vp.setXIndex(m_selectedAttribs[i]);</span>
<span class="nc" id="L923">	vp.setYIndex(m_selectedAttribs[j]);</span>
<span class="nc" id="L924">	vp.m_ColourCombo.setSelectedIndex( m_classIndex );</span>
      }
<span class="nc" id="L926">      catch(Exception ex) { ex.printStackTrace(); }</span>
<span class="nc" id="L927">      jf.getContentPane().add(vp);</span>
<span class="nc" id="L928">      jf.setSize(800,600);</span>
<span class="nc" id="L929">      jf.setVisible(true);</span>
<span class="nc" id="L930">    }</span>

<span class="nc" id="L932">    public void mouseEntered(MouseEvent e){ }</span>
<span class="nc" id="L933">    public void mouseExited(MouseEvent e){ }</span>
<span class="nc" id="L934">    public void mousePressed(MouseEvent e){ }</span>
<span class="nc" id="L935">    public void mouseReleased(MouseEvent e){ }</span>

    /** sets the new jitter value for the plots
     */
    public void setJitter(int newjitter) {
<span class="nc" id="L940">      jitter = newjitter;</span>
<span class="nc" id="L941">    }</span>

    /** sets the new size for the plots
     */
    public void setCellSize(int newCellSize) {
<span class="nc" id="L946">      cellSize = newCellSize;</span>
<span class="nc" id="L947">      initialize();</span>
<span class="nc" id="L948">    }</span>

    /** Returns the X and Y attributes of the plot the mouse is currently
	on
    */
    public String getToolTipText(MouseEvent event) {
<span class="nc" id="L954">      int xpos=extpad, ypos=extpad;</span>

<span class="nc bnc" id="L956" title="All 2 branches missed.">      for(int j=m_selectedAttribs.length-1; j&gt;=0; j--) {</span>
<span class="nc bnc" id="L957" title="All 2 branches missed.">	for(int i=0; i&lt;m_selectedAttribs.length; i++) {</span>
<span class="nc bnc" id="L958" title="All 4 branches missed.">	  if(event.getX()&gt;=xpos &amp;&amp; event.getX()&lt;=xpos+cellSize+extpad)</span>
<span class="nc bnc" id="L959" title="All 4 branches missed.">	    if(event.getY()&gt;=ypos &amp;&amp; event.getY()&lt;=ypos+cellSize+extpad)</span>
<span class="nc" id="L960">	      return(Messages.getInstance().getString(&quot;MatrixPanel_Plot_GetToolTipText_Text_First&quot;) + m_data.attribute(m_selectedAttribs[i]).name()+</span>
<span class="nc" id="L961">		     Messages.getInstance().getString(&quot;MatrixPanel_Plot_GetToolTipText_Text_Second&quot;) + m_data.attribute(m_selectedAttribs[j]).name()+</span>
<span class="nc" id="L962">		     Messages.getInstance().getString(&quot;MatrixPanel_Plot_GetToolTipText_Text_Third&quot;));</span>
<span class="nc" id="L963">	  xpos+=cellSize+extpad;</span>
	}
<span class="nc" id="L965">	xpos=extpad;</span>
<span class="nc" id="L966">	ypos+=cellSize+extpad;</span>
      }
<span class="nc" id="L968">      return (Messages.getInstance().getString(&quot;MatrixPanel_Plot_GetToolTipText_Text_Fourth&quot;));</span>
    }

    /**  Paints a single Plot at xpos, ypos. and xattrib and yattrib on X and
	 Y axes
    */
    public void paintGraph(Graphics g, int xattrib, int yattrib, int xpos, int ypos) {
      int x, y;
<span class="nc" id="L976">      g.setColor( this.getBackground().darker().darker() );</span>
<span class="nc" id="L977">      g.drawRect(xpos-1, ypos-1, cellSize+1, cellSize+1);</span>
<span class="nc" id="L978">      g.setColor(Color.white);</span>
<span class="nc" id="L979">      g.fillRect(xpos, ypos, cellSize, cellSize);</span>
<span class="nc bnc" id="L980" title="All 2 branches missed.">      for(int i=0; i&lt;m_points.length; i++) {</span>

<span class="nc bnc" id="L982" title="All 4 branches missed.">        if( !(m_missing[i][yattrib] || m_missing[i][xattrib]) ) {</span>

<span class="nc bnc" id="L984" title="All 2 branches missed.">          if(m_type[0]==0)</span>
<span class="nc bnc" id="L985" title="All 2 branches missed.">            if(m_missing[i][m_missing[0].length-1])</span>
<span class="nc" id="L986">              g.setColor(m_defaultColors[m_defaultColors.length-1]);</span>
            else
<span class="nc" id="L988">              g.setColor( new Color(m_pointColors[i],150,(255-m_pointColors[i])) );</span>
          else
<span class="nc" id="L990">            g.setColor((Color)m_colorList.elementAt(m_pointColors[i]));</span>

<span class="nc bnc" id="L992" title="All 4 branches missed.">          if(m_points[i][xattrib]+jitterVals[i][0]&lt;0 || m_points[i][xattrib]+jitterVals[i][0]&gt;cellRange)</span>
<span class="nc bnc" id="L993" title="All 4 branches missed.">            if(cellRange-m_points[i][yattrib]+jitterVals[i][1]&lt;0 || cellRange-m_points[i][yattrib]+jitterVals[i][1]&gt;cellRange) {</span>
              //both x and y out of range don't add jitter
<span class="nc" id="L995">              x=intpad+m_points[i][xattrib];</span>
<span class="nc" id="L996">              y=intpad+(cellRange - m_points[i][yattrib]);</span>
            }
            else {
              //only x out of range
<span class="nc" id="L1000">              x=intpad+m_points[i][xattrib];</span>
<span class="nc" id="L1001">              y=intpad+(cellRange - m_points[i][yattrib])+jitterVals[i][1];</span>
            }
<span class="nc bnc" id="L1003" title="All 4 branches missed.">          else if(cellRange-m_points[i][yattrib]+jitterVals[i][1]&lt;0 || cellRange-m_points[i][yattrib]+jitterVals[i][1]&gt;cellRange) {</span>
            //only y out of range
<span class="nc" id="L1005">            x=intpad+m_points[i][xattrib]+jitterVals[i][0];</span>
<span class="nc" id="L1006">            y=intpad+(cellRange - m_points[i][yattrib]);</span>
          }
          else {
            //none out of range
<span class="nc" id="L1010">            x=intpad+m_points[i][xattrib]+jitterVals[i][0];</span>
<span class="nc" id="L1011">            y=intpad+(cellRange - m_points[i][yattrib])+jitterVals[i][1];</span>
          }
<span class="nc bnc" id="L1013" title="All 2 branches missed.">          if(datapointSize==1)</span>
<span class="nc" id="L1014">            g.drawLine(x+xpos, y+ypos, x+xpos, y+ypos);</span>
          else
<span class="nc" id="L1016">            g.drawOval(x+xpos-datapointSize/2, y+ypos-datapointSize/2, datapointSize, datapointSize);</span>
        }
      }
<span class="nc" id="L1019">      g.setColor( fontColor );</span>
<span class="nc" id="L1020">    }</span>


    /**
       Paints the matrix of plots in the current visible region
    */
    public void paintME(Graphics g) {
<span class="nc" id="L1027">      r = g.getClipBounds();</span>

<span class="nc" id="L1029">      g.setColor( this.getBackground() );</span>
<span class="nc" id="L1030">      g.fillRect(r.x, r.y, r.width, r.height);</span>
<span class="nc" id="L1031">      g.setColor( fontColor );</span>

<span class="nc" id="L1033">      int xpos = 0, ypos = 0;</span>

<span class="nc" id="L1035">      xpos = extpad;</span>
<span class="nc" id="L1036">      ypos=extpad;</span>


<span class="nc bnc" id="L1039" title="All 2 branches missed.">      for(int j=m_selectedAttribs.length-1; j&gt;=0; j--) {</span>
<span class="nc bnc" id="L1040" title="All 2 branches missed.">        if( ypos+cellSize &lt; r.y )</span>
<span class="nc" id="L1041">        { ypos += cellSize+extpad;  continue; }</span>
<span class="nc bnc" id="L1042" title="All 2 branches missed.">        else if( ypos &gt; r.y+r.height )</span>
<span class="nc" id="L1043">          break;</span>
        else {
<span class="nc bnc" id="L1045" title="All 2 branches missed.">          for(int i=0; i&lt;m_selectedAttribs.length; i++) {</span>
<span class="nc bnc" id="L1046" title="All 2 branches missed.">            if( xpos+cellSize &lt; r.x) {</span>
<span class="nc" id="L1047">              xpos += cellSize+extpad; continue; }</span>
<span class="nc bnc" id="L1048" title="All 2 branches missed.">            else if(xpos &gt; r.x+r.width)</span>
<span class="nc" id="L1049">              break;</span>
            else
<span class="nc" id="L1051">              paintGraph(g, i, j, xpos, ypos); //m_selectedAttribs[i], m_selectedAttribs[j], xpos, ypos);</span>
<span class="nc" id="L1052">            xpos += cellSize+extpad;</span>
          }
        }
<span class="nc" id="L1055">        xpos = extpad;</span>
<span class="nc" id="L1056">        ypos += cellSize+extpad;</span>
      }
<span class="nc" id="L1058">    }</span>

    /** paints this JPanel (PlotsPanel)
     */
    public void paintComponent(Graphics g) {
<span class="nc" id="L1063">      paintME(g);</span>
<span class="nc" id="L1064">    }</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>