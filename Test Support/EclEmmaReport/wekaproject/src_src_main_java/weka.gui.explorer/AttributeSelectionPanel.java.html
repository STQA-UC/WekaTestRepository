<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>AttributeSelectionPanel.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.gui.explorer</a> &gt; <span class="el_source">AttributeSelectionPanel.java</span></div><h1>AttributeSelectionPanel.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">/*</span>
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 *    AttributeSelectionPanel.java
 *    Copyright (C) 1999 University of Waikato, Hamilton, New Zealand
 *
 */

package weka.gui.explorer;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.GridLayout;
import java.awt.Insets;
import java.awt.Point;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.InputEvent;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Random;
import java.util.Vector;

import javax.swing.BorderFactory;
import javax.swing.ButtonGroup;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JFileChooser;
import javax.swing.JLabel;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JPopupMenu;
import javax.swing.JRadioButton;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.JViewport;
import javax.swing.SwingConstants;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;

import weka.attributeSelection.ASEvaluation;
import weka.attributeSelection.ASSearch;
import weka.attributeSelection.AttributeEvaluator;
import weka.attributeSelection.AttributeSelection;
import weka.attributeSelection.AttributeTransformer;
import weka.attributeSelection.Ranker;
import weka.core.Attribute;
import weka.core.Capabilities;
import weka.core.CapabilitiesHandler;
import weka.core.FastVector;
import weka.core.Instances;
import weka.core.OptionHandler;
import weka.core.Utils;
import weka.gui.ExtensionFileFilter;
import weka.gui.GenericObjectEditor;
import weka.gui.Logger;
import weka.gui.PropertyPanel;
import weka.gui.ResultHistoryPanel;
import weka.gui.SaveBuffer;
import weka.gui.SysErrLog;
import weka.gui.TaskLogger;
import weka.gui.explorer.Explorer.CapabilitiesFilterChangeEvent;
import weka.gui.explorer.Explorer.CapabilitiesFilterChangeListener;
import weka.gui.explorer.Explorer.ExplorerPanel;
import weka.gui.explorer.Explorer.LogHandler;
import weka.gui.visualize.MatrixPanel;

/** 
 * This panel allows the user to select and configure an attribute
 * evaluator and a search method, set the
 * attribute of the current dataset to be used as the class, and perform
 * attribute selection using one of two  selection modes (select using all the
 * training data or perform a n-fold cross validation---on each trial
 * selecting features using n-1 folds of the data).
 * The results of attribute selection runs are stored in a results history
 * so that previous results are accessible.
 *
 * @author Mark Hall (mhall@cs.waikato.ac.nz)
 * @version $Revision: 9495 $
 */
<span class="nc" id="L107">public class AttributeSelectionPanel </span>
  extends JPanel
  implements CapabilitiesFilterChangeListener, ExplorerPanel, LogHandler {
  
  /** for serialization */
  static final long serialVersionUID = 5627185966993476142L;

  /** the parent frame */
<span class="nc" id="L115">  protected Explorer m_Explorer = null;</span>

  /** Lets the user configure the attribute evaluator */
<span class="nc" id="L118">  protected GenericObjectEditor m_AttributeEvaluatorEditor =</span>
<span class="nc" id="L119">    new GenericObjectEditor();</span>

  /** Lets the user configure the search method */
<span class="nc" id="L122">  protected GenericObjectEditor m_AttributeSearchEditor = </span>
<span class="nc" id="L123">    new GenericObjectEditor();</span>

  /** The panel showing the current attribute evaluation method */
<span class="nc" id="L126">  protected PropertyPanel m_AEEPanel = </span>
<span class="nc" id="L127">    new PropertyPanel(m_AttributeEvaluatorEditor);</span>

  /** The panel showing the current search method */
<span class="nc" id="L130">  protected PropertyPanel m_ASEPanel = </span>
<span class="nc" id="L131">    new PropertyPanel(m_AttributeSearchEditor);</span>
  
  /** The output area for attribute selection results */
<span class="nc" id="L134">  protected JTextArea m_OutText = new JTextArea(20, 40);</span>

  /** The destination for log/status messages */
<span class="nc" id="L137">  protected Logger m_Log = new SysErrLog();</span>

  /** The buffer saving object for saving output */
<span class="nc" id="L140">  SaveBuffer m_SaveOut = new SaveBuffer(m_Log, this);</span>

  /** A panel controlling results viewing */
<span class="nc" id="L143">  protected ResultHistoryPanel m_History = new ResultHistoryPanel(m_OutText);</span>

  /** Lets the user select the class column */
<span class="nc" id="L146">  protected JComboBox m_ClassCombo = new JComboBox();</span>

  /** Click to set evaluation mode to cross-validation */
<span class="nc" id="L149">  protected JRadioButton m_CVBut = new JRadioButton(Messages.getInstance().getString(&quot;AttributeSelectionPanel_CVBut_JRadioButton_Text&quot;));</span>

  /** Click to set test mode to test on training data */
<span class="nc" id="L152">  protected JRadioButton m_TrainBut = new JRadioButton(Messages.getInstance().getString(&quot;AttributeSelectionPanel_TrainBut_JRadioButton_Text&quot;));</span>

  /** Label by where the cv folds are entered */
<span class="nc" id="L155">  protected JLabel m_CVLab = new JLabel(Messages.getInstance().getString(&quot;AttributeSelectionPanel_CVLab_JLabel_Text&quot;), SwingConstants.RIGHT);</span>

  /** The field where the cv folds are entered */
<span class="nc" id="L158">  protected JTextField m_CVText = new JTextField(Messages.getInstance().getString(&quot;AttributeSelectionPanel_CVText_JTextField_Text&quot;));</span>

  //protected JTextField m_CVText = new JTextField(10);
  
  /** Label by where cv random seed is entered */
<span class="nc" id="L163">  protected JLabel m_SeedLab = new JLabel(Messages.getInstance().getString(&quot;AttributeSelectionPanel_SeedLab_JLabel_Text&quot;),SwingConstants.RIGHT);</span>

  /** The field where the seed value is entered */
<span class="nc" id="L166">  protected JTextField m_SeedText = new JTextField(Messages.getInstance().getString(&quot;AttributeSelectionPanel_SeedText_JTextField_Text&quot;));</span>

  /** Click to set evaluation mode to cross-validation */
  //protected JRadioButton m_CVBut = new JRadioButton(&quot;Cross-validation&quot;);

  /** Click to set test mode to test on training data */
  //protected JRadioButton m_TrainBut = 
  //  new JRadioButton(&quot;Use full training set&quot;);

  /** Label by where the cv folds are entered */
  //protected JLabel m_CVLab = new JLabel(&quot;Folds&quot;, SwingConstants.RIGHT);

  /** The field where the cv folds are entered */
  //protected JTextField m_CVText = new JTextField(&quot;10&quot;);

  /** Label by where cv random seed is entered */
  //protected JLabel m_SeedLab = new JLabel(&quot;Seed&quot;,SwingConstants.RIGHT);

  /** The field where the seed value is entered */
  //protected JTextField m_SeedText = new JTextField(&quot;1&quot;);
  
  /**
   * Alters the enabled/disabled status of elements associated with each
   * radio button
   */
<span class="nc" id="L191">  ActionListener m_RadioListener = new ActionListener() {</span>
    public void actionPerformed(ActionEvent e) {
<span class="nc" id="L193">      updateRadioLinks();</span>
<span class="nc" id="L194">    }</span>
  };

  /** Click to start running the attribute selector */
<span class="nc" id="L198">  protected JButton m_StartBut = new JButton(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartBut_JButton_Text&quot;));</span>

  /** Click to stop a running classifier */
<span class="nc" id="L201">  protected JButton m_StopBut = new JButton(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StopBut_JButton_Text&quot;));</span>

 /** Stop the class combo from taking up to much space */
<span class="nc" id="L204">  private Dimension COMBO_SIZE = new Dimension(150, m_StartBut</span>
<span class="nc" id="L205">					       .getPreferredSize().height);</span>
  
  /** The main set of instances we're playing with */
  protected Instances m_Instances;

  /** A thread that attribute selection runs in */
  protected Thread m_RunThread;

  /* Register the property editors we need */
  static {
<span class="nc" id="L215">     GenericObjectEditor.registerEditors();</span>
  }
  
  /**
   * Creates the classifier panel
   */
<span class="nc" id="L221">  public AttributeSelectionPanel() {</span>
    // Connect / configure the components
<span class="nc" id="L223">    m_OutText.setEditable(false);</span>
<span class="nc" id="L224">    m_OutText.setFont(new Font(&quot;Monospaced&quot;, Font.PLAIN, 12));</span>
<span class="nc" id="L225">    m_OutText.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
<span class="nc" id="L226">    m_OutText.addMouseListener(new MouseAdapter() {</span>
      public void mouseClicked(MouseEvent e) {
<span class="nc bnc" id="L228" title="All 2 branches missed.">	if ((e.getModifiers() &amp; InputEvent.BUTTON1_MASK)</span>
<span class="nc" id="L229">	    != InputEvent.BUTTON1_MASK) {</span>
<span class="nc" id="L230">	  m_OutText.selectAll();</span>
	}
<span class="nc" id="L232">      }</span>
    });
<span class="nc" id="L234">    m_History.setBorder(BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;AttributeSelectionPanel_History_BorderFactoryCreateTitledBorder_Text&quot;)));</span>
<span class="nc" id="L235">    m_AttributeEvaluatorEditor.setClassType(ASEvaluation.class);</span>
<span class="nc" id="L236">    m_AttributeEvaluatorEditor.setValue(ExplorerDefaults.getASEvaluator());</span>
<span class="nc" id="L237">    m_AttributeEvaluatorEditor.</span>
<span class="nc" id="L238">      addPropertyChangeListener(new PropertyChangeListener() {</span>
      public void propertyChange(PropertyChangeEvent e) {
<span class="nc bnc" id="L240" title="All 2 branches missed.">        if (m_AttributeEvaluatorEditor.getValue() instanceof AttributeEvaluator) {</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">          if (!(m_AttributeSearchEditor.getValue() instanceof Ranker)) {</span>
<span class="nc" id="L242">            Object backup = m_AttributeEvaluatorEditor.getBackup();</span>
<span class="nc" id="L243">            int result = </span>
<span class="nc" id="L244">              JOptionPane.showConfirmDialog(null, Messages.getInstance().getString(&quot;AttributeSelectionPanel_Result_JOptionPaneShowConfirmDialog_Text_First&quot;)</span>
<span class="nc" id="L245">                                            +m_AttributeEvaluatorEditor.getValue().getClass().getName()</span>
<span class="nc" id="L246">                                            +Messages.getInstance().getString(&quot;AttributeSelectionPanel_Result_JOptionPaneShowConfirmDialog_Text_Second&quot;),</span>
<span class="nc" id="L247">                                            Messages.getInstance().getString(&quot;AttributeSelectionPanel_Result_JOptionPaneShowConfirmDialog_Text_Third&quot;), JOptionPane.YES_NO_OPTION);</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">            if (result == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L249">              m_AttributeSearchEditor.setValue(new Ranker());</span>
            } else {
              // restore to what was there previously (if possible)
<span class="nc bnc" id="L252" title="All 2 branches missed.">              if (backup != null) {</span>
<span class="nc" id="L253">                m_AttributeEvaluatorEditor.setValue(backup);</span>
              }             
            }
          }
        } else {
<span class="nc bnc" id="L258" title="All 2 branches missed.">          if (m_AttributeSearchEditor.getValue() instanceof Ranker) {</span>
<span class="nc" id="L259">            Object backup = m_AttributeEvaluatorEditor.getBackup();</span>
<span class="nc" id="L260">            int result = </span>
<span class="nc" id="L261">              JOptionPane.showConfirmDialog(null, Messages.getInstance().getString(&quot;AttributeSelectionPanel_Result_JOptionPaneShowConfirmDialog_Text_Fourth&quot;)</span>
<span class="nc" id="L262">                                            +m_AttributeEvaluatorEditor.getValue().getClass().getName()</span>
<span class="nc" id="L263">                                            +Messages.getInstance().getString(&quot;AttributeSelectionPanel_Result_JOptionPaneShowConfirmDialog_Text_Fifth&quot;),</span>
<span class="nc" id="L264">                                            Messages.getInstance().getString(&quot;AttributeSelectionPanel_Result_JOptionPaneShowConfirmDialog_Text_Sixth&quot;), JOptionPane.YES_NO_OPTION);</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">            if (result == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L266">              m_AttributeSearchEditor.setValue(new weka.attributeSelection.GreedyStepwise());</span>
            } else {
              // restore to what was there previously (if possible)
<span class="nc bnc" id="L269" title="All 2 branches missed.">              if (backup != null) {</span>
<span class="nc" id="L270">                m_AttributeEvaluatorEditor.setValue(backup);</span>
              } 
            }
          }
        }
<span class="nc" id="L275">	updateRadioLinks();</span>
	
<span class="nc" id="L277">	m_StartBut.setEnabled(true);</span>
	// check capabilities...
<span class="nc" id="L279">        Capabilities currentFilter = m_AttributeEvaluatorEditor.getCapabilitiesFilter();</span>
<span class="nc" id="L280">        ASEvaluation evaluator = (ASEvaluation) m_AttributeEvaluatorEditor.getValue();</span>
<span class="nc" id="L281">        Capabilities currentSchemeCapabilities =  null;</span>
<span class="nc bnc" id="L282" title="All 4 branches missed.">        if (evaluator != null &amp;&amp; currentFilter != null &amp;&amp; </span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">            (evaluator instanceof CapabilitiesHandler)) {</span>
<span class="nc" id="L284">          currentSchemeCapabilities = ((CapabilitiesHandler)evaluator).getCapabilities();</span>
          
<span class="nc bnc" id="L286" title="All 2 branches missed.">          if (!currentSchemeCapabilities.supportsMaybe(currentFilter) &amp;&amp;</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">              !currentSchemeCapabilities.supports(currentFilter)) {</span>
<span class="nc" id="L288">            m_StartBut.setEnabled(false);</span>
          }
        }
<span class="nc" id="L291">	repaint();</span>
<span class="nc" id="L292">      }</span>
    });

<span class="nc" id="L295">    m_AttributeSearchEditor.setClassType(ASSearch.class);</span>
<span class="nc" id="L296">    m_AttributeSearchEditor.setValue(ExplorerDefaults.getASSearch());</span>
<span class="nc" id="L297">    m_AttributeSearchEditor.</span>
<span class="nc" id="L298">      addPropertyChangeListener(new PropertyChangeListener() {</span>
	public void propertyChange(PropertyChangeEvent e) {
<span class="nc bnc" id="L300" title="All 2 branches missed.">          if (m_AttributeSearchEditor.getValue() instanceof Ranker) {</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">            if (!(m_AttributeEvaluatorEditor.getValue() instanceof AttributeEvaluator)) {</span>
<span class="nc" id="L302">              Object backup = m_AttributeSearchEditor.getBackup();</span>
<span class="nc" id="L303">              int result = </span>
<span class="nc" id="L304">                JOptionPane.showConfirmDialog(null, Messages.getInstance().getString(&quot;AttributeSelectionPanel_Result_JOptionPaneShowConfirmDialog_Text_Seventh&quot;),</span>
<span class="nc" id="L305">                                              Messages.getInstance().getString(&quot;AttributeSelectionPanel_Result_JOptionPaneShowConfirmDialog_Text_Eigth&quot;), JOptionPane.YES_NO_OPTION);</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">              if (result == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L307">                m_AttributeEvaluatorEditor.setValue(new weka.attributeSelection.InfoGainAttributeEval());</span>
              } else {
                // restore to what was there previously (if possible)
<span class="nc bnc" id="L310" title="All 2 branches missed.">                if (backup != null) {</span>
<span class="nc" id="L311">                  m_AttributeSearchEditor.setValue(backup);</span>
                }             
              }
            }
          } else {
<span class="nc bnc" id="L316" title="All 2 branches missed.">            if (m_AttributeEvaluatorEditor.getValue() instanceof AttributeEvaluator) {</span>
<span class="nc" id="L317">              Object backup = m_AttributeSearchEditor.getBackup();</span>
<span class="nc" id="L318">              int result = </span>
<span class="nc" id="L319">                JOptionPane.showConfirmDialog(null, Messages.getInstance().getString(&quot;AttributeSelectionPanel_Result_JOptionPaneShowConfirmDialog_Text_Nineth&quot;)</span>
<span class="nc" id="L320">                                              +m_AttributeEvaluatorEditor.getValue().getClass().getName()</span>
<span class="nc" id="L321">                                              +Messages.getInstance().getString(&quot;AttributeSelectionPanel_Result_JOptionPaneShowConfirmDialog_Text_Tenth&quot;),</span>
<span class="nc" id="L322">                                              Messages.getInstance().getString(&quot;AttributeSelectionPanel_Result_JOptionPaneShowConfirmDialog_Text_Eleventh&quot;), JOptionPane.YES_NO_OPTION);</span>

<span class="nc bnc" id="L324" title="All 2 branches missed.">              if (result == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L325">                m_AttributeEvaluatorEditor.setValue(new weka.attributeSelection.CfsSubsetEval());</span>
              } else {
                // restore to what was there previously (if possible)
<span class="nc bnc" id="L328" title="All 2 branches missed.">                if (backup != null) {</span>
<span class="nc" id="L329">                  m_AttributeSearchEditor.setValue(backup);</span>
                }              
              }
            }
          }
<span class="nc" id="L334">	  repaint();</span>
<span class="nc" id="L335">	}</span>
      });
    
<span class="nc" id="L338">    m_ClassCombo.addActionListener(new ActionListener() {</span>
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L340">	updateCapabilitiesFilter(m_AttributeEvaluatorEditor.getCapabilitiesFilter());</span>
<span class="nc" id="L341">      }</span>
    });

<span class="nc" id="L344">    m_ClassCombo.setToolTipText(Messages.getInstance().getString(&quot;AttributeSelectionPanel_ClassCombo_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L345">    m_TrainBut.setToolTipText(Messages.getInstance().getString(&quot;AttributeSelectionPanel_TrainBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L346">    m_CVBut.setToolTipText(Messages.getInstance().getString(&quot;AttributeSelectionPanel_CVBut_SetToolTipText_Text&quot;));</span>

<span class="nc" id="L348">    m_StartBut.setToolTipText(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L349">    m_StopBut.setToolTipText(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StopBut_SetToolTipText_Text&quot;));</span>
    
<span class="nc" id="L351">    m_ClassCombo.setPreferredSize(COMBO_SIZE);</span>
<span class="nc" id="L352">    m_ClassCombo.setMaximumSize(COMBO_SIZE);</span>
<span class="nc" id="L353">    m_ClassCombo.setMinimumSize(COMBO_SIZE);</span>
<span class="nc" id="L354">    m_History.setPreferredSize(COMBO_SIZE);</span>
<span class="nc" id="L355">    m_History.setMaximumSize(COMBO_SIZE);</span>
<span class="nc" id="L356">    m_History.setMinimumSize(COMBO_SIZE);</span>
    
<span class="nc" id="L358">    m_ClassCombo.setEnabled(false);</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">    m_TrainBut.setSelected(ExplorerDefaults.getASTestMode() == 0);</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">    m_CVBut.setSelected(ExplorerDefaults.getASTestMode() == 1);</span>
<span class="nc" id="L361">    updateRadioLinks();</span>
<span class="nc" id="L362">    ButtonGroup bg = new ButtonGroup();</span>
<span class="nc" id="L363">    bg.add(m_TrainBut);</span>
<span class="nc" id="L364">    bg.add(m_CVBut);</span>

<span class="nc" id="L366">    m_TrainBut.addActionListener(m_RadioListener);</span>
<span class="nc" id="L367">    m_CVBut.addActionListener(m_RadioListener);</span>

<span class="nc" id="L369">    m_CVText.setText(&quot;&quot; + ExplorerDefaults.getASCrossvalidationFolds());</span>
<span class="nc" id="L370">    m_SeedText.setText(&quot;&quot; + ExplorerDefaults.getASRandomSeed());</span>
    
<span class="nc" id="L372">    m_StartBut.setEnabled(false);</span>
<span class="nc" id="L373">    m_StopBut.setEnabled(false);</span>

<span class="nc" id="L375">    m_StartBut.addActionListener(new ActionListener() {</span>
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L377">        boolean proceed = true;</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">        if (Explorer.m_Memory.memoryIsLow()) {</span>
<span class="nc" id="L379">          proceed = Explorer.m_Memory.showMemoryIsLow();</span>
        }
        
<span class="nc bnc" id="L382" title="All 2 branches missed.">        if (proceed) {</span>
<span class="nc" id="L383">          startAttributeSelection();</span>
        }
<span class="nc" id="L385">      }</span>
    });
<span class="nc" id="L387">    m_StopBut.addActionListener(new ActionListener() {</span>
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L389">	stopAttributeSelection();</span>
<span class="nc" id="L390">      }</span>
    });
    
<span class="nc" id="L393">    m_History.setHandleRightClicks(false);</span>
    // see if we can popup a menu for the selected result
<span class="nc" id="L395">    m_History.getList().addMouseListener(new MouseAdapter() {</span>
	public void mouseClicked(MouseEvent e) {
<span class="nc bnc" id="L397" title="All 2 branches missed.">	  if (((e.getModifiers() &amp; InputEvent.BUTTON1_MASK)</span>
<span class="nc bnc" id="L398" title="All 2 branches missed.">	       != InputEvent.BUTTON1_MASK) || e.isAltDown()) {</span>
<span class="nc" id="L399">	    int index = m_History.getList().locationToIndex(e.getPoint());</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">	    if (index != -1) {</span>
<span class="nc" id="L401">	      String name = m_History.getNameAtIndex(index);</span>
<span class="nc" id="L402">	      visualize(name, e.getX(), e.getY());</span>
	    } else {
<span class="nc" id="L404">	      visualize(null, e.getX(), e.getY());</span>
	    }
	  }
<span class="nc" id="L407">	}</span>
      });

    // Layout the GUI
<span class="nc" id="L411">    JPanel p1 = new JPanel();</span>
<span class="nc" id="L412">    p1.setBorder(BorderFactory.createCompoundBorder(</span>
<span class="nc" id="L413">		 BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;AttributeSelectionPanel_P1_BorderFactoryCreateTitledBorder_Text&quot;)),</span>
<span class="nc" id="L414">		 BorderFactory.createEmptyBorder(0, 5, 5, 5)</span>
		 ));
<span class="nc" id="L416">    p1.setLayout(new BorderLayout());</span>
<span class="nc" id="L417">    p1.add(m_AEEPanel, BorderLayout.NORTH);</span>

<span class="nc" id="L419">    JPanel p1_1 = new JPanel();</span>
<span class="nc" id="L420">    p1_1.setBorder(BorderFactory.createCompoundBorder(</span>
<span class="nc" id="L421">		 BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;AttributeSelectionPanel_P1_1_BorderFactoryCreateTitledBorder_Text&quot;)),</span>
<span class="nc" id="L422">		 BorderFactory.createEmptyBorder(0, 5, 5, 5)</span>
		 ));
<span class="nc" id="L424">    p1_1.setLayout(new BorderLayout());</span>
<span class="nc" id="L425">    p1_1.add(m_ASEPanel, BorderLayout.NORTH);</span>

<span class="nc" id="L427">    JPanel p_new = new JPanel();</span>
<span class="nc" id="L428">    p_new.setLayout(new BorderLayout());</span>
<span class="nc" id="L429">    p_new.add(p1, BorderLayout.NORTH);</span>
<span class="nc" id="L430">    p_new.add(p1_1, BorderLayout.CENTER);</span>

<span class="nc" id="L432">    JPanel p2 = new JPanel();</span>
<span class="nc" id="L433">    GridBagLayout gbL = new GridBagLayout();</span>
<span class="nc" id="L434">    p2.setLayout(gbL);</span>
<span class="nc" id="L435">    p2.setBorder(BorderFactory.createCompoundBorder(</span>
<span class="nc" id="L436">		 BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;AttributeSelectionPanel_P2_BorderFactoryCreateTitledBorder_Text&quot;)),</span>
<span class="nc" id="L437">		 BorderFactory.createEmptyBorder(0, 5, 5, 5)</span>
		 ));
<span class="nc" id="L439">    GridBagConstraints gbC = new GridBagConstraints();</span>
<span class="nc" id="L440">    gbC.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L441">    gbC.gridy = 2;     gbC.gridx = 0;</span>
<span class="nc" id="L442">    gbL.setConstraints(m_TrainBut, gbC);</span>
<span class="nc" id="L443">    p2.add(m_TrainBut);</span>

<span class="nc" id="L445">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L446">    gbC.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L447">    gbC.gridy = 4;     gbC.gridx = 0;</span>
<span class="nc" id="L448">    gbL.setConstraints(m_CVBut, gbC);</span>
<span class="nc" id="L449">    p2.add(m_CVBut);</span>

<span class="nc" id="L451">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L452">    gbC.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L453">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L454">    gbC.gridy = 4;     gbC.gridx = 1;</span>
<span class="nc" id="L455">    gbC.insets = new Insets(2, 10, 2, 10);</span>
<span class="nc" id="L456">    gbL.setConstraints(m_CVLab, gbC);</span>
<span class="nc" id="L457">    p2.add(m_CVLab);</span>

<span class="nc" id="L459">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L460">    gbC.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L461">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L462">    gbC.gridy = 4;     gbC.gridx = 2;  gbC.weightx = 100;</span>
<span class="nc" id="L463">    gbC.ipadx = 20;</span>
<span class="nc" id="L464">    gbL.setConstraints(m_CVText, gbC);</span>
<span class="nc" id="L465">    p2.add(m_CVText);</span>

<span class="nc" id="L467">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L468">    gbC.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L469">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L470">    gbC.gridy = 6;     gbC.gridx = 1;</span>
<span class="nc" id="L471">    gbC.insets = new Insets(2, 10, 2, 10);</span>
<span class="nc" id="L472">    gbL.setConstraints(m_SeedLab, gbC);</span>
<span class="nc" id="L473">    p2.add(m_SeedLab);</span>

<span class="nc" id="L475">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L476">    gbC.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L477">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L478">    gbC.gridy = 6;     gbC.gridx = 2;  gbC.weightx = 100;</span>
<span class="nc" id="L479">    gbC.ipadx = 20;</span>
<span class="nc" id="L480">    gbL.setConstraints(m_SeedText, gbC);</span>
<span class="nc" id="L481">    p2.add(m_SeedText);</span>


<span class="nc" id="L484">    JPanel buttons = new JPanel();</span>
<span class="nc" id="L485">    buttons.setLayout(new GridLayout(2, 2));</span>
<span class="nc" id="L486">    buttons.add(m_ClassCombo);</span>
<span class="nc" id="L487">    m_ClassCombo.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
<span class="nc" id="L488">    JPanel ssButs = new JPanel();</span>
<span class="nc" id="L489">    ssButs.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
<span class="nc" id="L490">    ssButs.setLayout(new GridLayout(1, 2, 5, 5));</span>
<span class="nc" id="L491">    ssButs.add(m_StartBut);</span>
<span class="nc" id="L492">    ssButs.add(m_StopBut);</span>
<span class="nc" id="L493">    buttons.add(ssButs);</span>
    
<span class="nc" id="L495">    JPanel p3 = new JPanel();</span>
<span class="nc" id="L496">    p3.setBorder(BorderFactory.</span>
<span class="nc" id="L497">		 createTitledBorder(Messages.getInstance().getString(&quot;AttributeSelectionPanel_P3_BorderFactoryCreateTitledBorder_Text&quot;)));</span>
<span class="nc" id="L498">    p3.setLayout(new BorderLayout());</span>
<span class="nc" id="L499">    final JScrollPane js = new JScrollPane(m_OutText);</span>
<span class="nc" id="L500">    p3.add(js, BorderLayout.CENTER);</span>
<span class="nc" id="L501">    js.getViewport().addChangeListener(new ChangeListener() {</span>
      private int lastHeight;
      public void stateChanged(ChangeEvent e) {
<span class="nc" id="L504">	JViewport vp = (JViewport)e.getSource();</span>
<span class="nc" id="L505">	int h = vp.getViewSize().height; </span>
<span class="nc bnc" id="L506" title="All 2 branches missed.">	if (h != lastHeight) { // i.e. an addition not just a user scrolling</span>
<span class="nc" id="L507">	  lastHeight = h;</span>
<span class="nc" id="L508">	  int x = h - vp.getExtentSize().height;</span>
<span class="nc" id="L509">	  vp.setViewPosition(new Point(0, x));</span>
	}
<span class="nc" id="L511">      }</span>
    });

<span class="nc" id="L514">    JPanel mondo = new JPanel();</span>
<span class="nc" id="L515">    gbL = new GridBagLayout();</span>
<span class="nc" id="L516">    mondo.setLayout(gbL);</span>
<span class="nc" id="L517">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L518">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L519">    gbC.gridy = 0;     gbC.gridx = 0; gbC.weightx = 0;</span>
<span class="nc" id="L520">    gbL.setConstraints(p2, gbC);</span>
<span class="nc" id="L521">    mondo.add(p2);</span>
<span class="nc" id="L522">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L523">    gbC.anchor = GridBagConstraints.NORTH;</span>
<span class="nc" id="L524">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L525">    gbC.gridy = 1;     gbC.gridx = 0; gbC.weightx = 0;</span>
<span class="nc" id="L526">    gbL.setConstraints(buttons, gbC);</span>
<span class="nc" id="L527">    mondo.add(buttons);</span>
<span class="nc" id="L528">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L529">    gbC.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L530">    gbC.gridy = 2;     gbC.gridx = 0; gbC.weightx = 0; gbC.weighty = 100;</span>
<span class="nc" id="L531">    gbL.setConstraints(m_History, gbC);</span>
<span class="nc" id="L532">    mondo.add(m_History);</span>
<span class="nc" id="L533">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L534">    gbC.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L535">    gbC.gridy = 0;     gbC.gridx = 1;</span>
<span class="nc" id="L536">    gbC.gridheight = 3;</span>
<span class="nc" id="L537">    gbC.weightx = 100; gbC.weighty = 100;</span>
<span class="nc" id="L538">    gbL.setConstraints(p3, gbC);</span>
<span class="nc" id="L539">    mondo.add(p3);</span>

<span class="nc" id="L541">    setLayout(new BorderLayout());</span>
<span class="nc" id="L542">    add(p_new, BorderLayout.NORTH);</span>
<span class="nc" id="L543">    add(mondo, BorderLayout.CENTER);</span>
<span class="nc" id="L544">  }</span>

  
  /**
   * Updates the enabled status of the input fields and labels.
   */
  protected void updateRadioLinks() {
<span class="nc" id="L551">    m_CVBut.setEnabled(true);</span>
<span class="nc" id="L552">    m_CVText.setEnabled(m_CVBut.isSelected());</span>
<span class="nc" id="L553">    m_CVLab.setEnabled(m_CVBut.isSelected());</span>
<span class="nc" id="L554">    m_SeedText.setEnabled(m_CVBut.isSelected());</span>
<span class="nc" id="L555">    m_SeedLab.setEnabled(m_CVBut.isSelected());</span>
    
<span class="nc bnc" id="L557" title="All 2 branches missed.">    if (m_AttributeEvaluatorEditor.getValue() </span>
	instanceof AttributeTransformer) {
<span class="nc" id="L559">      m_CVBut.setSelected(false);</span>
<span class="nc" id="L560">      m_CVBut.setEnabled(false);</span>
<span class="nc" id="L561">      m_CVText.setEnabled(false);</span>
<span class="nc" id="L562">      m_CVLab.setEnabled(false);</span>
<span class="nc" id="L563">      m_SeedText.setEnabled(false);</span>
<span class="nc" id="L564">      m_SeedLab.setEnabled(false);</span>
<span class="nc" id="L565">      m_TrainBut.setSelected(true);</span>
    }
<span class="nc" id="L567">  }</span>
  
  /**
   * Sets the Logger to receive informational messages
   *
   * @param newLog the Logger that will now get info messages
   */
  public void setLog(Logger newLog) {

<span class="nc" id="L576">    m_Log = newLog;</span>
<span class="nc" id="L577">  }</span>
  
  /**
   * Tells the panel to use a new set of instances.
   *
   * @param inst a set of Instances
   */
  public void setInstances(Instances inst) {
    
<span class="nc" id="L586">    m_Instances = inst;</span>
<span class="nc" id="L587">    String [] attribNames = new String [m_Instances.numAttributes() + 1];</span>
<span class="nc" id="L588">    attribNames[0] = &quot;No class&quot;;      </span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">    for (int i = 0; i &lt; inst.numAttributes(); i++) {</span>
<span class="nc" id="L590">      String type = &quot;&quot;;</span>
<span class="nc bnc" id="L591" title="All 6 branches missed.">      switch (m_Instances.attribute(i).type()) {</span>
      case Attribute.NOMINAL:
<span class="nc" id="L593">	type = Messages.getInstance().getString(&quot;AttributeSelectionPanel_SetInstances_AttributeNOMINAL_Type_Text&quot;);</span>
<span class="nc" id="L594">	break;</span>
      case Attribute.NUMERIC:
<span class="nc" id="L596">	type = Messages.getInstance().getString(&quot;AttributeSelectionPanel_SetInstances_AttributeNUMERIC_Type_Text&quot;);</span>
<span class="nc" id="L597">	break;</span>
      case Attribute.STRING:
<span class="nc" id="L599">	type = Messages.getInstance().getString(&quot;AttributeSelectionPanel_SetInstances_AttributeSTRING_Type_Text&quot;);</span>
<span class="nc" id="L600">	break;</span>
      case Attribute.DATE:
<span class="nc" id="L602">	type = Messages.getInstance().getString(&quot;AttributeSelectionPanel_SetInstances_AttributeDATE_Type_Text&quot;);</span>
<span class="nc" id="L603">	break;</span>
      case Attribute.RELATIONAL:
<span class="nc" id="L605">	type = Messages.getInstance().getString(&quot;AttributeSelectionPanel_SetInstances_AttributeRELATIONAL_Type_Text&quot;);</span>
<span class="nc" id="L606">	break;</span>
      default:
<span class="nc" id="L608">	type = Messages.getInstance().getString(&quot;AttributeSelectionPanel_SetInstances_AttributeDEFAULT_Type_Text&quot;);</span>
      }
<span class="nc" id="L610">      String attnm = m_Instances.attribute(i).name();</span>
     
<span class="nc" id="L612">      attribNames[i + 1] = type + attnm;</span>
    }
<span class="nc bnc" id="L614" title="All 2 branches missed.">    m_StartBut.setEnabled(m_RunThread == null);</span>
<span class="nc bnc" id="L615" title="All 2 branches missed.">    m_StopBut.setEnabled(m_RunThread != null);</span>
<span class="nc" id="L616">    m_ClassCombo.setModel(new DefaultComboBoxModel(attribNames));</span>
<span class="nc bnc" id="L617" title="All 2 branches missed.">    if (inst.classIndex() == -1)</span>
<span class="nc" id="L618">      m_ClassCombo.setSelectedIndex(attribNames.length - 1);</span>
    else
<span class="nc" id="L620">      m_ClassCombo.setSelectedIndex(inst.classIndex());</span>
<span class="nc" id="L621">    m_ClassCombo.setEnabled(true);</span>
<span class="nc" id="L622">  }</span>
  
  /**
   * Starts running the currently configured attribute evaluator and
   * search method. This is run in a separate thread, and will only start if
   * there is no attribute selection  already running. The attribute selection
   * output is sent to the results history panel.
   */
  protected void startAttributeSelection() {

<span class="nc bnc" id="L632" title="All 2 branches missed.">    if (m_RunThread == null) {</span>
<span class="nc" id="L633">      m_StartBut.setEnabled(false);</span>
<span class="nc" id="L634">      m_StopBut.setEnabled(true);</span>
<span class="nc" id="L635">      m_RunThread = new Thread() {</span>
	public void run() {
	  // Copy the current state of things
<span class="nc" id="L638">	  m_Log.statusMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_StatusMessage_Text_First&quot;));</span>
<span class="nc" id="L639">	  Instances inst = new Instances(m_Instances);</span>

<span class="nc" id="L641">	  int testMode = 0;</span>
<span class="nc" id="L642">	  int numFolds = 10;</span>
<span class="nc" id="L643">	  int seed = 1;</span>
<span class="nc" id="L644">	  int classIndex = m_ClassCombo.getSelectedIndex() - 1;</span>
<span class="nc" id="L645">	  ASEvaluation evaluator = </span>
<span class="nc" id="L646">	     (ASEvaluation) m_AttributeEvaluatorEditor.getValue();</span>

<span class="nc" id="L648">	  ASSearch search = (ASSearch) m_AttributeSearchEditor.getValue();</span>

<span class="nc" id="L650">	  StringBuffer outBuff = new StringBuffer();</span>
<span class="nc" id="L651">	  String name = (new SimpleDateFormat(&quot;HH:mm:ss - &quot;))</span>
<span class="nc" id="L652">	  .format(new Date());</span>
<span class="nc" id="L653">	  String sname = search.getClass().getName();</span>
<span class="nc bnc" id="L654" title="All 2 branches missed.">	  if (sname.startsWith(&quot;weka.attributeSelection.&quot;)) {</span>
<span class="nc" id="L655">	    name += sname.substring(&quot;weka.attributeSelection.&quot;.length());</span>
	  } else {
<span class="nc" id="L657">	    name += sname;</span>
	  }
<span class="nc" id="L659">	  String ename = evaluator.getClass().getName();</span>
<span class="nc bnc" id="L660" title="All 2 branches missed.">	  if (ename.startsWith(&quot;weka.attributeSelection.&quot;)) {</span>
<span class="nc" id="L661">	    name += (&quot; + &quot;</span>
<span class="nc" id="L662">		     +ename.substring(&quot;weka.attributeSelection.&quot;.length()));</span>
	  } else {
<span class="nc" id="L664">	    name += (&quot; + &quot;+ename);</span>
	  }
          
	  // assemble commands
          String cmd;
	  String cmdFilter;
          String cmdClassifier;
          
          // 1. attribute selection command
<span class="nc" id="L673">          Vector&lt;String&gt; list = new Vector&lt;String&gt;();</span>
<span class="nc" id="L674">          list.add(&quot;-s&quot;);</span>
<span class="nc bnc" id="L675" title="All 2 branches missed.">          if (search instanceof OptionHandler)</span>
<span class="nc" id="L676">            list.add(sname + &quot; &quot; + Utils.joinOptions(((OptionHandler) search).getOptions()));</span>
          else
<span class="nc" id="L678">            list.add(sname);</span>
<span class="nc bnc" id="L679" title="All 2 branches missed.">          if (evaluator instanceof OptionHandler) {</span>
<span class="nc" id="L680">            String[] opt = ((OptionHandler) evaluator).getOptions();</span>
<span class="nc bnc" id="L681" title="All 2 branches missed.">            for (int i = 0; i &lt; opt.length; i++)</span>
<span class="nc" id="L682">              list.add(opt[i]);</span>
          }
<span class="nc" id="L684">          cmd =   ename + &quot; &quot; </span>
<span class="nc" id="L685">                + Utils.joinOptions(list.toArray(new String[list.size()]));</span>

          // 2. filter command
<span class="nc" id="L688">          weka.filters.supervised.attribute.AttributeSelection filter = </span>
<span class="nc" id="L689">            new weka.filters.supervised.attribute.AttributeSelection();</span>
<span class="nc" id="L690">          filter.setEvaluator((ASEvaluation) m_AttributeEvaluatorEditor.getValue());</span>
<span class="nc" id="L691">          filter.setSearch((ASSearch) m_AttributeSearchEditor.getValue());</span>
<span class="nc" id="L692">	  cmdFilter =   filter.getClass().getName() + &quot; &quot; </span>
<span class="nc" id="L693">                      + Utils.joinOptions(((OptionHandler) filter).getOptions());</span>

          // 3. meta-classifier command
<span class="nc" id="L696">          weka.classifiers.meta.AttributeSelectedClassifier cls = </span>
<span class="nc" id="L697">            new weka.classifiers.meta.AttributeSelectedClassifier();</span>
<span class="nc" id="L698">          cls.setEvaluator((ASEvaluation) m_AttributeEvaluatorEditor.getValue());</span>
<span class="nc" id="L699">          cls.setSearch((ASSearch) m_AttributeSearchEditor.getValue());</span>
<span class="nc" id="L700">          cmdClassifier =   cls.getClass().getName() + &quot; &quot; </span>
<span class="nc" id="L701">                          + Utils.joinOptions(cls.getOptions());</span>
          
<span class="nc" id="L703">	  AttributeSelection eval = null;</span>

	  try {
<span class="nc bnc" id="L706" title="All 2 branches missed.">	    if (m_CVBut.isSelected()) {</span>
<span class="nc" id="L707">	      testMode = 1;</span>
<span class="nc" id="L708">	      numFolds = Integer.parseInt(m_CVText.getText());</span>
<span class="nc" id="L709">	      seed = Integer.parseInt(m_SeedText.getText());</span>
<span class="nc bnc" id="L710" title="All 2 branches missed.">	      if (numFolds &lt;= 1) {</span>
<span class="nc" id="L711">		throw new Exception(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Exception_Text_First&quot;));</span>
	      }
	    }
	    
<span class="nc bnc" id="L715" title="All 2 branches missed.">	    if (classIndex &gt;= 0) {</span>
<span class="nc" id="L716">	      inst.setClassIndex(classIndex);</span>
	    }

	    // Output some header information
<span class="nc" id="L720">	    m_Log.logMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_LogMessage_Text_First&quot;) + ename);</span>
<span class="nc" id="L721">	    m_Log.logMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_LogMessage_Text_Second&quot;) + cmd);</span>
<span class="nc" id="L722">            m_Log.logMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_LogMessage_Text_Third&quot;) + cmdFilter);</span>
<span class="nc" id="L723">            m_Log.logMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_LogMessage_Text_Fourth&quot;) + cmdClassifier);</span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">	    if (m_Log instanceof TaskLogger) {</span>
<span class="nc" id="L725">	      ((TaskLogger)m_Log).taskStarted();</span>
	    }
<span class="nc" id="L727">	    outBuff.append(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_OutBuffer_Text_First&quot;));</span>
<span class="nc" id="L728">	    outBuff.append(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_OutBuffer_Text_Second&quot;) + ename);</span>
<span class="nc bnc" id="L729" title="All 2 branches missed.">	    if (evaluator instanceof OptionHandler) {</span>
<span class="nc" id="L730">	      String [] o = ((OptionHandler) evaluator).getOptions();</span>
<span class="nc" id="L731">	      outBuff.append(&quot; &quot; + Utils.joinOptions(o));</span>
	    }
<span class="nc" id="L733">	    outBuff.append(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_OutBuffer_Text_Third&quot;) + sname);</span>
<span class="nc bnc" id="L734" title="All 2 branches missed.">	    if (search instanceof OptionHandler) {</span>
<span class="nc" id="L735">	      String [] o = ((OptionHandler) search).getOptions();</span>
<span class="nc" id="L736">	      outBuff.append(&quot; &quot; + Utils.joinOptions(o));</span>
	    }
<span class="nc" id="L738">	    outBuff.append(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_OutBuffer_Text_Fourth&quot;));</span>
<span class="nc" id="L739">	    outBuff.append(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_OutBuffer_Text_Fifth&quot;) + inst.relationName() + '\n');</span>
<span class="nc" id="L740">	    outBuff.append(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_OutBuffer_Text_Sixth&quot;) + inst.numInstances() + '\n');</span>
<span class="nc" id="L741">	    outBuff.append(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_OutBuffer_Text_Seventh&quot;) + inst.numAttributes() + '\n');</span>
<span class="nc bnc" id="L742" title="All 2 branches missed.">	    if (inst.numAttributes() &lt; 100) {</span>
<span class="nc bnc" id="L743" title="All 2 branches missed.">	      for (int i = 0; i &lt; inst.numAttributes(); i++) {</span>
<span class="nc" id="L744">		outBuff.append(&quot;              &quot; + inst.attribute(i).name()</span>
<span class="nc" id="L745">			       + '\n');</span>
	      }
	    } else {
<span class="nc" id="L748">	      outBuff.append(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_OutBuffer_Text_Eigth&quot;));</span>
	    }
<span class="nc" id="L750">	    outBuff.append(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_OutBuffer_Text_Nineth&quot;));</span>
<span class="nc bnc" id="L751" title="All 3 branches missed.">	    switch (testMode) {</span>
	      case 0: // select using all training
<span class="nc" id="L753">	      outBuff.append(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_OutBuffer_Text_Tenth&quot;));</span>
<span class="nc" id="L754">	      break;</span>
	      case 1: // CV mode
<span class="nc" id="L756">	      outBuff.append(&quot;&quot; + numFolds + Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_OutBuffer_Text_Eleventh&quot;));</span>
	      break;
	    }
<span class="nc" id="L759">	    outBuff.append(&quot;\n&quot;);</span>
<span class="nc" id="L760">	    m_History.addResult(name, outBuff);</span>
<span class="nc" id="L761">	    m_History.setSingle(name);</span>
	    
	    // Do the feature selection and output the results.
<span class="nc" id="L764">	    m_Log.statusMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_StatusMessage_Text&quot;));</span>
<span class="nc" id="L765">	    m_History.updateResult(name);</span>
	    
<span class="nc" id="L767">	    eval = new AttributeSelection();</span>
<span class="nc" id="L768">	    eval.setEvaluator(evaluator);</span>
<span class="nc" id="L769">	    eval.setSearch(search);</span>
<span class="nc" id="L770">	    eval.setFolds(numFolds);</span>
<span class="nc" id="L771">	    eval.setSeed(seed);</span>
<span class="nc bnc" id="L772" title="All 2 branches missed.">	    if (testMode == 1) {</span>
<span class="nc" id="L773">	      eval.setXval(true);</span>
	    }
	    	    
<span class="nc bnc" id="L776" title="All 3 branches missed.">	    switch (testMode) {</span>
	      case 0: // select using training
<span class="nc" id="L778">	      m_Log.statusMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_StatusMessage_Text_First&quot;));</span>
<span class="nc" id="L779">	      eval.SelectAttributes(inst);</span>
<span class="nc" id="L780">	      break;</span>

	      case 1: // CV mode
<span class="nc" id="L783">	      m_Log.statusMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_StatusMessage_Text_Second&quot;));</span>
<span class="nc" id="L784">	      Random random = new Random(seed);</span>
<span class="nc" id="L785">	      inst.randomize(random);</span>
<span class="nc bnc" id="L786" title="All 2 branches missed.">	      if (inst.attribute(classIndex).isNominal()) {</span>
<span class="nc" id="L787">		m_Log.statusMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_StatusMessage_Text_Third&quot;));</span>
<span class="nc" id="L788">		inst.stratify(numFolds);</span>
	      }
<span class="nc bnc" id="L790" title="All 2 branches missed.">	      for (int fold = 0; fold &lt; numFolds;fold++) {</span>
<span class="nc" id="L791">		m_Log.statusMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_StatusMessage_Text_Fourth&quot;)</span>
<span class="nc" id="L792">				    + (fold + 1) + Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_StatusMessage_Text_Fifth&quot;));</span>
<span class="nc" id="L793">		Instances train = inst.trainCV(numFolds, fold, random);</span>
<span class="nc" id="L794">		m_Log.statusMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_StatusMessage_Text_Sixth&quot;)</span>
<span class="nc" id="L795">				    + (fold + 1) + Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_StatusMessage_Text_Seventh&quot;));</span>
		
<span class="nc" id="L797">		eval.selectAttributesCVSplit(train);</span>
	      }
<span class="nc" id="L799">	      break;</span>
	      default:
<span class="nc" id="L801">	      throw new Exception(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Exception_Text_Second&quot;));</span>
	    }

<span class="nc bnc" id="L804" title="All 2 branches missed.">	    if (testMode == 0) {</span>
<span class="nc" id="L805">	      outBuff.append(eval.toResultsString());</span>
	    } else {
<span class="nc" id="L807">	      outBuff.append(eval.CVResultsString());</span>
	    }
	  
<span class="nc" id="L810">	    outBuff.append(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_OutBuffer_Text_Thirteenth&quot;));</span>
<span class="nc" id="L811">	    m_History.updateResult(name);</span>
<span class="nc" id="L812">	    m_Log.logMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_LogMessage_Text_Fifth&quot;) + ename+&quot; &quot;+sname);</span>
<span class="nc" id="L813">	    m_Log.statusMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_StatusMessage_Text_Eigth&quot;));</span>
<span class="nc" id="L814">	  } catch (Exception ex) {</span>
<span class="nc" id="L815">	    m_Log.logMessage(ex.getMessage());</span>
<span class="nc" id="L816">	    m_Log.statusMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_StatusMessage_Text_Ninth&quot;));</span>
<span class="nc" id="L817">	  } finally {</span>
<span class="nc bnc" id="L818" title="All 6 branches missed.">	    if (evaluator instanceof AttributeTransformer) {</span>
	      try {
<span class="nc" id="L820">		Instances transformed = </span>
<span class="nc" id="L821">		  ((AttributeTransformer)evaluator).transformedData(inst);</span>
<span class="nc" id="L822">		transformed.</span>
<span class="nc" id="L823">		  setRelationName(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Transformed_SetRelationName_Text&quot;) + transformed.relationName());</span>

<span class="nc" id="L825">		FastVector vv = new FastVector();</span>
<span class="nc" id="L826">		vv.addElement(transformed);</span>
<span class="nc" id="L827">		m_History.addObject(name, vv);</span>
<span class="nc" id="L828">	      } catch (Exception ex) {</span>
<span class="nc" id="L829">		System.err.println(ex);</span>
<span class="nc" id="L830">		ex.printStackTrace();</span>
	      }
<span class="nc bnc" id="L832" title="All 6 branches missed.">	    } else if (testMode == 0) {</span>
	      try {
<span class="nc" id="L834">		Instances reducedInst = eval.reduceDimensionality(inst);</span>
<span class="nc" id="L835">		FastVector vv = new FastVector();</span>
<span class="nc" id="L836">		vv.addElement(reducedInst);</span>
<span class="nc" id="L837">		m_History.addObject(name, vv);</span>
<span class="nc" id="L838">	      } catch (Exception ex) {</span>
<span class="nc" id="L839">		ex.printStackTrace();</span>
	      }
	    }
<span class="nc bnc" id="L842" title="All 6 branches missed.">	    if (isInterrupted()) {</span>
<span class="nc" id="L843">	      m_Log.logMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_LogMessage_Text_Sixth&quot;) + ename+&quot; &quot;+sname);</span>
<span class="nc" id="L844">	      m_Log.statusMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_StartAttributeSelection_Run_Log_StatusMessage_Text_Tenth&quot;));</span>
	    }
<span class="nc" id="L846">	    m_RunThread = null;</span>
<span class="nc" id="L847">	    m_StartBut.setEnabled(true);</span>
<span class="nc" id="L848">	    m_StopBut.setEnabled(false);</span>
<span class="nc bnc" id="L849" title="All 6 branches missed.">	    if (m_Log instanceof TaskLogger) {</span>
<span class="nc" id="L850">	      ((TaskLogger)m_Log).taskFinished();</span>
	    }
<span class="nc" id="L852">	  }</span>
<span class="nc" id="L853">	}</span>
      };
<span class="nc" id="L855">      m_RunThread.setPriority(Thread.MIN_PRIORITY);</span>
<span class="nc" id="L856">      m_RunThread.start();</span>
    }
<span class="nc" id="L858">  }</span>
  
  /**
   * Stops the currently running attribute selection (if any).
   */
  protected void stopAttributeSelection() {

<span class="nc bnc" id="L865" title="All 2 branches missed.">    if (m_RunThread != null) {</span>
<span class="nc" id="L866">      m_RunThread.interrupt();</span>
      
      // This is deprecated (and theoretically the interrupt should do).
<span class="nc" id="L869">      m_RunThread.stop();</span>
      
    }
<span class="nc" id="L872">  }</span>
  
  /**
   * Save the named buffer to a file.
   * @param name the name of the buffer to be saved.
   */
  protected void saveBuffer(String name) {
<span class="nc" id="L879">    StringBuffer sb = m_History.getNamedBuffer(name);</span>
<span class="nc bnc" id="L880" title="All 2 branches missed.">    if (sb != null) {</span>
<span class="nc bnc" id="L881" title="All 2 branches missed.">      if (m_SaveOut.save(sb)) {</span>
<span class="nc" id="L882">	m_Log.logMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_SaveBuffer_Log_LogMessage_Text&quot;));</span>
      }
    }
<span class="nc" id="L885">  }</span>

  /**
   * Popup a visualize panel for viewing transformed data
   * 
   * @param ti          the Instances to display
   */
  protected void visualizeTransformedData(Instances ti) {
<span class="nc bnc" id="L893" title="All 2 branches missed.">    if (ti != null) {</span>
<span class="nc" id="L894">      MatrixPanel mp = new MatrixPanel();</span>
<span class="nc" id="L895">      mp.setInstances(ti);</span>
<span class="nc" id="L896">      String plotName = ti.relationName();</span>
<span class="nc" id="L897">      final javax.swing.JFrame jf = </span>
<span class="nc" id="L898">	new javax.swing.JFrame(Messages.getInstance().getString(&quot;AttributeSelectionPanel_VisualizeTransformedData_JFrame_Text&quot;)</span>
<span class="nc" id="L899">			       +plotName);</span>
<span class="nc" id="L900">      jf.setSize(800,600);</span>
<span class="nc" id="L901">      jf.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L902">      jf.getContentPane().add(mp, BorderLayout.CENTER);</span>
<span class="nc" id="L903">      jf.addWindowListener(new java.awt.event.WindowAdapter() {</span>
	  public void windowClosing(java.awt.event.WindowEvent e) {
<span class="nc" id="L905">	    jf.dispose();</span>
<span class="nc" id="L906">	  }</span>
	});

<span class="nc" id="L909">      jf.setVisible(true);</span>
    }
<span class="nc" id="L911">  }</span>

  /**
   * Popup a SaveDialog for saving the transformed data
   * 
   * @param ti          the Instances to display
   */
  protected void saveTransformedData(Instances ti) {
    JFileChooser        fc;
    int                 retVal;
    BufferedWriter      writer;
    ExtensionFileFilter filter;

<span class="nc" id="L924">    fc     = new JFileChooser();</span>
<span class="nc" id="L925">    filter = new ExtensionFileFilter(&quot;.arff&quot;, Messages.getInstance().getString(&quot;AttributeSelectionPanel_SaveTransformedData_Filter_Text&quot;));</span>
<span class="nc" id="L926">    fc.setFileFilter(filter);</span>
<span class="nc" id="L927">    retVal = fc.showSaveDialog(this);</span>

<span class="nc bnc" id="L929" title="All 2 branches missed.">    if (retVal == JFileChooser.APPROVE_OPTION) {</span>
      try {
<span class="nc" id="L931">        writer = new BufferedWriter(new FileWriter(fc.getSelectedFile()));</span>
<span class="nc" id="L932">        writer.write(ti.toString());</span>
<span class="nc" id="L933">        writer.flush();</span>
<span class="nc" id="L934">        writer.close();</span>
      }
<span class="nc" id="L936">      catch (Exception e) {</span>
<span class="nc" id="L937">        e.printStackTrace();</span>
<span class="nc" id="L938">        m_Log.logMessage(Messages.getInstance().getString(&quot;AttributeSelectionPanel_SaveTransformedData_Log_LogMessage_Text&quot;) + e.getMessage());</span>
<span class="nc" id="L939">        JOptionPane.showMessageDialog(</span>
<span class="nc" id="L940">            this, </span>
<span class="nc" id="L941">            Messages.getInstance().getString(&quot;AttributeSelectionPanel_SaveTransformedData_JOptionPaneShowMessageDialog_Text_First&quot;) + e.getMessage(), </span>
<span class="nc" id="L942">            Messages.getInstance().getString(&quot;AttributeSelectionPanel_SaveTransformedData_JOptionPaneShowMessageDialog_Text_Second&quot;), </span>
<span class="nc" id="L943">            JOptionPane.ERROR_MESSAGE);</span>
      }
    }
<span class="nc" id="L946">  }</span>

  /**
   * Handles constructing a popup menu with visualization options
   * @param name the name of the result history list entry clicked on by
   * the user.
   * @param x the x coordinate for popping up the menu
   * @param y the y coordinate for popping up the menu
   */
  protected void visualize(String name, int x, int y) {
<span class="nc" id="L956">    final String selectedName = name;</span>
<span class="nc" id="L957">    JPopupMenu resultListMenu = new JPopupMenu();</span>

<span class="nc" id="L959">    JMenuItem visMainBuffer = new JMenuItem(Messages.getInstance().getString(&quot;AttributeSelectionPanel_Visualize_VisMainBuffer_JMenuItem_Text&quot;));</span>
<span class="nc bnc" id="L960" title="All 2 branches missed.">    if (selectedName != null) {</span>
<span class="nc" id="L961">      visMainBuffer.addActionListener(new ActionListener() {</span>
	  public void actionPerformed(ActionEvent e) {
<span class="nc" id="L963">	    m_History.setSingle(selectedName);</span>
<span class="nc" id="L964">	  }</span>
	});
    } else {
<span class="nc" id="L967">      visMainBuffer.setEnabled(false);</span>
    }
<span class="nc" id="L969">    resultListMenu.add(visMainBuffer);</span>

<span class="nc" id="L971">    JMenuItem visSepBuffer = new JMenuItem(Messages.getInstance().getString(&quot;AttributeSelectionPanel_Visualize_VisSepBuffer_JMenuItem_Text&quot;));</span>
<span class="nc bnc" id="L972" title="All 2 branches missed.">    if (selectedName != null) {</span>
<span class="nc" id="L973">    visSepBuffer.addActionListener(new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {
<span class="nc" id="L975">	  m_History.openFrame(selectedName);</span>
<span class="nc" id="L976">	}</span>
      });
    } else {
<span class="nc" id="L979">      visSepBuffer.setEnabled(false);</span>
    }
<span class="nc" id="L981">    resultListMenu.add(visSepBuffer);</span>

<span class="nc" id="L983">    JMenuItem saveOutput = new JMenuItem(Messages.getInstance().getString(&quot;AttributeSelectionPanel_Visualize_SaveOutput_JMenuItem_Text&quot;));</span>
<span class="nc bnc" id="L984" title="All 2 branches missed.">    if (selectedName != null) {</span>
<span class="nc" id="L985">    saveOutput.addActionListener(new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {
<span class="nc" id="L987">	  saveBuffer(selectedName);</span>
<span class="nc" id="L988">	}</span>
      });
    } else {
<span class="nc" id="L991">      saveOutput.setEnabled(false);</span>
    }
<span class="nc" id="L993">    resultListMenu.add(saveOutput);</span>
    
<span class="nc" id="L995">    JMenuItem deleteOutput = new JMenuItem(Messages.getInstance().getString(&quot;AttributeSelectionPanel_Visualize_DeleteOutput_JMenuItem_Text&quot;));</span>
<span class="nc bnc" id="L996" title="All 2 branches missed.">    if (selectedName != null) {</span>
<span class="nc" id="L997">      deleteOutput.addActionListener(new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {
<span class="nc" id="L999">	  m_History.removeResult(selectedName);</span>
<span class="nc" id="L1000">	}</span>
      });
    } else {
<span class="nc" id="L1003">      deleteOutput.setEnabled(false);</span>
    }
<span class="nc" id="L1005">    resultListMenu.add(deleteOutput);</span>


<span class="nc" id="L1008">    FastVector o = null;</span>
<span class="nc bnc" id="L1009" title="All 2 branches missed.">    if (selectedName != null) {</span>
<span class="nc" id="L1010">      o = (FastVector)m_History.getNamedObject(selectedName);</span>
    }    

    //    VisualizePanel temp_vp = null;
<span class="nc" id="L1014">    Instances tempTransformed = null;</span>

<span class="nc bnc" id="L1016" title="All 2 branches missed.">    if (o != null) {</span>
<span class="nc bnc" id="L1017" title="All 2 branches missed.">      for (int i = 0; i &lt; o.size(); i++) {</span>
<span class="nc" id="L1018">	Object temp = o.elementAt(i);</span>
	//	if (temp instanceof VisualizePanel) {
<span class="nc bnc" id="L1020" title="All 2 branches missed.">	if (temp instanceof Instances) {</span>
	  //	  temp_vp = (VisualizePanel)temp;
<span class="nc" id="L1022">	  tempTransformed = (Instances) temp;</span>
	} 
      }
    }
    
    //    final VisualizePanel vp = temp_vp;
<span class="nc" id="L1028">    final Instances ti = tempTransformed;</span>
<span class="nc" id="L1029">    JMenuItem visTrans = null;</span>
    
<span class="nc bnc" id="L1031" title="All 2 branches missed.">    if (ti != null) {</span>
<span class="nc bnc" id="L1032" title="All 2 branches missed.">      if (ti.relationName().startsWith(Messages.getInstance().getString(&quot;AttributeSelectionPanel_Visualize_RelationName_Text_First&quot;))) {</span>
<span class="nc" id="L1033">	visTrans = new JMenuItem(Messages.getInstance().getString(&quot;AttributeSelectionPanel_Visualize_VisTrans_JMenuItem_Text_First&quot;));</span>
      } else {
<span class="nc" id="L1035">	visTrans = new JMenuItem(Messages.getInstance().getString(&quot;AttributeSelectionPanel_Visualize_VisTrans_JMenuItem_Text_Second&quot;));</span>
      }
<span class="nc" id="L1037">      resultListMenu.addSeparator();</span>
    }

    //    JMenuItem visTrans = new JMenuItem(&quot;Visualize transformed data&quot;);
<span class="nc bnc" id="L1041" title="All 4 branches missed.">    if (ti != null &amp;&amp; visTrans != null) {</span>
<span class="nc" id="L1042">      visTrans.addActionListener(new ActionListener() {</span>
	  public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1044">	    visualizeTransformedData(ti);</span>
<span class="nc" id="L1045">	  }</span>
	});
    }
     
<span class="nc bnc" id="L1049" title="All 2 branches missed.">    if (visTrans != null) {</span>
<span class="nc" id="L1050">      resultListMenu.add(visTrans);</span>
    }
    
<span class="nc" id="L1053">    JMenuItem saveTrans = null;</span>
<span class="nc bnc" id="L1054" title="All 2 branches missed.">    if (ti != null) {</span>
<span class="nc bnc" id="L1055" title="All 2 branches missed.">      if (ti.relationName().startsWith(Messages.getInstance().getString(&quot;AttributeSelectionPanel_Visualize_RelationName_Text_Second&quot;)))</span>
<span class="nc" id="L1056">        saveTrans = new JMenuItem(Messages.getInstance().getString(&quot;AttributeSelectionPanel_Visualize_SaveTrans_JMenuItem_Text_First&quot;));</span>
      else
<span class="nc" id="L1058">        saveTrans = new JMenuItem(Messages.getInstance().getString(&quot;AttributeSelectionPanel_Visualize_SaveTrans_JMenuItem_Text_Second&quot;));</span>
    }
<span class="nc bnc" id="L1060" title="All 2 branches missed.">    if (saveTrans != null) {</span>
<span class="nc" id="L1061">      saveTrans.addActionListener(new ActionListener() {</span>
          public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1063">            saveTransformedData(ti);</span>
<span class="nc" id="L1064">          }</span>
      });
<span class="nc" id="L1066">      resultListMenu.add(saveTrans);</span>
    }
    
<span class="nc" id="L1069">    resultListMenu.show(m_History.getList(), x, y);</span>
<span class="nc" id="L1070">  }</span>
  
  /**
   * updates the capabilities filter of the GOE
   * 
   * @param filter	the new filter to use
   */
  protected void updateCapabilitiesFilter(Capabilities filter) {
    Instances 		tempInst;
    Capabilities 	filterClass;

<span class="nc bnc" id="L1081" title="All 2 branches missed.">    if (filter == null) {</span>
<span class="nc" id="L1082">      m_AttributeEvaluatorEditor.setCapabilitiesFilter(new Capabilities(null));</span>
<span class="nc" id="L1083">      m_AttributeSearchEditor.setCapabilitiesFilter(new Capabilities(null));</span>
<span class="nc" id="L1084">      return;</span>
    }
    
<span class="nc bnc" id="L1087" title="All 2 branches missed.">    if (!ExplorerDefaults.getInitGenericObjectEditorFilter())</span>
<span class="nc" id="L1088">      tempInst = new Instances(m_Instances, 0);</span>
    else
<span class="nc" id="L1090">      tempInst = new Instances(m_Instances);</span>
<span class="nc" id="L1091">    int clIndex = m_ClassCombo.getSelectedIndex() - 1;</span>
    
<span class="nc bnc" id="L1093" title="All 2 branches missed.">    if (clIndex &gt;= 0) {</span>
<span class="nc" id="L1094">      tempInst.setClassIndex(clIndex);</span>
    }        

    try {
<span class="nc" id="L1098">      filterClass = Capabilities.forInstances(tempInst);</span>
    }
<span class="nc" id="L1100">    catch (Exception e) {</span>
<span class="nc" id="L1101">      filterClass = new Capabilities(null);</span>
    }
    
    // set new filter
<span class="nc" id="L1105">    m_AttributeEvaluatorEditor.setCapabilitiesFilter(filterClass);</span>
<span class="nc" id="L1106">    m_AttributeSearchEditor.setCapabilitiesFilter(filterClass);</span>

<span class="nc" id="L1108">    m_StartBut.setEnabled(true);</span>
    // check capabilities...
<span class="nc" id="L1110">    Capabilities currentFilter = m_AttributeEvaluatorEditor.getCapabilitiesFilter();</span>
<span class="nc" id="L1111">    ASEvaluation evaluator = (ASEvaluation) m_AttributeEvaluatorEditor.getValue();</span>
<span class="nc" id="L1112">    Capabilities currentSchemeCapabilities =  null;</span>
<span class="nc bnc" id="L1113" title="All 4 branches missed.">    if (evaluator != null &amp;&amp; currentFilter != null &amp;&amp; </span>
<span class="nc bnc" id="L1114" title="All 2 branches missed.">        (evaluator instanceof CapabilitiesHandler)) {</span>
<span class="nc" id="L1115">      currentSchemeCapabilities = ((CapabilitiesHandler)evaluator).getCapabilities();</span>
          
<span class="nc bnc" id="L1117" title="All 2 branches missed.">      if (!currentSchemeCapabilities.supportsMaybe(currentFilter) &amp;&amp;</span>
<span class="nc bnc" id="L1118" title="All 2 branches missed.">          !currentSchemeCapabilities.supports(currentFilter)) {</span>
<span class="nc" id="L1119">        m_StartBut.setEnabled(false);</span>
      }
    }
<span class="nc" id="L1122">  }</span>
  
  /**
   * method gets called in case of a change event
   * 
   * @param e		the associated change event
   */
  public void capabilitiesFilterChanged(CapabilitiesFilterChangeEvent e) {
<span class="nc bnc" id="L1130" title="All 2 branches missed.">    if (e.getFilter() == null)</span>
<span class="nc" id="L1131">      updateCapabilitiesFilter(null);</span>
    else
<span class="nc" id="L1133">      updateCapabilitiesFilter((Capabilities) e.getFilter().clone());</span>
<span class="nc" id="L1134">  }</span>

  /**
   * Sets the Explorer to use as parent frame (used for sending notifications
   * about changes in the data)
   * 
   * @param parent	the parent frame
   */
  public void setExplorer(Explorer parent) {
<span class="nc" id="L1143">    m_Explorer = parent;</span>
<span class="nc" id="L1144">  }</span>
  
  /**
   * returns the parent Explorer frame
   * 
   * @return		the parent
   */
  public Explorer getExplorer() {
<span class="nc" id="L1152">    return m_Explorer;</span>
  }
  
  /**
   * Returns the title for the tab in the Explorer
   * 
   * @return 		the title of this tab
   */
  public String getTabTitle() {
<span class="nc" id="L1161">    return Messages.getInstance().getString(&quot;AttributeSelectionPanel_GetTabTitle_Text&quot;);</span>
  }
  
  /**
   * Returns the tooltip for the tab in the Explorer
   * 
   * @return 		the tooltip of this tab
   */
  public String getTabTitleToolTip() {
<span class="nc" id="L1170">    return Messages.getInstance().getString(&quot;AttributeSelectionPanel_GetTabTitleToolTip_Text&quot;);</span>
  }

  /**
   * Tests out the attribute selection panel from the command line.
   *
   * @param args may optionally contain the name of a dataset to load.
   */
  public static void main(String [] args) {

    try {
<span class="nc" id="L1181">      final javax.swing.JFrame jf =</span>
<span class="nc" id="L1182">	new javax.swing.JFrame(Messages.getInstance().getString(&quot;AttributeSelectionPanel_Main_JFrame_Text&quot;));</span>
<span class="nc" id="L1183">      jf.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L1184">      final AttributeSelectionPanel sp = new AttributeSelectionPanel();</span>
<span class="nc" id="L1185">      jf.getContentPane().add(sp, BorderLayout.CENTER);</span>
<span class="nc" id="L1186">      weka.gui.LogPanel lp = new weka.gui.LogPanel();</span>
<span class="nc" id="L1187">      sp.setLog(lp);</span>
<span class="nc" id="L1188">      jf.getContentPane().add(lp, BorderLayout.SOUTH);</span>
<span class="nc" id="L1189">      jf.addWindowListener(new java.awt.event.WindowAdapter() {</span>
	public void windowClosing(java.awt.event.WindowEvent e) {
<span class="nc" id="L1191">	  jf.dispose();</span>
<span class="nc" id="L1192">	  System.exit(0);</span>
<span class="nc" id="L1193">	}</span>
      });
<span class="nc" id="L1195">      jf.pack();</span>
<span class="nc" id="L1196">      jf.setVisible(true);</span>
<span class="nc bnc" id="L1197" title="All 2 branches missed.">      if (args.length == 1) {</span>
<span class="nc" id="L1198">	System.err.println(Messages.getInstance().getString(&quot;AttributeSelectionPanel_Main_Error_Text&quot;) + args[0]);</span>
<span class="nc" id="L1199">	java.io.Reader r = new java.io.BufferedReader(</span>
<span class="nc" id="L1200">			   new java.io.FileReader(args[0]));</span>
<span class="nc" id="L1201">	Instances i = new Instances(r);</span>
<span class="nc" id="L1202">	sp.setInstances(i);</span>
      }
<span class="nc" id="L1204">    } catch (Exception ex) {</span>
<span class="nc" id="L1205">      ex.printStackTrace();</span>
<span class="nc" id="L1206">      System.err.println(ex.getMessage());</span>
    }
<span class="nc" id="L1208">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>