<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>ClassifierPanel.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.gui.explorer</a> &gt; <span class="el_source">ClassifierPanel.java</span></div><h1>ClassifierPanel.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">/*</span>
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 *    ClassifierPanel.java
 *    Copyright (C) 1999 University of Waikato, Hamilton, New Zealand
 *
 */

package weka.gui.explorer;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.Font;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.GridLayout;
import java.awt.Insets;
import java.awt.Point;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.InputEvent;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.io.OutputStream;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Random;
import java.util.Vector;
import java.util.zip.GZIPInputStream;
import java.util.zip.GZIPOutputStream;

import javax.swing.BorderFactory;
import javax.swing.ButtonGroup;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JComboBox;
import javax.swing.JDialog;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JMenu;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JPopupMenu;
import javax.swing.JRadioButton;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.JViewport;
import javax.swing.SwingConstants;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;
import javax.swing.filechooser.FileFilter;

import weka.classifiers.Classifier;
import weka.classifiers.CostMatrix;
import weka.classifiers.Evaluation;
import weka.classifiers.Sourcable;
import weka.classifiers.evaluation.CostCurve;
import weka.classifiers.evaluation.MarginCurve;
import weka.classifiers.evaluation.ThresholdCurve;
import weka.classifiers.pmml.consumer.PMMLClassifier;
import weka.core.Attribute;
import weka.core.Capabilities;
import weka.core.CapabilitiesHandler;
import weka.core.Drawable;
import weka.core.FastVector;
import weka.core.Instance;
import weka.core.Instances;
import weka.core.OptionHandler;
import weka.core.Range;
import weka.core.SerializedObject;
import weka.core.Utils;
import weka.core.Version;
import weka.core.converters.ConverterUtils.DataSource;
import weka.core.converters.IncrementalConverter;
import weka.core.converters.Loader;
import weka.core.pmml.PMMLFactory;
import weka.core.pmml.PMMLModel;
import weka.gui.CostMatrixEditor;
import weka.gui.ExtensionFileFilter;
import weka.gui.GenericObjectEditor;
import weka.gui.Logger;
import weka.gui.PropertyDialog;
import weka.gui.PropertyPanel;
import weka.gui.ResultHistoryPanel;
import weka.gui.SaveBuffer;
import weka.gui.SetInstancesPanel;
import weka.gui.SysErrLog;
import weka.gui.TaskLogger;
import weka.gui.beans.CostBenefitAnalysis;
import weka.gui.explorer.Explorer.CapabilitiesFilterChangeEvent;
import weka.gui.explorer.Explorer.CapabilitiesFilterChangeListener;
import weka.gui.explorer.Explorer.ExplorerPanel;
import weka.gui.explorer.Explorer.LogHandler;
import weka.gui.graphvisualizer.BIFFormatException;
import weka.gui.graphvisualizer.GraphVisualizer;
import weka.gui.treevisualizer.PlaceNode2;
import weka.gui.treevisualizer.TreeVisualizer;
import weka.gui.visualize.Plot2D;
import weka.gui.visualize.PlotData2D;
import weka.gui.visualize.ThresholdVisualizePanel;
import weka.gui.visualize.VisualizePanel;
import weka.gui.visualize.plugins.ErrorVisualizePlugin;
import weka.gui.visualize.plugins.GraphVisualizePlugin;
import weka.gui.visualize.plugins.TreeVisualizePlugin;
import weka.gui.visualize.plugins.VisualizePlugin;

/**
 * 0* This panel allows the user to select and configure a classifier, set the
 * attribute of the current dataset to be used as the class, and evaluate the
 * classifier using a number of testing modes (test on the training data,
 * train/test on a percentage split, n-fold cross-validation, test on a separate
 * split). The results of classification runs are stored in a result history so
 * that previous results are accessible.
 * 
 * @author Len Trigg (trigg@cs.waikato.ac.nz)
 * @author Mark Hall (mhall@cs.waikato.ac.nz)
 * @author Richard Kirkby (rkirkby@cs.waikato.ac.nz)
 * @version $Revision: 9755 $
 */
<span class="nc" id="L147">public class ClassifierPanel extends JPanel implements</span>
    CapabilitiesFilterChangeListener, ExplorerPanel, LogHandler {

  /** for serialization */
  static final long serialVersionUID = 6959973704963624003L;

  /** the parent frame */
<span class="nc" id="L154">  protected Explorer m_Explorer = null;</span>

  /** The filename extension that should be used for model files */
<span class="nc" id="L157">  public static String MODEL_FILE_EXTENSION = &quot;.model&quot;;</span>

  /** The filename extension that should be used for PMML xml files */
<span class="nc" id="L160">  public static String PMML_FILE_EXTENSION = &quot;.xml&quot;;</span>

  /** Lets the user configure the classifier */
<span class="nc" id="L163">  protected GenericObjectEditor m_ClassifierEditor = new GenericObjectEditor();</span>

  /** The panel showing the current classifier selection */
<span class="nc" id="L166">  protected PropertyPanel m_CEPanel = new PropertyPanel(m_ClassifierEditor);</span>

  /** The output area for classification results */
<span class="nc" id="L169">  protected JTextArea m_OutText = new JTextArea(20, 40);</span>

  /** The destination for log/status messages */
<span class="nc" id="L172">  protected Logger m_Log = new SysErrLog();</span>

  /** The buffer saving object for saving output */
<span class="nc" id="L175">  SaveBuffer m_SaveOut = new SaveBuffer(m_Log, this);</span>

  /** A panel controlling results viewing */
<span class="nc" id="L178">  protected ResultHistoryPanel m_History = new ResultHistoryPanel(m_OutText);</span>

  /** Lets the user select the class column */
<span class="nc" id="L181">  protected JComboBox m_ClassCombo = new JComboBox();</span>

  /** Click to set test mode to cross-validation */
<span class="nc" id="L184">  protected JRadioButton m_CVBut = new JRadioButton(Messages.getInstance()</span>
<span class="nc" id="L185">      .getString(&quot;ClassifierPanel_CVBut_JRadioButton_Text&quot;));</span>

  /** Click to set test mode to generate a % split */
<span class="nc" id="L188">  protected JRadioButton m_PercentBut = new JRadioButton(Messages.getInstance()</span>
<span class="nc" id="L189">      .getString(&quot;ClassifierPanel_PercentBut_JRadioButton_Text&quot;));</span>

  /** Click to set test mode to test on training data */
<span class="nc" id="L192">  protected JRadioButton m_TrainBut = new JRadioButton(Messages.getInstance()</span>
<span class="nc" id="L193">      .getString(&quot;ClassifierPanel_TrainBut_JRadioButton_Text&quot;));</span>

  /** Click to set test mode to a user-specified test set */
<span class="nc" id="L196">  protected JRadioButton m_TestSplitBut = new JRadioButton(Messages</span>
<span class="nc" id="L197">      .getInstance()</span>
<span class="nc" id="L198">      .getString(&quot;ClassifierPanel_TestSplitBut_JRadioButton_Text&quot;));</span>

  /**
   * Check to save the predictions in the results list for visualizing later on
   */
<span class="nc" id="L203">  protected JCheckBox m_StorePredictionsBut = new JCheckBox(Messages</span>
<span class="nc" id="L204">      .getInstance().getString(</span>
<span class="nc" id="L205">          &quot;ClassifierPanel_StorePredictionsBut_JCheckBox_Text&quot;));</span>

  /** Check to output the model built from the training data */
<span class="nc" id="L208">  protected JCheckBox m_OutputModelBut = new JCheckBox(Messages.getInstance()</span>
<span class="nc" id="L209">      .getString(&quot;ClassifierPanel_OutputModelBut_JCheckBox_Text&quot;));</span>

  /** Check to output true/false positives, precision/recall for each class */
<span class="nc" id="L212">  protected JCheckBox m_OutputPerClassBut = new JCheckBox(Messages</span>
<span class="nc" id="L213">      .getInstance().getString(</span>
<span class="nc" id="L214">          &quot;ClassifierPanel_OutputPerClassBut_JCheckBox_Text&quot;));</span>

  /** Check to output a confusion matrix */
<span class="nc" id="L217">  protected JCheckBox m_OutputConfusionBut = new JCheckBox(Messages</span>
<span class="nc" id="L218">      .getInstance().getString(</span>
<span class="nc" id="L219">          &quot;ClassifierPanel_OutputConfusionBut_JCheckBox_Text&quot;));</span>

  /** Check to output entropy statistics */
<span class="nc" id="L222">  protected JCheckBox m_OutputEntropyBut = new JCheckBox(Messages.getInstance()</span>
<span class="nc" id="L223">      .getString(&quot;ClassifierPanel_OutputEntropyBut_JCheckBox_Text&quot;));</span>

  /** Check to output text predictions */
<span class="nc" id="L226">  protected JCheckBox m_OutputPredictionsTextBut = new JCheckBox(Messages</span>
<span class="nc" id="L227">      .getInstance().getString(</span>
<span class="nc" id="L228">          &quot;ClassifierPanel_OutputPredictionsTextBut_JCheckBox_Text&quot;));</span>

  /** Lists indices for additional attributes to output */
<span class="nc" id="L231">  protected JTextField m_OutputAdditionalAttributesText = new JTextField(&quot;&quot;, 10);</span>

  /** Label for the text field with additional attributes in the output */
<span class="nc" id="L234">  protected JLabel m_OutputAdditionalAttributesLab = new JLabel(Messages</span>
<span class="nc" id="L235">      .getInstance().getString(</span>
<span class="nc" id="L236">          &quot;ClassifierPanel_OutputAdditionalAttributesLab_JLabel_Text&quot;));</span>

  /** the range of attributes to output */
<span class="nc" id="L239">  protected Range m_OutputAdditionalAttributesRange = null;</span>

  /** Check to evaluate w.r.t a cost matrix */
<span class="nc" id="L242">  protected JCheckBox m_EvalWRTCostsBut = new JCheckBox(Messages.getInstance()</span>
<span class="nc" id="L243">      .getString(&quot;ClassifierPanel_EvalWRTCostsBut_JCheckBox_Text&quot;));</span>

  /** for the cost matrix */
<span class="nc" id="L246">  protected JButton m_SetCostsBut = new JButton(Messages.getInstance()</span>
<span class="nc" id="L247">      .getString(&quot;ClassifierPanel_SetCostsBut_JButton_Text&quot;));</span>

  /** Label by where the cv folds are entered */
<span class="nc" id="L250">  protected JLabel m_CVLab = new JLabel(Messages.getInstance().getString(</span>
<span class="nc" id="L251">      &quot;ClassifierPanel_CVLab_JLabel_Text&quot;), SwingConstants.RIGHT);</span>

  /** The field where the cv folds are entered */
<span class="nc" id="L254">  protected JTextField m_CVText = new JTextField(Messages.getInstance()</span>
<span class="nc" id="L255">      .getString(&quot;ClassifierPanel_CVText_JTextField_Text&quot;), 3);</span>

  /** Label by where the % split is entered */
<span class="nc" id="L258">  protected JLabel m_PercentLab = new JLabel(Messages.getInstance().getString(</span>
<span class="nc" id="L259">      &quot;ClassifierPanel_PercentLab_JLabel_Text&quot;), SwingConstants.RIGHT);</span>

  /** The field where the % split is entered */
<span class="nc" id="L262">  protected JTextField m_PercentText = new JTextField(Messages.getInstance()</span>
<span class="nc" id="L263">      .getString(&quot;ClassifierPanel_PercentText_JTextField_Text&quot;), 3);</span>

  /** The button used to open a separate test dataset */
<span class="nc" id="L266">  protected JButton m_SetTestBut = new JButton(Messages.getInstance()</span>
<span class="nc" id="L267">      .getString(&quot;ClassifierPanel_SetTestBut_JButton_Text&quot;));</span>

  /** The frame used to show the test set selection panel */
  protected JFrame m_SetTestFrame;

  /** The frame used to show the cost matrix editing panel */
  protected PropertyDialog m_SetCostsFrame;

  /**
   * Alters the enabled/disabled status of elements associated with each radio
   * button
   */
<span class="nc" id="L279">  ActionListener m_RadioListener = new ActionListener() {</span>
    @Override
    public void actionPerformed(ActionEvent e) {
<span class="nc" id="L282">      updateRadioLinks();</span>
<span class="nc" id="L283">    }</span>
  };

  /** Button for further output/visualize options */
<span class="nc" id="L287">  JButton m_MoreOptions = new JButton(Messages.getInstance().getString(</span>
<span class="nc" id="L288">      &quot;ClassifierPanel_MoreOptions_JButton_Text&quot;));</span>

  /** User specified random seed for cross validation or % split */
<span class="nc" id="L291">  protected JTextField m_RandomSeedText = new JTextField(Messages.getInstance()</span>
<span class="nc" id="L292">      .getString(&quot;ClassifierPanel_RandomSeedText_JTextField_Text&quot;), 3);</span>

  /** the label for the random seed textfield */
<span class="nc" id="L295">  protected JLabel m_RandomLab = new JLabel(Messages.getInstance().getString(</span>
<span class="nc" id="L296">      &quot;ClassifierPanel_RandomLab_JLabel_Text&quot;), SwingConstants.RIGHT);</span>

  /** Whether randomization is turned off to preserve order */
<span class="nc" id="L299">  protected JCheckBox m_PreserveOrderBut = new JCheckBox(Messages.getInstance()</span>
<span class="nc" id="L300">      .getString(&quot;ClassifierPanel_PreserveOrderBut_JCheckBox_Text&quot;));</span>

  /**
   * Whether to output the source code (only for classifiers importing
   * Sourcable)
   */
<span class="nc" id="L306">  protected JCheckBox m_OutputSourceCode = new JCheckBox(Messages.getInstance()</span>
<span class="nc" id="L307">      .getString(&quot;ClassifierPanel_OutputSourceCode_JCheckBox_Text&quot;));</span>

  /** The name of the generated class (only applicable to Sourcable schemes) */
<span class="nc" id="L310">  protected JTextField m_SourceCodeClass = new JTextField(Messages</span>
<span class="nc" id="L311">      .getInstance().getString(</span>
<span class="nc" id="L312">          &quot;ClassifierPanel_SourceCodeClass_JTextField_Text&quot;), 10);</span>

  /** Click to start running the classifier */
<span class="nc" id="L315">  protected JButton m_StartBut = new JButton(Messages.getInstance().getString(</span>
<span class="nc" id="L316">      &quot;ClassifierPanel_StartBut_JButton_Text&quot;));</span>

  /** Click to stop a running classifier */
<span class="nc" id="L319">  protected JButton m_StopBut = new JButton(Messages.getInstance().getString(</span>
<span class="nc" id="L320">      &quot;ClassifierPanel_StopBut_JButton_Text&quot;));</span>

  /** Stop the class combo from taking up to much space */
<span class="nc" id="L323">  private final Dimension COMBO_SIZE = new Dimension(150,</span>
<span class="nc" id="L324">      m_StartBut.getPreferredSize().height);</span>

  /** The cost matrix editor for evaluation costs */
<span class="nc" id="L327">  protected CostMatrixEditor m_CostMatrixEditor = new CostMatrixEditor();</span>

  /** The main set of instances we're playing with */
  protected Instances m_Instances;

  /** The loader used to load the user-supplied test set (if any) */
  protected Loader m_TestLoader;

  /** A thread that classification runs in */
  protected Thread m_RunThread;

  /** The current visualization object */
<span class="nc" id="L339">  protected VisualizePanel m_CurrentVis = null;</span>

  /** Filter to ensure only model files are selected */
<span class="nc" id="L342">  protected FileFilter m_ModelFilter = new ExtensionFileFilter(</span>
<span class="nc" id="L343">      MODEL_FILE_EXTENSION, Messages.getInstance().getString(</span>
<span class="nc" id="L344">          &quot;ClassifierPanel_ModelFilter_FileFilter_Text&quot;));</span>

<span class="nc" id="L346">  protected FileFilter m_PMMLModelFilter = new ExtensionFileFilter(</span>
<span class="nc" id="L347">      PMML_FILE_EXTENSION, Messages.getInstance().getString(</span>
<span class="nc" id="L348">          &quot;ClassifierPanel_PMMLModelFilter_FileFilter_Text&quot;));</span>

  /** The file chooser for selecting model files */
<span class="nc" id="L351">  protected JFileChooser m_FileChooser = new JFileChooser(new File(</span>
<span class="nc" id="L352">      System.getProperty(&quot;user.dir&quot;)));</span>

  /* Register the property editors we need */
  static {
<span class="nc" id="L356">    GenericObjectEditor.registerEditors();</span>
  }

  /**
   * Creates the classifier panel
   */
<span class="nc" id="L362">  public ClassifierPanel() {</span>

    // Connect / configure the components
<span class="nc" id="L365">    m_OutText.setEditable(false);</span>
<span class="nc" id="L366">    m_OutText.setFont(new Font(&quot;Monospaced&quot;, Font.PLAIN, 12));</span>
<span class="nc" id="L367">    m_OutText.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
<span class="nc" id="L368">    m_OutText.addMouseListener(new MouseAdapter() {</span>
      @Override
      public void mouseClicked(MouseEvent e) {
<span class="nc bnc" id="L371" title="All 2 branches missed.">        if ((e.getModifiers() &amp; InputEvent.BUTTON1_MASK) != InputEvent.BUTTON1_MASK) {</span>
<span class="nc" id="L372">          m_OutText.selectAll();</span>
        }
<span class="nc" id="L374">      }</span>
    });
<span class="nc" id="L376">    m_History.setBorder(BorderFactory.createTitledBorder(Messages.getInstance()</span>
<span class="nc" id="L377">        .getString(</span>
<span class="nc" id="L378">            &quot;ClassifierPanel_History_BorderFactoryCreateTitledBorder_Text&quot;)));</span>
<span class="nc" id="L379">    m_ClassifierEditor.setClassType(Classifier.class);</span>
<span class="nc" id="L380">    m_ClassifierEditor.setValue(ExplorerDefaults.getClassifier());</span>
<span class="nc" id="L381">    m_ClassifierEditor.addPropertyChangeListener(new PropertyChangeListener() {</span>
      @Override
      public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L384">        m_StartBut.setEnabled(true);</span>
        // Check capabilities
<span class="nc" id="L386">        Capabilities currentFilter = m_ClassifierEditor.getCapabilitiesFilter();</span>
<span class="nc" id="L387">        Classifier classifier = (Classifier) m_ClassifierEditor.getValue();</span>
<span class="nc" id="L388">        Capabilities currentSchemeCapabilities = null;</span>
<span class="nc bnc" id="L389" title="All 4 branches missed.">        if (classifier != null &amp;&amp; currentFilter != null</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">            &amp;&amp; (classifier instanceof CapabilitiesHandler)) {</span>
<span class="nc" id="L391">          currentSchemeCapabilities = ((CapabilitiesHandler) classifier)</span>
<span class="nc" id="L392">              .getCapabilities();</span>

<span class="nc bnc" id="L394" title="All 2 branches missed.">          if (!currentSchemeCapabilities.supportsMaybe(currentFilter)</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">              &amp;&amp; !currentSchemeCapabilities.supports(currentFilter)) {</span>
<span class="nc" id="L396">            m_StartBut.setEnabled(false);</span>
          }
        }
<span class="nc" id="L399">        repaint();</span>
<span class="nc" id="L400">      }</span>
    });

<span class="nc" id="L403">    m_ClassCombo.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L404">        &quot;ClassifierPanel_ClassCombo_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L405">    m_TrainBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L406">        &quot;ClassifierPanel_TrainBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L407">    m_CVBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L408">        &quot;ClassifierPanel_CVBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L409">    m_PercentBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L410">        &quot;ClassifierPanel_PercentBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L411">    m_TestSplitBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L412">        &quot;ClassifierPanel_TestSplitBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L413">    m_StartBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L414">        &quot;ClassifierPanel_StartBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L415">    m_StopBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L416">        &quot;ClassifierPanel_StopBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L417">    m_StorePredictionsBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L418">        &quot;ClassifierPanel_StorePredictionsBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L419">    m_OutputModelBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L420">        &quot;ClassifierPanel_OutputModelBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L421">    m_OutputPerClassBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L422">        &quot;ClassifierPanel_OutputPerClassBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L423">    m_OutputConfusionBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L424">        &quot;ClassifierPanel_OutputConfusionBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L425">    m_OutputEntropyBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L426">        &quot;ClassifierPanel_OutputEntropyBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L427">    m_EvalWRTCostsBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L428">        &quot;ClassifierPanel_EvalWRTCostsBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L429">    m_OutputPredictionsTextBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L430">        &quot;ClassifierPanel_OutputPredictionsTextBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L431">    m_OutputAdditionalAttributesText</span>
<span class="nc" id="L432">        .setToolTipText(Messages</span>
<span class="nc" id="L433">            .getInstance()</span>
<span class="nc" id="L434">            .getString(</span>
<span class="nc" id="L435">                &quot;ClassifierPanel_OutputAdditionalAttributesText_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L436">    m_RandomLab.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L437">        &quot;ClassifierPanel_RandomLab_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L438">    m_RandomSeedText.setToolTipText(m_RandomLab.getToolTipText());</span>
<span class="nc" id="L439">    m_PreserveOrderBut.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L440">        &quot;ClassifierPanel_PreserveOrderBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L441">    m_OutputSourceCode.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L442">        &quot;ClassifierPanel_OutputSourceCode_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L443">    m_SourceCodeClass.setToolTipText(Messages.getInstance().getString(</span>
<span class="nc" id="L444">        &quot;ClassifierPanel_SourceCodeClass_SetToolTipText_Text&quot;));</span>

<span class="nc" id="L446">    m_FileChooser.addChoosableFileFilter(m_PMMLModelFilter);</span>
<span class="nc" id="L447">    m_FileChooser.setFileFilter(m_ModelFilter);</span>

<span class="nc" id="L449">    m_FileChooser.setFileSelectionMode(JFileChooser.FILES_ONLY);</span>

<span class="nc" id="L451">    m_StorePredictionsBut.setSelected(ExplorerDefaults</span>
<span class="nc" id="L452">        .getClassifierStorePredictionsForVis());</span>
<span class="nc" id="L453">    m_OutputModelBut.setSelected(ExplorerDefaults.getClassifierOutputModel());</span>
<span class="nc" id="L454">    m_OutputPerClassBut.setSelected(ExplorerDefaults</span>
<span class="nc" id="L455">        .getClassifierOutputPerClassStats());</span>
<span class="nc" id="L456">    m_OutputConfusionBut.setSelected(ExplorerDefaults</span>
<span class="nc" id="L457">        .getClassifierOutputConfusionMatrix());</span>
<span class="nc" id="L458">    m_EvalWRTCostsBut.setSelected(ExplorerDefaults</span>
<span class="nc" id="L459">        .getClassifierCostSensitiveEval());</span>
<span class="nc" id="L460">    m_OutputEntropyBut.setSelected(ExplorerDefaults</span>
<span class="nc" id="L461">        .getClassifierOutputEntropyEvalMeasures());</span>
<span class="nc" id="L462">    m_OutputPredictionsTextBut.setSelected(ExplorerDefaults</span>
<span class="nc" id="L463">        .getClassifierOutputPredictions());</span>
<span class="nc" id="L464">    m_OutputPredictionsTextBut.addActionListener(new ActionListener() {</span>
      @Override
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L467">        m_OutputAdditionalAttributesText.setEnabled(m_OutputPredictionsTextBut</span>
<span class="nc" id="L468">            .isSelected());</span>
<span class="nc" id="L469">      }</span>
    });
<span class="nc" id="L471">    m_OutputAdditionalAttributesText.setText(ExplorerDefaults</span>
<span class="nc" id="L472">        .getClassifierOutputAdditionalAttributes());</span>
<span class="nc" id="L473">    m_OutputAdditionalAttributesText.setEnabled(m_OutputPredictionsTextBut</span>
<span class="nc" id="L474">        .isSelected());</span>
<span class="nc" id="L475">    m_RandomSeedText.setText(&quot;&quot; + ExplorerDefaults.getClassifierRandomSeed());</span>
<span class="nc" id="L476">    m_PreserveOrderBut.setSelected(ExplorerDefaults</span>
<span class="nc" id="L477">        .getClassifierPreserveOrder());</span>
<span class="nc" id="L478">    m_OutputSourceCode.addActionListener(new ActionListener() {</span>
      @Override
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L481">        m_SourceCodeClass.setEnabled(m_OutputSourceCode.isSelected());</span>
<span class="nc" id="L482">      }</span>
    });
<span class="nc" id="L484">    m_OutputSourceCode.setSelected(ExplorerDefaults</span>
<span class="nc" id="L485">        .getClassifierOutputSourceCode());</span>
<span class="nc" id="L486">    m_SourceCodeClass.setText(ExplorerDefaults.getClassifierSourceCodeClass());</span>
<span class="nc" id="L487">    m_SourceCodeClass.setEnabled(m_OutputSourceCode.isSelected());</span>
<span class="nc" id="L488">    m_ClassCombo.setEnabled(false);</span>
<span class="nc" id="L489">    m_ClassCombo.setPreferredSize(COMBO_SIZE);</span>
<span class="nc" id="L490">    m_ClassCombo.setMaximumSize(COMBO_SIZE);</span>
<span class="nc" id="L491">    m_ClassCombo.setMinimumSize(COMBO_SIZE);</span>

<span class="nc" id="L493">    m_CVBut.setSelected(true);</span>
    // see &quot;testMode&quot; variable in startClassifier
<span class="nc bnc" id="L495" title="All 2 branches missed.">    m_CVBut.setSelected(ExplorerDefaults.getClassifierTestMode() == 1);</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">    m_PercentBut.setSelected(ExplorerDefaults.getClassifierTestMode() == 2);</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">    m_TrainBut.setSelected(ExplorerDefaults.getClassifierTestMode() == 3);</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">    m_TestSplitBut.setSelected(ExplorerDefaults.getClassifierTestMode() == 4);</span>
<span class="nc" id="L499">    m_PercentText.setText(&quot;&quot; + ExplorerDefaults.getClassifierPercentageSplit());</span>
<span class="nc" id="L500">    m_CVText.setText(&quot;&quot; + ExplorerDefaults.getClassifierCrossvalidationFolds());</span>
<span class="nc" id="L501">    updateRadioLinks();</span>
<span class="nc" id="L502">    ButtonGroup bg = new ButtonGroup();</span>
<span class="nc" id="L503">    bg.add(m_TrainBut);</span>
<span class="nc" id="L504">    bg.add(m_CVBut);</span>
<span class="nc" id="L505">    bg.add(m_PercentBut);</span>
<span class="nc" id="L506">    bg.add(m_TestSplitBut);</span>
<span class="nc" id="L507">    m_TrainBut.addActionListener(m_RadioListener);</span>
<span class="nc" id="L508">    m_CVBut.addActionListener(m_RadioListener);</span>
<span class="nc" id="L509">    m_PercentBut.addActionListener(m_RadioListener);</span>
<span class="nc" id="L510">    m_TestSplitBut.addActionListener(m_RadioListener);</span>
<span class="nc" id="L511">    m_SetTestBut.addActionListener(new ActionListener() {</span>
      @Override
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L514">        setTestSet();</span>
<span class="nc" id="L515">      }</span>
    });
<span class="nc" id="L517">    m_EvalWRTCostsBut.addActionListener(new ActionListener() {</span>
      @Override
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L520">        m_SetCostsBut.setEnabled(m_EvalWRTCostsBut.isSelected());</span>
<span class="nc bnc" id="L521" title="All 4 branches missed.">        if ((m_SetCostsFrame != null) &amp;&amp; (!m_EvalWRTCostsBut.isSelected())) {</span>
<span class="nc" id="L522">          m_SetCostsFrame.setVisible(false);</span>
        }
<span class="nc" id="L524">      }</span>
    });
<span class="nc" id="L526">    m_CostMatrixEditor.setValue(new CostMatrix(1));</span>
<span class="nc" id="L527">    m_SetCostsBut.setEnabled(m_EvalWRTCostsBut.isSelected());</span>
<span class="nc" id="L528">    m_SetCostsBut.addActionListener(new ActionListener() {</span>
      @Override
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L531">        m_SetCostsBut.setEnabled(false);</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">        if (m_SetCostsFrame == null) {</span>
<span class="nc bnc" id="L533" title="All 2 branches missed.">          if (PropertyDialog.getParentDialog(ClassifierPanel.this) != null)</span>
<span class="nc" id="L534">            m_SetCostsFrame = new PropertyDialog(PropertyDialog</span>
<span class="nc" id="L535">                .getParentDialog(ClassifierPanel.this), m_CostMatrixEditor,</span>
<span class="nc" id="L536">                100, 100);</span>
          else
<span class="nc" id="L538">            m_SetCostsFrame = new PropertyDialog(PropertyDialog</span>
<span class="nc" id="L539">                .getParentFrame(ClassifierPanel.this), m_CostMatrixEditor, 100,</span>
<span class="nc" id="L540">                100);</span>
<span class="nc" id="L541">          m_SetCostsFrame.setTitle(Messages.getInstance().getString(</span>
<span class="nc" id="L542">              &quot;ClassifierPanel_SetCostsFrame_SetTitle_Text&quot;));</span>
          // pd.setSize(250,150);
<span class="nc" id="L544">          m_SetCostsFrame.addWindowListener(new java.awt.event.WindowAdapter() {</span>
            @Override
            public void windowClosing(java.awt.event.WindowEvent p) {
<span class="nc" id="L547">              m_SetCostsBut.setEnabled(m_EvalWRTCostsBut.isSelected());</span>
<span class="nc bnc" id="L548" title="All 2 branches missed.">              if ((m_SetCostsFrame != null)</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">                  &amp;&amp; (!m_EvalWRTCostsBut.isSelected())) {</span>
<span class="nc" id="L550">                m_SetCostsFrame.setVisible(false);</span>
              }
<span class="nc" id="L552">            }</span>
          });
<span class="nc" id="L554">          m_SetCostsFrame.setVisible(true);</span>
        }

        // do we need to change the size of the matrix?
<span class="nc" id="L558">        int classIndex = m_ClassCombo.getSelectedIndex();</span>
<span class="nc" id="L559">        int numClasses = m_Instances.attribute(classIndex).numValues();</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">        if (numClasses != ((CostMatrix) m_CostMatrixEditor.getValue())</span>
<span class="nc" id="L561">            .numColumns())</span>
<span class="nc" id="L562">          m_CostMatrixEditor.setValue(new CostMatrix(numClasses));</span>

<span class="nc" id="L564">        m_SetCostsFrame.setVisible(true);</span>
<span class="nc" id="L565">      }</span>
    });

<span class="nc" id="L568">    m_StartBut.setEnabled(false);</span>
<span class="nc" id="L569">    m_StopBut.setEnabled(false);</span>
<span class="nc" id="L570">    m_StartBut.addActionListener(new ActionListener() {</span>
      @Override
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L573">        boolean proceed = true;</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">        if (Explorer.m_Memory.memoryIsLow()) {</span>
<span class="nc" id="L575">          proceed = Explorer.m_Memory.showMemoryIsLow();</span>
        }

<span class="nc bnc" id="L578" title="All 2 branches missed.">        if (proceed) {</span>
<span class="nc" id="L579">          startClassifier();</span>
        }
<span class="nc" id="L581">      }</span>
    });
<span class="nc" id="L583">    m_StopBut.addActionListener(new ActionListener() {</span>
      @Override
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L586">        stopClassifier();</span>
<span class="nc" id="L587">      }</span>
    });

<span class="nc" id="L590">    m_ClassCombo.addActionListener(new ActionListener() {</span>
      @Override
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L593">        int selected = m_ClassCombo.getSelectedIndex();</span>
<span class="nc bnc" id="L594" title="All 2 branches missed.">        if (selected != -1) {</span>
<span class="nc" id="L595">          boolean isNominal = m_Instances.attribute(selected).isNominal();</span>
<span class="nc" id="L596">          m_OutputPerClassBut.setEnabled(isNominal);</span>
<span class="nc" id="L597">          m_OutputConfusionBut.setEnabled(isNominal);</span>
        }
<span class="nc" id="L599">        updateCapabilitiesFilter(m_ClassifierEditor.getCapabilitiesFilter());</span>
<span class="nc" id="L600">      }</span>
    });

<span class="nc" id="L603">    m_History.setHandleRightClicks(false);</span>
    // see if we can popup a menu for the selected result
<span class="nc" id="L605">    m_History.getList().addMouseListener(new MouseAdapter() {</span>
      @Override
      public void mouseClicked(MouseEvent e) {
<span class="nc bnc" id="L608" title="All 2 branches missed.">        if (((e.getModifiers() &amp; InputEvent.BUTTON1_MASK) != InputEvent.BUTTON1_MASK)</span>
<span class="nc bnc" id="L609" title="All 2 branches missed.">            || e.isAltDown()) {</span>
<span class="nc" id="L610">          int index = m_History.getList().locationToIndex(e.getPoint());</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">          if (index != -1) {</span>
<span class="nc" id="L612">            String name = m_History.getNameAtIndex(index);</span>
<span class="nc" id="L613">            visualize(name, e.getX(), e.getY());</span>
          } else {
<span class="nc" id="L615">            visualize(null, e.getX(), e.getY());</span>
          }
        }
<span class="nc" id="L618">      }</span>
    });

<span class="nc" id="L621">    m_MoreOptions.addActionListener(new ActionListener() {</span>
      @Override
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L624">        m_MoreOptions.setEnabled(false);</span>
<span class="nc" id="L625">        JPanel moreOptionsPanel = new JPanel();</span>
<span class="nc" id="L626">        moreOptionsPanel.setBorder(BorderFactory.createEmptyBorder(0, 5, 5, 5));</span>
<span class="nc" id="L627">        moreOptionsPanel.setLayout(new GridLayout(11, 1));</span>
<span class="nc" id="L628">        moreOptionsPanel.add(m_OutputModelBut);</span>
<span class="nc" id="L629">        moreOptionsPanel.add(m_OutputPerClassBut);</span>
<span class="nc" id="L630">        moreOptionsPanel.add(m_OutputEntropyBut);</span>
<span class="nc" id="L631">        moreOptionsPanel.add(m_OutputConfusionBut);</span>
<span class="nc" id="L632">        moreOptionsPanel.add(m_StorePredictionsBut);</span>
<span class="nc" id="L633">        moreOptionsPanel.add(m_OutputPredictionsTextBut);</span>
<span class="nc" id="L634">        JPanel additionalAttsPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));</span>
<span class="nc" id="L635">        additionalAttsPanel.add(m_OutputAdditionalAttributesLab);</span>
<span class="nc" id="L636">        additionalAttsPanel.add(m_OutputAdditionalAttributesText);</span>
<span class="nc" id="L637">        moreOptionsPanel.add(additionalAttsPanel);</span>
<span class="nc" id="L638">        JPanel costMatrixOption = new JPanel(new FlowLayout(FlowLayout.LEFT));</span>
<span class="nc" id="L639">        costMatrixOption.add(m_EvalWRTCostsBut);</span>
<span class="nc" id="L640">        costMatrixOption.add(m_SetCostsBut);</span>
<span class="nc" id="L641">        moreOptionsPanel.add(costMatrixOption);</span>
<span class="nc" id="L642">        JPanel seedPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));</span>
<span class="nc" id="L643">        seedPanel.add(m_RandomLab);</span>
<span class="nc" id="L644">        seedPanel.add(m_RandomSeedText);</span>
<span class="nc" id="L645">        moreOptionsPanel.add(seedPanel);</span>
<span class="nc" id="L646">        moreOptionsPanel.add(m_PreserveOrderBut);</span>
<span class="nc" id="L647">        JPanel sourcePanel = new JPanel(new FlowLayout(FlowLayout.LEFT));</span>
<span class="nc" id="L648">        m_OutputSourceCode.setEnabled(m_ClassifierEditor.getValue() instanceof Sourcable);</span>
<span class="nc bnc" id="L649" title="All 2 branches missed.">        m_SourceCodeClass.setEnabled(m_OutputSourceCode.isEnabled()</span>
<span class="nc bnc" id="L650" title="All 2 branches missed.">            &amp;&amp; m_OutputSourceCode.isSelected());</span>
<span class="nc" id="L651">        sourcePanel.add(m_OutputSourceCode);</span>
<span class="nc" id="L652">        sourcePanel.add(m_SourceCodeClass);</span>
<span class="nc" id="L653">        moreOptionsPanel.add(sourcePanel);</span>

<span class="nc" id="L655">        JPanel all = new JPanel();</span>
<span class="nc" id="L656">        all.setLayout(new BorderLayout());</span>

<span class="nc" id="L658">        JButton oK = new JButton(Messages.getInstance().getString(</span>
<span class="nc" id="L659">            &quot;ClassifierPanel_OK_JButton_Text&quot;));</span>
<span class="nc" id="L660">        JPanel okP = new JPanel();</span>
<span class="nc" id="L661">        okP.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
<span class="nc" id="L662">        okP.setLayout(new GridLayout(1, 1, 5, 5));</span>
<span class="nc" id="L663">        okP.add(oK);</span>

<span class="nc" id="L665">        all.add(moreOptionsPanel, BorderLayout.CENTER);</span>
<span class="nc" id="L666">        all.add(okP, BorderLayout.SOUTH);</span>

<span class="nc" id="L668">        final JDialog jd = new JDialog(PropertyDialog</span>
<span class="nc" id="L669">            .getParentFrame(ClassifierPanel.this), Messages.getInstance()</span>
<span class="nc" id="L670">            .getString(&quot;ClassifierPanel_JD_JDialog_Text&quot;));</span>
<span class="nc" id="L671">        jd.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L672">        jd.getContentPane().add(all, BorderLayout.CENTER);</span>
<span class="nc" id="L673">        jd.addWindowListener(new java.awt.event.WindowAdapter() {</span>
          @Override
          public void windowClosing(java.awt.event.WindowEvent w) {
<span class="nc" id="L676">            jd.dispose();</span>
<span class="nc" id="L677">            m_MoreOptions.setEnabled(true);</span>
<span class="nc" id="L678">          }</span>
        });
<span class="nc" id="L680">        oK.addActionListener(new ActionListener() {</span>
          @Override
          public void actionPerformed(ActionEvent a) {
<span class="nc" id="L683">            m_MoreOptions.setEnabled(true);</span>
<span class="nc" id="L684">            jd.dispose();</span>
<span class="nc" id="L685">          }</span>
        });
<span class="nc" id="L687">        jd.pack();</span>
<span class="nc" id="L688">        jd.setLocation(m_MoreOptions.getLocationOnScreen());</span>
<span class="nc" id="L689">        jd.setVisible(true);</span>
<span class="nc" id="L690">      }</span>
    });

    // Layout the GUI
<span class="nc" id="L694">    JPanel p1 = new JPanel();</span>
<span class="nc" id="L695">    p1.setBorder(BorderFactory.createCompoundBorder(</span>
<span class="nc" id="L696">        BorderFactory.createTitledBorder(Messages.getInstance().getString(</span>
<span class="nc" id="L697">            &quot;ClassifierPanel_P1_JPanel_BorderFactoryCreateTitledBorder_Text&quot;)),</span>
<span class="nc" id="L698">        BorderFactory.createEmptyBorder(0, 5, 5, 5)));</span>
<span class="nc" id="L699">    p1.setLayout(new BorderLayout());</span>
<span class="nc" id="L700">    p1.add(m_CEPanel, BorderLayout.NORTH);</span>

<span class="nc" id="L702">    JPanel p2 = new JPanel();</span>
<span class="nc" id="L703">    GridBagLayout gbL = new GridBagLayout();</span>
<span class="nc" id="L704">    p2.setLayout(gbL);</span>
<span class="nc" id="L705">    p2.setBorder(BorderFactory.createCompoundBorder(</span>
<span class="nc" id="L706">        BorderFactory.createTitledBorder(Messages.getInstance().getString(</span>
<span class="nc" id="L707">            &quot;ClassifierPanel_P2_JPanel_BorderFactoryCreateTitledBorder_Text&quot;)),</span>
<span class="nc" id="L708">        BorderFactory.createEmptyBorder(0, 5, 5, 5)));</span>
<span class="nc" id="L709">    GridBagConstraints gbC = new GridBagConstraints();</span>
<span class="nc" id="L710">    gbC.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L711">    gbC.gridy = 0;</span>
<span class="nc" id="L712">    gbC.gridx = 0;</span>
<span class="nc" id="L713">    gbL.setConstraints(m_TrainBut, gbC);</span>
<span class="nc" id="L714">    p2.add(m_TrainBut);</span>

<span class="nc" id="L716">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L717">    gbC.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L718">    gbC.gridy = 1;</span>
<span class="nc" id="L719">    gbC.gridx = 0;</span>
<span class="nc" id="L720">    gbL.setConstraints(m_TestSplitBut, gbC);</span>
<span class="nc" id="L721">    p2.add(m_TestSplitBut);</span>

<span class="nc" id="L723">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L724">    gbC.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L725">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L726">    gbC.gridy = 1;</span>
<span class="nc" id="L727">    gbC.gridx = 1;</span>
<span class="nc" id="L728">    gbC.gridwidth = 2;</span>
<span class="nc" id="L729">    gbC.insets = new Insets(2, 10, 2, 0);</span>
<span class="nc" id="L730">    gbL.setConstraints(m_SetTestBut, gbC);</span>
<span class="nc" id="L731">    p2.add(m_SetTestBut);</span>

<span class="nc" id="L733">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L734">    gbC.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L735">    gbC.gridy = 2;</span>
<span class="nc" id="L736">    gbC.gridx = 0;</span>
<span class="nc" id="L737">    gbL.setConstraints(m_CVBut, gbC);</span>
<span class="nc" id="L738">    p2.add(m_CVBut);</span>

<span class="nc" id="L740">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L741">    gbC.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L742">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L743">    gbC.gridy = 2;</span>
<span class="nc" id="L744">    gbC.gridx = 1;</span>
<span class="nc" id="L745">    gbC.insets = new Insets(2, 10, 2, 10);</span>
<span class="nc" id="L746">    gbL.setConstraints(m_CVLab, gbC);</span>
<span class="nc" id="L747">    p2.add(m_CVLab);</span>

<span class="nc" id="L749">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L750">    gbC.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L751">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L752">    gbC.gridy = 2;</span>
<span class="nc" id="L753">    gbC.gridx = 2;</span>
<span class="nc" id="L754">    gbC.weightx = 100;</span>
<span class="nc" id="L755">    gbC.ipadx = 20;</span>
<span class="nc" id="L756">    gbL.setConstraints(m_CVText, gbC);</span>
<span class="nc" id="L757">    p2.add(m_CVText);</span>

<span class="nc" id="L759">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L760">    gbC.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L761">    gbC.gridy = 3;</span>
<span class="nc" id="L762">    gbC.gridx = 0;</span>
<span class="nc" id="L763">    gbL.setConstraints(m_PercentBut, gbC);</span>
<span class="nc" id="L764">    p2.add(m_PercentBut);</span>

<span class="nc" id="L766">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L767">    gbC.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L768">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L769">    gbC.gridy = 3;</span>
<span class="nc" id="L770">    gbC.gridx = 1;</span>
<span class="nc" id="L771">    gbC.insets = new Insets(2, 10, 2, 10);</span>
<span class="nc" id="L772">    gbL.setConstraints(m_PercentLab, gbC);</span>
<span class="nc" id="L773">    p2.add(m_PercentLab);</span>

<span class="nc" id="L775">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L776">    gbC.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L777">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L778">    gbC.gridy = 3;</span>
<span class="nc" id="L779">    gbC.gridx = 2;</span>
<span class="nc" id="L780">    gbC.weightx = 100;</span>
<span class="nc" id="L781">    gbC.ipadx = 20;</span>
<span class="nc" id="L782">    gbL.setConstraints(m_PercentText, gbC);</span>
<span class="nc" id="L783">    p2.add(m_PercentText);</span>

<span class="nc" id="L785">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L786">    gbC.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L787">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L788">    gbC.gridy = 4;</span>
<span class="nc" id="L789">    gbC.gridx = 0;</span>
<span class="nc" id="L790">    gbC.weightx = 100;</span>
<span class="nc" id="L791">    gbC.gridwidth = 3;</span>

<span class="nc" id="L793">    gbC.insets = new Insets(3, 0, 1, 0);</span>
<span class="nc" id="L794">    gbL.setConstraints(m_MoreOptions, gbC);</span>
<span class="nc" id="L795">    p2.add(m_MoreOptions);</span>

<span class="nc" id="L797">    JPanel buttons = new JPanel();</span>
<span class="nc" id="L798">    buttons.setLayout(new GridLayout(2, 2));</span>
<span class="nc" id="L799">    buttons.add(m_ClassCombo);</span>
<span class="nc" id="L800">    m_ClassCombo.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
<span class="nc" id="L801">    JPanel ssButs = new JPanel();</span>
<span class="nc" id="L802">    ssButs.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
<span class="nc" id="L803">    ssButs.setLayout(new GridLayout(1, 2, 5, 5));</span>
<span class="nc" id="L804">    ssButs.add(m_StartBut);</span>
<span class="nc" id="L805">    ssButs.add(m_StopBut);</span>

<span class="nc" id="L807">    buttons.add(ssButs);</span>

<span class="nc" id="L809">    JPanel p3 = new JPanel();</span>
<span class="nc" id="L810">    p3.setBorder(BorderFactory.createTitledBorder(Messages.getInstance()</span>
<span class="nc" id="L811">        .getString(</span>
<span class="nc" id="L812">            &quot;ClassifierPanel_P3_JPanel_BorderFactoryCreateTitledBorder_Text&quot;)));</span>
<span class="nc" id="L813">    p3.setLayout(new BorderLayout());</span>
<span class="nc" id="L814">    final JScrollPane js = new JScrollPane(m_OutText);</span>
<span class="nc" id="L815">    p3.add(js, BorderLayout.CENTER);</span>
<span class="nc" id="L816">    js.getViewport().addChangeListener(new ChangeListener() {</span>
      private int lastHeight;

      @Override
      public void stateChanged(ChangeEvent e) {
<span class="nc" id="L821">        JViewport vp = (JViewport) e.getSource();</span>
<span class="nc" id="L822">        int h = vp.getViewSize().height;</span>
<span class="nc bnc" id="L823" title="All 2 branches missed.">        if (h != lastHeight) { // i.e. an addition not just a user scrolling</span>
<span class="nc" id="L824">          lastHeight = h;</span>
<span class="nc" id="L825">          int x = h - vp.getExtentSize().height;</span>
<span class="nc" id="L826">          vp.setViewPosition(new Point(0, x));</span>
        }
<span class="nc" id="L828">      }</span>
    });

<span class="nc" id="L831">    JPanel mondo = new JPanel();</span>
<span class="nc" id="L832">    gbL = new GridBagLayout();</span>
<span class="nc" id="L833">    mondo.setLayout(gbL);</span>
<span class="nc" id="L834">    gbC = new GridBagConstraints();</span>
    // gbC.anchor = GridBagConstraints.WEST;
<span class="nc" id="L836">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L837">    gbC.gridy = 0;</span>
<span class="nc" id="L838">    gbC.gridx = 0;</span>
<span class="nc" id="L839">    gbL.setConstraints(p2, gbC);</span>
<span class="nc" id="L840">    mondo.add(p2);</span>
<span class="nc" id="L841">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L842">    gbC.anchor = GridBagConstraints.NORTH;</span>
<span class="nc" id="L843">    gbC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L844">    gbC.gridy = 1;</span>
<span class="nc" id="L845">    gbC.gridx = 0;</span>
<span class="nc" id="L846">    gbL.setConstraints(buttons, gbC);</span>
<span class="nc" id="L847">    mondo.add(buttons);</span>
<span class="nc" id="L848">    gbC = new GridBagConstraints();</span>
    // gbC.anchor = GridBagConstraints.NORTH;
<span class="nc" id="L850">    gbC.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L851">    gbC.gridy = 2;</span>
<span class="nc" id="L852">    gbC.gridx = 0;</span>
<span class="nc" id="L853">    gbC.weightx = 0;</span>
<span class="nc" id="L854">    gbL.setConstraints(m_History, gbC);</span>
<span class="nc" id="L855">    mondo.add(m_History);</span>
<span class="nc" id="L856">    gbC = new GridBagConstraints();</span>
<span class="nc" id="L857">    gbC.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L858">    gbC.gridy = 0;</span>
<span class="nc" id="L859">    gbC.gridx = 1;</span>
<span class="nc" id="L860">    gbC.gridheight = 3;</span>
<span class="nc" id="L861">    gbC.weightx = 100;</span>
<span class="nc" id="L862">    gbC.weighty = 100;</span>
<span class="nc" id="L863">    gbL.setConstraints(p3, gbC);</span>
<span class="nc" id="L864">    mondo.add(p3);</span>

<span class="nc" id="L866">    setLayout(new BorderLayout());</span>
<span class="nc" id="L867">    add(p1, BorderLayout.NORTH);</span>
<span class="nc" id="L868">    add(mondo, BorderLayout.CENTER);</span>
<span class="nc" id="L869">  }</span>

  /**
   * Updates the enabled status of the input fields and labels.
   */
  protected void updateRadioLinks() {

<span class="nc" id="L876">    m_SetTestBut.setEnabled(m_TestSplitBut.isSelected());</span>
<span class="nc bnc" id="L877" title="All 4 branches missed.">    if ((m_SetTestFrame != null) &amp;&amp; (!m_TestSplitBut.isSelected())) {</span>
<span class="nc" id="L878">      m_SetTestFrame.setVisible(false);</span>
    }
<span class="nc" id="L880">    m_CVText.setEnabled(m_CVBut.isSelected());</span>
<span class="nc" id="L881">    m_CVLab.setEnabled(m_CVBut.isSelected());</span>
<span class="nc" id="L882">    m_PercentText.setEnabled(m_PercentBut.isSelected());</span>
<span class="nc" id="L883">    m_PercentLab.setEnabled(m_PercentBut.isSelected());</span>
<span class="nc" id="L884">  }</span>

  /**
   * Sets the Logger to receive informational messages
   * 
   * @param newLog the Logger that will now get info messages
   */
  @Override
  public void setLog(Logger newLog) {

<span class="nc" id="L894">    m_Log = newLog;</span>
<span class="nc" id="L895">  }</span>

  /**
   * Tells the panel to use a new set of instances.
   * 
   * @param inst a set of Instances
   */
  @Override
  public void setInstances(Instances inst) {
<span class="nc" id="L904">    m_Instances = inst;</span>

<span class="nc" id="L906">    String[] attribNames = new String[m_Instances.numAttributes()];</span>
<span class="nc bnc" id="L907" title="All 2 branches missed.">    for (int i = 0; i &lt; attribNames.length; i++) {</span>
<span class="nc" id="L908">      String type = &quot;&quot;;</span>
<span class="nc bnc" id="L909" title="All 6 branches missed.">      switch (m_Instances.attribute(i).type()) {</span>
      case Attribute.NOMINAL:
<span class="nc" id="L911">        type = Messages.getInstance().getString(</span>
<span class="nc" id="L912">            &quot;ClassifierPanel_SetInstances_Type_AttributeNOMINAL_Text&quot;);</span>
<span class="nc" id="L913">        break;</span>
      case Attribute.NUMERIC:
<span class="nc" id="L915">        type = Messages.getInstance().getString(</span>
<span class="nc" id="L916">            &quot;ClassifierPanel_SetInstances_Type_AttributeNUMERIC_Text&quot;);</span>
<span class="nc" id="L917">        break;</span>
      case Attribute.STRING:
<span class="nc" id="L919">        type = Messages.getInstance().getString(</span>
<span class="nc" id="L920">            &quot;ClassifierPanel_SetInstances_Type_AttributeSTRING_Text&quot;);</span>
<span class="nc" id="L921">        break;</span>
      case Attribute.DATE:
<span class="nc" id="L923">        type = Messages.getInstance().getString(</span>
<span class="nc" id="L924">            &quot;ClassifierPanel_SetInstances_Type_AttributeDATE_Text&quot;);</span>
<span class="nc" id="L925">        break;</span>
      case Attribute.RELATIONAL:
<span class="nc" id="L927">        type = Messages.getInstance().getString(</span>
<span class="nc" id="L928">            &quot;ClassifierPanel_SetInstances_Type_AttributeRELATIONAL_Text&quot;);</span>
<span class="nc" id="L929">        break;</span>
      default:
<span class="nc" id="L931">        type = Messages.getInstance().getString(</span>
<span class="nc" id="L932">            &quot;ClassifierPanel_SetInstances_Type_AttributeDEFAULT_Text&quot;);</span>
      }
<span class="nc" id="L934">      attribNames[i] = type + m_Instances.attribute(i).name();</span>
    }
<span class="nc" id="L936">    m_ClassCombo.setModel(new DefaultComboBoxModel(attribNames));</span>
<span class="nc bnc" id="L937" title="All 2 branches missed.">    if (attribNames.length &gt; 0) {</span>
<span class="nc bnc" id="L938" title="All 2 branches missed.">      if (inst.classIndex() == -1)</span>
<span class="nc" id="L939">        m_ClassCombo.setSelectedIndex(attribNames.length - 1);</span>
      else
<span class="nc" id="L941">        m_ClassCombo.setSelectedIndex(inst.classIndex());</span>
<span class="nc" id="L942">      m_ClassCombo.setEnabled(true);</span>
<span class="nc bnc" id="L943" title="All 2 branches missed.">      m_StartBut.setEnabled(m_RunThread == null);</span>
<span class="nc bnc" id="L944" title="All 2 branches missed.">      m_StopBut.setEnabled(m_RunThread != null);</span>
    } else {
<span class="nc" id="L946">      m_StartBut.setEnabled(false);</span>
<span class="nc" id="L947">      m_StopBut.setEnabled(false);</span>
    }
<span class="nc" id="L949">  }</span>

  /**
   * Sets the user test set. Information about the current test set is displayed
   * in an InstanceSummaryPanel and the user is given the ability to load
   * another set from a file or url.
   * 
   */
  protected void setTestSet() {

<span class="nc bnc" id="L959" title="All 2 branches missed.">    if (m_SetTestFrame == null) {</span>
<span class="nc" id="L960">      final SetInstancesPanel sp = new SetInstancesPanel(true,</span>
<span class="nc" id="L961">          m_Explorer.getPreprocessPanel().m_FileChooser);</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">      if (m_TestLoader != null) {</span>
        try {
<span class="nc bnc" id="L964" title="All 2 branches missed.">          if (m_TestLoader.getStructure() != null)</span>
<span class="nc" id="L965">            sp.setInstances(m_TestLoader.getStructure());</span>
<span class="nc" id="L966">        } catch (Exception ex) {</span>
<span class="nc" id="L967">          ex.printStackTrace();</span>
        }
      }
<span class="nc" id="L970">      sp.addPropertyChangeListener(new PropertyChangeListener() {</span>
        @Override
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L973">          m_TestLoader = sp.getLoader();</span>
<span class="nc" id="L974">        }</span>
      });
      // Add propertychangelistener to update m_TestLoader whenever
      // it changes in the settestframe
<span class="nc" id="L978">      m_SetTestFrame = new JFrame(Messages.getInstance().getString(</span>
<span class="nc" id="L979">          &quot;ClassifierPanel_SetTestSet_SetTestFrame_JFrame_Text&quot;));</span>
<span class="nc" id="L980">      sp.setParentFrame(m_SetTestFrame); // enable Close-Button</span>
<span class="nc" id="L981">      m_SetTestFrame.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L982">      m_SetTestFrame.getContentPane().add(sp, BorderLayout.CENTER);</span>
<span class="nc" id="L983">      m_SetTestFrame.pack();</span>
    }
<span class="nc" id="L985">    m_SetTestFrame.setVisible(true);</span>
<span class="nc" id="L986">  }</span>

  /**
   * Process a classifier's prediction for an instance and update a set of
   * plotting instances and additional plotting info. plotInfo for nominal class
   * datasets holds shape types (actual data points have automatic shape type
   * assignment; classifier error data points have box shape type). For numeric
   * class datasets, the actual data points are stored in plotInstances and
   * plotInfo stores the error (which is later converted to shape size values)
   * 
   * @param toPredict the actual data point
   * @param classifier the classifier
   * @param eval the evaluation object to use for evaluating the classifier on
   *          the instance to predict
   * @param plotInstances a set of plottable instances
   * @param plotShape additional plotting information (shape)
   * @param plotSize additional plotting information (size)
   */
  public static void processClassifierPrediction(Instance toPredict,
      Classifier classifier, Evaluation eval, Instances plotInstances,
      FastVector plotShape, FastVector plotSize) {
    try {
<span class="nc" id="L1008">      double pred = eval.evaluateModelOnceAndRecordPrediction(classifier,</span>
<span class="nc" id="L1009">          toPredict);</span>

<span class="nc bnc" id="L1011" title="All 2 branches missed.">      if (plotInstances != null) {</span>
<span class="nc" id="L1012">        double[] values = new double[plotInstances.numAttributes()];</span>
<span class="nc bnc" id="L1013" title="All 2 branches missed.">        for (int i = 0; i &lt; plotInstances.numAttributes(); i++) {</span>
<span class="nc bnc" id="L1014" title="All 2 branches missed.">          if (i &lt; toPredict.classIndex()) {</span>
<span class="nc" id="L1015">            values[i] = toPredict.value(i);</span>
<span class="nc bnc" id="L1016" title="All 2 branches missed.">          } else if (i == toPredict.classIndex()) {</span>
<span class="nc" id="L1017">            values[i] = pred;</span>
<span class="nc" id="L1018">            values[i + 1] = toPredict.value(i);</span>
            /*
             * // if the class value of the instances to predict is missing then
             * // set it to the predicted value if (toPredict.isMissing(i)) {
             * values[i+1] = pred; }
             */
<span class="nc" id="L1024">            i++;</span>
          } else {
<span class="nc" id="L1026">            values[i] = toPredict.value(i - 1);</span>
          }
        }

<span class="nc" id="L1030">        plotInstances.add(new Instance(1.0, values));</span>
<span class="nc bnc" id="L1031" title="All 2 branches missed.">        if (toPredict.classAttribute().isNominal()) {</span>
<span class="nc bnc" id="L1032" title="All 2 branches missed.">          if (toPredict.isMissing(toPredict.classIndex())</span>
<span class="nc bnc" id="L1033" title="All 2 branches missed.">              || Instance.isMissingValue(pred)) {</span>
<span class="nc" id="L1034">            plotShape.addElement(new Integer(Plot2D.MISSING_SHAPE));</span>
<span class="nc bnc" id="L1035" title="All 2 branches missed.">          } else if (pred != toPredict.classValue()) {</span>
            // set to default error point shape
<span class="nc" id="L1037">            plotShape.addElement(new Integer(Plot2D.ERROR_SHAPE));</span>
          } else {
            // otherwise set to constant (automatically assigned) point shape
<span class="nc" id="L1040">            plotShape.addElement(new Integer(Plot2D.CONST_AUTOMATIC_SHAPE));</span>
          }
<span class="nc" id="L1042">          plotSize.addElement(new Integer(Plot2D.DEFAULT_SHAPE_SIZE));</span>
        } else {
          // store the error (to be converted to a point size later)
<span class="nc" id="L1045">          Double errd = null;</span>
<span class="nc bnc" id="L1046" title="All 2 branches missed.">          if (!toPredict.isMissing(toPredict.classIndex())</span>
<span class="nc bnc" id="L1047" title="All 2 branches missed.">              &amp;&amp; !Instance.isMissingValue(pred)) {</span>
<span class="nc" id="L1048">            errd = new Double(pred - toPredict.classValue());</span>
<span class="nc" id="L1049">            plotShape.addElement(new Integer(Plot2D.CONST_AUTOMATIC_SHAPE));</span>
          } else {
            // missing shape if actual class not present or prediction is
            // missing
<span class="nc" id="L1053">            plotShape.addElement(new Integer(Plot2D.MISSING_SHAPE));</span>
          }
<span class="nc" id="L1055">          plotSize.addElement(errd);</span>
        }
      }
<span class="nc" id="L1058">    } catch (Exception ex) {</span>
<span class="nc" id="L1059">      ex.printStackTrace();</span>
    }
<span class="nc" id="L1061">  }</span>

  /**
   * Post processes numeric class errors into shape sizes for plotting in the
   * visualize panel
   * 
   * @param plotSize a FastVector of numeric class errors
   */
  private void postProcessPlotInfo(FastVector plotSize) {
<span class="nc" id="L1070">    int maxpSize = 20;</span>
<span class="nc" id="L1071">    double maxErr = Double.NEGATIVE_INFINITY;</span>
<span class="nc" id="L1072">    double minErr = Double.POSITIVE_INFINITY;</span>
    double err;

<span class="nc bnc" id="L1075" title="All 2 branches missed.">    for (int i = 0; i &lt; plotSize.size(); i++) {</span>
<span class="nc" id="L1076">      Double errd = (Double) plotSize.elementAt(i);</span>
<span class="nc bnc" id="L1077" title="All 2 branches missed.">      if (errd != null) {</span>
<span class="nc" id="L1078">        err = Math.abs(errd.doubleValue());</span>
<span class="nc bnc" id="L1079" title="All 2 branches missed.">        if (err &lt; minErr) {</span>
<span class="nc" id="L1080">          minErr = err;</span>
        }
<span class="nc bnc" id="L1082" title="All 2 branches missed.">        if (err &gt; maxErr) {</span>
<span class="nc" id="L1083">          maxErr = err;</span>
        }
      }
    }

<span class="nc bnc" id="L1088" title="All 2 branches missed.">    for (int i = 0; i &lt; plotSize.size(); i++) {</span>
<span class="nc" id="L1089">      Double errd = (Double) plotSize.elementAt(i);</span>
<span class="nc bnc" id="L1090" title="All 2 branches missed.">      if (errd != null) {</span>
<span class="nc" id="L1091">        err = Math.abs(errd.doubleValue());</span>
<span class="nc bnc" id="L1092" title="All 2 branches missed.">        if (maxErr - minErr &gt; 0) {</span>
<span class="nc" id="L1093">          double temp = (((err - minErr) / (maxErr - minErr)) * maxpSize);</span>
<span class="nc" id="L1094">          plotSize.setElementAt(new Integer((int) temp), i);</span>
        } else {
<span class="nc" id="L1096">          plotSize.setElementAt(new Integer(1), i);</span>
        }
      } else {
<span class="nc" id="L1099">        plotSize.setElementAt(new Integer(1), i);</span>
      }
    }
<span class="nc" id="L1102">  }</span>

  /**
   * Sets up the structure for the visualizable instances. This dataset contains
   * the original attributes plus the classifier's predictions for the class as
   * an attribute called &quot;predicted+WhateverTheClassIsCalled&quot;.
   * 
   * @param trainInstances the instances that the classifier is trained on
   * @return a new set of instances containing one more attribute (predicted
   *         class) than the trainInstances
   */
  public static Instances setUpVisualizableInstances(Instances trainInstances) {
<span class="nc" id="L1114">    FastVector hv = new FastVector();</span>
    Attribute predictedClass;

<span class="nc" id="L1117">    Attribute classAt = trainInstances.attribute(trainInstances.classIndex());</span>
<span class="nc bnc" id="L1118" title="All 2 branches missed.">    if (classAt.isNominal()) {</span>
<span class="nc" id="L1119">      FastVector attVals = new FastVector();</span>
<span class="nc bnc" id="L1120" title="All 2 branches missed.">      for (int i = 0; i &lt; classAt.numValues(); i++) {</span>
<span class="nc" id="L1121">        attVals.addElement(classAt.value(i));</span>
      }
<span class="nc" id="L1123">      predictedClass = new Attribute(</span>
<span class="nc" id="L1124">          Messages</span>
<span class="nc" id="L1125">              .getInstance()</span>
<span class="nc" id="L1126">              .getString(</span>
<span class="nc" id="L1127">                  &quot;ClassifierPanel_SetUpVisualizableInstances_PredictedClass_Attribute_Text_First&quot;)</span>
<span class="nc" id="L1128">              + classAt.name(), attVals);</span>
    } else {
<span class="nc" id="L1130">      predictedClass = new Attribute(</span>
<span class="nc" id="L1131">          Messages</span>
<span class="nc" id="L1132">              .getInstance()</span>
<span class="nc" id="L1133">              .getString(</span>
<span class="nc" id="L1134">                  &quot;ClassifierPanel_SetUpVisualizableInstances_PredictedClass_Attribute_Text_Second&quot;)</span>
<span class="nc" id="L1135">              + classAt.name());</span>
    }

<span class="nc bnc" id="L1138" title="All 2 branches missed.">    for (int i = 0; i &lt; trainInstances.numAttributes(); i++) {</span>
<span class="nc bnc" id="L1139" title="All 2 branches missed.">      if (i == trainInstances.classIndex()) {</span>
<span class="nc" id="L1140">        hv.addElement(predictedClass);</span>
      }
<span class="nc" id="L1142">      hv.addElement(trainInstances.attribute(i).copy());</span>
    }
<span class="nc" id="L1144">    return new Instances(trainInstances.relationName() + &quot;_predicted&quot;, hv,</span>
<span class="nc" id="L1145">        trainInstances.numInstances());</span>
  }

  /**
   * outputs the header for the predictions on the data
   * 
   * @param outBuff the buffer to add the output to
   * @param inst the data header
   * @param title the title to print
   */
  protected void printPredictionsHeader(StringBuffer outBuff, Instances inst,
      String title) {
<span class="nc" id="L1157">    outBuff</span>
<span class="nc" id="L1158">        .append(Messages.getInstance().getString(</span>
<span class="nc" id="L1159">            &quot;ClassifierPanel_PrintPredictionsHeader_OutBuffer_Text_First&quot;)</span>
<span class="nc" id="L1160">            + title</span>
<span class="nc" id="L1161">            + &quot; &quot;</span>
<span class="nc" id="L1162">            + Messages</span>
<span class="nc" id="L1163">                .getInstance()</span>
<span class="nc" id="L1164">                .getString(</span>
<span class="nc" id="L1165">                    &quot;ClassifierPanel_PrintPredictionsHeader_OutBuffer_Text_First_Alpha&quot;));</span>
<span class="nc" id="L1166">    outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L1167">        &quot;ClassifierPanel_PrintPredictionsHeader_OutBuffer_Text_Second&quot;));</span>
<span class="nc bnc" id="L1168" title="All 2 branches missed.">    if (inst.classAttribute().isNominal()) {</span>
<span class="nc" id="L1169">      outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L1170">          &quot;ClassifierPanel_PrintPredictionsHeader_OutBuffer_Text_Third&quot;));</span>
    }
<span class="nc bnc" id="L1172" title="All 2 branches missed.">    if (m_OutputAdditionalAttributesRange != null) {</span>
<span class="nc" id="L1173">      outBuff.append(&quot; (&quot;);</span>
<span class="nc" id="L1174">      boolean first = true;</span>
<span class="nc bnc" id="L1175" title="All 2 branches missed.">      for (int i = 0; i &lt; inst.numAttributes() - 1; i++) {</span>
<span class="nc bnc" id="L1176" title="All 2 branches missed.">        if (m_OutputAdditionalAttributesRange.isInRange(i)) {</span>
<span class="nc bnc" id="L1177" title="All 2 branches missed.">          if (!first)</span>
<span class="nc" id="L1178">            outBuff.append(&quot;,&quot;);</span>
          else
<span class="nc" id="L1180">            first = false;</span>
<span class="nc" id="L1181">          outBuff.append(inst.attribute(i).name());</span>
        }
      }
<span class="nc" id="L1184">      outBuff.append(&quot;)&quot;);</span>
    }
<span class="nc" id="L1186">    outBuff.append(&quot;\n&quot;);</span>
<span class="nc" id="L1187">  }</span>

  /**
   * Starts running the currently configured classifier with the current
   * settings. This is run in a separate thread, and will only start if there is
   * no classifier already running. The classifier output is sent to the results
   * history panel.
   */
  protected void startClassifier() {

<span class="nc bnc" id="L1197" title="All 2 branches missed.">    if (m_RunThread == null) {</span>
<span class="nc" id="L1198">      synchronized (this) {</span>
<span class="nc" id="L1199">        m_StartBut.setEnabled(false);</span>
<span class="nc" id="L1200">        m_StopBut.setEnabled(true);</span>
      }
<span class="nc" id="L1202">      m_RunThread = new Thread() {</span>
        @Override
        public void run() {
          // Copy the current state of things
<span class="nc" id="L1206">          m_Log.statusMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L1207">              &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_First&quot;));</span>
<span class="nc" id="L1208">          CostMatrix costMatrix = null;</span>
<span class="nc" id="L1209">          Instances inst = new Instances(m_Instances);</span>
<span class="nc" id="L1210">          DataSource source = null;</span>
<span class="nc" id="L1211">          Instances userTestStructure = null;</span>
          // additional vis info (either shape type or point size)
<span class="nc" id="L1213">          FastVector plotShape = new FastVector();</span>
<span class="nc" id="L1214">          FastVector plotSize = new FastVector();</span>
<span class="nc" id="L1215">          Instances predInstances = null;</span>

          // for timing
<span class="nc" id="L1218">          long trainTimeStart = 0, trainTimeElapsed = 0;</span>

          try {
<span class="nc bnc" id="L1221" title="All 4 branches missed.">            if (m_TestLoader != null &amp;&amp; m_TestLoader.getStructure() != null) {</span>
<span class="nc" id="L1222">              m_TestLoader.reset();</span>
<span class="nc" id="L1223">              source = new DataSource(m_TestLoader);</span>
<span class="nc" id="L1224">              userTestStructure = source.getStructure();</span>
            }
<span class="nc" id="L1226">          } catch (Exception ex) {</span>
<span class="nc" id="L1227">            ex.printStackTrace();</span>
          }
<span class="nc bnc" id="L1229" title="All 2 branches missed.">          if (m_EvalWRTCostsBut.isSelected()) {</span>
<span class="nc" id="L1230">            costMatrix = new CostMatrix(</span>
<span class="nc" id="L1231">                (CostMatrix) m_CostMatrixEditor.getValue());</span>
          }
<span class="nc" id="L1233">          boolean outputModel = m_OutputModelBut.isSelected();</span>
<span class="nc" id="L1234">          boolean outputConfusion = m_OutputConfusionBut.isSelected();</span>
<span class="nc" id="L1235">          boolean outputPerClass = m_OutputPerClassBut.isSelected();</span>
<span class="nc" id="L1236">          boolean outputSummary = true;</span>
<span class="nc" id="L1237">          boolean outputEntropy = m_OutputEntropyBut.isSelected();</span>
<span class="nc" id="L1238">          boolean saveVis = m_StorePredictionsBut.isSelected();</span>
<span class="nc" id="L1239">          boolean outputPredictionsText = m_OutputPredictionsTextBut</span>
<span class="nc" id="L1240">              .isSelected();</span>
<span class="nc bnc" id="L1241" title="All 2 branches missed.">          if (m_OutputAdditionalAttributesText.getText().equals(&quot;&quot;)) {</span>
<span class="nc" id="L1242">            m_OutputAdditionalAttributesRange = null;</span>
          } else {
<span class="nc" id="L1244">            m_OutputAdditionalAttributesRange = new Range(</span>
<span class="nc" id="L1245">                m_OutputAdditionalAttributesText.getText());</span>
<span class="nc" id="L1246">            m_OutputAdditionalAttributesRange</span>
<span class="nc" id="L1247">                .setUpper(inst.numAttributes() - 1);</span>
          }

<span class="nc" id="L1250">          String grph = null;</span>

<span class="nc" id="L1252">          int testMode = 0;</span>
<span class="nc" id="L1253">          int numFolds = 10;</span>
<span class="nc" id="L1254">          double percent = 66;</span>
<span class="nc" id="L1255">          int classIndex = m_ClassCombo.getSelectedIndex();</span>
<span class="nc" id="L1256">          Classifier classifier = (Classifier) m_ClassifierEditor.getValue();</span>
<span class="nc" id="L1257">          Classifier template = null;</span>
          try {
<span class="nc" id="L1259">            template = Classifier.makeCopy(classifier);</span>
<span class="nc" id="L1260">          } catch (Exception ex) {</span>
<span class="nc" id="L1261">            m_Log.logMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L1262">                &quot;ClassifierPanel_StartClassifier_Log_LogMessage_Text_First&quot;)</span>
<span class="nc" id="L1263">                + ex.getMessage());</span>
          }
<span class="nc" id="L1265">          Classifier fullClassifier = null;</span>
<span class="nc" id="L1266">          StringBuffer outBuff = new StringBuffer();</span>
<span class="nc" id="L1267">          String name = (new SimpleDateFormat(&quot;HH:mm:ss - &quot;))</span>
<span class="nc" id="L1268">              .format(new Date());</span>
<span class="nc" id="L1269">          String cname = classifier.getClass().getName();</span>
<span class="nc bnc" id="L1270" title="All 2 branches missed.">          if (cname.startsWith(&quot;weka.classifiers.&quot;)) {</span>
<span class="nc" id="L1271">            name += cname.substring(&quot;weka.classifiers.&quot;.length());</span>
          } else {
<span class="nc" id="L1273">            name += cname;</span>
          }
<span class="nc" id="L1275">          String cmd = m_ClassifierEditor.getValue().getClass().getName();</span>
<span class="nc bnc" id="L1276" title="All 2 branches missed.">          if (m_ClassifierEditor.getValue() instanceof OptionHandler)</span>
<span class="nc" id="L1277">            cmd += &quot; &quot;</span>
<span class="nc" id="L1278">                + Utils.joinOptions(((OptionHandler) m_ClassifierEditor</span>
<span class="nc" id="L1279">                    .getValue()).getOptions());</span>
<span class="nc" id="L1280">          Evaluation eval = null;</span>
          try {
<span class="nc bnc" id="L1282" title="All 2 branches missed.">            if (m_CVBut.isSelected()) {</span>
<span class="nc" id="L1283">              testMode = 1;</span>
<span class="nc" id="L1284">              numFolds = Integer.parseInt(m_CVText.getText());</span>
<span class="nc bnc" id="L1285" title="All 2 branches missed.">              if (numFolds &lt;= 1) {</span>
<span class="nc" id="L1286">                throw new Exception(Messages.getInstance().getString(</span>
<span class="nc" id="L1287">                    &quot;ClassifierPanel_StartClassifier_Exception_Text_First&quot;));</span>
              }
<span class="nc bnc" id="L1289" title="All 2 branches missed.">            } else if (m_PercentBut.isSelected()) {</span>
<span class="nc" id="L1290">              testMode = 2;</span>
<span class="nc" id="L1291">              percent = Double.parseDouble(m_PercentText.getText());</span>
<span class="nc bnc" id="L1292" title="All 4 branches missed.">              if ((percent &lt;= 0) || (percent &gt;= 100)) {</span>
<span class="nc" id="L1293">                throw new Exception(Messages.getInstance().getString(</span>
<span class="nc" id="L1294">                    &quot;ClassifierPanel_StartClassifier_Exception_Text_Second&quot;));</span>
              }
<span class="nc bnc" id="L1296" title="All 2 branches missed.">            } else if (m_TrainBut.isSelected()) {</span>
<span class="nc" id="L1297">              testMode = 3;</span>
<span class="nc bnc" id="L1298" title="All 2 branches missed.">            } else if (m_TestSplitBut.isSelected()) {</span>
<span class="nc" id="L1299">              testMode = 4;</span>
              // Check the test instance compatibility
<span class="nc bnc" id="L1301" title="All 2 branches missed.">              if (source == null) {</span>
<span class="nc" id="L1302">                throw new Exception(Messages.getInstance().getString(</span>
<span class="nc" id="L1303">                    &quot;ClassifierPanel_StartClassifier_Exception_Text_Third&quot;));</span>
              }
<span class="nc bnc" id="L1305" title="All 2 branches missed.">              if (!inst.equalHeaders(userTestStructure)) {</span>
<span class="nc" id="L1306">                throw new Exception(Messages.getInstance().getString(</span>
<span class="nc" id="L1307">                    &quot;ClassifierPanel_StartClassifier_Exception_Text_Fourth&quot;));</span>
              }
<span class="nc" id="L1309">              userTestStructure.setClassIndex(classIndex);</span>
            } else {
<span class="nc" id="L1311">              throw new Exception(Messages.getInstance().getString(</span>
<span class="nc" id="L1312">                  &quot;ClassifierPanel_StartClassifier_Exception_Text_Fifth&quot;));</span>
            }
<span class="nc" id="L1314">            inst.setClassIndex(classIndex);</span>

            // set up the structure of the plottable instances for
            // visualization
<span class="nc bnc" id="L1318" title="All 2 branches missed.">            if (saveVis) {</span>
<span class="nc" id="L1319">              predInstances = setUpVisualizableInstances(inst);</span>
<span class="nc" id="L1320">              predInstances.setClassIndex(inst.classIndex() + 1);</span>
            }

            // Output some header information
<span class="nc" id="L1324">            m_Log.logMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L1325">                &quot;ClassifierPanel_StartClassifier_Log_LogMessage_Text_Second&quot;)</span>
<span class="nc" id="L1326">                + cname);</span>
<span class="nc" id="L1327">            m_Log.logMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L1328">                &quot;ClassifierPanel_StartClassifier_Log_LogMessage_Text_Third&quot;)</span>
<span class="nc" id="L1329">                + cmd);</span>
<span class="nc bnc" id="L1330" title="All 2 branches missed.">            if (m_Log instanceof TaskLogger) {</span>
<span class="nc" id="L1331">              ((TaskLogger) m_Log).taskStarted();</span>
            }
<span class="nc" id="L1333">            outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L1334">                &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_First&quot;));</span>
<span class="nc" id="L1335">            outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L1336">                &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_Second&quot;)</span>
<span class="nc" id="L1337">                + cname);</span>
<span class="nc bnc" id="L1338" title="All 2 branches missed.">            if (classifier instanceof OptionHandler) {</span>
<span class="nc" id="L1339">              String[] o = ((OptionHandler) classifier).getOptions();</span>
<span class="nc" id="L1340">              outBuff.append(&quot; &quot; + Utils.joinOptions(o));</span>
            }
<span class="nc" id="L1342">            outBuff.append(&quot;\n&quot;);</span>
<span class="nc" id="L1343">            outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L1344">                &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_Fourth&quot;)</span>
<span class="nc" id="L1345">                + inst.relationName() + '\n');</span>
<span class="nc" id="L1346">            outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L1347">                &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_Sixth&quot;)</span>
<span class="nc" id="L1348">                + inst.numInstances() + '\n');</span>
<span class="nc" id="L1349">            outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L1350">                &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_Eigth&quot;)</span>
<span class="nc" id="L1351">                + inst.numAttributes() + '\n');</span>
<span class="nc bnc" id="L1352" title="All 2 branches missed.">            if (inst.numAttributes() &lt; 100) {</span>
<span class="nc bnc" id="L1353" title="All 2 branches missed.">              for (int i = 0; i &lt; inst.numAttributes(); i++) {</span>
<span class="nc" id="L1354">                outBuff.append(&quot;              &quot; + inst.attribute(i).name()</span>
<span class="nc" id="L1355">                    + '\n');</span>
              }
            } else {
<span class="nc" id="L1358">              outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L1359">                  &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_Twelveth&quot;));</span>
            }

<span class="nc" id="L1362">            outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L1363">                &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_Thirteenth&quot;));</span>
<span class="nc bnc" id="L1364" title="All 5 branches missed.">            switch (testMode) {</span>
            case 3: // Test on training
<span class="nc" id="L1366">              outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L1367">                  &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_Fourteenth&quot;));</span>
<span class="nc" id="L1368">              break;</span>
            case 1: // CV mode
<span class="nc" id="L1370">              outBuff</span>
<span class="nc" id="L1371">                  .append(&quot;&quot;</span>
<span class="nc" id="L1372">                      + numFolds</span>
<span class="nc" id="L1373">                      + Messages</span>
<span class="nc" id="L1374">                          .getInstance()</span>
<span class="nc" id="L1375">                          .getString(</span>
<span class="nc" id="L1376">                              &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_Sixteenth&quot;));</span>
<span class="nc" id="L1377">              break;</span>
            case 2: // Percent split
<span class="nc" id="L1379">              outBuff</span>
<span class="nc" id="L1380">                  .append(Messages</span>
<span class="nc" id="L1381">                      .getInstance()</span>
<span class="nc" id="L1382">                      .getString(</span>
<span class="nc" id="L1383">                          &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_Seventeenth&quot;)</span>
<span class="nc" id="L1384">                      + percent</span>
<span class="nc" id="L1385">                      + Messages</span>
<span class="nc" id="L1386">                          .getInstance()</span>
<span class="nc" id="L1387">                          .getString(</span>
<span class="nc" id="L1388">                              &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_Eighteenth&quot;));</span>
<span class="nc" id="L1389">              break;</span>
            case 4: // Test on user split
<span class="nc bnc" id="L1391" title="All 2 branches missed.">              if (source.isIncremental())</span>
<span class="nc" id="L1392">                outBuff</span>
<span class="nc" id="L1393">                    .append(Messages</span>
<span class="nc" id="L1394">                        .getInstance()</span>
<span class="nc" id="L1395">                        .getString(</span>
<span class="nc" id="L1396">                            &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_Nineteenth&quot;));</span>
              else
<span class="nc" id="L1398">                outBuff</span>
<span class="nc" id="L1399">                    .append(Messages</span>
<span class="nc" id="L1400">                        .getInstance()</span>
<span class="nc" id="L1401">                        .getString(</span>
<span class="nc" id="L1402">                            &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_Twentyth&quot;)</span>
<span class="nc" id="L1403">                        + source.getDataSet().numInstances()</span>
<span class="nc" id="L1404">                        + Messages</span>
<span class="nc" id="L1405">                            .getInstance()</span>
<span class="nc" id="L1406">                            .getString(</span>
<span class="nc" id="L1407">                                &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_TwentyFirst&quot;));</span>
              break;
            }
<span class="nc bnc" id="L1410" title="All 2 branches missed.">            if (costMatrix != null) {</span>
<span class="nc" id="L1411">              outBuff</span>
<span class="nc" id="L1412">                  .append(</span>
                      Messages
<span class="nc" id="L1414">                          .getInstance()</span>
<span class="nc" id="L1415">                          .getString(</span>
<span class="nc" id="L1416">                              &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_TwentySecond&quot;))</span>
<span class="nc" id="L1417">                  .append(costMatrix.toString()).append(&quot;\n&quot;);</span>
            }
<span class="nc" id="L1419">            outBuff.append(&quot;\n&quot;);</span>
<span class="nc" id="L1420">            m_History.addResult(name, outBuff);</span>
<span class="nc" id="L1421">            m_History.setSingle(name);</span>

            // Build the model and output it.
<span class="nc bnc" id="L1424" title="All 6 branches missed.">            if (outputModel || (testMode == 3) || (testMode == 4)) {</span>
<span class="nc" id="L1425">              m_Log</span>
<span class="nc" id="L1426">                  .statusMessage(Messages</span>
<span class="nc" id="L1427">                      .getInstance()</span>
<span class="nc" id="L1428">                      .getString(</span>
<span class="nc" id="L1429">                          &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Second&quot;));</span>

<span class="nc" id="L1431">              trainTimeStart = System.currentTimeMillis();</span>
<span class="nc" id="L1432">              classifier.buildClassifier(inst);</span>
<span class="nc" id="L1433">              trainTimeElapsed = System.currentTimeMillis() - trainTimeStart;</span>
            }

<span class="nc bnc" id="L1436" title="All 2 branches missed.">            if (outputModel) {</span>
<span class="nc" id="L1437">              outBuff</span>
<span class="nc" id="L1438">                  .append(Messages</span>
<span class="nc" id="L1439">                      .getInstance()</span>
<span class="nc" id="L1440">                      .getString(</span>
<span class="nc" id="L1441">                          &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_TwentySixth&quot;));</span>
<span class="nc" id="L1442">              outBuff.append(classifier.toString() + &quot;\n&quot;);</span>
<span class="nc" id="L1443">              outBuff</span>
<span class="nc" id="L1444">                  .append(Messages</span>
<span class="nc" id="L1445">                      .getInstance()</span>
<span class="nc" id="L1446">                      .getString(</span>
<span class="nc" id="L1447">                          &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_TwentyEighth&quot;)</span>
<span class="nc" id="L1448">                      + Utils.doubleToString(trainTimeElapsed / 1000.0, 2)</span>
<span class="nc" id="L1449">                      + &quot; &quot;</span>
<span class="nc" id="L1450">                      + Messages</span>
<span class="nc" id="L1451">                          .getInstance()</span>
<span class="nc" id="L1452">                          .getString(</span>
<span class="nc" id="L1453">                              &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_TwentyNineth&quot;));</span>
<span class="nc" id="L1454">              m_History.updateResult(name);</span>
<span class="nc bnc" id="L1455" title="All 2 branches missed.">              if (classifier instanceof Drawable) {</span>
<span class="nc" id="L1456">                grph = null;</span>
                try {
<span class="nc" id="L1458">                  grph = ((Drawable) classifier).graph();</span>
<span class="nc" id="L1459">                } catch (Exception ex) {</span>
                }
              }
              // copy full model for output
<span class="nc" id="L1463">              SerializedObject so = new SerializedObject(classifier);</span>
<span class="nc" id="L1464">              fullClassifier = (Classifier) so.getObject();</span>
            }

<span class="nc bnc" id="L1467" title="All 5 branches missed.">            switch (testMode) {</span>
            case 3: // Test on training
<span class="nc" id="L1469">              m_Log.statusMessage(&quot;Evaluating on training data...&quot;);</span>
<span class="nc" id="L1470">              eval = new Evaluation(inst, costMatrix);</span>

<span class="nc bnc" id="L1472" title="All 2 branches missed.">              if (outputPredictionsText) {</span>
<span class="nc" id="L1473">                printPredictionsHeader(outBuff, inst, &quot;training set&quot;);</span>
              }

<span class="nc bnc" id="L1476" title="All 2 branches missed.">              for (int jj = 0; jj &lt; inst.numInstances(); jj++) {</span>
<span class="nc" id="L1477">                processClassifierPrediction(inst.instance(jj), classifier,</span>
<span class="nc" id="L1478">                    eval, predInstances, plotShape, plotSize);</span>

<span class="nc bnc" id="L1480" title="All 2 branches missed.">                if (outputPredictionsText) {</span>
<span class="nc" id="L1481">                  outBuff.append(predictionText(classifier, inst.instance(jj),</span>
<span class="nc" id="L1482">                      jj + 1));</span>
                }
<span class="nc bnc" id="L1484" title="All 2 branches missed.">                if ((jj % 100) == 0) {</span>
<span class="nc" id="L1485">                  m_Log.statusMessage(&quot;Evaluating on training data. Processed &quot;</span>
<span class="nc" id="L1486">                      + jj + &quot; instances...&quot;);</span>
                }
              }
<span class="nc bnc" id="L1489" title="All 2 branches missed.">              if (outputPredictionsText) {</span>
<span class="nc" id="L1490">                outBuff.append(&quot;\n&quot;);</span>
              }
<span class="nc" id="L1492">              outBuff.append(&quot;=== Evaluation on training set ===\n&quot;);</span>
<span class="nc" id="L1493">              break;</span>

            case 1: // CV mode
<span class="nc" id="L1496">              m_Log.statusMessage(&quot;Randomizing instances...&quot;);</span>
<span class="nc" id="L1497">              int rnd = 1;</span>
              try {
<span class="nc" id="L1499">                rnd = Integer.parseInt(m_RandomSeedText.getText().trim());</span>
                // System.err.println(&quot;Using random seed &quot;+rnd);
<span class="nc" id="L1501">              } catch (Exception ex) {</span>
<span class="nc" id="L1502">                m_Log.logMessage(&quot;Trouble parsing random seed value&quot;);</span>
<span class="nc" id="L1503">                rnd = 1;</span>
              }
<span class="nc" id="L1505">              Random random = new Random(rnd);</span>
<span class="nc" id="L1506">              inst.randomize(random);</span>
<span class="nc bnc" id="L1507" title="All 2 branches missed.">              if (inst.attribute(classIndex).isNominal()) {</span>
<span class="nc" id="L1508">                m_Log.statusMessage(&quot;Stratifying instances...&quot;);</span>
<span class="nc" id="L1509">                inst.stratify(numFolds);</span>
              }
<span class="nc" id="L1511">              eval = new Evaluation(inst, costMatrix);</span>

<span class="nc bnc" id="L1513" title="All 2 branches missed.">              if (outputPredictionsText) {</span>
<span class="nc" id="L1514">                printPredictionsHeader(outBuff, inst, &quot;test data&quot;);</span>
              }

              // Make some splits and do a CV
<span class="nc bnc" id="L1518" title="All 2 branches missed.">              for (int fold = 0; fold &lt; numFolds; fold++) {</span>
<span class="nc" id="L1519">                m_Log</span>
<span class="nc" id="L1520">                    .statusMessage(Messages</span>
<span class="nc" id="L1521">                        .getInstance()</span>
<span class="nc" id="L1522">                        .getString(</span>
<span class="nc" id="L1523">                            &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Eighth&quot;)</span>
<span class="nc" id="L1524">                        + (fold + 1)</span>
<span class="nc" id="L1525">                        + Messages</span>
<span class="nc" id="L1526">                            .getInstance()</span>
<span class="nc" id="L1527">                            .getString(</span>
<span class="nc" id="L1528">                                &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Nineth&quot;));</span>
<span class="nc" id="L1529">                Instances train = inst.trainCV(numFolds, fold, random);</span>
<span class="nc" id="L1530">                eval.setPriors(train);</span>
<span class="nc" id="L1531">                m_Log</span>
<span class="nc" id="L1532">                    .statusMessage(Messages</span>
<span class="nc" id="L1533">                        .getInstance()</span>
<span class="nc" id="L1534">                        .getString(</span>
<span class="nc" id="L1535">                            &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Tenth&quot;)</span>
<span class="nc" id="L1536">                        + (fold + 1)</span>
<span class="nc" id="L1537">                        + Messages</span>
<span class="nc" id="L1538">                            .getInstance()</span>
<span class="nc" id="L1539">                            .getString(</span>
<span class="nc" id="L1540">                                &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Twelveth&quot;));</span>
<span class="nc" id="L1541">                Classifier current = null;</span>
                try {
<span class="nc" id="L1543">                  current = Classifier.makeCopy(template);</span>
<span class="nc" id="L1544">                } catch (Exception ex) {</span>
<span class="nc" id="L1545">                  m_Log</span>
<span class="nc" id="L1546">                      .logMessage(Messages</span>
<span class="nc" id="L1547">                          .getInstance()</span>
<span class="nc" id="L1548">                          .getString(</span>
<span class="nc" id="L1549">                              &quot;ClassifierPanel_StartClassifier_Log_LogMessage_Text_Fifth&quot;)</span>
<span class="nc" id="L1550">                          + ex.getMessage());</span>
                }
<span class="nc" id="L1552">                current.buildClassifier(train);</span>
<span class="nc" id="L1553">                Instances test = inst.testCV(numFolds, fold);</span>
<span class="nc" id="L1554">                m_Log</span>
<span class="nc" id="L1555">                    .statusMessage(Messages</span>
<span class="nc" id="L1556">                        .getInstance()</span>
<span class="nc" id="L1557">                        .getString(</span>
<span class="nc" id="L1558">                            &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Eleventh&quot;)</span>
<span class="nc" id="L1559">                        + (fold + 1)</span>
<span class="nc" id="L1560">                        + Messages</span>
<span class="nc" id="L1561">                            .getInstance()</span>
<span class="nc" id="L1562">                            .getString(</span>
<span class="nc" id="L1563">                                &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Twelveth&quot;));</span>
<span class="nc bnc" id="L1564" title="All 2 branches missed.">                for (int jj = 0; jj &lt; test.numInstances(); jj++) {</span>
<span class="nc" id="L1565">                  processClassifierPrediction(test.instance(jj), current, eval,</span>
<span class="nc" id="L1566">                      predInstances, plotShape, plotSize);</span>
<span class="nc bnc" id="L1567" title="All 2 branches missed.">                  if (outputPredictionsText) {</span>
<span class="nc" id="L1568">                    outBuff.append(predictionText(current, test.instance(jj),</span>
<span class="nc" id="L1569">                        jj + 1));</span>
                  }
                }
              }
<span class="nc bnc" id="L1573" title="All 2 branches missed.">              if (outputPredictionsText) {</span>
<span class="nc" id="L1574">                outBuff.append(&quot;\n&quot;);</span>
              }
<span class="nc bnc" id="L1576" title="All 2 branches missed.">              if (inst.attribute(classIndex).isNominal()) {</span>
<span class="nc" id="L1577">                outBuff</span>
<span class="nc" id="L1578">                    .append(Messages</span>
<span class="nc" id="L1579">                        .getInstance()</span>
<span class="nc" id="L1580">                        .getString(</span>
<span class="nc" id="L1581">                            &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_ThirtyThird&quot;));</span>
              } else {
<span class="nc" id="L1583">                outBuff</span>
<span class="nc" id="L1584">                    .append(Messages</span>
<span class="nc" id="L1585">                        .getInstance()</span>
<span class="nc" id="L1586">                        .getString(</span>
<span class="nc" id="L1587">                            &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_ThirtyFourth&quot;));</span>
              }
<span class="nc" id="L1589">              break;</span>

            case 2: // Percent split
<span class="nc bnc" id="L1592" title="All 2 branches missed.">              if (!m_PreserveOrderBut.isSelected()) {</span>
<span class="nc" id="L1593">                m_Log</span>
<span class="nc" id="L1594">                    .statusMessage(Messages</span>
<span class="nc" id="L1595">                        .getInstance()</span>
<span class="nc" id="L1596">                        .getString(</span>
<span class="nc" id="L1597">                            &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Thirteenth&quot;));</span>
                try {
<span class="nc" id="L1599">                  rnd = Integer.parseInt(m_RandomSeedText.getText().trim());</span>
<span class="nc" id="L1600">                } catch (Exception ex) {</span>
<span class="nc" id="L1601">                  m_Log</span>
<span class="nc" id="L1602">                      .logMessage(Messages</span>
<span class="nc" id="L1603">                          .getInstance()</span>
<span class="nc" id="L1604">                          .getString(</span>
<span class="nc" id="L1605">                              &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Fourteenth&quot;));</span>
<span class="nc" id="L1606">                  rnd = 1;</span>
                }
<span class="nc" id="L1608">                inst.randomize(new Random(rnd));</span>
              }
<span class="nc" id="L1610">              int trainSize = (int) Math.round(inst.numInstances() * percent</span>
<span class="nc" id="L1611">                  / 100);</span>
<span class="nc" id="L1612">              int testSize = inst.numInstances() - trainSize;</span>
<span class="nc" id="L1613">              Instances train = new Instances(inst, 0, trainSize);</span>
<span class="nc" id="L1614">              Instances test = new Instances(inst, trainSize, testSize);</span>
<span class="nc" id="L1615">              m_Log</span>
<span class="nc" id="L1616">                  .statusMessage(Messages</span>
<span class="nc" id="L1617">                      .getInstance()</span>
<span class="nc" id="L1618">                      .getString(</span>
<span class="nc" id="L1619">                          &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Fifteenth&quot;)</span>
<span class="nc" id="L1620">                      + trainSize</span>
<span class="nc" id="L1621">                      + Messages</span>
<span class="nc" id="L1622">                          .getInstance()</span>
<span class="nc" id="L1623">                          .getString(</span>
<span class="nc" id="L1624">                              &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Sixteenth&quot;));</span>
<span class="nc" id="L1625">              Classifier current = null;</span>
              try {
<span class="nc" id="L1627">                current = Classifier.makeCopy(template);</span>
<span class="nc" id="L1628">              } catch (Exception ex) {</span>
<span class="nc" id="L1629">                m_Log</span>
<span class="nc" id="L1630">                    .logMessage(Messages</span>
<span class="nc" id="L1631">                        .getInstance()</span>
<span class="nc" id="L1632">                        .getString(</span>
<span class="nc" id="L1633">                            &quot;ClassifierPanel_StartClassifier_Log_LogMessage_Text_Sixth&quot;)</span>
<span class="nc" id="L1634">                        + ex.getMessage());</span>
              }
<span class="nc" id="L1636">              current.buildClassifier(train);</span>
<span class="nc" id="L1637">              eval = new Evaluation(train, costMatrix);</span>
<span class="nc" id="L1638">              m_Log</span>
<span class="nc" id="L1639">                  .statusMessage(Messages</span>
<span class="nc" id="L1640">                      .getInstance()</span>
<span class="nc" id="L1641">                      .getString(</span>
<span class="nc" id="L1642">                          &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Seventeenth&quot;));</span>

<span class="nc bnc" id="L1644" title="All 2 branches missed.">              if (outputPredictionsText) {</span>
<span class="nc" id="L1645">                printPredictionsHeader(</span>
<span class="nc" id="L1646">                    outBuff,</span>
<span class="nc" id="L1647">                    inst,</span>
                    Messages
<span class="nc" id="L1649">                        .getInstance()</span>
<span class="nc" id="L1650">                        .getString(</span>
<span class="nc" id="L1651">                            &quot;ClassifierPanel_StartClassifier_PrintPredictionsHeader_Text_First&quot;));</span>
              }

<span class="nc bnc" id="L1654" title="All 2 branches missed.">              for (int jj = 0; jj &lt; test.numInstances(); jj++) {</span>
<span class="nc" id="L1655">                processClassifierPrediction(test.instance(jj), current, eval,</span>
<span class="nc" id="L1656">                    predInstances, plotShape, plotSize);</span>
<span class="nc bnc" id="L1657" title="All 2 branches missed.">                if (outputPredictionsText) {</span>
<span class="nc" id="L1658">                  outBuff.append(predictionText(current, test.instance(jj),</span>
<span class="nc" id="L1659">                      jj + 1));</span>
                }
<span class="nc bnc" id="L1661" title="All 2 branches missed.">                if ((jj % 100) == 0) {</span>
<span class="nc" id="L1662">                  m_Log</span>
<span class="nc" id="L1663">                      .statusMessage(Messages</span>
<span class="nc" id="L1664">                          .getInstance()</span>
<span class="nc" id="L1665">                          .getString(</span>
<span class="nc" id="L1666">                              &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Eighteenth&quot;)</span>
<span class="nc" id="L1667">                          + jj</span>
<span class="nc" id="L1668">                          + Messages</span>
<span class="nc" id="L1669">                              .getInstance()</span>
<span class="nc" id="L1670">                              .getString(</span>
<span class="nc" id="L1671">                                  &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Nineteenth&quot;));</span>
                }
              }
<span class="nc bnc" id="L1674" title="All 2 branches missed.">              if (outputPredictionsText) {</span>
<span class="nc" id="L1675">                outBuff.append(&quot;\n&quot;);</span>
              }
<span class="nc" id="L1677">              outBuff</span>
<span class="nc" id="L1678">                  .append(Messages</span>
<span class="nc" id="L1679">                      .getInstance()</span>
<span class="nc" id="L1680">                      .getString(</span>
<span class="nc" id="L1681">                          &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_ThirtySixth&quot;));</span>
<span class="nc" id="L1682">              break;</span>

            case 4: // Test on user split
<span class="nc" id="L1685">              m_Log</span>
<span class="nc" id="L1686">                  .statusMessage(Messages</span>
<span class="nc" id="L1687">                      .getInstance()</span>
<span class="nc" id="L1688">                      .getString(</span>
<span class="nc" id="L1689">                          &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_Twentyth&quot;));</span>
<span class="nc" id="L1690">              eval = new Evaluation(inst, costMatrix);</span>

<span class="nc bnc" id="L1692" title="All 2 branches missed.">              if (outputPredictionsText) {</span>
<span class="nc" id="L1693">                printPredictionsHeader(</span>
<span class="nc" id="L1694">                    outBuff,</span>
<span class="nc" id="L1695">                    inst,</span>
                    Messages
<span class="nc" id="L1697">                        .getInstance()</span>
<span class="nc" id="L1698">                        .getString(</span>
<span class="nc" id="L1699">                            &quot;ClassifierPanel_StartClassifier_PrintPredictionsHeader_Text_Second&quot;));</span>
              }

              Instance instance;
<span class="nc" id="L1703">              int jj = 0;</span>
<span class="nc bnc" id="L1704" title="All 2 branches missed.">              while (source.hasMoreElements(userTestStructure)) {</span>
<span class="nc" id="L1705">                instance = source.nextElement(userTestStructure);</span>
<span class="nc" id="L1706">                processClassifierPrediction(instance, classifier, eval,</span>
<span class="nc" id="L1707">                    predInstances, plotShape, plotSize);</span>
<span class="nc bnc" id="L1708" title="All 2 branches missed.">                if (outputPredictionsText) {</span>
<span class="nc" id="L1709">                  outBuff.append(predictionText(classifier, instance, jj + 1));</span>
                }
<span class="nc bnc" id="L1711" title="All 2 branches missed.">                if ((++jj % 100) == 0) {</span>
<span class="nc" id="L1712">                  m_Log</span>
<span class="nc" id="L1713">                      .statusMessage(Messages</span>
<span class="nc" id="L1714">                          .getInstance()</span>
<span class="nc" id="L1715">                          .getString(</span>
<span class="nc" id="L1716">                              &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_TwentyFirst&quot;)</span>
<span class="nc" id="L1717">                          + jj</span>
<span class="nc" id="L1718">                          + Messages</span>
<span class="nc" id="L1719">                              .getInstance()</span>
<span class="nc" id="L1720">                              .getString(</span>
<span class="nc" id="L1721">                                  &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_TwentySecond&quot;));</span>
                }
              }

<span class="nc bnc" id="L1725" title="All 2 branches missed.">              if (outputPredictionsText) {</span>
<span class="nc" id="L1726">                outBuff.append(&quot;\n&quot;);</span>
              }
<span class="nc" id="L1728">              outBuff</span>
<span class="nc" id="L1729">                  .append(Messages</span>
<span class="nc" id="L1730">                      .getInstance()</span>
<span class="nc" id="L1731">                      .getString(</span>
<span class="nc" id="L1732">                          &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_ThirtyEighth&quot;));</span>
<span class="nc" id="L1733">              break;</span>

            default:
<span class="nc" id="L1736">              throw new Exception(Messages.getInstance().getString(</span>
<span class="nc" id="L1737">                  &quot;ClassifierPanel_StartClassifier_Exception_Text&quot;));</span>
            }

<span class="nc bnc" id="L1740" title="All 2 branches missed.">            if (outputSummary) {</span>
<span class="nc" id="L1741">              outBuff.append(eval.toSummaryString(outputEntropy) + &quot;\n&quot;);</span>
            }

<span class="nc bnc" id="L1744" title="All 2 branches missed.">            if (inst.attribute(classIndex).isNominal()) {</span>

<span class="nc bnc" id="L1746" title="All 2 branches missed.">              if (outputPerClass) {</span>
<span class="nc" id="L1747">                outBuff.append(eval.toClassDetailsString() + &quot;\n&quot;);</span>
              }

<span class="nc bnc" id="L1750" title="All 2 branches missed.">              if (outputConfusion) {</span>
<span class="nc" id="L1751">                outBuff.append(eval.toMatrixString() + &quot;\n&quot;);</span>
              }
            }

<span class="nc bnc" id="L1755" title="All 2 branches missed.">            if ((fullClassifier instanceof Sourcable)</span>
<span class="nc bnc" id="L1756" title="All 2 branches missed.">                &amp;&amp; m_OutputSourceCode.isSelected()) {</span>
<span class="nc" id="L1757">              outBuff</span>
<span class="nc" id="L1758">                  .append(Messages</span>
<span class="nc" id="L1759">                      .getInstance()</span>
<span class="nc" id="L1760">                      .getString(</span>
<span class="nc" id="L1761">                          &quot;ClassifierPanel_StartClassifier_OutBuffer_Text_FourtySecond&quot;));</span>
<span class="nc" id="L1762">              outBuff.append(Evaluation.wekaStaticWrapper(</span>
<span class="nc" id="L1763">                  ((Sourcable) fullClassifier), m_SourceCodeClass.getText()));</span>
            }

<span class="nc" id="L1766">            m_History.updateResult(name);</span>
<span class="nc" id="L1767">            m_Log.logMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L1768">                &quot;ClassifierPanel_StartClassifier_Log_LogMessage_Text_Seventh&quot;)</span>
<span class="nc" id="L1769">                + cname);</span>
<span class="nc" id="L1770">            m_Log</span>
<span class="nc" id="L1771">                .statusMessage(Messages</span>
<span class="nc" id="L1772">                    .getInstance()</span>
<span class="nc" id="L1773">                    .getString(</span>
<span class="nc" id="L1774">                        &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_TwentyThird&quot;));</span>
<span class="nc" id="L1775">          } catch (Exception ex) {</span>
<span class="nc" id="L1776">            ex.printStackTrace();</span>
<span class="nc" id="L1777">            m_Log.logMessage(ex.getMessage());</span>
            JOptionPane
<span class="nc" id="L1779">                .showMessageDialog(</span>
<span class="nc" id="L1780">                    ClassifierPanel.this,</span>
<span class="nc" id="L1781">                    Messages</span>
<span class="nc" id="L1782">                        .getInstance()</span>
<span class="nc" id="L1783">                        .getString(</span>
<span class="nc" id="L1784">                            &quot;ClassifierPanel_StartClassifier_JOptionPaneShowMessageDialog_Text_First&quot;)</span>
<span class="nc" id="L1785">                        + ex.getMessage(),</span>
                    Messages
<span class="nc" id="L1787">                        .getInstance()</span>
<span class="nc" id="L1788">                        .getString(</span>
<span class="nc" id="L1789">                            &quot;ClassifierPanel_StartClassifier_JOptionPaneShowMessageDialog_Text_Second&quot;),</span>
<span class="nc" id="L1790">                    JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L1791">            m_Log</span>
<span class="nc" id="L1792">                .statusMessage(Messages</span>
<span class="nc" id="L1793">                    .getInstance()</span>
<span class="nc" id="L1794">                    .getString(</span>
<span class="nc" id="L1795">                        &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_TwentyFourth&quot;));</span>
<span class="nc" id="L1796">          } finally {</span>
            try {
<span class="nc bnc" id="L1798" title="All 12 branches missed.">              if (!saveVis &amp;&amp; outputModel) {</span>
<span class="nc" id="L1799">                FastVector vv = new FastVector();</span>
<span class="nc" id="L1800">                vv.addElement(fullClassifier);</span>
<span class="nc" id="L1801">                Instances trainHeader = new Instances(m_Instances, 0);</span>
<span class="nc" id="L1802">                trainHeader.setClassIndex(classIndex);</span>
<span class="nc" id="L1803">                vv.addElement(trainHeader);</span>
<span class="nc bnc" id="L1804" title="All 6 branches missed.">                if (grph != null) {</span>
<span class="nc" id="L1805">                  vv.addElement(grph);</span>
                }
<span class="nc" id="L1807">                m_History.addObject(name, vv);</span>
<span class="nc bnc" id="L1808" title="All 12 branches missed.">              } else if (saveVis &amp;&amp; predInstances != null</span>
<span class="nc bnc" id="L1809" title="All 6 branches missed.">                  &amp;&amp; predInstances.numInstances() &gt; 0) {</span>
<span class="nc" id="L1810">                if (predInstances.attribute(predInstances.classIndex())</span>
<span class="nc bnc" id="L1811" title="All 6 branches missed.">                    .isNumeric()) {</span>
<span class="nc" id="L1812">                  postProcessPlotInfo(plotSize);</span>
                }
<span class="nc" id="L1814">                m_CurrentVis = new VisualizePanel();</span>
<span class="nc" id="L1815">                m_CurrentVis.setName(name + &quot; (&quot; + inst.relationName() + &quot;)&quot;);</span>
<span class="nc" id="L1816">                m_CurrentVis.setLog(m_Log);</span>
<span class="nc" id="L1817">                PlotData2D tempd = new PlotData2D(predInstances);</span>
<span class="nc" id="L1818">                tempd.setShapeSize(plotSize);</span>
<span class="nc" id="L1819">                tempd.setShapeType(plotShape);</span>
<span class="nc" id="L1820">                tempd.setPlotName(name + &quot; (&quot; + inst.relationName() + &quot;)&quot;);</span>
                // tempd.addInstanceNumberAttribute();

<span class="nc" id="L1823">                m_CurrentVis.addPlot(tempd);</span>
                // m_CurrentVis.setColourIndex(predInstances.classIndex()+1);
<span class="nc" id="L1825">                m_CurrentVis.setColourIndex(predInstances.classIndex());</span>

<span class="nc" id="L1827">                FastVector vv = new FastVector();</span>
<span class="nc bnc" id="L1828" title="All 6 branches missed.">                if (outputModel) {</span>
<span class="nc" id="L1829">                  vv.addElement(fullClassifier);</span>
<span class="nc" id="L1830">                  Instances trainHeader = new Instances(m_Instances, 0);</span>
<span class="nc" id="L1831">                  trainHeader.setClassIndex(classIndex);</span>
<span class="nc" id="L1832">                  vv.addElement(trainHeader);</span>
<span class="nc bnc" id="L1833" title="All 6 branches missed.">                  if (grph != null) {</span>
<span class="nc" id="L1834">                    vv.addElement(grph);</span>
                  }
                }
<span class="nc" id="L1837">                vv.addElement(m_CurrentVis);</span>

<span class="nc bnc" id="L1839" title="All 12 branches missed.">                if ((eval != null) &amp;&amp; (eval.predictions() != null)) {</span>
<span class="nc" id="L1840">                  vv.addElement(eval.predictions());</span>
<span class="nc" id="L1841">                  vv.addElement(inst.classAttribute());</span>
                }
<span class="nc" id="L1843">                m_History.addObject(name, vv);</span>
              }
<span class="nc" id="L1845">            } catch (Exception ex) {</span>
<span class="nc" id="L1846">              ex.printStackTrace();</span>
            }

<span class="nc bnc" id="L1849" title="All 6 branches missed.">            if (isInterrupted()) {</span>
<span class="nc" id="L1850">              m_Log.logMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L1851">                  &quot;ClassifierPanel_StartClassifier_Log_LogMessage_Text_Eighth&quot;)</span>
<span class="nc" id="L1852">                  + cname);</span>
<span class="nc" id="L1853">              m_Log</span>
<span class="nc" id="L1854">                  .statusMessage(Messages</span>
<span class="nc" id="L1855">                      .getInstance()</span>
<span class="nc" id="L1856">                      .getString(</span>
<span class="nc" id="L1857">                          &quot;ClassifierPanel_StartClassifier_Log_StatusMessage_Text_TwentyFourth&quot;));</span>
            }

<span class="nc" id="L1860">            synchronized (this) {</span>
<span class="nc" id="L1861">              m_StartBut.setEnabled(true);</span>
<span class="nc" id="L1862">              m_StopBut.setEnabled(false);</span>
<span class="nc" id="L1863">              m_RunThread = null;</span>
            }
<span class="nc bnc" id="L1865" title="All 6 branches missed.">            if (m_Log instanceof TaskLogger) {</span>
<span class="nc" id="L1866">              ((TaskLogger) m_Log).taskFinished();</span>
            }
<span class="nc" id="L1868">          }</span>
<span class="nc" id="L1869">        }</span>
      };
<span class="nc" id="L1871">      m_RunThread.setPriority(Thread.MIN_PRIORITY);</span>
<span class="nc" id="L1872">      m_RunThread.start();</span>
    }
<span class="nc" id="L1874">  }</span>

  /**
   * generates a prediction row for an instance
   * 
   * @param classifier the classifier to use for making the prediction
   * @param inst the instance to predict
   * @param instNum the index of the instance
   * @throws Exception if something goes wrong
   * @return the generated row
   */
  protected String predictionText(Classifier classifier, Instance inst,
      int instNum) throws Exception {

    // &gt; inst# actual predicted error probability distribution

<span class="nc" id="L1890">    StringBuffer text = new StringBuffer();</span>
    // inst #
<span class="nc" id="L1892">    text.append(Utils.padLeft(&quot;&quot; + instNum, 6) + &quot; &quot;);</span>
<span class="nc bnc" id="L1893" title="All 2 branches missed.">    if (inst.classAttribute().isNominal()) {</span>

      // actual
<span class="nc bnc" id="L1896" title="All 2 branches missed.">      if (inst.classIsMissing())</span>
<span class="nc" id="L1897">        text.append(Utils.padLeft(&quot;?&quot;, 10) + &quot; &quot;);</span>
      else
<span class="nc" id="L1899">        text.append(Utils.padLeft(&quot;&quot; + ((int) inst.classValue() + 1) + &quot;:&quot;</span>
<span class="nc" id="L1900">            + inst.stringValue(inst.classAttribute()), 10)</span>
<span class="nc" id="L1901">            + &quot; &quot;);</span>

      // predicted
<span class="nc" id="L1904">      double[] probdist = null;</span>
      double pred;
<span class="nc bnc" id="L1906" title="All 2 branches missed.">      if (inst.classAttribute().isNominal()) {</span>
<span class="nc" id="L1907">        probdist = classifier.distributionForInstance(inst);</span>
<span class="nc" id="L1908">        pred = Utils.maxIndex(probdist);</span>
<span class="nc bnc" id="L1909" title="All 2 branches missed.">        if (probdist[(int) pred] &lt;= 0.0)</span>
<span class="nc" id="L1910">          pred = Instance.missingValue();</span>
      } else {
<span class="nc" id="L1912">        pred = classifier.classifyInstance(inst);</span>
      }
<span class="nc" id="L1914">      text.append(Utils.padLeft(</span>
<span class="nc bnc" id="L1915" title="All 2 branches missed.">          (Instance.isMissingValue(pred) ? &quot;?&quot; : (((int) pred + 1) + &quot;:&quot; + inst</span>
<span class="nc" id="L1916">              .classAttribute().value((int) pred))), 10)</span>
<span class="nc" id="L1917">          + &quot; &quot;);</span>
      // error
<span class="nc bnc" id="L1919" title="All 2 branches missed.">      if (pred == inst.classValue())</span>
<span class="nc" id="L1920">        text.append(Utils.padLeft(&quot; &quot;, 6) + &quot; &quot;);</span>
      else
<span class="nc" id="L1922">        text.append(Utils.padLeft(&quot;+&quot;, 6) + &quot; &quot;);</span>

      // prob dist
<span class="nc bnc" id="L1925" title="All 2 branches missed.">      if (inst.classAttribute().type() == Attribute.NOMINAL) {</span>
<span class="nc bnc" id="L1926" title="All 2 branches missed.">        for (int i = 0; i &lt; probdist.length; i++) {</span>
<span class="nc bnc" id="L1927" title="All 2 branches missed.">          if (i == (int) pred)</span>
<span class="nc" id="L1928">            text.append(&quot; *&quot;);</span>
          else
<span class="nc" id="L1930">            text.append(&quot;  &quot;);</span>
<span class="nc" id="L1931">          text.append(Utils.doubleToString(probdist[i], 5, 3));</span>
        }
      }
    } else {

      // actual
<span class="nc bnc" id="L1937" title="All 2 branches missed.">      if (inst.classIsMissing())</span>
<span class="nc" id="L1938">        text.append(Utils.padLeft(&quot;?&quot;, 10) + &quot; &quot;);</span>
      else
<span class="nc" id="L1940">        text.append(Utils.doubleToString(inst.classValue(), 10, 3) + &quot; &quot;);</span>

      // predicted
<span class="nc" id="L1943">      double pred = classifier.classifyInstance(inst);</span>
<span class="nc bnc" id="L1944" title="All 2 branches missed.">      if (Instance.isMissingValue(pred))</span>
<span class="nc" id="L1945">        text.append(Utils.padLeft(&quot;?&quot;, 10) + &quot; &quot;);</span>
      else
<span class="nc" id="L1947">        text.append(Utils.doubleToString(pred, 10, 3) + &quot; &quot;);</span>

      // err
<span class="nc bnc" id="L1950" title="All 4 branches missed.">      if (!inst.classIsMissing() &amp;&amp; !Instance.isMissingValue(pred))</span>
<span class="nc" id="L1951">        text.append(Utils.doubleToString(pred - inst.classValue(), 10, 3));</span>
    }

    // additional Attributes
<span class="nc bnc" id="L1955" title="All 2 branches missed.">    if (m_OutputAdditionalAttributesRange != null) {</span>
<span class="nc" id="L1956">      text.append(&quot; (&quot;);</span>
<span class="nc" id="L1957">      boolean first = true;</span>
<span class="nc bnc" id="L1958" title="All 2 branches missed.">      for (int i = 0; i &lt; inst.numAttributes() - 1; i++) {</span>
<span class="nc bnc" id="L1959" title="All 2 branches missed.">        if (m_OutputAdditionalAttributesRange.isInRange(i)) {</span>
<span class="nc bnc" id="L1960" title="All 2 branches missed.">          if (!first)</span>
<span class="nc" id="L1961">            text.append(&quot;,&quot;);</span>
          else
<span class="nc" id="L1963">            first = false;</span>
<span class="nc" id="L1964">          text.append(inst.toString(i));</span>
        }
      }
<span class="nc" id="L1967">      text.append(&quot;)&quot;);</span>
    }

<span class="nc" id="L1970">    text.append(&quot;\n&quot;);</span>
<span class="nc" id="L1971">    return text.toString();</span>
  }

  /**
   * Handles constructing a popup menu with visualization options.
   * 
   * @param name the name of the result history list entry clicked on by the
   *          user
   * @param x the x coordinate for popping up the menu
   * @param y the y coordinate for popping up the menu
   */
  protected void visualize(String name, int x, int y) {
<span class="nc" id="L1983">    final String selectedName = name;</span>
<span class="nc" id="L1984">    JPopupMenu resultListMenu = new JPopupMenu();</span>

<span class="nc" id="L1986">    JMenuItem visMainBuffer = new JMenuItem(Messages.getInstance().getString(</span>
<span class="nc" id="L1987">        &quot;ClassifierPanel_Visualize_VisMainBuffer_JMenuItem_Text&quot;));</span>
<span class="nc bnc" id="L1988" title="All 2 branches missed.">    if (selectedName != null) {</span>
<span class="nc" id="L1989">      visMainBuffer.addActionListener(new ActionListener() {</span>
        @Override
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1992">          m_History.setSingle(selectedName);</span>
<span class="nc" id="L1993">        }</span>
      });
    } else {
<span class="nc" id="L1996">      visMainBuffer.setEnabled(false);</span>
    }
<span class="nc" id="L1998">    resultListMenu.add(visMainBuffer);</span>

<span class="nc" id="L2000">    JMenuItem visSepBuffer = new JMenuItem(Messages.getInstance().getString(</span>
<span class="nc" id="L2001">        &quot;ClassifierPanel_Visualize_VisSepBuffer_JMenuItem_Text&quot;));</span>
<span class="nc bnc" id="L2002" title="All 2 branches missed.">    if (selectedName != null) {</span>
<span class="nc" id="L2003">      visSepBuffer.addActionListener(new ActionListener() {</span>
        @Override
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2006">          m_History.openFrame(selectedName);</span>
<span class="nc" id="L2007">        }</span>
      });
    } else {
<span class="nc" id="L2010">      visSepBuffer.setEnabled(false);</span>
    }
<span class="nc" id="L2012">    resultListMenu.add(visSepBuffer);</span>

<span class="nc" id="L2014">    JMenuItem saveOutput = new JMenuItem(Messages.getInstance().getString(</span>
<span class="nc" id="L2015">        &quot;ClassifierPanel_Visualize_SaveOutput_JMenuItem_Text&quot;));</span>
<span class="nc bnc" id="L2016" title="All 2 branches missed.">    if (selectedName != null) {</span>
<span class="nc" id="L2017">      saveOutput.addActionListener(new ActionListener() {</span>
        @Override
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2020">          saveBuffer(selectedName);</span>
<span class="nc" id="L2021">        }</span>
      });
    } else {
<span class="nc" id="L2024">      saveOutput.setEnabled(false);</span>
    }
<span class="nc" id="L2026">    resultListMenu.add(saveOutput);</span>

<span class="nc" id="L2028">    JMenuItem deleteOutput = new JMenuItem(Messages.getInstance().getString(</span>
<span class="nc" id="L2029">        &quot;ClassifierPanel_Visualize_DeleteOutput_JMenuItem_Text&quot;));</span>
<span class="nc bnc" id="L2030" title="All 2 branches missed.">    if (selectedName != null) {</span>
<span class="nc" id="L2031">      deleteOutput.addActionListener(new ActionListener() {</span>
        @Override
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2034">          m_History.removeResult(selectedName);</span>
<span class="nc" id="L2035">        }</span>
      });
    } else {
<span class="nc" id="L2038">      deleteOutput.setEnabled(false);</span>
    }
<span class="nc" id="L2040">    resultListMenu.add(deleteOutput);</span>

<span class="nc" id="L2042">    resultListMenu.addSeparator();</span>

<span class="nc" id="L2044">    JMenuItem loadModel = new JMenuItem(Messages.getInstance().getString(</span>
<span class="nc" id="L2045">        &quot;ClassifierPanel_Visualize_LoadModel_JMenuItem_Text&quot;));</span>
<span class="nc" id="L2046">    loadModel.addActionListener(new ActionListener() {</span>
      @Override
      public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2049">        loadClassifier();</span>
<span class="nc" id="L2050">      }</span>
    });
<span class="nc" id="L2052">    resultListMenu.add(loadModel);</span>

<span class="nc" id="L2054">    FastVector o = null;</span>
<span class="nc bnc" id="L2055" title="All 2 branches missed.">    if (selectedName != null) {</span>
<span class="nc" id="L2056">      o = (FastVector) m_History.getNamedObject(selectedName);</span>
    }

<span class="nc" id="L2059">    VisualizePanel temp_vp = null;</span>
<span class="nc" id="L2060">    String temp_grph = null;</span>
<span class="nc" id="L2061">    FastVector temp_preds = null;</span>
<span class="nc" id="L2062">    Attribute temp_classAtt = null;</span>
<span class="nc" id="L2063">    Classifier temp_classifier = null;</span>
<span class="nc" id="L2064">    Instances temp_trainHeader = null;</span>

<span class="nc bnc" id="L2066" title="All 2 branches missed.">    if (o != null) {</span>
<span class="nc bnc" id="L2067" title="All 2 branches missed.">      for (int i = 0; i &lt; o.size(); i++) {</span>
<span class="nc" id="L2068">        Object temp = o.elementAt(i);</span>
<span class="nc bnc" id="L2069" title="All 2 branches missed.">        if (temp instanceof Classifier) {</span>
<span class="nc" id="L2070">          temp_classifier = (Classifier) temp;</span>
<span class="nc bnc" id="L2071" title="All 2 branches missed.">        } else if (temp instanceof Instances) { // training header</span>
<span class="nc" id="L2072">          temp_trainHeader = (Instances) temp;</span>
<span class="nc bnc" id="L2073" title="All 2 branches missed.">        } else if (temp instanceof VisualizePanel) { // normal errors</span>
<span class="nc" id="L2074">          temp_vp = (VisualizePanel) temp;</span>
<span class="nc bnc" id="L2075" title="All 2 branches missed.">        } else if (temp instanceof String) { // graphable output</span>
<span class="nc" id="L2076">          temp_grph = (String) temp;</span>
<span class="nc bnc" id="L2077" title="All 2 branches missed.">        } else if (temp instanceof FastVector) { // predictions</span>
<span class="nc" id="L2078">          temp_preds = (FastVector) temp;</span>
<span class="nc bnc" id="L2079" title="All 2 branches missed.">        } else if (temp instanceof Attribute) { // class attribute</span>
<span class="nc" id="L2080">          temp_classAtt = (Attribute) temp;</span>
        }
      }
    }

<span class="nc" id="L2085">    final VisualizePanel vp = temp_vp;</span>
<span class="nc" id="L2086">    final String grph = temp_grph;</span>
<span class="nc" id="L2087">    final FastVector preds = temp_preds;</span>
<span class="nc" id="L2088">    final Attribute classAtt = temp_classAtt;</span>
<span class="nc" id="L2089">    final Classifier classifier = temp_classifier;</span>
<span class="nc" id="L2090">    final Instances trainHeader = temp_trainHeader;</span>

<span class="nc" id="L2092">    JMenuItem saveModel = new JMenuItem(Messages.getInstance().getString(</span>
<span class="nc" id="L2093">        &quot;ClassifierPanel_Visualize_SaveModel_JMenuItem_Text&quot;));</span>
<span class="nc bnc" id="L2094" title="All 2 branches missed.">    if (classifier != null) {</span>
<span class="nc" id="L2095">      saveModel.addActionListener(new ActionListener() {</span>
        @Override
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2098">          saveClassifier(selectedName, classifier, trainHeader);</span>
<span class="nc" id="L2099">        }</span>
      });
    } else {
<span class="nc" id="L2102">      saveModel.setEnabled(false);</span>
    }
<span class="nc" id="L2104">    resultListMenu.add(saveModel);</span>

<span class="nc" id="L2106">    JMenuItem reEvaluate = new JMenuItem(Messages.getInstance().getString(</span>
<span class="nc" id="L2107">        &quot;ClassifierPanel_Visualize_ReEvaluate_JMenuItem_Text&quot;));</span>
<span class="nc bnc" id="L2108" title="All 4 branches missed.">    if (classifier != null &amp;&amp; m_TestLoader != null) {</span>
<span class="nc" id="L2109">      reEvaluate.addActionListener(new ActionListener() {</span>
        @Override
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2112">          reevaluateModel(selectedName, classifier, trainHeader);</span>
<span class="nc" id="L2113">        }</span>
      });
    } else {
<span class="nc" id="L2116">      reEvaluate.setEnabled(false);</span>
    }
<span class="nc" id="L2118">    resultListMenu.add(reEvaluate);</span>

<span class="nc" id="L2120">    resultListMenu.addSeparator();</span>

<span class="nc" id="L2122">    JMenuItem visErrors = new JMenuItem(Messages.getInstance().getString(</span>
<span class="nc" id="L2123">        &quot;ClassifierPanel_Visualize_VisErrors_JMenuItem_Text&quot;));</span>
<span class="nc bnc" id="L2124" title="All 2 branches missed.">    if (vp != null) {</span>
<span class="nc bnc" id="L2125" title="All 4 branches missed.">      if ((vp.getXIndex() == 0) &amp;&amp; (vp.getYIndex() == 1)) {</span>
        try {
<span class="nc" id="L2127">          vp.setXIndex(vp.getInstances().classIndex()); // class</span>
<span class="nc" id="L2128">          vp.setYIndex(vp.getInstances().classIndex() - 1); // predicted class</span>
<span class="nc" id="L2129">        } catch (Exception e) {</span>
          // ignored
        }
      }
<span class="nc" id="L2133">      visErrors.addActionListener(new ActionListener() {</span>
        @Override
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2136">          visualizeClassifierErrors(vp);</span>
<span class="nc" id="L2137">        }</span>
      });
    } else {
<span class="nc" id="L2140">      visErrors.setEnabled(false);</span>
    }
<span class="nc" id="L2142">    resultListMenu.add(visErrors);</span>

<span class="nc" id="L2144">    JMenuItem visGrph = new JMenuItem(Messages.getInstance().getString(</span>
<span class="nc" id="L2145">        &quot;ClassifierPanel_Visualize_VisGrph_JMenuItem_Text_First&quot;));</span>
<span class="nc bnc" id="L2146" title="All 2 branches missed.">    if (grph != null) {</span>
<span class="nc bnc" id="L2147" title="All 2 branches missed.">      if (((Drawable) temp_classifier).graphType() == Drawable.TREE) {</span>
<span class="nc" id="L2148">        visGrph.addActionListener(new ActionListener() {</span>
          @Override
          public void actionPerformed(ActionEvent e) {
            String title;
<span class="nc bnc" id="L2152" title="All 2 branches missed.">            if (vp != null)</span>
<span class="nc" id="L2153">              title = vp.getName();</span>
            else
<span class="nc" id="L2155">              title = selectedName;</span>
<span class="nc" id="L2156">            visualizeTree(grph, title);</span>
<span class="nc" id="L2157">          }</span>
        });
<span class="nc bnc" id="L2159" title="All 2 branches missed.">      } else if (((Drawable) temp_classifier).graphType() == Drawable.BayesNet) {</span>
<span class="nc" id="L2160">        visGrph.setText(Messages.getInstance().getString(</span>
<span class="nc" id="L2161">            &quot;ClassifierPanel_Visualize_VisGrph_JMenuItem_Text_Second&quot;));</span>
<span class="nc" id="L2162">        visGrph.addActionListener(new ActionListener() {</span>
          @Override
          public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2165">            Thread th = new Thread() {</span>
              @Override
              public void run() {
<span class="nc" id="L2168">                visualizeBayesNet(grph, selectedName);</span>
<span class="nc" id="L2169">              }</span>
            };
<span class="nc" id="L2171">            th.start();</span>
<span class="nc" id="L2172">          }</span>
        });
      } else
<span class="nc" id="L2175">        visGrph.setEnabled(false);</span>
    } else {
<span class="nc" id="L2177">      visGrph.setEnabled(false);</span>
    }
<span class="nc" id="L2179">    resultListMenu.add(visGrph);</span>

<span class="nc" id="L2181">    JMenuItem visMargin = new JMenuItem(Messages.getInstance().getString(</span>
<span class="nc" id="L2182">        &quot;ClassifierPanel_Visualize_VisMargin_JMenuItem_Text&quot;));</span>
<span class="nc bnc" id="L2183" title="All 2 branches missed.">    if (preds != null) {</span>
<span class="nc" id="L2184">      visMargin.addActionListener(new ActionListener() {</span>
        @Override
        public void actionPerformed(ActionEvent e) {
          try {
<span class="nc" id="L2188">            MarginCurve tc = new MarginCurve();</span>
<span class="nc" id="L2189">            Instances result = tc.getCurve(preds);</span>
<span class="nc" id="L2190">            VisualizePanel vmc = new VisualizePanel();</span>
<span class="nc" id="L2191">            vmc.setName(result.relationName());</span>
<span class="nc" id="L2192">            vmc.setLog(m_Log);</span>
<span class="nc" id="L2193">            PlotData2D tempd = new PlotData2D(result);</span>
<span class="nc" id="L2194">            tempd.setPlotName(result.relationName());</span>
<span class="nc" id="L2195">            tempd.addInstanceNumberAttribute();</span>
<span class="nc" id="L2196">            vmc.addPlot(tempd);</span>
<span class="nc" id="L2197">            visualizeClassifierErrors(vmc);</span>
<span class="nc" id="L2198">          } catch (Exception ex) {</span>
<span class="nc" id="L2199">            ex.printStackTrace();</span>
          }
<span class="nc" id="L2201">        }</span>
      });
    } else {
<span class="nc" id="L2204">      visMargin.setEnabled(false);</span>
    }
<span class="nc" id="L2206">    resultListMenu.add(visMargin);</span>

<span class="nc" id="L2208">    JMenu visThreshold = new JMenu(Messages.getInstance().getString(</span>
<span class="nc" id="L2209">        &quot;ClassifierPanel_Visualize_VisThreshold_JMenu_Text&quot;));</span>
<span class="nc bnc" id="L2210" title="All 4 branches missed.">    if (preds != null &amp;&amp; classAtt != null) {</span>
<span class="nc bnc" id="L2211" title="All 2 branches missed.">      for (int i = 0; i &lt; classAtt.numValues(); i++) {</span>
<span class="nc" id="L2212">        JMenuItem clv = new JMenuItem(classAtt.value(i));</span>
<span class="nc" id="L2213">        final int classValue = i;</span>
<span class="nc" id="L2214">        clv.addActionListener(new ActionListener() {</span>
          @Override
          public void actionPerformed(ActionEvent e) {
            try {
<span class="nc" id="L2218">              ThresholdCurve tc = new ThresholdCurve();</span>
<span class="nc" id="L2219">              Instances result = tc.getCurve(preds, classValue);</span>
              // VisualizePanel vmc = new VisualizePanel();
<span class="nc" id="L2221">              ThresholdVisualizePanel vmc = new ThresholdVisualizePanel();</span>
<span class="nc" id="L2222">              vmc.setROCString(Messages.getInstance().getString(</span>
<span class="nc" id="L2223">                  &quot;ClassifierPanel_Visualize_VMC_SetROCString_Text_First&quot;)</span>
<span class="nc" id="L2224">                  + Utils.doubleToString(ThresholdCurve.getROCArea(result), 4)</span>
<span class="nc" id="L2225">                  + Messages.getInstance().getString(</span>
<span class="nc" id="L2226">                      &quot;ClassifierPanel_Visualize_VMC_SetROCString_Text_Second&quot;));</span>
<span class="nc" id="L2227">              vmc.setLog(m_Log);</span>
<span class="nc" id="L2228">              vmc.setName(result.relationName()</span>
<span class="nc" id="L2229">                  + Messages.getInstance().getString(</span>
<span class="nc" id="L2230">                      &quot;ClassifierPanel_Visualize_VMC_SetName_Text_First&quot;)</span>
<span class="nc" id="L2231">                  + classAtt.value(classValue)</span>
<span class="nc" id="L2232">                  + Messages.getInstance().getString(</span>
<span class="nc" id="L2233">                      &quot;ClassifierPanel_Visualize_VMC_SetName_Text_Second&quot;));</span>
<span class="nc" id="L2234">              PlotData2D tempd = new PlotData2D(result);</span>
<span class="nc" id="L2235">              tempd.setPlotName(result.relationName());</span>
<span class="nc" id="L2236">              tempd.addInstanceNumberAttribute();</span>
              // specify which points are connected
<span class="nc" id="L2238">              boolean[] cp = new boolean[result.numInstances()];</span>
<span class="nc bnc" id="L2239" title="All 2 branches missed.">              for (int n = 1; n &lt; cp.length; n++)</span>
<span class="nc" id="L2240">                cp[n] = true;</span>
<span class="nc" id="L2241">              tempd.setConnectPoints(cp);</span>
              // add plot
<span class="nc" id="L2243">              vmc.addPlot(tempd);</span>
<span class="nc" id="L2244">              visualizeClassifierErrors(vmc);</span>
<span class="nc" id="L2245">            } catch (Exception ex) {</span>
<span class="nc" id="L2246">              ex.printStackTrace();</span>
            }
<span class="nc" id="L2248">          }</span>
        });
<span class="nc" id="L2250">        visThreshold.add(clv);</span>
      }
    } else {
<span class="nc" id="L2253">      visThreshold.setEnabled(false);</span>
    }
<span class="nc" id="L2255">    resultListMenu.add(visThreshold);</span>

<span class="nc" id="L2257">    JMenu visCostBenefit = new JMenu(Messages.getInstance().getString(</span>
<span class="nc" id="L2258">        &quot;ClassifierPanel_Visualize_VisCostBenefit_JMenu_Text&quot;));</span>
<span class="nc bnc" id="L2259" title="All 6 branches missed.">    if ((preds != null) &amp;&amp; (classAtt != null) &amp;&amp; (classAtt.isNominal())) {</span>
<span class="nc bnc" id="L2260" title="All 2 branches missed.">      for (int i = 0; i &lt; classAtt.numValues(); i++) {</span>
<span class="nc" id="L2261">        JMenuItem clv = new JMenuItem(classAtt.value(i));</span>
<span class="nc" id="L2262">        final int classValue = i;</span>
<span class="nc" id="L2263">        clv.addActionListener(new ActionListener() {</span>
          @Override
          public void actionPerformed(ActionEvent e) {
            try {
<span class="nc" id="L2267">              ThresholdCurve tc = new ThresholdCurve();</span>
<span class="nc" id="L2268">              Instances result = tc.getCurve(preds, classValue);</span>

              // Create a dummy class attribute with the chosen
              // class value as index 0 (if necessary).
<span class="nc" id="L2272">              Attribute classAttToUse = classAtt;</span>
<span class="nc bnc" id="L2273" title="All 2 branches missed.">              if (classValue != 0) {</span>
<span class="nc" id="L2274">                FastVector newNames = new FastVector();</span>
<span class="nc" id="L2275">                newNames.addElement(classAtt.value(classValue));</span>
<span class="nc bnc" id="L2276" title="All 2 branches missed.">                for (int k = 0; k &lt; classAtt.numValues(); k++) {</span>
<span class="nc bnc" id="L2277" title="All 2 branches missed.">                  if (k != classValue) {</span>
<span class="nc" id="L2278">                    newNames.addElement(classAtt.value(k));</span>
                  }
                }
<span class="nc" id="L2281">                classAttToUse = new Attribute(classAtt.name(), newNames);</span>
              }

<span class="nc" id="L2284">              CostBenefitAnalysis cbAnalysis = new CostBenefitAnalysis();</span>

<span class="nc" id="L2286">              PlotData2D tempd = new PlotData2D(result);</span>
<span class="nc" id="L2287">              tempd.setPlotName(result.relationName());</span>
<span class="nc" id="L2288">              tempd.m_alwaysDisplayPointsOfThisSize = 10;</span>
              // specify which points are connected
<span class="nc" id="L2290">              boolean[] cp = new boolean[result.numInstances()];</span>
<span class="nc bnc" id="L2291" title="All 2 branches missed.">              for (int n = 1; n &lt; cp.length; n++)</span>
<span class="nc" id="L2292">                cp[n] = true;</span>
<span class="nc" id="L2293">              tempd.setConnectPoints(cp);</span>

<span class="nc" id="L2295">              String windowTitle = &quot;&quot;;</span>
<span class="nc bnc" id="L2296" title="All 2 branches missed.">              if (classifier != null) {</span>
<span class="nc" id="L2297">                String cname = classifier.getClass().getName();</span>
<span class="nc bnc" id="L2298" title="All 2 branches missed.">                if (cname.startsWith(&quot;weka.classifiers.&quot;)) {</span>
<span class="nc" id="L2299">                  windowTitle = &quot;&quot;</span>
<span class="nc" id="L2300">                      + cname.substring(&quot;weka.classifiers.&quot;.length()) + &quot; &quot;;</span>
                }
              }
<span class="nc" id="L2303">              windowTitle += Messages.getInstance().getString(</span>
<span class="nc" id="L2304">                  &quot;ClassifierPanel_Visualize_WindowTitle_Text_First&quot;)</span>
<span class="nc" id="L2305">                  + classAttToUse.value(0)</span>
<span class="nc" id="L2306">                  + Messages.getInstance().getString(</span>
<span class="nc" id="L2307">                      &quot;ClassifierPanel_Visualize_WindowTitle_Text_Second&quot;);</span>

              // add plot
<span class="nc" id="L2310">              cbAnalysis.setCurveData(tempd, classAttToUse);</span>
<span class="nc" id="L2311">              visualizeCostBenefitAnalysis(cbAnalysis, windowTitle);</span>
<span class="nc" id="L2312">            } catch (Exception ex) {</span>
<span class="nc" id="L2313">              ex.printStackTrace();</span>
            }
<span class="nc" id="L2315">          }</span>
        });
<span class="nc" id="L2317">        visCostBenefit.add(clv);</span>
      }
    } else {
<span class="nc" id="L2320">      visCostBenefit.setEnabled(false);</span>
    }
<span class="nc" id="L2322">    resultListMenu.add(visCostBenefit);</span>

<span class="nc" id="L2324">    JMenu visCost = new JMenu(Messages.getInstance().getString(</span>
<span class="nc" id="L2325">        &quot;ClassifierPanel_VisCost_JMenu_Text&quot;));</span>
<span class="nc bnc" id="L2326" title="All 4 branches missed.">    if (preds != null &amp;&amp; classAtt != null) {</span>
<span class="nc bnc" id="L2327" title="All 2 branches missed.">      for (int i = 0; i &lt; classAtt.numValues(); i++) {</span>
<span class="nc" id="L2328">        JMenuItem clv = new JMenuItem(classAtt.value(i));</span>
<span class="nc" id="L2329">        final int classValue = i;</span>
<span class="nc" id="L2330">        clv.addActionListener(new ActionListener() {</span>
          @Override
          public void actionPerformed(ActionEvent e) {
            try {
<span class="nc" id="L2334">              CostCurve cc = new CostCurve();</span>
<span class="nc" id="L2335">              Instances result = cc.getCurve(preds, classValue);</span>
<span class="nc" id="L2336">              VisualizePanel vmc = new VisualizePanel();</span>
<span class="nc" id="L2337">              vmc.setLog(m_Log);</span>
<span class="nc" id="L2338">              vmc.setName(result.relationName()</span>
<span class="nc" id="L2339">                  + Messages.getInstance().getString(</span>
<span class="nc" id="L2340">                      &quot;ClassifierPanel_Visualize_VMC_SetName_Text_Third&quot;)</span>
<span class="nc" id="L2341">                  + classAtt.value(classValue)</span>
<span class="nc" id="L2342">                  + Messages.getInstance().getString(</span>
<span class="nc" id="L2343">                      &quot;ClassifierPanel_Visualize_VMC_SetName_Text_Fourth&quot;));</span>
<span class="nc" id="L2344">              PlotData2D tempd = new PlotData2D(result);</span>
<span class="nc" id="L2345">              tempd.m_displayAllPoints = true;</span>
<span class="nc" id="L2346">              tempd.setPlotName(result.relationName());</span>
<span class="nc" id="L2347">              boolean[] connectPoints = new boolean[result.numInstances()];</span>
<span class="nc bnc" id="L2348" title="All 2 branches missed.">              for (int jj = 1; jj &lt; connectPoints.length; jj += 2) {</span>
<span class="nc" id="L2349">                connectPoints[jj] = true;</span>
              }
<span class="nc" id="L2351">              tempd.setConnectPoints(connectPoints);</span>
              // tempd.addInstanceNumberAttribute();
<span class="nc" id="L2353">              vmc.addPlot(tempd);</span>
<span class="nc" id="L2354">              visualizeClassifierErrors(vmc);</span>
<span class="nc" id="L2355">            } catch (Exception ex) {</span>
<span class="nc" id="L2356">              ex.printStackTrace();</span>
            }
<span class="nc" id="L2358">          }</span>
        });
<span class="nc" id="L2360">        visCost.add(clv);</span>
      }
    } else {
<span class="nc" id="L2363">      visCost.setEnabled(false);</span>
    }
<span class="nc" id="L2365">    resultListMenu.add(visCost);</span>

<span class="nc" id="L2367">    JMenu visPlugins = new JMenu(Messages.getInstance().getString(</span>
<span class="nc" id="L2368">        &quot;ClassifierPanel_Visualize_VisPlugins_JMenu_Text&quot;));</span>
<span class="nc" id="L2369">    Vector pluginsVector = GenericObjectEditor</span>
<span class="nc" id="L2370">        .getClassnames(VisualizePlugin.class.getName());</span>
<span class="nc" id="L2371">    boolean availablePlugins = false;</span>

<span class="nc bnc" id="L2373" title="All 2 branches missed.">    for (int i = 0; i &lt; pluginsVector.size(); i++) {</span>
<span class="nc" id="L2374">      String className = (String) (pluginsVector.elementAt(i));</span>
      try {
<span class="nc" id="L2376">        VisualizePlugin plugin = (VisualizePlugin) Class.forName(className)</span>
<span class="nc" id="L2377">            .newInstance();</span>
<span class="nc bnc" id="L2378" title="All 2 branches missed.">        if (plugin == null)</span>
<span class="nc" id="L2379">          continue;</span>
<span class="nc" id="L2380">        availablePlugins = true;</span>
<span class="nc" id="L2381">        JMenuItem pluginMenuItem = plugin.getVisualizeMenuItem(preds, classAtt);</span>
<span class="nc" id="L2382">        Version version = new Version();</span>
<span class="nc bnc" id="L2383" title="All 2 branches missed.">        if (pluginMenuItem != null) {</span>
          /*
           * if (version.compareTo(plugin.getMinVersion()) &lt; 0)
           * pluginMenuItem.setText(pluginMenuItem.getText() +
           * Messages.getInstance().getString(
           * &quot;ClassifierPanel_Visualize_PluginMenuItemSetText_Text_First&quot;)); if
           * (version.compareTo(plugin.getMaxVersion()) &gt;= 0)
           * pluginMenuItem.setText(pluginMenuItem.getText() +
           * Messages.getInstance().getString(
           * &quot;ClassifierPanel_Visualize_PluginMenuItemSetText_Text_Second&quot;));
           */
<span class="nc" id="L2394">          visPlugins.add(pluginMenuItem);</span>
        }
<span class="nc" id="L2396">      } catch (ClassNotFoundException cnfe) {</span>
        // System.out.println(&quot;Visualize plugin ClassNotFoundException &quot; +
        // cnfe.getMessage());
<span class="nc" id="L2399">      } catch (InstantiationException ie) {</span>
        // System.out.println(&quot;Visualize plugin InstantiationException &quot; +
        // ie.getMessage());
<span class="nc" id="L2402">      } catch (IllegalAccessException iae) {</span>
        // System.out.println(&quot;Visualize plugin IllegalAccessException &quot; +
        // iae.getMessage());
      }
    }

    // errors
<span class="nc" id="L2409">    pluginsVector = GenericObjectEditor</span>
<span class="nc" id="L2410">        .getClassnames(ErrorVisualizePlugin.class.getName());</span>
<span class="nc bnc" id="L2411" title="All 2 branches missed.">    for (int i = 0; i &lt; pluginsVector.size(); i++) {</span>
<span class="nc" id="L2412">      String className = (String) (pluginsVector.elementAt(i));</span>
      try {
<span class="nc" id="L2414">        ErrorVisualizePlugin plugin = (ErrorVisualizePlugin) Class.forName(</span>
<span class="nc" id="L2415">            className).newInstance();</span>
<span class="nc bnc" id="L2416" title="All 2 branches missed.">        if (plugin == null)</span>
<span class="nc" id="L2417">          continue;</span>
<span class="nc" id="L2418">        availablePlugins = true;</span>
<span class="nc" id="L2419">        JMenuItem pluginMenuItem = plugin.getVisualizeMenuItem(vp</span>
<span class="nc" id="L2420">            .getInstances());</span>
<span class="nc" id="L2421">        Version version = new Version();</span>
<span class="nc bnc" id="L2422" title="All 2 branches missed.">        if (pluginMenuItem != null) {</span>
          /*
           * if (version.compareTo(plugin.getMinVersion()) &lt; 0)
           * pluginMenuItem.setText(pluginMenuItem.getText() +
           * &quot; (weka outdated)&quot;); if (version.compareTo(plugin.getMaxVersion())
           * &gt;= 0) pluginMenuItem.setText(pluginMenuItem.getText() +
           * &quot; (plugin outdated)&quot;);
           */
<span class="nc" id="L2430">          visPlugins.add(pluginMenuItem);</span>
        }
<span class="nc" id="L2432">      } catch (Exception e) {</span>
        // e.printStackTrace();
      }
    }

    // graphs+trees
<span class="nc bnc" id="L2438" title="All 2 branches missed.">    if (grph != null) {</span>
      // trees
<span class="nc bnc" id="L2440" title="All 2 branches missed.">      if (((Drawable) temp_classifier).graphType() == Drawable.TREE) {</span>
<span class="nc" id="L2441">        pluginsVector = GenericObjectEditor</span>
<span class="nc" id="L2442">            .getClassnames(TreeVisualizePlugin.class.getName());</span>
<span class="nc bnc" id="L2443" title="All 2 branches missed.">        for (int i = 0; i &lt; pluginsVector.size(); i++) {</span>
<span class="nc" id="L2444">          String className = (String) (pluginsVector.elementAt(i));</span>
          try {
<span class="nc" id="L2446">            TreeVisualizePlugin plugin = (TreeVisualizePlugin) Class.forName(</span>
<span class="nc" id="L2447">                className).newInstance();</span>
<span class="nc bnc" id="L2448" title="All 2 branches missed.">            if (plugin == null)</span>
<span class="nc" id="L2449">              continue;</span>
<span class="nc" id="L2450">            availablePlugins = true;</span>
<span class="nc" id="L2451">            JMenuItem pluginMenuItem = plugin.getVisualizeMenuItem(grph,</span>
<span class="nc" id="L2452">                selectedName);</span>
<span class="nc" id="L2453">            Version version = new Version();</span>
<span class="nc bnc" id="L2454" title="All 2 branches missed.">            if (pluginMenuItem != null) {</span>
              /*
               * if (version.compareTo(plugin.getMinVersion()) &lt; 0)
               * pluginMenuItem.setText(pluginMenuItem.getText() +
               * &quot; (weka outdated)&quot;); if
               * (version.compareTo(plugin.getMaxVersion()) &gt;= 0)
               * pluginMenuItem.setText(pluginMenuItem.getText() +
               * &quot; (plugin outdated)&quot;);
               */
<span class="nc" id="L2463">              visPlugins.add(pluginMenuItem);</span>
            }
<span class="nc" id="L2465">          } catch (Exception e) {</span>
            // e.printStackTrace();
          }
        }
      }
      // graphs
      else {
<span class="nc" id="L2472">        pluginsVector = GenericObjectEditor</span>
<span class="nc" id="L2473">            .getClassnames(GraphVisualizePlugin.class.getName());</span>
<span class="nc bnc" id="L2474" title="All 2 branches missed.">        for (int i = 0; i &lt; pluginsVector.size(); i++) {</span>
<span class="nc" id="L2475">          String className = (String) (pluginsVector.elementAt(i));</span>
          try {
<span class="nc" id="L2477">            GraphVisualizePlugin plugin = (GraphVisualizePlugin) Class.forName(</span>
<span class="nc" id="L2478">                className).newInstance();</span>
<span class="nc bnc" id="L2479" title="All 2 branches missed.">            if (plugin == null)</span>
<span class="nc" id="L2480">              continue;</span>
<span class="nc" id="L2481">            availablePlugins = true;</span>
<span class="nc" id="L2482">            JMenuItem pluginMenuItem = plugin.getVisualizeMenuItem(grph,</span>
<span class="nc" id="L2483">                selectedName);</span>
<span class="nc" id="L2484">            Version version = new Version();</span>
<span class="nc bnc" id="L2485" title="All 2 branches missed.">            if (pluginMenuItem != null) {</span>
              /*
               * if (version.compareTo(plugin.getMinVersion()) &lt; 0)
               * pluginMenuItem.setText(pluginMenuItem.getText() +
               * &quot; (weka outdated)&quot;); if
               * (version.compareTo(plugin.getMaxVersion()) &gt;= 0)
               * pluginMenuItem.setText(pluginMenuItem.getText() +
               * &quot; (plugin outdated)&quot;);
               */
<span class="nc" id="L2494">              visPlugins.add(pluginMenuItem);</span>
            }
<span class="nc" id="L2496">          } catch (Exception e) {</span>
            // e.printStackTrace();
          }
        }
      }
    }

<span class="nc bnc" id="L2503" title="All 2 branches missed.">    if (availablePlugins)</span>
<span class="nc" id="L2504">      resultListMenu.add(visPlugins);</span>

<span class="nc" id="L2506">    resultListMenu.show(m_History.getList(), x, y);</span>
<span class="nc" id="L2507">  }</span>

  /**
   * Pops up a TreeVisualizer for the classifier from the currently selected
   * item in the results list
   * 
   * @param dottyString the description of the tree in dotty format
   * @param treeName the title to assign to the display
   */
  protected void visualizeTree(String dottyString, String treeName) {
<span class="nc" id="L2517">    final javax.swing.JFrame jf = new javax.swing.JFrame(Messages.getInstance()</span>
<span class="nc" id="L2518">        .getString(&quot;ClassifierPanel_VisualizeTree_JF_JFrame_Text&quot;) + treeName);</span>
<span class="nc" id="L2519">    jf.setSize(500, 400);</span>
<span class="nc" id="L2520">    jf.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L2521">    TreeVisualizer tv = new TreeVisualizer(null, dottyString, new PlaceNode2());</span>
<span class="nc" id="L2522">    jf.getContentPane().add(tv, BorderLayout.CENTER);</span>
<span class="nc" id="L2523">    jf.addWindowListener(new java.awt.event.WindowAdapter() {</span>
      @Override
      public void windowClosing(java.awt.event.WindowEvent e) {
<span class="nc" id="L2526">        jf.dispose();</span>
<span class="nc" id="L2527">      }</span>
    });

<span class="nc" id="L2530">    jf.setVisible(true);</span>
<span class="nc" id="L2531">    tv.fitToScreen();</span>
<span class="nc" id="L2532">  }</span>

  /**
   * Pops up a GraphVisualizer for the BayesNet classifier from the currently
   * selected item in the results list
   * 
   * @param XMLBIF the description of the graph in XMLBIF ver. 0.3
   * @param graphName the name of the graph
   */
  protected void visualizeBayesNet(String XMLBIF, String graphName) {
<span class="nc" id="L2542">    final javax.swing.JFrame jf = new javax.swing.JFrame(Messages.getInstance()</span>
<span class="nc" id="L2543">        .getString(&quot;ClassifierPanel_VisualizeBayesNet_JF_JFrame_Text&quot;)</span>
<span class="nc" id="L2544">        + graphName);</span>
<span class="nc" id="L2545">    jf.setSize(500, 400);</span>
<span class="nc" id="L2546">    jf.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L2547">    GraphVisualizer gv = new GraphVisualizer();</span>
    try {
<span class="nc" id="L2549">      gv.readBIF(XMLBIF);</span>
<span class="nc" id="L2550">    } catch (BIFFormatException be) {</span>
<span class="nc" id="L2551">      System.err.println(Messages.getInstance().getString(</span>
<span class="nc" id="L2552">          &quot;ClassifierPanel_VisualizeBayesNet_Error_Text&quot;));</span>
<span class="nc" id="L2553">      be.printStackTrace();</span>
    }
<span class="nc" id="L2555">    gv.layoutGraph();</span>

<span class="nc" id="L2557">    jf.getContentPane().add(gv, BorderLayout.CENTER);</span>
<span class="nc" id="L2558">    jf.addWindowListener(new java.awt.event.WindowAdapter() {</span>
      @Override
      public void windowClosing(java.awt.event.WindowEvent e) {
<span class="nc" id="L2561">        jf.dispose();</span>
<span class="nc" id="L2562">      }</span>
    });

<span class="nc" id="L2565">    jf.setVisible(true);</span>
<span class="nc" id="L2566">  }</span>

  /**
   * Pops up a VisualizePanel for visualizing the data and errors for the
   * classifier from the currently selected item in the results list
   * 
   * @param sp the VisualizePanel to pop up.
   */
  protected void visualizeClassifierErrors(VisualizePanel sp) {

<span class="nc bnc" id="L2576" title="All 2 branches missed.">    if (sp != null) {</span>
<span class="nc" id="L2577">      String plotName = sp.getName();</span>
<span class="nc" id="L2578">      final javax.swing.JFrame jf = new javax.swing.JFrame(Messages</span>
<span class="nc" id="L2579">          .getInstance().getString(</span>
<span class="nc" id="L2580">              &quot;ClassifierPanel_VisualizeClassifierErrors_JF_JFrame_Text&quot;)</span>
<span class="nc" id="L2581">          + plotName);</span>
<span class="nc" id="L2582">      jf.setSize(600, 400);</span>
<span class="nc" id="L2583">      jf.getContentPane().setLayout(new BorderLayout());</span>

<span class="nc" id="L2585">      jf.getContentPane().add(sp, BorderLayout.CENTER);</span>
<span class="nc" id="L2586">      jf.addWindowListener(new java.awt.event.WindowAdapter() {</span>
        @Override
        public void windowClosing(java.awt.event.WindowEvent e) {
<span class="nc" id="L2589">          jf.dispose();</span>
<span class="nc" id="L2590">        }</span>
      });

<span class="nc" id="L2593">      jf.setVisible(true);</span>
    }
<span class="nc" id="L2595">  }</span>

  /**
   * Pops up the Cost/Benefit analysis panel.
   * 
   * @param cb the CostBenefitAnalysis panel to pop up
   */
  protected void visualizeCostBenefitAnalysis(CostBenefitAnalysis cb,
      String classifierAndRelationName) {
<span class="nc bnc" id="L2604" title="All 2 branches missed.">    if (cb != null) {</span>
<span class="nc" id="L2605">      String windowTitle = Messages.getInstance().getString(</span>
<span class="nc" id="L2606">          &quot;ClassifierPanel_VisualizeCostBenefitAnalysis_WindowTitle_Text&quot;);</span>
<span class="nc bnc" id="L2607" title="All 2 branches missed.">      if (classifierAndRelationName != null) {</span>
<span class="nc" id="L2608">        windowTitle += &quot;- &quot; + classifierAndRelationName;</span>
      }
<span class="nc" id="L2610">      final javax.swing.JFrame jf = new javax.swing.JFrame(windowTitle);</span>
<span class="nc" id="L2611">      jf.setSize(1000, 600);</span>
<span class="nc" id="L2612">      jf.getContentPane().setLayout(new BorderLayout());</span>

<span class="nc" id="L2614">      jf.getContentPane().add(cb, BorderLayout.CENTER);</span>
<span class="nc" id="L2615">      jf.addWindowListener(new java.awt.event.WindowAdapter() {</span>
        @Override
        public void windowClosing(java.awt.event.WindowEvent e) {
<span class="nc" id="L2618">          jf.dispose();</span>
<span class="nc" id="L2619">        }</span>
      });

<span class="nc" id="L2622">      jf.setVisible(true);</span>
    }
<span class="nc" id="L2624">  }</span>

  /**
   * Save the currently selected classifier output to a file.
   * 
   * @param name the name of the buffer to save
   */
  protected void saveBuffer(String name) {
<span class="nc" id="L2632">    StringBuffer sb = m_History.getNamedBuffer(name);</span>
<span class="nc bnc" id="L2633" title="All 2 branches missed.">    if (sb != null) {</span>
<span class="nc bnc" id="L2634" title="All 2 branches missed.">      if (m_SaveOut.save(sb)) {</span>
<span class="nc" id="L2635">        m_Log.logMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L2636">            &quot;ClassifierPanel_SaveBuffer_Log_LogMessage_Text&quot;));</span>
      }
    }
<span class="nc" id="L2639">  }</span>

  /**
   * Stops the currently running classifier (if any).
   */
  protected void stopClassifier() {

<span class="nc bnc" id="L2646" title="All 2 branches missed.">    if (m_RunThread != null) {</span>
<span class="nc" id="L2647">      m_RunThread.interrupt();</span>

      // This is deprecated (and theoretically the interrupt should do).
<span class="nc" id="L2650">      m_RunThread.stop();</span>
    }
<span class="nc" id="L2652">  }</span>

  /**
   * Saves the currently selected classifier
   * 
   * @param name the name of the run
   * @param classifier the classifier to save
   * @param trainHeader the header of the training instances
   */
  protected void saveClassifier(String name, Classifier classifier,
      Instances trainHeader) {

<span class="nc" id="L2664">    File sFile = null;</span>
<span class="nc" id="L2665">    boolean saveOK = true;</span>

<span class="nc" id="L2667">    m_FileChooser.removeChoosableFileFilter(m_PMMLModelFilter);</span>
<span class="nc" id="L2668">    m_FileChooser.setFileFilter(m_ModelFilter);</span>
<span class="nc" id="L2669">    int returnVal = m_FileChooser.showSaveDialog(this);</span>
<span class="nc bnc" id="L2670" title="All 2 branches missed.">    if (returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L2671">      sFile = m_FileChooser.getSelectedFile();</span>
<span class="nc bnc" id="L2672" title="All 2 branches missed.">      if (!sFile.getName().toLowerCase().endsWith(MODEL_FILE_EXTENSION)) {</span>
<span class="nc" id="L2673">        sFile = new File(sFile.getParent(), sFile.getName()</span>
<span class="nc" id="L2674">            + MODEL_FILE_EXTENSION);</span>
      }
<span class="nc" id="L2676">      m_Log.statusMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L2677">          &quot;ClassifierPanel_SaveClassifier_Log_StatusMessage_Text&quot;));</span>

      try {
<span class="nc" id="L2680">        OutputStream os = new FileOutputStream(sFile);</span>
<span class="nc bnc" id="L2681" title="All 2 branches missed.">        if (sFile.getName().endsWith(&quot;.gz&quot;)) {</span>
<span class="nc" id="L2682">          os = new GZIPOutputStream(os);</span>
        }
<span class="nc" id="L2684">        ObjectOutputStream objectOutputStream = new ObjectOutputStream(os);</span>
<span class="nc" id="L2685">        objectOutputStream.writeObject(classifier);</span>
<span class="nc" id="L2686">        trainHeader = trainHeader.stringFreeStructure();</span>
<span class="nc bnc" id="L2687" title="All 2 branches missed.">        if (trainHeader != null)</span>
<span class="nc" id="L2688">          objectOutputStream.writeObject(trainHeader);</span>
<span class="nc" id="L2689">        objectOutputStream.flush();</span>
<span class="nc" id="L2690">        objectOutputStream.close();</span>
<span class="nc" id="L2691">      } catch (Exception e) {</span>

        JOptionPane
<span class="nc" id="L2694">            .showMessageDialog(</span>
<span class="nc" id="L2695">                null,</span>
<span class="nc" id="L2696">                e,</span>
                Messages
<span class="nc" id="L2698">                    .getInstance()</span>
<span class="nc" id="L2699">                    .getString(</span>
<span class="nc" id="L2700">                        &quot;ClassifierPanel_SaveClassifier_JOptionPaneShowMessageDialog_Text_First&quot;),</span>
<span class="nc" id="L2701">                JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L2702">        saveOK = false;</span>
      }
<span class="nc bnc" id="L2704" title="All 2 branches missed.">      if (saveOK)</span>
<span class="nc" id="L2705">        m_Log.logMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L2706">            &quot;ClassifierPanel_SaveClassifier_Log_LogMessage_Text_First&quot;)</span>
<span class="nc" id="L2707">            + name</span>
<span class="nc" id="L2708">            + Messages.getInstance().getString(</span>
<span class="nc" id="L2709">                &quot;ClassifierPanel_SaveClassifier_Log_LogMessage_Text_Second&quot;)</span>
<span class="nc" id="L2710">            + sFile.getName()</span>
<span class="nc" id="L2711">            + Messages.getInstance().getString(</span>
<span class="nc" id="L2712">                &quot;ClassifierPanel_SaveClassifier_Log_LogMessage_Text_Third&quot;));</span>
<span class="nc" id="L2713">      m_Log.statusMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L2714">          &quot;ClassifierPanel_SaveClassifier_JOptionPaneShowMessageDialog_Text&quot;));</span>
    }
<span class="nc" id="L2716">  }</span>

  /**
   * Loads a classifier
   */
  protected void loadClassifier() {

<span class="nc" id="L2723">    m_FileChooser.addChoosableFileFilter(m_PMMLModelFilter);</span>
<span class="nc" id="L2724">    m_FileChooser.setFileFilter(m_ModelFilter);</span>
<span class="nc" id="L2725">    int returnVal = m_FileChooser.showOpenDialog(this);</span>
<span class="nc bnc" id="L2726" title="All 2 branches missed.">    if (returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L2727">      File selected = m_FileChooser.getSelectedFile();</span>
<span class="nc" id="L2728">      Classifier classifier = null;</span>
<span class="nc" id="L2729">      Instances trainHeader = null;</span>

<span class="nc" id="L2731">      m_Log.statusMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L2732">          &quot;ClassifierPanel_LoadClassifier_Log_StatusMessage_Text_First&quot;));</span>

      try {
<span class="nc" id="L2735">        InputStream is = new FileInputStream(selected);</span>
<span class="nc bnc" id="L2736" title="All 2 branches missed.">        if (selected.getName().endsWith(PMML_FILE_EXTENSION)) {</span>
<span class="nc" id="L2737">          PMMLModel model = PMMLFactory.getPMMLModel(is, m_Log);</span>
<span class="nc bnc" id="L2738" title="All 2 branches missed.">          if (model instanceof PMMLClassifier) {</span>
<span class="nc" id="L2739">            classifier = (PMMLClassifier) model;</span>
            /*
             * trainHeader = ((PMMLClassifier)classifier).getMiningSchema().
             * getMiningSchemaAsInstances();
             */
          } else {
<span class="nc" id="L2745">            throw new Exception(Messages.getInstance().getString(</span>
<span class="nc" id="L2746">                &quot;ClassifierPanel_LoadClassifier_Exception_Text&quot;));</span>
          }
        } else {
<span class="nc bnc" id="L2749" title="All 2 branches missed.">          if (selected.getName().endsWith(&quot;.gz&quot;)) {</span>
<span class="nc" id="L2750">            is = new GZIPInputStream(is);</span>
          }
<span class="nc" id="L2752">          ObjectInputStream objectInputStream = new ObjectInputStream(is);</span>
<span class="nc" id="L2753">          classifier = (Classifier) objectInputStream.readObject();</span>
          try { // see if we can load the header
<span class="nc" id="L2755">            trainHeader = (Instances) objectInputStream.readObject();</span>
<span class="nc" id="L2756">          } catch (Exception e) {</span>
          } // don't fuss if we can't
<span class="nc" id="L2758">          objectInputStream.close();</span>
        }
<span class="nc" id="L2760">      } catch (Exception e) {</span>

        JOptionPane
<span class="nc" id="L2763">            .showMessageDialog(</span>
<span class="nc" id="L2764">                null,</span>
<span class="nc" id="L2765">                e,</span>
                Messages
<span class="nc" id="L2767">                    .getInstance()</span>
<span class="nc" id="L2768">                    .getString(</span>
<span class="nc" id="L2769">                        &quot;ClassifierPanel_LoadClassifier_JOptionPaneShowMessageDialog_Text&quot;),</span>
<span class="nc" id="L2770">                JOptionPane.ERROR_MESSAGE);</span>
      }

<span class="nc" id="L2773">      m_Log.statusMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L2774">          &quot;ClassifierPanel_LoadClassifier_Log_StatusMessage_Text_Second&quot;));</span>

<span class="nc bnc" id="L2776" title="All 2 branches missed.">      if (classifier != null) {</span>
<span class="nc" id="L2777">        m_Log.logMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L2778">            &quot;ClassifierPanel_SaveClassifier_Log_LogMessage_Text_Fourth&quot;)</span>
<span class="nc" id="L2779">            + selected.getName()</span>
<span class="nc" id="L2780">            + Messages.getInstance().getString(</span>
<span class="nc" id="L2781">                &quot;ClassifierPanel_SaveClassifier_Log_LogMessage_Text_Fifth&quot;));</span>
<span class="nc" id="L2782">        String name = (new SimpleDateFormat(&quot;HH:mm:ss - &quot;)).format(new Date());</span>
<span class="nc" id="L2783">        String cname = classifier.getClass().getName();</span>
<span class="nc bnc" id="L2784" title="All 2 branches missed.">        if (cname.startsWith(&quot;weka.classifiers.&quot;))</span>
<span class="nc" id="L2785">          cname = cname.substring(&quot;weka.classifiers.&quot;.length());</span>
<span class="nc" id="L2786">        name += cname</span>
<span class="nc" id="L2787">            + Messages.getInstance().getString(</span>
<span class="nc" id="L2788">                &quot;ClassifierPanel_SaveClassifier_Name_Text_First&quot;)</span>
<span class="nc" id="L2789">            + selected.getName()</span>
<span class="nc" id="L2790">            + Messages.getInstance().getString(</span>
<span class="nc" id="L2791">                &quot;ClassifierPanel_SaveClassifier_Name_Text_Second&quot;);</span>
<span class="nc" id="L2792">        StringBuffer outBuff = new StringBuffer();</span>

<span class="nc" id="L2794">        outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2795">            &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_First&quot;));</span>
<span class="nc" id="L2796">        outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2797">            &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Second&quot;)</span>
<span class="nc" id="L2798">            + selected.getName() + &quot;\n&quot;);</span>
<span class="nc" id="L2799">        outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2800">            &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Fourth&quot;)</span>
<span class="nc" id="L2801">            + classifier.getClass().getName());</span>
<span class="nc bnc" id="L2802" title="All 2 branches missed.">        if (classifier instanceof OptionHandler) {</span>
<span class="nc" id="L2803">          String[] o = ((OptionHandler) classifier).getOptions();</span>
<span class="nc" id="L2804">          outBuff.append(&quot; &quot; + Utils.joinOptions(o));</span>
        }
<span class="nc" id="L2806">        outBuff.append(&quot;\n&quot;);</span>
<span class="nc bnc" id="L2807" title="All 2 branches missed.">        if (trainHeader != null) {</span>
<span class="nc" id="L2808">          outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2809">              &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Fifth&quot;)</span>
<span class="nc" id="L2810">              + trainHeader.relationName() + '\n');</span>
<span class="nc" id="L2811">          outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2812">              &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Seventh&quot;)</span>
<span class="nc" id="L2813">              + trainHeader.numAttributes() + '\n');</span>
<span class="nc bnc" id="L2814" title="All 2 branches missed.">          if (trainHeader.numAttributes() &lt; 100) {</span>
<span class="nc bnc" id="L2815" title="All 2 branches missed.">            for (int i = 0; i &lt; trainHeader.numAttributes(); i++) {</span>
<span class="nc" id="L2816">              outBuff.append(&quot;              &quot; + trainHeader.attribute(i).name()</span>
<span class="nc" id="L2817">                  + '\n');</span>
            }
          } else {
<span class="nc" id="L2820">            outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2821">                &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Nineth&quot;));</span>
          }
        } else {
<span class="nc" id="L2824">          outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2825">              &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Tenth&quot;));</span>
        }

<span class="nc" id="L2828">        outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2829">            &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Eleventh&quot;));</span>
<span class="nc" id="L2830">        outBuff.append(classifier.toString() + &quot;\n&quot;);</span>

<span class="nc" id="L2832">        m_History.addResult(name, outBuff);</span>
<span class="nc" id="L2833">        m_History.setSingle(name);</span>
<span class="nc" id="L2834">        FastVector vv = new FastVector();</span>
<span class="nc" id="L2835">        vv.addElement(classifier);</span>
<span class="nc bnc" id="L2836" title="All 2 branches missed.">        if (trainHeader != null)</span>
<span class="nc" id="L2837">          vv.addElement(trainHeader);</span>
        // allow visualization of graphable classifiers
<span class="nc" id="L2839">        String grph = null;</span>
<span class="nc bnc" id="L2840" title="All 2 branches missed.">        if (classifier instanceof Drawable) {</span>
          try {
<span class="nc" id="L2842">            grph = ((Drawable) classifier).graph();</span>
<span class="nc" id="L2843">          } catch (Exception ex) {</span>
          }
        }
<span class="nc bnc" id="L2846" title="All 2 branches missed.">        if (grph != null)</span>
<span class="nc" id="L2847">          vv.addElement(grph);</span>

<span class="nc" id="L2849">        m_History.addObject(name, vv);</span>
      }
    }
<span class="nc" id="L2852">  }</span>

  /**
   * Re-evaluates the named classifier with the current test set. Unpredictable
   * things will happen if the data set is not compatible with the classifier.
   * 
   * @param name the name of the classifier entry
   * @param classifier the classifier to evaluate
   * @param trainHeader the header of the training set
   */
  protected void reevaluateModel(final String name,
      final Classifier classifier, final Instances trainHeader) {

<span class="nc bnc" id="L2865" title="All 2 branches missed.">    if (m_RunThread == null) {</span>
<span class="nc" id="L2866">      synchronized (this) {</span>
<span class="nc" id="L2867">        m_StartBut.setEnabled(false);</span>
<span class="nc" id="L2868">        m_StopBut.setEnabled(true);</span>
      }
<span class="nc" id="L2870">      m_RunThread = new Thread() {</span>
        @Override
        public void run() {
          // Copy the current state of things
<span class="nc" id="L2874">          m_Log.statusMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L2875">              &quot;ClassifierPanel_ReEvaluateModel_Log_StatusMessage_Text_First&quot;));</span>

<span class="nc" id="L2877">          StringBuffer outBuff = m_History.getNamedBuffer(name);</span>
<span class="nc" id="L2878">          DataSource source = null;</span>
<span class="nc" id="L2879">          Instances userTestStructure = null;</span>
          // additional vis info (either shape type or point size)
<span class="nc" id="L2881">          FastVector plotShape = new FastVector();</span>
<span class="nc" id="L2882">          FastVector plotSize = new FastVector();</span>
<span class="nc" id="L2883">          Instances predInstances = null;</span>

<span class="nc" id="L2885">          CostMatrix costMatrix = null;</span>
<span class="nc bnc" id="L2886" title="All 2 branches missed.">          if (m_EvalWRTCostsBut.isSelected()) {</span>
<span class="nc" id="L2887">            costMatrix = new CostMatrix(</span>
<span class="nc" id="L2888">                (CostMatrix) m_CostMatrixEditor.getValue());</span>
          }
<span class="nc" id="L2890">          boolean outputConfusion = m_OutputConfusionBut.isSelected();</span>
<span class="nc" id="L2891">          boolean outputPerClass = m_OutputPerClassBut.isSelected();</span>
<span class="nc" id="L2892">          boolean outputSummary = true;</span>
<span class="nc" id="L2893">          boolean outputEntropy = m_OutputEntropyBut.isSelected();</span>
<span class="nc" id="L2894">          boolean saveVis = m_StorePredictionsBut.isSelected();</span>
<span class="nc" id="L2895">          boolean outputPredictionsText = m_OutputPredictionsTextBut</span>
<span class="nc" id="L2896">              .isSelected();</span>
<span class="nc" id="L2897">          String grph = null;</span>
<span class="nc" id="L2898">          Evaluation eval = null;</span>

          try {

<span class="nc" id="L2902">            boolean incrementalLoader = (m_TestLoader instanceof IncrementalConverter);</span>
<span class="nc bnc" id="L2903" title="All 4 branches missed.">            if (m_TestLoader != null &amp;&amp; m_TestLoader.getStructure() != null) {</span>
<span class="nc" id="L2904">              m_TestLoader.reset();</span>
<span class="nc" id="L2905">              source = new DataSource(m_TestLoader);</span>
<span class="nc" id="L2906">              userTestStructure = source.getStructure();</span>
            }
            // Check the test instance compatibility
<span class="nc bnc" id="L2909" title="All 2 branches missed.">            if (source == null) {</span>
<span class="nc" id="L2910">              throw new Exception(Messages.getInstance().getString(</span>
<span class="nc" id="L2911">                  &quot;ClassifierPanel_ReEvaluateModel_Exception_Text_First&quot;));</span>
            }
<span class="nc bnc" id="L2913" title="All 2 branches missed.">            if (trainHeader != null) {</span>
<span class="nc bnc" id="L2914" title="All 2 branches missed.">              if (trainHeader.classIndex() &gt; userTestStructure.numAttributes() - 1)</span>
<span class="nc" id="L2915">                throw new Exception(Messages.getInstance().getString(</span>
<span class="nc" id="L2916">                    &quot;ClassifierPanel_ReEvaluateModel_Exception_Text_Second&quot;));</span>
<span class="nc" id="L2917">              userTestStructure.setClassIndex(trainHeader.classIndex());</span>
<span class="nc bnc" id="L2918" title="All 2 branches missed.">              if (!trainHeader.equalHeaders(userTestStructure)) {</span>
<span class="nc" id="L2919">                throw new Exception(Messages.getInstance().getString(</span>
<span class="nc" id="L2920">                    &quot;ClassifierPanel_ReEvaluateModel_Exception_Text_Third&quot;));</span>
              }
            } else {
<span class="nc bnc" id="L2923" title="All 2 branches missed.">              if (classifier instanceof PMMLClassifier) {</span>
                // set the class based on information in the mining schema
<span class="nc" id="L2925">                Instances miningSchemaStructure = ((PMMLClassifier) classifier)</span>
<span class="nc" id="L2926">                    .getMiningSchema().getMiningSchemaAsInstances();</span>
<span class="nc" id="L2927">                String className = miningSchemaStructure.classAttribute()</span>
<span class="nc" id="L2928">                    .name();</span>
<span class="nc" id="L2929">                Attribute classMatch = userTestStructure.attribute(className);</span>
<span class="nc bnc" id="L2930" title="All 2 branches missed.">                if (classMatch == null) {</span>
<span class="nc" id="L2931">                  throw new Exception(</span>
<span class="nc" id="L2932">                      Messages</span>
<span class="nc" id="L2933">                          .getInstance()</span>
<span class="nc" id="L2934">                          .getString(</span>
<span class="nc" id="L2935">                              &quot;ClassifierPanel_ReEvaluateModel_Exception_Text_Fourth&quot;)</span>
<span class="nc" id="L2936">                          + className</span>
<span class="nc" id="L2937">                          + Messages</span>
<span class="nc" id="L2938">                              .getInstance()</span>
<span class="nc" id="L2939">                              .getString(</span>
<span class="nc" id="L2940">                                  &quot;ClassifierPanel_ReEvaluateModel_Exception_Text_Fifth&quot;));</span>
                }
<span class="nc" id="L2942">                userTestStructure.setClass(classMatch);</span>
              } else {
<span class="nc" id="L2944">                userTestStructure.setClassIndex(userTestStructure</span>
<span class="nc" id="L2945">                    .numAttributes() - 1);</span>
              }
            }
<span class="nc bnc" id="L2948" title="All 2 branches missed.">            if (m_Log instanceof TaskLogger) {</span>
<span class="nc" id="L2949">              ((TaskLogger) m_Log).taskStarted();</span>
            }
<span class="nc" id="L2951">            m_Log</span>
<span class="nc" id="L2952">                .statusMessage(Messages</span>
<span class="nc" id="L2953">                    .getInstance()</span>
<span class="nc" id="L2954">                    .getString(</span>
<span class="nc" id="L2955">                        &quot;ClassifierPanel_ReEvaluateModel_Log_StatusMessage_Text_Second&quot;));</span>
<span class="nc" id="L2956">            m_Log</span>
<span class="nc" id="L2957">                .logMessage(Messages</span>
<span class="nc" id="L2958">                    .getInstance()</span>
<span class="nc" id="L2959">                    .getString(</span>
<span class="nc" id="L2960">                        &quot;ClassifierPanel_ReEvaluateModel_Log_LogMessage_Text_First&quot;)</span>
<span class="nc" id="L2961">                    + name</span>
<span class="nc" id="L2962">                    + Messages</span>
<span class="nc" id="L2963">                        .getInstance()</span>
<span class="nc" id="L2964">                        .getString(</span>
<span class="nc" id="L2965">                            &quot;ClassifierPanel_ReEvaluateModel_Log_LogMessage_Text_Second&quot;));</span>
<span class="nc" id="L2966">            eval = new Evaluation(userTestStructure, costMatrix);</span>
<span class="nc" id="L2967">            eval.useNoPriors();</span>

            // set up the structure of the plottable instances for
            // visualization if selected
<span class="nc bnc" id="L2971" title="All 2 branches missed.">            if (saveVis) {</span>
<span class="nc" id="L2972">              predInstances = setUpVisualizableInstances(userTestStructure);</span>
<span class="nc" id="L2973">              predInstances.setClassIndex(userTestStructure.classIndex() + 1);</span>
            }

<span class="nc" id="L2976">            outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2977">                &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Twelveth&quot;));</span>
<span class="nc" id="L2978">            outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2979">                &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Thirteenth&quot;));</span>
<span class="nc" id="L2980">            outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2981">                &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Fourteenth&quot;)</span>
<span class="nc" id="L2982">                + userTestStructure.relationName() + '\n');</span>
<span class="nc bnc" id="L2983" title="All 2 branches missed.">            if (incrementalLoader)</span>
<span class="nc" id="L2984">              outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2985">                  &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Sixteenth&quot;));</span>
            else
<span class="nc" id="L2987">              outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2988">                  &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Seventeenth&quot;)</span>
<span class="nc" id="L2989">                  + source.getDataSet().numInstances() + &quot;\n&quot;);</span>
<span class="nc" id="L2990">            outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2991">                &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_Nineteenth&quot;)</span>
<span class="nc" id="L2992">                + userTestStructure.numAttributes() + &quot;\n\n&quot;);</span>
<span class="nc bnc" id="L2993" title="All 2 branches missed.">            if (trainHeader == null</span>
<span class="nc bnc" id="L2994" title="All 2 branches missed.">                &amp;&amp; !(classifier instanceof weka.classifiers.pmml.consumer.PMMLClassifier)) {</span>

<span class="nc" id="L2996">              outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L2997">                  &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_TwentyFirst&quot;));</span>

            }

<span class="nc bnc" id="L3001" title="All 2 branches missed.">            if (outputPredictionsText) {</span>
<span class="nc" id="L3002">              outBuff</span>
<span class="nc" id="L3003">                  .append(Messages</span>
<span class="nc" id="L3004">                      .getInstance()</span>
<span class="nc" id="L3005">                      .getString(</span>
<span class="nc" id="L3006">                          &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_TwentySecond&quot;));</span>
<span class="nc" id="L3007">              outBuff.append(Messages.getInstance().getString(</span>
<span class="nc" id="L3008">                  &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_TwentyThird&quot;));</span>
<span class="nc bnc" id="L3009" title="All 2 branches missed.">              if (userTestStructure.classAttribute().isNominal()) {</span>
<span class="nc" id="L3010">                outBuff</span>
<span class="nc" id="L3011">                    .append(Messages</span>
<span class="nc" id="L3012">                        .getInstance()</span>
<span class="nc" id="L3013">                        .getString(</span>
<span class="nc" id="L3014">                            &quot;ClassifierPanel_SaveClassifier_OutBuffer_Text_TwentyFourth&quot;));</span>
              }
<span class="nc" id="L3016">              outBuff.append(&quot;\n&quot;);</span>
            }

            Instance instance;
<span class="nc" id="L3020">            int jj = 0;</span>
<span class="nc bnc" id="L3021" title="All 2 branches missed.">            while (source.hasMoreElements(userTestStructure)) {</span>
<span class="nc" id="L3022">              instance = source.nextElement(userTestStructure);</span>
<span class="nc" id="L3023">              processClassifierPrediction(instance, classifier, eval,</span>
<span class="nc" id="L3024">                  predInstances, plotShape, plotSize);</span>
<span class="nc bnc" id="L3025" title="All 2 branches missed.">              if (outputPredictionsText) {</span>
<span class="nc" id="L3026">                outBuff.append(predictionText(classifier, instance, jj + 1));</span>
              }
<span class="nc bnc" id="L3028" title="All 2 branches missed.">              if ((++jj % 100) == 0) {</span>
<span class="nc" id="L3029">                m_Log</span>
<span class="nc" id="L3030">                    .statusMessage(Messages</span>
<span class="nc" id="L3031">                        .getInstance()</span>
<span class="nc" id="L3032">                        .getString(</span>
<span class="nc" id="L3033">                            &quot;ClassifierPanel_ReEvaluateModel_Log_StatusMessage_Text_Third&quot;)</span>
<span class="nc" id="L3034">                        + jj</span>
<span class="nc" id="L3035">                        + Messages</span>
<span class="nc" id="L3036">                            .getInstance()</span>
<span class="nc" id="L3037">                            .getString(</span>
<span class="nc" id="L3038">                                &quot;ClassifierPanel_ReEvaluateModel_Log_StatusMessage_Text_Fourth&quot;));</span>
              }
            }

<span class="nc bnc" id="L3042" title="All 2 branches missed.">            if (outputPredictionsText) {</span>
<span class="nc" id="L3043">              outBuff.append(&quot;\n&quot;);</span>
            }

<span class="nc bnc" id="L3046" title="All 2 branches missed.">            if (outputSummary) {</span>
<span class="nc" id="L3047">              outBuff.append(eval.toSummaryString(outputEntropy) + &quot;\n&quot;);</span>
            }

<span class="nc bnc" id="L3050" title="All 2 branches missed.">            if (userTestStructure.classAttribute().isNominal()) {</span>

<span class="nc bnc" id="L3052" title="All 2 branches missed.">              if (outputPerClass) {</span>
<span class="nc" id="L3053">                outBuff.append(eval.toClassDetailsString() + &quot;\n&quot;);</span>
              }

<span class="nc bnc" id="L3056" title="All 2 branches missed.">              if (outputConfusion) {</span>
<span class="nc" id="L3057">                outBuff.append(eval.toMatrixString() + &quot;\n&quot;);</span>
              }
            }

<span class="nc" id="L3061">            m_History.updateResult(name);</span>
<span class="nc" id="L3062">            m_Log.logMessage(Messages.getInstance().getString(</span>
<span class="nc" id="L3063">                &quot;ClassifierPanel_ReEvaluateModel_Log_LogMessage_Text_Third&quot;));</span>
<span class="nc" id="L3064">            m_Log</span>
<span class="nc" id="L3065">                .statusMessage(Messages</span>
<span class="nc" id="L3066">                    .getInstance()</span>
<span class="nc" id="L3067">                    .getString(</span>
<span class="nc" id="L3068">                        &quot;ClassifierPanel_ReEvaluateModel_Log_StatusMessage_Text_Fifth&quot;));</span>
<span class="nc" id="L3069">          } catch (Exception ex) {</span>
<span class="nc" id="L3070">            ex.printStackTrace();</span>
<span class="nc" id="L3071">            m_Log.logMessage(ex.getMessage());</span>
<span class="nc" id="L3072">            m_Log</span>
<span class="nc" id="L3073">                .statusMessage(Messages</span>
<span class="nc" id="L3074">                    .getInstance()</span>
<span class="nc" id="L3075">                    .getString(</span>
<span class="nc" id="L3076">                        &quot;ClassifierPanel_ReEvaluateModel_Log_StatusMessage_Text_Sixth&quot;));</span>

<span class="nc" id="L3078">            ex.printStackTrace();</span>
<span class="nc" id="L3079">            m_Log.logMessage(ex.getMessage());</span>
            JOptionPane
<span class="nc" id="L3081">                .showMessageDialog(</span>
<span class="nc" id="L3082">                    ClassifierPanel.this,</span>
<span class="nc" id="L3083">                    Messages</span>
<span class="nc" id="L3084">                        .getInstance()</span>
<span class="nc" id="L3085">                        .getString(</span>
<span class="nc" id="L3086">                            &quot;ClassifierPanel_ReEvaluateModel_JOptionPaneShowMessageDialog_Text_First&quot;)</span>
<span class="nc" id="L3087">                        + ex.getMessage(),</span>
                    Messages
<span class="nc" id="L3089">                        .getInstance()</span>
<span class="nc" id="L3090">                        .getString(</span>
<span class="nc" id="L3091">                            &quot;ClassifierPanel_ReEvaluateModel_JOptionPaneShowMessageDialog_Text_Second&quot;),</span>
<span class="nc" id="L3092">                    JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L3093">            m_Log</span>
<span class="nc" id="L3094">                .statusMessage(Messages</span>
<span class="nc" id="L3095">                    .getInstance()</span>
<span class="nc" id="L3096">                    .getString(</span>
<span class="nc" id="L3097">                        &quot;ClassifierPanel_ReEvaluateModel_Log_StatusMessage_Text_Seventh&quot;));</span>
<span class="nc" id="L3098">          } finally {</span>
            try {
<span class="nc bnc" id="L3100" title="All 6 branches missed.">              if (classifier instanceof PMMLClassifier) {</span>
                // signal the end of the scoring run so
                // that the initialized state can be reset
                // (forces the field mapping to be recomputed
                // for the next scoring run).
<span class="nc" id="L3105">                ((PMMLClassifier) classifier).done();</span>
              }

<span class="nc bnc" id="L3108" title="All 12 branches missed.">              if (predInstances != null &amp;&amp; predInstances.numInstances() &gt; 0) {</span>
<span class="nc" id="L3109">                if (predInstances.attribute(predInstances.classIndex())</span>
<span class="nc bnc" id="L3110" title="All 6 branches missed.">                    .isNumeric()) {</span>
<span class="nc" id="L3111">                  postProcessPlotInfo(plotSize);</span>
                }
<span class="nc" id="L3113">                m_CurrentVis = new VisualizePanel();</span>
<span class="nc" id="L3114">                m_CurrentVis.setName(name + &quot; (&quot;</span>
<span class="nc" id="L3115">                    + userTestStructure.relationName() + &quot;)&quot;);</span>
<span class="nc" id="L3116">                m_CurrentVis.setLog(m_Log);</span>
<span class="nc" id="L3117">                PlotData2D tempd = new PlotData2D(predInstances);</span>
<span class="nc" id="L3118">                tempd.setShapeSize(plotSize);</span>
<span class="nc" id="L3119">                tempd.setShapeType(plotShape);</span>
<span class="nc" id="L3120">                tempd.setPlotName(name + &quot; (&quot;</span>
<span class="nc" id="L3121">                    + userTestStructure.relationName() + &quot;)&quot;);</span>
                // tempd.addInstanceNumberAttribute();

<span class="nc" id="L3124">                m_CurrentVis.addPlot(tempd);</span>
<span class="nc" id="L3125">                m_CurrentVis.setColourIndex(predInstances.classIndex());</span>
                // m_CurrentVis.setColourIndex(predInstances.classIndex()+1);

<span class="nc bnc" id="L3128" title="All 6 branches missed.">                if (classifier instanceof Drawable) {</span>
                  try {
<span class="nc" id="L3130">                    grph = ((Drawable) classifier).graph();</span>
<span class="nc" id="L3131">                  } catch (Exception ex) {</span>
                  }
                }

<span class="nc bnc" id="L3135" title="All 6 branches missed.">                if (saveVis) {</span>
<span class="nc" id="L3136">                  FastVector vv = new FastVector();</span>
<span class="nc" id="L3137">                  vv.addElement(classifier);</span>
<span class="nc bnc" id="L3138" title="All 6 branches missed.">                  if (trainHeader != null)</span>
<span class="nc" id="L3139">                    vv.addElement(trainHeader);</span>
<span class="nc" id="L3140">                  vv.addElement(m_CurrentVis);</span>
<span class="nc bnc" id="L3141" title="All 6 branches missed.">                  if (grph != null) {</span>
<span class="nc" id="L3142">                    vv.addElement(grph);</span>
                  }
<span class="nc bnc" id="L3144" title="All 12 branches missed.">                  if ((eval != null) &amp;&amp; (eval.predictions() != null)) {</span>
<span class="nc" id="L3145">                    vv.addElement(eval.predictions());</span>
<span class="nc" id="L3146">                    vv.addElement(userTestStructure.classAttribute());</span>
                  }
<span class="nc" id="L3148">                  m_History.addObject(name, vv);</span>
                } else {
<span class="nc" id="L3150">                  FastVector vv = new FastVector();</span>
<span class="nc" id="L3151">                  vv.addElement(classifier);</span>
<span class="nc bnc" id="L3152" title="All 6 branches missed.">                  if (trainHeader != null)</span>
<span class="nc" id="L3153">                    vv.addElement(trainHeader);</span>
<span class="nc" id="L3154">                  m_History.addObject(name, vv);</span>
                }
              }
<span class="nc" id="L3157">            } catch (Exception ex) {</span>
<span class="nc" id="L3158">              ex.printStackTrace();</span>
            }
<span class="nc bnc" id="L3160" title="All 6 branches missed.">            if (isInterrupted()) {</span>
<span class="nc" id="L3161">              m_Log</span>
<span class="nc" id="L3162">                  .logMessage(Messages</span>
<span class="nc" id="L3163">                      .getInstance()</span>
<span class="nc" id="L3164">                      .getString(</span>
<span class="nc" id="L3165">                          &quot;ClassifierPanel_ReEvaluateModel_Log_LogMessage_Text_Fourth&quot;));</span>
<span class="nc" id="L3166">              m_Log</span>
<span class="nc" id="L3167">                  .statusMessage(Messages</span>
<span class="nc" id="L3168">                      .getInstance()</span>
<span class="nc" id="L3169">                      .getString(</span>
<span class="nc" id="L3170">                          &quot;ClassifierPanel_ReEvaluateModel_Log_StatusMessage_Text_Seventh&quot;));</span>
            }

<span class="nc" id="L3173">            synchronized (this) {</span>
<span class="nc" id="L3174">              m_StartBut.setEnabled(true);</span>
<span class="nc" id="L3175">              m_StopBut.setEnabled(false);</span>
<span class="nc" id="L3176">              m_RunThread = null;</span>
            }

<span class="nc bnc" id="L3179" title="All 6 branches missed.">            if (m_Log instanceof TaskLogger) {</span>
<span class="nc" id="L3180">              ((TaskLogger) m_Log).taskFinished();</span>
            }
<span class="nc" id="L3182">          }</span>
<span class="nc" id="L3183">        }</span>
      };

<span class="nc" id="L3186">      m_RunThread.setPriority(Thread.MIN_PRIORITY);</span>
<span class="nc" id="L3187">      m_RunThread.start();</span>
    }
<span class="nc" id="L3189">  }</span>

  /**
   * updates the capabilities filter of the GOE
   * 
   * @param filter the new filter to use
   */
  protected void updateCapabilitiesFilter(Capabilities filter) {
    Instances tempInst;
    Capabilities filterClass;

<span class="nc bnc" id="L3200" title="All 2 branches missed.">    if (filter == null) {</span>
<span class="nc" id="L3201">      m_ClassifierEditor.setCapabilitiesFilter(new Capabilities(null));</span>
<span class="nc" id="L3202">      return;</span>
    }

<span class="nc bnc" id="L3205" title="All 2 branches missed.">    if (!ExplorerDefaults.getInitGenericObjectEditorFilter())</span>
<span class="nc" id="L3206">      tempInst = new Instances(m_Instances, 0);</span>
    else
<span class="nc" id="L3208">      tempInst = new Instances(m_Instances);</span>
<span class="nc" id="L3209">    tempInst.setClassIndex(m_ClassCombo.getSelectedIndex());</span>

    try {
<span class="nc" id="L3212">      filterClass = Capabilities.forInstances(tempInst);</span>
<span class="nc" id="L3213">    } catch (Exception e) {</span>
<span class="nc" id="L3214">      filterClass = new Capabilities(null);</span>
    }

    // set new filter
<span class="nc" id="L3218">    m_ClassifierEditor.setCapabilitiesFilter(filterClass);</span>

<span class="nc" id="L3220">    m_StartBut.setEnabled(true);</span>
    // Check capabilities
<span class="nc" id="L3222">    Capabilities currentFilter = m_ClassifierEditor.getCapabilitiesFilter();</span>
<span class="nc" id="L3223">    Classifier classifier = (Classifier) m_ClassifierEditor.getValue();</span>
<span class="nc" id="L3224">    Capabilities currentSchemeCapabilities = null;</span>
<span class="nc bnc" id="L3225" title="All 4 branches missed.">    if (classifier != null &amp;&amp; currentFilter != null</span>
<span class="nc bnc" id="L3226" title="All 2 branches missed.">        &amp;&amp; (classifier instanceof CapabilitiesHandler)) {</span>
<span class="nc" id="L3227">      currentSchemeCapabilities = ((CapabilitiesHandler) classifier)</span>
<span class="nc" id="L3228">          .getCapabilities();</span>

<span class="nc bnc" id="L3230" title="All 2 branches missed.">      if (!currentSchemeCapabilities.supportsMaybe(currentFilter)</span>
<span class="nc bnc" id="L3231" title="All 2 branches missed.">          &amp;&amp; !currentSchemeCapabilities.supports(currentFilter)) {</span>
<span class="nc" id="L3232">        m_StartBut.setEnabled(false);</span>
      }
    }
<span class="nc" id="L3235">  }</span>

  /**
   * method gets called in case of a change event
   * 
   * @param e the associated change event
   */
  @Override
  public void capabilitiesFilterChanged(CapabilitiesFilterChangeEvent e) {
<span class="nc bnc" id="L3244" title="All 2 branches missed.">    if (e.getFilter() == null)</span>
<span class="nc" id="L3245">      updateCapabilitiesFilter(null);</span>
    else
<span class="nc" id="L3247">      updateCapabilitiesFilter((Capabilities) e.getFilter().clone());</span>
<span class="nc" id="L3248">  }</span>

  /**
   * Sets the Explorer to use as parent frame (used for sending notifications
   * about changes in the data)
   * 
   * @param parent the parent frame
   */
  @Override
  public void setExplorer(Explorer parent) {
<span class="nc" id="L3258">    m_Explorer = parent;</span>
<span class="nc" id="L3259">  }</span>

  /**
   * returns the parent Explorer frame
   * 
   * @return the parent
   */
  @Override
  public Explorer getExplorer() {
<span class="nc" id="L3268">    return m_Explorer;</span>
  }

  /**
   * Returns the title for the tab in the Explorer
   * 
   * @return the title of this tab
   */
  @Override
  public String getTabTitle() {
<span class="nc" id="L3278">    return Messages.getInstance().getString(&quot;ClassifierPanel_GetTabTitle_Text&quot;);</span>
  }

  /**
   * Returns the tooltip for the tab in the Explorer
   * 
   * @return the tooltip of this tab
   */
  @Override
  public String getTabTitleToolTip() {
<span class="nc" id="L3288">    return Messages.getInstance().getString(</span>
<span class="nc" id="L3289">        &quot;ClassifierPanel_GetTabTitleToolTip_Text&quot;);</span>
  }

  /**
   * Tests out the classifier panel from the command line.
   * 
   * @param args may optionally contain the name of a dataset to load.
   */
  public static void main(String[] args) {

    try {
<span class="nc" id="L3300">      final javax.swing.JFrame jf = new javax.swing.JFrame(Messages</span>
<span class="nc" id="L3301">          .getInstance().getString(&quot;ClassifierPanel_Main_JFrame_Text&quot;));</span>
<span class="nc" id="L3302">      jf.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L3303">      final ClassifierPanel sp = new ClassifierPanel();</span>
<span class="nc" id="L3304">      jf.getContentPane().add(sp, BorderLayout.CENTER);</span>
<span class="nc" id="L3305">      weka.gui.LogPanel lp = new weka.gui.LogPanel();</span>
<span class="nc" id="L3306">      sp.setLog(lp);</span>
<span class="nc" id="L3307">      jf.getContentPane().add(lp, BorderLayout.SOUTH);</span>
<span class="nc" id="L3308">      jf.addWindowListener(new java.awt.event.WindowAdapter() {</span>
        @Override
        public void windowClosing(java.awt.event.WindowEvent e) {
<span class="nc" id="L3311">          jf.dispose();</span>
<span class="nc" id="L3312">          System.exit(0);</span>
<span class="nc" id="L3313">        }</span>
      });
<span class="nc" id="L3315">      jf.pack();</span>
<span class="nc" id="L3316">      jf.setSize(800, 600);</span>
<span class="nc" id="L3317">      jf.setVisible(true);</span>
<span class="nc bnc" id="L3318" title="All 2 branches missed.">      if (args.length == 1) {</span>
<span class="nc" id="L3319">        System.err.println(Messages.getInstance().getString(</span>
<span class="nc" id="L3320">            &quot;ClassifierPanel_Main_Error_Text&quot;)</span>
<span class="nc" id="L3321">            + args[0]);</span>
<span class="nc" id="L3322">        java.io.Reader r = new java.io.BufferedReader(new java.io.FileReader(</span>
<span class="nc" id="L3323">            args[0]));</span>
<span class="nc" id="L3324">        Instances i = new Instances(r);</span>
<span class="nc" id="L3325">        sp.setInstances(i);</span>
      }
<span class="nc" id="L3327">    } catch (Exception ex) {</span>
<span class="nc" id="L3328">      ex.printStackTrace();</span>
<span class="nc" id="L3329">      System.err.println(ex.getMessage());</span>
    }
<span class="nc" id="L3331">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>