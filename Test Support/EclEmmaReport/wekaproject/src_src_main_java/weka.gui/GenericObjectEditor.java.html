<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>GenericObjectEditor.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.gui</a> &gt; <span class="el_source">GenericObjectEditor.java</span></div><h1>GenericObjectEditor.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">/*</span>
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 *    GenericObjectEditor.java
 *    Copyright (C) 2002 University of Waikato, Hamilton, New Zealand
 *
 */

package weka.gui;

import weka.core.Capabilities;
import weka.core.CapabilitiesHandler;
import weka.core.ClassDiscovery;
import weka.core.OptionHandler;
import weka.core.SerializedObject;
import weka.core.Utils;
import weka.core.Capabilities.Capability;
import weka.gui.CheckBoxList.CheckBoxListModel;

import java.awt.BorderLayout;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.FontMetrics;
import java.awt.Frame;
import java.awt.GridLayout;
import java.awt.Window;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.beans.PropertyChangeSupport;
import java.beans.PropertyEditor;
import java.beans.PropertyEditorManager;
import java.io.BufferedInputStream;
import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.lang.reflect.Array;
import java.util.Enumeration;
import java.util.Hashtable;
import java.util.Properties;
import java.util.StringTokenizer;
import java.util.Vector;

import javax.swing.BorderFactory;
import javax.swing.JButton;
import javax.swing.JDialog;
import javax.swing.JFileChooser;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JPopupMenu;
import javax.swing.JScrollPane;
import javax.swing.JTree;
import javax.swing.event.TreeSelectionEvent;
import javax.swing.event.TreeSelectionListener;
import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.TreePath;
import javax.swing.tree.TreeSelectionModel;

/**
 * A PropertyEditor for objects. It can be used either in a static or a dynamic
 * way. &lt;br&gt;
 * &lt;br&gt;
 * In the &lt;b&gt;static&lt;/b&gt; way (&lt;code&gt;USE_DYNAMIC&lt;/code&gt; is &lt;code&gt;false&lt;/code&gt;) the
 * objects have been defined as editable in the GenericObjectEditor
 * configuration file, which lists possible values that can be selected from,
 * and themselves configured. The configuration file is called
 * &quot;GenericObjectEditor.props&quot; and may live in either the location given by
 * &quot;user.home&quot; or the current directory (this last will take precedence), and a
 * default properties file is read from the Weka distribution. For speed, the
 * properties file is read only once when the class is first loaded -- this may
 * need to be changed if we ever end up running in a Java OS ;-). &lt;br&gt;
 * &lt;br&gt;
 * If it is used in a &lt;b&gt;dynamic&lt;/b&gt; way (the &lt;code&gt;UseDynamic&lt;/code&gt; property 
 * of the GenericPropertiesCreator props file is set to &lt;code&gt;true&lt;/code&gt;) 
 * then the classes to list are discovered by the 
 * &lt;code&gt;GenericPropertiesCreator&lt;/code&gt; class (it checks the complete classpath). 
 * 
 * @see GenericPropertiesCreator
 * @see GenericPropertiesCreator#useDynamic()
 * @see GenericPropertiesCreator#CREATOR_FILE
 * @see weka.core.ClassDiscovery
 * 
 * @author Len Trigg (trigg@cs.waikato.ac.nz)
 * @author Xin Xu (xx5@cs.waikato.ac.nz)
 * @author Richard Kirkby (rkirkby@cs.waikato.ac.nz)
 * @author FracPete (fracpete at waikato dot ac dot nz)
 * @version $Revision: 7059 $
 */
<span class="fc" id="L111">public class GenericObjectEditor implements PropertyEditor, CustomPanelSupplier {</span>
  
  /** The object being configured. */
  protected Object m_Object;
  
  /** Holds a copy of the current object that can be reverted to
      if the user decides to cancel. */
  protected Object m_Backup;
    
  /** Handles property change notification. */
<span class="nc" id="L121">  protected PropertyChangeSupport m_Support = new PropertyChangeSupport(this);</span>
    
  /** The Class of objects being edited. */
  protected Class m_ClassType;
    
  /** The model containing the list of names to select from. */
  protected Hashtable m_ObjectNames;

  /** The GUI component for editing values, created when needed. */
  protected GOEPanel m_EditorComponent;
    
  /** True if the GUI component is needed. */
<span class="nc" id="L133">  protected boolean m_Enabled = true;</span>
    
  /** The name of the properties file. */
<span class="fc" id="L136">  protected static String PROPERTY_FILE = &quot;weka/gui/GenericObjectEditor.props&quot;;</span>
    
  /** Contains the editor properties. */
  protected static Properties EDITOR_PROPERTIES;

  /** the properties files containing the class/editor mappings. */
  public static final String GUIEDITORS_PROPERTY_FILE = &quot;weka/gui/GUIEditors.props&quot;;

  /** The tree node of the current object so we can re-select it for the user. */
  protected GOETreeNode m_treeNodeOfCurrentObject;

  /** The property panel created for the objects. */
  protected PropertyPanel m_ObjectPropertyPanel;
    
  /** whether the class can be changed. */
  protected boolean m_canChangeClassInDialog;
  
  /** whether the Weka Editors were already registered. */
  protected static boolean m_EditorsRegistered;

  /** for filtering the tree based on the Capabilities of the leaves. */
<span class="nc" id="L157">  protected Capabilities m_CapabilitiesFilter = null;</span>
  
  /** 
   * Loads the configuration property file (USE_DYNAMIC is FALSE) or determines
   * the classes dynamically (USE_DYNAMIC is TRUE)
   * @see #USE_DYNAMIC
   * @see GenericPropertiesCreator
   */
  static {

    try {
<span class="fc" id="L168">      GenericPropertiesCreator creator = new GenericPropertiesCreator();</span>

      // dynamic approach?
<span class="pc bpc" id="L171" title="1 of 2 branches missed.">      if (creator.useDynamic()) {</span>
	try {
<span class="fc" id="L173">	  creator.execute(false);</span>
<span class="fc" id="L174">	  EDITOR_PROPERTIES = creator.getOutputProperties();</span>
	}
<span class="nc" id="L176">	catch (Exception e) {</span>
<span class="nc" id="L177">	  JOptionPane.showMessageDialog(</span>
<span class="nc" id="L178">	      null,</span>
<span class="nc" id="L179">	      Messages.getInstance().getString(&quot;GenericObjectEditor_JOptionPaneShowMessageDialog_Text_First&quot;)</span>
<span class="nc" id="L180">	      + e.toString(),</span>
<span class="nc" id="L181">	      Messages.getInstance().getString(&quot;GenericObjectEditor_JOptionPaneShowMessageDialog_Text_Second&quot;),</span>
<span class="nc" id="L182">	      JOptionPane.ERROR_MESSAGE);</span>
	}
      }
      else {
	// Allow a properties file in the current directory to override
	try {
<span class="nc" id="L188">	  EDITOR_PROPERTIES = Utils.readProperties(PROPERTY_FILE);</span>
<span class="nc" id="L189">	  java.util.Enumeration keys = </span>
<span class="nc" id="L190">	    (java.util.Enumeration)EDITOR_PROPERTIES.propertyNames();</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">	  if (!keys.hasMoreElements()) {</span>
<span class="nc" id="L192">	    throw new Exception(Messages.getInstance().getString(&quot;GenericObjectEditor_Exception_Text&quot;));</span>
	  }
	}
<span class="nc" id="L195">	catch (Exception ex) {</span>
<span class="nc" id="L196">	  JOptionPane.showMessageDialog(</span>
<span class="nc" id="L197">	      null,</span>
<span class="nc" id="L198">	      Messages.getInstance().getString(&quot;GenericObjectEditor_Exception_JOptionPaneShowMessageDialog_Text_First&quot;) </span>
<span class="nc" id="L199">	      + PROPERTY_FILE + Messages.getInstance().getString(&quot;GenericObjectEditor_Exception_JOptionPaneShowMessageDialog_Text_Second&quot;) </span>
<span class="nc" id="L200">	      + System.getProperties().getProperty(&quot;user.home&quot;) </span>
<span class="nc" id="L201">	      + Messages.getInstance().getString(&quot;GenericObjectEditor_Exception_JOptionPaneShowMessageDialog_Text_Third&quot;),</span>
<span class="nc" id="L202">	      Messages.getInstance().getString(&quot;GenericObjectEditor_Exception_JOptionPaneShowMessageDialog_Text_Fourth&quot;),</span>
<span class="nc" id="L203">	      JOptionPane.ERROR_MESSAGE);</span>
	}
      }
    }
<span class="nc" id="L207">    catch (Exception e) {</span>
<span class="nc" id="L208">      JOptionPane.showMessageDialog(</span>
<span class="nc" id="L209">	  null,</span>
<span class="nc" id="L210">	  Messages.getInstance().getString(&quot;GenericObjectEditor_Exception_JOptionPaneShowMessageDialog_Text_Fifth&quot;)</span>
<span class="nc" id="L211">	  + e.toString(),</span>
<span class="nc" id="L212">	  Messages.getInstance().getString(&quot;GenericObjectEditor_Exception_JOptionPaneShowMessageDialog_Text_Sixth&quot;),</span>
<span class="nc" id="L213">	  JOptionPane.ERROR_MESSAGE);</span>
    }
  }

  /**
   * A specialized TreeNode for supporting filtering via Capabilities.
   */
  public class GOETreeNode
    extends DefaultMutableTreeNode {
    
    /** for serialization. */
    static final long serialVersionUID = -1707872446682150133L;
    
    /** color for &quot;no support&quot;. */
    public final static String NO_SUPPORT = &quot;silver&quot;;
    
    /** color for &quot;maybe support&quot;. */
    public final static String MAYBE_SUPPORT = &quot;blue&quot;;
    
    /** the Capabilities object to use for filtering. */
<span class="nc" id="L233">    protected Capabilities m_Capabilities = null;</span>
    
    /**
     * Creates a tree node that has no parent and no children, but which 
     * allows children.
     */
    public GOETreeNode() {
<span class="nc" id="L240">      super();</span>
<span class="nc" id="L241">    }</span>
    
    /**
     * Creates a tree node with no parent, no children, but which allows 
     * children, and initializes it with the specified user object.
     * 
     * @param userObject	an Object provided by the user that constitutes 
     * 				the node's data
     */
    public GOETreeNode(Object userObject) {
<span class="nc" id="L251">      super(userObject);</span>
<span class="nc" id="L252">    }</span>
    
    /**
     * Creates a tree node with no parent, no children, initialized with the 
     * specified user object, and that allows children only if specified.

     * @param userObject	an Object provided by the user that constitutes 
     * 				the node's data
     * @param allowsChildren	if true, the node is allowed to have child nodes 
     * 				-- otherwise, it is always a leaf node
     */
    public GOETreeNode(Object userObject, boolean allowsChildren) {
<span class="nc" id="L264">      super(userObject, allowsChildren);</span>
<span class="nc" id="L265">    }</span>
    
    /**
     * generates if necessary a Capabilities object for the given leaf.
     */
    protected void initCapabilities() {
      String 	classname;
      Class	cls;
      Object	obj;
      
<span class="nc bnc" id="L275" title="All 2 branches missed.">      if (m_Capabilities != null)</span>
<span class="nc" id="L276">	return;</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">      if (!isLeaf())</span>
<span class="nc" id="L278">	return;</span>
      
<span class="nc" id="L280">      classname = getClassnameFromPath(new TreePath(getPath()));</span>
      try {
<span class="nc" id="L282">	cls = Class.forName(classname);</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">	if (!ClassDiscovery.hasInterface(CapabilitiesHandler.class, cls))</span>
<span class="nc" id="L284">	  return;</span>
	
<span class="nc" id="L286">	obj = cls.newInstance();</span>
<span class="nc" id="L287">	m_Capabilities = ((CapabilitiesHandler) obj).getCapabilities();</span>
      }
<span class="nc" id="L289">      catch (Exception e) {</span>
	// ignore it
      }
<span class="nc" id="L292">    }</span>
    
    /**
     * returns a string representation of this treenode.
     * 
     * @return 		the text to display 
     */
    public String toString() {
      String	result;
      
<span class="nc" id="L302">      result = super.toString();</span>
      
<span class="nc bnc" id="L304" title="All 2 branches missed.">      if (m_CapabilitiesFilter != null) {</span>
<span class="nc" id="L305">	initCapabilities();</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">	if (m_Capabilities != null) {</span>
<span class="nc bnc" id="L307" title="All 4 branches missed.">	  if (m_Capabilities.supportsMaybe(m_CapabilitiesFilter) &amp;&amp; !m_Capabilities.supports(m_CapabilitiesFilter))</span>
<span class="nc" id="L308">	    result = Messages.getInstance().getString(&quot;GenericObjectEditor_GOETreeNode_ToString_Result_Text_First&quot;) + MAYBE_SUPPORT + Messages.getInstance().getString(&quot;GenericObjectEditor_GOETreeNode_ToString_Result_Text_Second&quot;) + result + Messages.getInstance().getString(&quot;GenericObjectEditor_GOETreeNode_ToString_Result_Text_Third&quot;);</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">	  else if (!m_Capabilities.supports(m_CapabilitiesFilter))</span>
<span class="nc" id="L310">	    result = Messages.getInstance().getString(&quot;GenericObjectEditor_GOETreeNode_ToString_Result_Text_Fourth&quot;) + NO_SUPPORT + Messages.getInstance().getString(&quot;GenericObjectEditor_GOETreeNode_ToString_Result_Text_Fifth&quot;) + result + Messages.getInstance().getString(&quot;GenericObjectEditor_GOETreeNode_ToString_Result_Text_Sixth&quot;);</span>
	}
      }
      
<span class="nc" id="L314">      return result;</span>
    }
  }
  
  /**
   * A dialog for selecting Capabilities to look for in the GOE tree.
   */
  public class CapabilitiesFilterDialog 
    extends JDialog {
    
    /** for serialization. */
    static final long serialVersionUID = -7845503345689646266L;
    
    /** the dialog itself. */
    protected JDialog m_Self;
    
    /** the popup to display again. */
<span class="nc" id="L331">    protected JPopupMenu m_Popup = null;</span>
    
    /** the capabilities used for initializing the dialog. */
<span class="nc" id="L334">    protected Capabilities m_Capabilities = new Capabilities(null);</span>

    /** the label, listing the name of the superclass. */
<span class="nc" id="L337">    protected JLabel m_InfoLabel = new JLabel();</span>
    
    /** the list with all the capabilities. */
<span class="nc" id="L340">    protected CheckBoxList m_List = new CheckBoxList();</span>
    
    /** the OK button. */
<span class="nc" id="L343">    protected JButton m_OkButton = new JButton(Messages.getInstance().getString(&quot;GenericObjectEditor_CapabilitiesFilterDialog_OkButton_JButton_Text&quot;));</span>
    
    /** the Cancel button. */
<span class="nc" id="L346">    protected JButton m_CancelButton = new JButton(Messages.getInstance().getString(&quot;GenericObjectEditor_CapabilitiesFilterDialog_CancelButton_JButton_Text&quot;));</span>
    
    /**
     * creates a dialog to choose Capabilities from.
     */
    public CapabilitiesFilterDialog() {
<span class="nc" id="L352">      super();</span>

<span class="nc" id="L354">      m_Self = this;</span>
      
<span class="nc" id="L356">      initGUI();</span>
<span class="nc" id="L357">    }</span>
    
    /**
     * sets up the GUI.
     */
    protected void initGUI() {
      JPanel			panel;
      CheckBoxListModel		model;

<span class="nc" id="L366">      setTitle(Messages.getInstance().getString(&quot;GenericObjectEditor_InitGUI_SetTitle_Text&quot;));</span>
<span class="nc" id="L367">      setLayout(new BorderLayout());</span>
      
<span class="nc" id="L369">      panel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L370">      panel.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
<span class="nc" id="L371">      getContentPane().add(panel, BorderLayout.NORTH);</span>
<span class="nc" id="L372">      m_InfoLabel.setText(</span>
<span class="nc" id="L373">    		  Messages.getInstance().getString(&quot;GenericObjectEditor_InitGUI_InfoLabel_SetTitle_Text_First&quot;)</span>
<span class="nc" id="L374">	  + m_ClassType.getName().replaceAll(&quot;.*\\.&quot;, &quot;&quot;) </span>
<span class="nc" id="L375">	  + Messages.getInstance().getString(&quot;GenericObjectEditor_InitGUI_InfoLabel_SetTitle_Text_Second&quot;) </span>
<span class="nc" id="L376">	  + GOETreeNode.NO_SUPPORT </span>
<span class="nc" id="L377">	  + Messages.getInstance().getString(&quot;GenericObjectEditor_InitGUI_InfoLabel_SetTitle_Text_Third&quot;)</span>
<span class="nc" id="L378">	  + GOETreeNode.NO_SUPPORT </span>
<span class="nc" id="L379">	  + Messages.getInstance().getString(&quot;GenericObjectEditor_InitGUI_InfoLabel_SetTitle_Text_Fourth&quot;) </span>
<span class="nc" id="L380">	  + GOETreeNode.MAYBE_SUPPORT </span>
<span class="nc" id="L381">	  + Messages.getInstance().getString(&quot;GenericObjectEditor_InitGUI_InfoLabel_SetTitle_Text_Fifth&quot;)</span>
<span class="nc" id="L382">	  + GOETreeNode.MAYBE_SUPPORT </span>
<span class="nc" id="L383">	  + Messages.getInstance().getString(&quot;GenericObjectEditor_InitGUI_InfoLabel_SetTitle_Text_Sixth&quot;));</span>
<span class="nc" id="L384">      panel.add(m_InfoLabel, BorderLayout.CENTER);</span>
      
      // list
<span class="nc" id="L387">      getContentPane().add(new JScrollPane(m_List), BorderLayout.CENTER);</span>
<span class="nc" id="L388">      model = (CheckBoxListModel) m_List.getModel();</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">      for (Capability cap: Capability.values())</span>
<span class="nc" id="L390">	model.addElement(cap);</span>
      
      // buttons
<span class="nc" id="L393">      panel = new JPanel(new FlowLayout(FlowLayout.CENTER));</span>
<span class="nc" id="L394">      getContentPane().add(panel, BorderLayout.SOUTH);</span>
      
<span class="nc" id="L396">      m_OkButton.setMnemonic('O');</span>
<span class="nc" id="L397">      m_OkButton.addActionListener(new ActionListener() {</span>
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L399">          updateCapabilities();</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">          if (m_CapabilitiesFilter == null)</span>
<span class="nc" id="L401">            m_CapabilitiesFilter = new Capabilities(null);</span>
<span class="nc" id="L402">          m_CapabilitiesFilter.assign(m_Capabilities);</span>
<span class="nc" id="L403">          m_Self.setVisible(false);</span>
<span class="nc" id="L404">          showPopup();</span>
<span class="nc" id="L405">        }</span>
      });
<span class="nc" id="L407">      panel.add(m_OkButton);</span>
      
<span class="nc" id="L409">      m_CancelButton.setMnemonic('C');</span>
<span class="nc" id="L410">      m_CancelButton.addActionListener(new ActionListener() {</span>
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L412">          m_Self.setVisible(false);</span>
<span class="nc" id="L413">          showPopup();</span>
<span class="nc" id="L414">        }</span>
      });
<span class="nc" id="L416">      panel.add(m_CancelButton);</span>
<span class="nc" id="L417">      pack();</span>
<span class="nc" id="L418">    }</span>

    /**
     * transfers the Capabilities object to the JList.
     * 
     * @see #m_Capabilities
     * @see #m_List
     */
    protected void updateList() {
      CheckBoxListModel		model;
      
<span class="nc" id="L429">      model = (CheckBoxListModel) m_List.getModel();</span>

<span class="nc bnc" id="L431" title="All 2 branches missed.">      for (Capability cap: Capability.values())</span>
<span class="nc" id="L432">	model.setChecked(model.indexOf(cap), m_Capabilities.handles(cap));</span>
<span class="nc" id="L433">    }</span>
    
    /**
     * transfers the selected Capabilities from the JList to the 
     * Capabilities object.
     * 
     * @see #m_Capabilities
     * @see #m_List
     */
    protected void updateCapabilities() {
      CheckBoxListModel		model;
      
<span class="nc" id="L445">      model = (CheckBoxListModel) m_List.getModel();</span>

<span class="nc bnc" id="L447" title="All 2 branches missed.">      for (Capability cap: Capability.values()) {</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">	if (model.getChecked(model.indexOf(cap)))</span>
<span class="nc" id="L449">          m_Capabilities.enable(cap);</span>
	else
<span class="nc" id="L451">	  m_Capabilities.disable(cap);</span>
      }
<span class="nc" id="L453">    }</span>
    
    /**
     * sets the initial capabilities.
     * 
     * @param value the capabilities to use
     */
    public void setCapabilities(Capabilities value) {
<span class="nc bnc" id="L461" title="All 2 branches missed.">      if (value != null)</span>
<span class="nc" id="L462">	m_Capabilities.assign(value);</span>
      else
<span class="nc" id="L464">	m_Capabilities = new Capabilities(null);</span>
      
<span class="nc" id="L466">      updateList();</span>
<span class="nc" id="L467">    }</span>
    
    /**
     * returns the currently selected capabilities.
     * 
     * @return the currently selected capabilities
     */
    public Capabilities getCapabilities() {
<span class="nc" id="L475">      return m_Capabilities;</span>
    }
    
    /**
     * sets the JPopupMenu to display again after closing the dialog.
     * 
     * @param value the JPopupMenu to display again
     */
    public void setPopup(JPopupMenu value) {
<span class="nc" id="L484">      m_Popup = value;</span>
<span class="nc" id="L485">    }</span>
    
    /**
     * returns the currently set JPopupMenu.
     * 
     * @return the current JPopupMenu
     */
    public JPopupMenu getPopup() {
<span class="nc" id="L493">      return m_Popup;</span>
    }
    
    /**
     * if a JPopupMenu is set, it is displayed again. Displaying this dialog
     * closes any JPopupMenu automatically.
     */
    public void showPopup() {
<span class="nc bnc" id="L501" title="All 2 branches missed.">      if (getPopup() != null)</span>
<span class="nc" id="L502">	getPopup().setVisible(true);</span>
<span class="nc" id="L503">    }</span>
  }
  
  /**
   * Creates a popup menu containing a tree that is aware
   * of the screen dimensions.
   */
  public class JTreePopupMenu 
    extends JPopupMenu {
    
    /** for serialization. */
    static final long serialVersionUID = -3404546329655057387L;

    /** the popup itself. */
    private JPopupMenu m_Self;
    
    /** The tree. */
    private JTree m_tree;

    /** The scroller. */
    private JScrollPane m_scroller;

    /** The filter button in case of CapabilitiesHandlers. */
<span class="nc" id="L526">    private JButton m_FilterButton = new JButton(Messages.getInstance().getString(&quot;GenericObjectEditor_JTreePopupMenu_FilterButton_JButton_Text&quot;));</span>

    /** The remove filter button in case of CapabilitiesHandlers. */
<span class="nc" id="L529">    private JButton m_RemoveFilterButton = new JButton(Messages.getInstance().getString(&quot;GenericObjectEditor_JTreePopupMenu_RemoveFilterButton_JButton_Text&quot;));</span>
    
    /** The button for closing the popup again. */
<span class="nc" id="L532">    private JButton m_CloseButton = new JButton(Messages.getInstance().getString(&quot;GenericObjectEditor_JTreePopupMenu_CloseButton_JButton_Text&quot;));</span>
    
    /**
     * Constructs a new popup menu.
     *
     * @param tree the tree to put in the menu
     */
<span class="nc" id="L539">    public JTreePopupMenu(JTree tree) {</span>

<span class="nc" id="L541">      m_Self = this;</span>
      
<span class="nc" id="L543">      setLayout(new BorderLayout());</span>
<span class="nc" id="L544">      JPanel panel = new JPanel(new FlowLayout(FlowLayout.RIGHT));</span>
<span class="nc" id="L545">      add(panel, BorderLayout.SOUTH);</span>

<span class="nc bnc" id="L547" title="All 2 branches missed.">      if (ClassDiscovery.hasInterface(CapabilitiesHandler.class, m_ClassType)) {</span>
	// filter
<span class="nc" id="L549">	m_FilterButton.setMnemonic('F');</span>
<span class="nc" id="L550">	m_FilterButton.addActionListener(new ActionListener() {</span>
	  public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L552" title="All 2 branches missed.">	    if (e.getSource() == m_FilterButton) {</span>
<span class="nc" id="L553">	      CapabilitiesFilterDialog dialog = new CapabilitiesFilterDialog();</span>
<span class="nc" id="L554">	      dialog.setCapabilities(m_CapabilitiesFilter);</span>
<span class="nc" id="L555">	      dialog.setPopup(m_Self);</span>
<span class="nc" id="L556">	      dialog.setVisible(true);</span>
<span class="nc" id="L557">	      m_Support.firePropertyChange(&quot;&quot;, null, null);</span>
<span class="nc" id="L558">	      repaint();</span>
	    }
<span class="nc" id="L560">	  }</span>
	});
<span class="nc" id="L562">	panel.add(m_FilterButton);</span>
	
	// remove
<span class="nc" id="L565">	m_RemoveFilterButton.setMnemonic('R');</span>
<span class="nc" id="L566">	m_RemoveFilterButton.addActionListener(new ActionListener() {</span>
	  public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L568" title="All 2 branches missed.">	    if (e.getSource() == m_RemoveFilterButton) {</span>
<span class="nc" id="L569">	      m_CapabilitiesFilter = null;</span>
<span class="nc" id="L570">	      m_Support.firePropertyChange(&quot;&quot;, null, null);</span>
<span class="nc" id="L571">	      repaint();</span>
	    }
<span class="nc" id="L573">	  }</span>
	});
<span class="nc" id="L575">	panel.add(m_RemoveFilterButton);</span>
      }

      // close
<span class="nc" id="L579">      m_CloseButton.setMnemonic('C');</span>
<span class="nc" id="L580">      m_CloseButton.addActionListener(new ActionListener() {</span>
        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L582" title="All 2 branches missed.">          if (e.getSource() == m_CloseButton) {</span>
<span class="nc" id="L583">            m_Self.setVisible(false);</span>
          }
<span class="nc" id="L585">        }</span>
      });
<span class="nc" id="L587">      panel.add(m_CloseButton);</span>
      
<span class="nc" id="L589">      m_tree = tree;</span>
      
<span class="nc" id="L591">      JPanel treeView = new JPanel();</span>
<span class="nc" id="L592">      treeView.setLayout(new BorderLayout());</span>
<span class="nc" id="L593">      treeView.add(m_tree, BorderLayout.NORTH);</span>
      
      // make backgrounds look the same
<span class="nc" id="L596">      treeView.setBackground(m_tree.getBackground());</span>

<span class="nc" id="L598">      m_scroller = new JScrollPane(treeView);</span>
      
<span class="nc" id="L600">      m_scroller.setPreferredSize(new Dimension(300, 400));</span>
<span class="nc" id="L601">      m_scroller.getVerticalScrollBar().setUnitIncrement(20);</span>

<span class="nc" id="L603">      add(m_scroller);</span>
<span class="nc" id="L604">    }</span>

    /**
     * Displays the menu, making sure it will fit on the screen.
     *
     * @param invoker the component thast invoked the menu
     * @param x the x location of the popup
     * @param y the y location of the popup
     */
    public void show(Component invoker, int x, int y) {

<span class="nc" id="L615">      super.show(invoker, x, y);</span>

      // calculate available screen area for popup
<span class="nc" id="L618">      java.awt.Point location = getLocationOnScreen();</span>
<span class="nc" id="L619">      java.awt.Dimension screenSize = getToolkit().getScreenSize();</span>
<span class="nc" id="L620">      int maxWidth = (int) (screenSize.getWidth() - location.getX());</span>
<span class="nc" id="L621">      int maxHeight = (int) (screenSize.getHeight() - location.getY());</span>

      // if the part of the popup goes off the screen then resize it
<span class="nc" id="L624">      Dimension scrollerSize = m_scroller.getPreferredSize();</span>
<span class="nc" id="L625">      int height = (int) scrollerSize.getHeight();</span>
<span class="nc" id="L626">      int width = (int) scrollerSize.getWidth();</span>
<span class="nc bnc" id="L627" title="All 2 branches missed.">      if (width &gt; maxWidth) width = maxWidth;</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">      if (height &gt; maxHeight) height = maxHeight;</span>
      
      // commit any size changes
<span class="nc" id="L631">      m_scroller.setPreferredSize(new Dimension(width, height));</span>
<span class="nc" id="L632">      revalidate();</span>
<span class="nc" id="L633">      pack();</span>
<span class="nc" id="L634">    }</span>
  }

  /**
   * Handles the GUI side of editing values.
   */
  public class GOEPanel 
    extends JPanel {
    
    /** for serialization. */
    static final long serialVersionUID = 3656028520876011335L;
    
    /** The component that performs classifier customization. */
    protected PropertySheetPanel m_ChildPropertySheet;
    
    /** The name of the current class. */
    protected JLabel m_ClassNameLabel;

    /** Open object from disk. */
    protected JButton m_OpenBut;
    
    /** Save object to disk. */
    protected JButton m_SaveBut;
    
    /** ok button. */
    protected JButton m_okBut;
    
    /** cancel button. */
    protected JButton m_cancelBut;
    
    /** The filechooser for opening and saving object files. */
    protected JFileChooser m_FileChooser;
    
    /** Creates the GUI editor component. */
<span class="nc" id="L668">    public GOEPanel() {</span>
    
<span class="nc" id="L670">      m_Backup = copyObject(m_Object);</span>
      
<span class="nc" id="L672">      m_ClassNameLabel = new JLabel(Messages.getInstance().getString(&quot;GenericObjectEditor_GOEPanel_ClassNameLabel_JLabel_Text&quot;));</span>
<span class="nc" id="L673">      m_ClassNameLabel.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));</span>

<span class="nc" id="L675">      m_ChildPropertySheet = new PropertySheetPanel();</span>
<span class="nc" id="L676">      m_ChildPropertySheet.addPropertyChangeListener</span>
<span class="nc" id="L677">	(new PropertyChangeListener() {</span>
	    public void propertyChange(PropertyChangeEvent evt) {
<span class="nc" id="L679">	      m_Support.firePropertyChange(&quot;&quot;, null, null);</span>
<span class="nc" id="L680">	    }</span>
	  });
      
<span class="nc" id="L683">      m_OpenBut = new JButton(Messages.getInstance().getString(&quot;GenericObjectEditor_OpenBut_JButton_Text&quot;));</span>
<span class="nc" id="L684">      m_OpenBut.setToolTipText(Messages.getInstance().getString(&quot;GenericObjectEditor_OpenBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L685">      m_OpenBut.setEnabled(true);</span>
<span class="nc" id="L686">      m_OpenBut.addActionListener(new ActionListener() {</span>
	  public void actionPerformed(ActionEvent e) {
<span class="nc" id="L688">	    Object object = openObject();</span>
<span class="nc bnc" id="L689" title="All 2 branches missed.">	    if (object != null) {</span>
	      // setValue takes care of: Making sure obj is of right type,
	      // and firing property change.
<span class="nc" id="L692">	      setValue(object);</span>
	      // Need a second setValue to get property values filled in OK.
	      // Not sure why.
<span class="nc" id="L695">	      setValue(object);</span>
	    }
<span class="nc" id="L697">	  }</span>
	});
      
<span class="nc" id="L700">      m_SaveBut = new JButton(Messages.getInstance().getString(&quot;GenericObjectEditor_SaveBut_JButton_Text&quot;));</span>
<span class="nc" id="L701">      m_SaveBut.setToolTipText(Messages.getInstance().getString(&quot;GenericObjectEditor_SaveBut_SetToolTipText_Text&quot;));</span>
<span class="nc" id="L702">      m_SaveBut.setEnabled(true);</span>
<span class="nc" id="L703">      m_SaveBut.addActionListener(new ActionListener() {</span>
	  public void actionPerformed(ActionEvent e) {
<span class="nc" id="L705">	    saveObject(m_Object);</span>
<span class="nc" id="L706">	  }</span>
	});
      
<span class="nc" id="L709">      m_okBut = new JButton(Messages.getInstance().getString(&quot;GenericObjectEditor_OkBut_JButton_Text&quot;));</span>
<span class="nc" id="L710">      m_okBut.setEnabled(true);</span>
<span class="nc" id="L711">      m_okBut.addActionListener(new ActionListener() {</span>
	  public void actionPerformed(ActionEvent e) {

<span class="nc" id="L714">	    m_Backup = copyObject(m_Object);</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">	    if ((getTopLevelAncestor() != null)</span>
<span class="nc bnc" id="L716" title="All 2 branches missed.">		&amp;&amp; (getTopLevelAncestor() instanceof Window)) {</span>
<span class="nc" id="L717">	      Window w = (Window) getTopLevelAncestor();</span>
<span class="nc" id="L718">	      w.dispose();</span>
	    }
<span class="nc" id="L720">	  }</span>
	});
      
<span class="nc" id="L723">      m_cancelBut = new JButton(Messages.getInstance().getString(&quot;GenericObjectEditor_CancelBut_JButton_Text&quot;));</span>
<span class="nc" id="L724">      m_cancelBut.setEnabled(true);</span>
<span class="nc" id="L725">      m_cancelBut.addActionListener(new ActionListener() {</span>
	  public void actionPerformed(ActionEvent e) {		 
<span class="nc bnc" id="L727" title="All 2 branches missed.">	    if (m_Backup != null) {</span>
	
<span class="nc" id="L729">	      m_Object = copyObject(m_Backup);</span>
	      
	      // To fire property change
<span class="nc" id="L732">	      m_Support.firePropertyChange(&quot;&quot;, null, null);</span>
<span class="nc" id="L733">	      m_ObjectNames = getClassesFromProperties();</span>
<span class="nc" id="L734">	      updateObjectNames();</span>
<span class="nc" id="L735">	      updateChildPropertySheet();</span>
	    }
<span class="nc bnc" id="L737" title="All 2 branches missed.">	    if ((getTopLevelAncestor() != null)</span>
<span class="nc bnc" id="L738" title="All 2 branches missed.">		&amp;&amp; (getTopLevelAncestor() instanceof Window)) {</span>
<span class="nc" id="L739">	      Window w = (Window) getTopLevelAncestor();</span>
<span class="nc" id="L740">	      w.dispose();</span>
	    }
<span class="nc" id="L742">	  }</span>
	});
      
<span class="nc" id="L745">      setLayout(new BorderLayout());</span>

<span class="nc bnc" id="L747" title="All 2 branches missed.">      if (m_canChangeClassInDialog) {</span>
<span class="nc" id="L748">	JButton chooseButton = createChooseClassButton();</span>
<span class="nc" id="L749">	JPanel top = new JPanel();</span>
<span class="nc" id="L750">	top.setLayout(new BorderLayout());</span>
<span class="nc" id="L751">	top.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));</span>
<span class="nc" id="L752">	top.add(chooseButton, BorderLayout.WEST);</span>
<span class="nc" id="L753">	top.add(m_ClassNameLabel, BorderLayout.CENTER);</span>
<span class="nc" id="L754">	add(top, BorderLayout.NORTH);</span>
      } else {
<span class="nc" id="L756">	add(m_ClassNameLabel, BorderLayout.NORTH);</span>
      }

<span class="nc" id="L759">      add(m_ChildPropertySheet, BorderLayout.CENTER);</span>
      // Since we resize to the size of the property sheet, a scrollpane isn't
      // typically needed
      // add(new JScrollPane(m_ChildPropertySheet), BorderLayout.CENTER);
      
<span class="nc" id="L764">      JPanel okcButs = new JPanel();</span>
<span class="nc" id="L765">      okcButs.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
<span class="nc" id="L766">      okcButs.setLayout(new GridLayout(1, 4, 5, 5));</span>
<span class="nc" id="L767">      okcButs.add(m_OpenBut);</span>
<span class="nc" id="L768">      okcButs.add(m_SaveBut);</span>
<span class="nc" id="L769">      okcButs.add(m_okBut);</span>
<span class="nc" id="L770">      okcButs.add(m_cancelBut);</span>
<span class="nc" id="L771">      add(okcButs, BorderLayout.SOUTH);</span>

<span class="nc bnc" id="L773" title="All 2 branches missed.">      if (m_ClassType != null) {</span>
<span class="nc" id="L774">	m_ObjectNames = getClassesFromProperties();</span>
<span class="nc bnc" id="L775" title="All 2 branches missed.">	if (m_Object != null) {</span>
<span class="nc" id="L776">	  updateObjectNames();</span>
<span class="nc" id="L777">	  updateChildPropertySheet();</span>
	}
      }
<span class="nc" id="L780">    }</span>
    
    /**
     * Enables/disables the cancel button.
     *
     * @param flag true to enable cancel button, false
     * to disable it
     */
    protected void setCancelButton(boolean flag) {

<span class="nc bnc" id="L790" title="All 2 branches missed.">      if(m_cancelBut != null)</span>
<span class="nc" id="L791">	m_cancelBut.setEnabled(flag);</span>
<span class="nc" id="L792">    }</span>
    
    /**
     * Opens an object from a file selected by the user.
     * 
     * @return the loaded object, or null if the operation was cancelled
     */
    protected Object openObject() {
      
<span class="nc bnc" id="L801" title="All 2 branches missed.">      if (m_FileChooser == null) {</span>
<span class="nc" id="L802">	createFileChooser();</span>
      }
<span class="nc" id="L804">      int returnVal = m_FileChooser.showOpenDialog(this);</span>
<span class="nc bnc" id="L805" title="All 2 branches missed.">      if (returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L806">	File selected = m_FileChooser.getSelectedFile();</span>
	try {
<span class="nc" id="L808">	  ObjectInputStream oi = new ObjectInputStream(new BufferedInputStream(new FileInputStream(selected)));</span>
<span class="nc" id="L809">	  Object obj = oi.readObject();</span>
<span class="nc" id="L810">	  oi.close();</span>
<span class="nc bnc" id="L811" title="All 2 branches missed.">	  if (!m_ClassType.isAssignableFrom(obj.getClass())) {</span>
<span class="nc" id="L812">	    throw new Exception(Messages.getInstance().getString(&quot;GenericObjectEditor_OpenObject_Exception_Text&quot;) + m_ClassType.getName());</span>
	  }
<span class="nc" id="L814">	  return obj;</span>
<span class="nc" id="L815">	} catch (Exception ex) {</span>
<span class="nc" id="L816">	  JOptionPane.showMessageDialog(this,</span>
<span class="nc" id="L817">			  Messages.getInstance().getString(&quot;GenericObjectEditor_OpenObject_Exception_JOptionPaneShowMessageDialog_Text&quot;)</span>
<span class="nc" id="L818">					+ selected.getName() </span>
<span class="nc" id="L819">					+ Messages.getInstance().getString(&quot;GenericObjectEditor_OpenObject_Exception_JOptionPaneShowMessageDialog_Text&quot;) + ex.getMessage(),</span>
<span class="nc" id="L820">					Messages.getInstance().getString(&quot;GenericObjectEditor_OpenObject_Exception_JOptionPaneShowMessageDialog_Text&quot;),</span>
<span class="nc" id="L821">					JOptionPane.ERROR_MESSAGE);</span>
	}
      }
<span class="nc" id="L824">      return null;</span>
    }
    
    /**
     * Saves an object to a file selected by the user.
     * 
     * @param object the object to save
     */
    protected void saveObject(Object object) {
      
<span class="nc bnc" id="L834" title="All 2 branches missed.">      if (m_FileChooser == null) {</span>
<span class="nc" id="L835">	createFileChooser();</span>
      }
<span class="nc" id="L837">      int returnVal = m_FileChooser.showSaveDialog(this);</span>
<span class="nc bnc" id="L838" title="All 2 branches missed.">      if (returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L839">	File sFile = m_FileChooser.getSelectedFile();</span>
	try {
<span class="nc" id="L841">	  ObjectOutputStream oo = new ObjectOutputStream(new BufferedOutputStream(new FileOutputStream(sFile)));</span>
<span class="nc" id="L842">	  oo.writeObject(object);</span>
<span class="nc" id="L843">	  oo.close();</span>
<span class="nc" id="L844">	} catch (Exception ex) {</span>
<span class="nc" id="L845">	  JOptionPane.showMessageDialog(this,</span>
<span class="nc" id="L846">			  Messages.getInstance().getString(&quot;GenericObjectEditor_SaveObject_Exception_JOptionPaneShowMessageDialog_Text&quot;)</span>
<span class="nc" id="L847">					+ sFile.getName() </span>
<span class="nc" id="L848">					+ Messages.getInstance().getString(&quot;GenericObjectEditor_SaveObject_Exception_JOptionPaneShowMessageDialog_Text&quot;) + ex.getMessage(),</span>
<span class="nc" id="L849">					Messages.getInstance().getString(&quot;GenericObjectEditor_SaveObject_Exception_JOptionPaneShowMessageDialog_Text&quot;),</span>
<span class="nc" id="L850">					JOptionPane.ERROR_MESSAGE);</span>
	}
      }
<span class="nc" id="L853">    }</span>

    /**
     * Creates the file chooser the user will use to save/load files with.
     */
    protected void createFileChooser() {
      
<span class="nc" id="L860">      m_FileChooser = new JFileChooser(new File(System.getProperty(&quot;user.dir&quot;)));</span>
<span class="nc" id="L861">      m_FileChooser.setFileSelectionMode(JFileChooser.FILES_ONLY);</span>
<span class="nc" id="L862">    }</span>
    
    /**
     * Makes a copy of an object using serialization.
     * 
     * @param source the object to copy
     * @return a copy of the source object
     */
    protected Object copyObject(Object source) {

<span class="nc" id="L872">      Object result = null;</span>
      try {
<span class="nc" id="L874">        result = GenericObjectEditor.this.makeCopy(source);</span>
<span class="nc" id="L875">	setCancelButton(true);</span>
	
<span class="nc" id="L877">      } catch (Exception ex) {</span>
<span class="nc" id="L878">	setCancelButton(false);</span>
<span class="nc" id="L879">	System.err.println(Messages.getInstance().getString(&quot;GenericObjectEditor_CopyObject_Error_Text&quot;));</span>
<span class="nc" id="L880">	System.err.println(ex);</span>
      }
<span class="nc" id="L882">      return result;</span>
    }
    
    /**
     * Allows customization of the action label on the dialog.
     * 
     * @param newLabel the new string for the ok button
     */
    public void setOkButtonText(String newLabel) {

<span class="nc" id="L892">      m_okBut.setText(newLabel);</span>
<span class="nc" id="L893">    }</span>

    /** 
     * This is used to hook an action listener to the ok button.
     * 
     * @param a The action listener.
     */
    public void addOkListener(ActionListener a) {

<span class="nc" id="L902">      m_okBut.addActionListener(a);</span>
<span class="nc" id="L903">    }</span>
    
    /**
     * This is used to hook an action listener to the cancel button.
     * 
     * @param a The action listener.
     */
    public void addCancelListener(ActionListener a) {

<span class="nc" id="L912">      m_cancelBut.addActionListener(a);</span>
<span class="nc" id="L913">    }</span>
	
    /**
     * This is used to remove an action listener from the ok button.
     * 
     * @param a The action listener
     */
    public void removeOkListener(ActionListener a) {

<span class="nc" id="L922">      m_okBut.removeActionListener(a);</span>
<span class="nc" id="L923">    }</span>
    
    /**
     * This is used to remove an action listener from the cancel button.
     * 
     * @param a The action listener
     */
    public void removeCancelListener(ActionListener a) {

<span class="nc" id="L932">      m_cancelBut.removeActionListener(a);</span>
<span class="nc" id="L933">    }</span>
    
    /**
     * Updates the child property sheet, and creates if needed.
     */
    public void updateChildPropertySheet() {
      
      // Update the object name displayed
<span class="nc" id="L941">      String className = Messages.getInstance().getString(&quot;GenericObjectEditor_UpdateChildPropertySheet_ClassName_Text&quot;);</span>
<span class="nc bnc" id="L942" title="All 2 branches missed.">      if (m_Object != null) {</span>
<span class="nc" id="L943">	className = m_Object.getClass().getName();</span>
      }
<span class="nc" id="L945">      m_ClassNameLabel.setText(className);</span>

      // Set the object as the target of the propertysheet
<span class="nc" id="L948">      m_ChildPropertySheet.setTarget(m_Object);</span>

      // Adjust size of containing window if possible
<span class="nc bnc" id="L951" title="All 2 branches missed.">      if ((getTopLevelAncestor() != null)</span>
<span class="nc bnc" id="L952" title="All 2 branches missed.">	  &amp;&amp; (getTopLevelAncestor() instanceof Window)) {</span>
<span class="nc" id="L953">	((Window) getTopLevelAncestor()).pack();</span>
      }
<span class="nc" id="L955">    }	</span>
  }

  /**
   * Default constructor.
   */
  public GenericObjectEditor() {

<span class="nc" id="L963">    this(false);</span>
<span class="nc" id="L964">  }</span>

  /**
   * Constructor that allows specifying whether it is possible
   * to change the class within the editor dialog.
   *
   * @param canChangeClassInDialog whether the user can change the class
   */
<span class="nc" id="L972">  public GenericObjectEditor(boolean canChangeClassInDialog) {</span>

<span class="nc" id="L974">    m_canChangeClassInDialog = canChangeClassInDialog;</span>
<span class="nc" id="L975">  }</span>
  
  /**
   * registers all the editors in Weka.
   */
  public static void registerEditors() {
    Properties 		props;
    Enumeration 	enm;
    String 		name;
    String 		value;
    Class 		baseCls;
    Class		cls;

<span class="pc bpc" id="L988" title="1 of 2 branches missed.">    if (m_EditorsRegistered)</span>
<span class="nc" id="L989">      return;</span>
    
<span class="fc" id="L991">    System.err.println(Messages.getInstance().getString(&quot;GenericObjectEditor_RegisterEditors_Error_Text&quot;));</span>
<span class="fc" id="L992">    m_EditorsRegistered = true;</span>

    // load properties
    try {
<span class="fc" id="L996">      props = Utils.readProperties(GUIEDITORS_PROPERTY_FILE);</span>
    }
<span class="nc" id="L998">    catch (Exception e) {</span>
<span class="nc" id="L999">      props = new Properties();</span>
<span class="nc" id="L1000">      e.printStackTrace();</span>
    }
    
<span class="fc" id="L1003">    enm = props.propertyNames();</span>
<span class="fc bfc" id="L1004" title="All 2 branches covered.">    while (enm.hasMoreElements()) {</span>
<span class="fc" id="L1005">      name  = enm.nextElement().toString();</span>
<span class="fc" id="L1006">      value = props.getProperty(name, &quot;&quot;);</span>
      try {
	// array class?
<span class="fc bfc" id="L1009" title="All 2 branches covered.">	if (name.endsWith(&quot;[]&quot;)) {</span>
<span class="fc" id="L1010">	  baseCls = Class.forName(name.substring(0, name.indexOf(&quot;[]&quot;)));</span>
<span class="fc" id="L1011">	  cls = Array.newInstance(baseCls, 1).getClass();</span>
	}
	else {
<span class="fc" id="L1014">	  cls = Class.forName(name);</span>
	}
	// register
<span class="fc" id="L1017">	PropertyEditorManager.registerEditor(cls, Class.forName(value));</span>
      }
<span class="nc" id="L1019">      catch (Exception e) {</span>
<span class="nc" id="L1020">	System.err.println(Messages.getInstance().getString(&quot;GenericObjectEditor_RegisterEditors_Exception_Error_Text_First&quot;) + name + Messages.getInstance().getString(&quot;GenericObjectEditor_RegisterEditors_Exception_Error_Text_Second&quot;) + value + Messages.getInstance().getString(&quot;GenericObjectEditor_RegisterEditors_Exception_Error_Text_Third&quot;) + e);</span>
      }
    }
<span class="fc" id="L1023">  }</span>

  /**
   * Sets whether the user can change the class in the dialog.
   * 
   * @param value	if true then the user can change the class
   */
  public void setCanChangeClassInDialog(boolean value) {
<span class="nc" id="L1031">    m_canChangeClassInDialog = value;</span>
<span class="nc" id="L1032">  }</span>
  
  /**
   * Returns whether the user can change the class in the dialog.
   * 
   * @return		true if the user can change the class
   */
  public boolean getCanChangeClassInDialog() {
<span class="nc" id="L1040">    return m_canChangeClassInDialog;</span>
  }
  
  /**
   * Returns the backup object (may be null if there is no
   * backup.
   *
   * @return the backup object
   */
  public Object getBackup() {
<span class="nc" id="L1050">    return m_Backup;</span>
  }
  
  /**
   * returns the name of the root element of the given class name, 
   * &lt;code&gt;null&lt;/code&gt; if it doesn't contain the separator.
   * 
   * @param clsname the full classname
   * @param separator the separator 
   * @return string the root element
   */
  protected static String getRootFromClass(String clsname, String separator) {
<span class="nc bnc" id="L1062" title="All 2 branches missed.">    if (clsname.indexOf(separator) &gt; -1)</span>
<span class="nc" id="L1063">      return clsname.substring(0, clsname.indexOf(separator));</span>
    else
<span class="nc" id="L1065">      return null;</span>
  }
  
  /**
   * parses the given string of classes separated by &quot;, &quot; and returns the
   * a hashtable with as many entries as there are different root elements in 
   * the class names (the key is the root element). E.g. if there's only 
   * &quot;weka.&quot; as the prefix for all classes the a hashtable of size 1 is returned. 
   * if NULL is the input, then NULL is also returned.
   * 
   * @param classes the classnames to work on
   * @return for each distinct root element in the classnames, one entry in
   * the hashtable (with the root element as key)
   */
  public static Hashtable sortClassesByRoot(String classes) {
    Hashtable                 roots;
    Hashtable                 result;
    Enumeration               enm;
    int                       i;
    StringTokenizer           tok;
    String                    clsname;
    Vector                    list;
    HierarchyPropertyParser   hpp;
    String                    separator;
    String                    root;
    String                    tmpStr;
    
<span class="nc bnc" id="L1092" title="All 2 branches missed.">    if (classes == null)</span>
<span class="nc" id="L1093">      return null;</span>
    
<span class="nc" id="L1095">    roots     = new Hashtable();</span>
<span class="nc" id="L1096">    hpp       = new HierarchyPropertyParser();</span>
<span class="nc" id="L1097">    separator = hpp.getSeperator();</span>
    
    // go over all classnames and store them in the hashtable, with the
    // root element as the key
<span class="nc" id="L1101">    tok   = new StringTokenizer(classes, &quot;, &quot;);</span>
<span class="nc bnc" id="L1102" title="All 2 branches missed.">    while (tok.hasMoreElements()) {</span>
<span class="nc" id="L1103">      clsname = tok.nextToken();</span>
<span class="nc" id="L1104">      root    = getRootFromClass(clsname, separator);</span>
<span class="nc bnc" id="L1105" title="All 2 branches missed.">      if (root == null)</span>
<span class="nc" id="L1106">        continue;</span>
      
      // already stored?
<span class="nc bnc" id="L1109" title="All 2 branches missed.">      if (!roots.containsKey(root)) {</span>
<span class="nc" id="L1110">        list = new Vector();</span>
<span class="nc" id="L1111">        roots.put(root, list);</span>
      }
      else {
<span class="nc" id="L1114">        list = (Vector) roots.get(root);</span>
      }
      
<span class="nc" id="L1117">      list.add(clsname);</span>
    }
    
    // build result
<span class="nc" id="L1121">    result = new Hashtable();</span>
<span class="nc" id="L1122">    enm    = roots.keys();</span>
<span class="nc bnc" id="L1123" title="All 2 branches missed.">    while (enm.hasMoreElements()) {</span>
<span class="nc" id="L1124">      root = (String) enm.nextElement();</span>
<span class="nc" id="L1125">      list = (Vector) roots.get(root);</span>
<span class="nc" id="L1126">      tmpStr = &quot;&quot;;</span>
<span class="nc bnc" id="L1127" title="All 2 branches missed.">      for (i = 0; i &lt; list.size(); i++) {</span>
<span class="nc bnc" id="L1128" title="All 2 branches missed.">        if (i &gt; 0)</span>
<span class="nc" id="L1129">          tmpStr += &quot;,&quot;;</span>
<span class="nc" id="L1130">        tmpStr += (String) list.get(i);</span>
      }
<span class="nc" id="L1132">      result.put(root, tmpStr);</span>
    }
      
<span class="nc" id="L1135">    return result;</span>
  }

  /** 
   * Called when the class of object being edited changes. 
   * 
   * @return the hashtable containing the HierarchyPropertyParsers for the root
   *         elements
   */
  protected Hashtable getClassesFromProperties() {	    

<span class="nc" id="L1146">    Hashtable hpps = new Hashtable();</span>
<span class="nc" id="L1147">    String className = m_ClassType.getName();</span>
<span class="nc" id="L1148">    Hashtable typeOptions = sortClassesByRoot(EDITOR_PROPERTIES.getProperty(className));</span>
<span class="nc bnc" id="L1149" title="All 2 branches missed.">    if (typeOptions == null) {</span>
      /*
      System.err.println(&quot;Warning: No configuration property found in\n&quot;
			 + PROPERTY_FILE + &quot;\n&quot;
			 + &quot;for &quot; + className);
      */
    } else {		    
      try {
<span class="nc" id="L1157">        Enumeration enm = typeOptions.keys();</span>
<span class="nc bnc" id="L1158" title="All 2 branches missed.">        while (enm.hasMoreElements()) {</span>
<span class="nc" id="L1159">          String root = (String) enm.nextElement();</span>
<span class="nc" id="L1160">          String typeOption = (String) typeOptions.get(root);</span>
<span class="nc" id="L1161">          HierarchyPropertyParser hpp = new HierarchyPropertyParser();</span>
<span class="nc" id="L1162">          hpp.build(typeOption, &quot;, &quot;);</span>
<span class="nc" id="L1163">	  hpps.put(root, hpp);</span>
        }
<span class="nc" id="L1165">      } catch (Exception ex) {</span>
<span class="nc" id="L1166">	System.err.println(Messages.getInstance().getString(&quot;GenericObjectEditor_GetClassesFromProperties_Exception_Error_Text&quot;) + typeOptions);</span>
      }	    
    }
<span class="nc" id="L1169">    return hpps;</span>
  }
  
  /**
   * Updates the list of selectable object names, adding any new names to the list.
   */
  protected void updateObjectNames() {
    
<span class="nc bnc" id="L1177" title="All 2 branches missed.">    if (m_ObjectNames == null) {</span>
<span class="nc" id="L1178">      m_ObjectNames = getClassesFromProperties();</span>
    }
    
<span class="nc bnc" id="L1181" title="All 2 branches missed.">    if (m_Object != null) {</span>
<span class="nc" id="L1182">      String className = m_Object.getClass().getName();</span>
<span class="nc" id="L1183">      String root = getRootFromClass(className, new HierarchyPropertyParser().getSeperator());</span>
<span class="nc" id="L1184">      HierarchyPropertyParser hpp = (HierarchyPropertyParser) m_ObjectNames.get(root);</span>
<span class="nc bnc" id="L1185" title="All 2 branches missed.">      if (hpp != null) {</span>
<span class="nc bnc" id="L1186" title="All 2 branches missed.">        if(!hpp.contains(className)){</span>
<span class="nc" id="L1187">          hpp.add(className);</span>
        }
      }
    }
<span class="nc" id="L1191">  }</span>
  
  /**
   * Sets whether the editor is &quot;enabled&quot;, meaning that the current
   * values will be painted.
   *
   * @param newVal a value of type 'boolean'
   */
  public void setEnabled(boolean newVal) {
    
<span class="nc bnc" id="L1201" title="All 2 branches missed.">    if (newVal != m_Enabled) {</span>
<span class="nc" id="L1202">      m_Enabled = newVal;</span>
    }
<span class="nc" id="L1204">  }</span>
  
  /**
   * Sets the class of values that can be edited.
   *
   * @param type a value of type 'Class'
   */
  public void setClassType(Class type) {
    
<span class="nc" id="L1213">    m_ClassType = type;</span>
<span class="nc" id="L1214">    m_ObjectNames = getClassesFromProperties();</span>
<span class="nc" id="L1215">  }</span>
  
  /**
   * Sets the current object to be the default, taken as the first item in
   * the chooser.
   */
  public void setDefaultValue() {
    
<span class="nc bnc" id="L1223" title="All 2 branches missed.">    if (m_ClassType == null) {</span>
<span class="nc" id="L1224">      System.err.println(Messages.getInstance().getString(&quot;GenericObjectEditor_SetDefaultValue_Error_Text&quot;));</span>
<span class="nc" id="L1225">      return;</span>
    }	
    
<span class="nc" id="L1228">    Hashtable hpps = getClassesFromProperties();</span>
<span class="nc" id="L1229">    HierarchyPropertyParser hpp = null;</span>
<span class="nc" id="L1230">    Enumeration enm = hpps.elements();</span>
    
    try{
<span class="nc bnc" id="L1233" title="All 2 branches missed.">      while (enm.hasMoreElements()) {</span>
<span class="nc" id="L1234">        hpp = (HierarchyPropertyParser) enm.nextElement(); </span>
<span class="nc bnc" id="L1235" title="All 2 branches missed.">        if(hpp.depth() &gt; 0) {		</span>
<span class="nc" id="L1236">          hpp.goToRoot();</span>
<span class="nc bnc" id="L1237" title="All 2 branches missed.">          while(!hpp.isLeafReached())</span>
<span class="nc" id="L1238">            hpp.goToChild(0);</span>
          
<span class="nc" id="L1240">          String defaultValue = hpp.fullValue();</span>
<span class="nc" id="L1241">          setValue(Class.forName(defaultValue).newInstance());</span>
        }
      }
<span class="nc" id="L1244">    }catch(Exception ex){</span>
<span class="nc" id="L1245">      System.err.println(Messages.getInstance().getString(&quot;GenericObjectEditor_SetDefaultValue_Exception_Error_Text&quot;) +</span>
<span class="nc" id="L1246">			 hpp.fullValue());</span>
<span class="nc" id="L1247">      ex.printStackTrace();</span>
    }
<span class="nc" id="L1249">  }</span>
  
  /**
   * Sets the current Object. If the Object is in the
   * Object chooser, this becomes the selected item (and added
   * to the chooser if necessary).
   *
   * @param o an object that must be a Object.
   */
  public void setValue(Object o) {
    
<span class="nc bnc" id="L1260" title="All 2 branches missed.">    if (m_ClassType == null) {</span>
<span class="nc" id="L1261">      System.err.println(Messages.getInstance().getString(&quot;GenericObjectEditor_SetValue_Error_Text_First&quot;));</span>
<span class="nc" id="L1262">      return;</span>
    }
<span class="nc bnc" id="L1264" title="All 2 branches missed.">    if (!m_ClassType.isAssignableFrom(o.getClass())) {</span>
<span class="nc" id="L1265">      System.err.println(Messages.getInstance().getString(&quot;GenericObjectEditor_SetValue_Error_Text_Second&quot;));</span>
<span class="nc" id="L1266">      return;</span>
    }
    
<span class="nc" id="L1269">    setObject(o);</span>

<span class="nc bnc" id="L1271" title="All 2 branches missed.">    if (m_EditorComponent != null) m_EditorComponent.repaint();</span>

<span class="nc" id="L1273">    updateObjectNames();</span>
<span class="nc" id="L1274">  }</span>
  
  /**
   * Sets the current Object.
   *
   * @param c a value of type 'Object'
   */
  protected void setObject(Object c) {
    
    // This should really call equals() for comparison.
    boolean trueChange ;
<span class="nc bnc" id="L1285" title="All 2 branches missed.">    if (getValue() != null) {</span>
<span class="nc bnc" id="L1286" title="All 2 branches missed.">      trueChange = (!c.equals(getValue()));</span>
    }
    else
<span class="nc" id="L1289">      trueChange = true;</span>
    
<span class="nc" id="L1291">    m_Backup = m_Object;</span>
    
<span class="nc" id="L1293">    m_Object = c;</span>
    
<span class="nc bnc" id="L1295" title="All 2 branches missed.">    if (m_EditorComponent != null) {</span>
<span class="nc" id="L1296">      m_EditorComponent.updateChildPropertySheet();</span>
    }
<span class="nc bnc" id="L1298" title="All 2 branches missed.">    if (trueChange) {</span>
<span class="nc" id="L1299">      m_Support.firePropertyChange(&quot;&quot;, null, null);</span>
    }
<span class="nc" id="L1301">  }</span>
  
  /**
   * Gets the current Object.
   *
   * @return the current Object
   */
  public Object getValue() {
    
<span class="nc" id="L1310">    Object result = null;</span>
    try {
<span class="nc" id="L1312">      result = makeCopy(m_Object);</span>
<span class="nc" id="L1313">    } catch (Exception ex) {</span>
<span class="nc" id="L1314">      ex.printStackTrace();</span>
    }
<span class="nc" id="L1316">    return result;</span>
  }
  
  /**
   * Supposedly returns an initialization string to create a Object
   * identical to the current one, including it's state, but this doesn't
   * appear possible given that the initialization string isn't supposed to
   * contain multiple statements.
   *
   * @return the java source code initialisation string
   */
  public String getJavaInitializationString() {

<span class="nc" id="L1329">    return &quot;new &quot; + m_Object.getClass().getName() + &quot;()&quot;;</span>
  }

  /**
   * Returns true to indicate that we can paint a representation of the
   * Object.
   *
   * @return true
   */
  public boolean isPaintable() {

<span class="nc" id="L1340">    return true;</span>
  }

  /**
   * Paints a representation of the current Object.
   *
   * @param gfx the graphics context to use
   * @param box the area we are allowed to paint into
   */
  public void paintValue(java.awt.Graphics gfx, java.awt.Rectangle box) {

<span class="nc bnc" id="L1351" title="All 2 branches missed.">    if (m_Enabled) {</span>
      String rep;
<span class="nc bnc" id="L1353" title="All 2 branches missed.">      if (m_Object != null) {</span>
<span class="nc" id="L1354">	rep = m_Object.getClass().getName();</span>
      } else {
<span class="nc" id="L1356">	rep = Messages.getInstance().getString(&quot;GenericObjectEditor_PaintValue_Rep_Text&quot;);</span>
      }
<span class="nc" id="L1358">      int dotPos = rep.lastIndexOf('.');</span>
<span class="nc bnc" id="L1359" title="All 2 branches missed.">      if (dotPos != -1) {</span>
<span class="nc" id="L1360">	rep = rep.substring(dotPos + 1);</span>
      }
      /*
      if (m_Object instanceof OptionHandler) {
	rep += &quot; &quot; + Utils.joinOptions(((OptionHandler)m_Object)
				       .getOptions());
      }
      */
<span class="nc" id="L1368">      java.awt.Font originalFont = gfx.getFont();</span>
<span class="nc" id="L1369">      gfx.setFont(originalFont.deriveFont(java.awt.Font.BOLD));</span>

<span class="nc" id="L1371">      FontMetrics fm = gfx.getFontMetrics();</span>
<span class="nc" id="L1372">      int vpad = (box.height - fm.getHeight());</span>
<span class="nc" id="L1373">      gfx.drawString(rep, 2, fm.getAscent() + vpad);</span>
<span class="nc" id="L1374">      int repwidth = fm.stringWidth(rep);</span>

<span class="nc" id="L1376">      gfx.setFont(originalFont);</span>
<span class="nc bnc" id="L1377" title="All 2 branches missed.">      if (m_Object instanceof OptionHandler) {</span>
<span class="nc" id="L1378">	gfx.drawString(&quot; &quot; + Utils.joinOptions(((OptionHandler)m_Object).getOptions()),</span>
<span class="nc" id="L1379">					       repwidth + 2, fm.getAscent() + vpad);</span>
      }
    }
<span class="nc" id="L1382">  }</span>

  /**
   * Returns null as we don't support getting/setting values as text.
   *
   * @return null
   */
  public String getAsText() {

<span class="nc" id="L1391">    return null;</span>
  }

  /**
   * Returns null as we don't support getting/setting values as text. 
   *
   * @param text the text value
   * @throws IllegalArgumentException as we don't support
   * getting/setting values as text.
   */
  public void setAsText(String text) {

<span class="nc" id="L1403">    throw new IllegalArgumentException(text);</span>
  }

  /**
   * Returns null as we don't support getting values as tags.
   *
   * @return null
   */
  public String[] getTags() {

<span class="nc" id="L1413">    return null;</span>
  }

  /**
   * Returns true because we do support a custom editor.
   *
   * @return true
   */
  public boolean supportsCustomEditor() {

<span class="nc" id="L1423">    return true;</span>
  }
  
  /**
   * Returns the array editing component.
   *
   * @return a value of type 'java.awt.Component'
   */
  public java.awt.Component getCustomEditor() {

<span class="nc bnc" id="L1433" title="All 2 branches missed.">    if (m_EditorComponent == null) {</span>
<span class="nc" id="L1434">      m_EditorComponent = new GOEPanel();</span>
    }
<span class="nc" id="L1436">    return m_EditorComponent;</span>
  }

  /**
   * Adds a PropertyChangeListener who will be notified of value changes.
   *
   * @param l a value of type 'PropertyChangeListener'
   */
  public void addPropertyChangeListener(PropertyChangeListener l) {

<span class="nc" id="L1446">    m_Support.addPropertyChangeListener(l);</span>
<span class="nc" id="L1447">  }</span>

  /**
   * Removes a PropertyChangeListener.
   *
   * @param l a value of type 'PropertyChangeListener'
   */
  public void removePropertyChangeListener(PropertyChangeListener l) {

<span class="nc" id="L1456">    m_Support.removePropertyChangeListener(l);</span>
<span class="nc" id="L1457">  }</span>

  /**
   * Gets the custom panel used for editing the object.
   *
   * @return the panel
   */
  public JPanel getCustomPanel() {
<span class="nc" id="L1465">    final JButton chooseButton = createChooseClassButton();    </span>
<span class="nc" id="L1466">    m_ObjectPropertyPanel = new PropertyPanel(this, true);</span>
    
<span class="nc" id="L1468">    JPanel customPanel = new JPanel() {</span>
      public void setEnabled(boolean enabled) {
<span class="nc" id="L1470">        super.setEnabled(enabled);</span>
<span class="nc" id="L1471">        chooseButton.setEnabled(enabled);</span>
<span class="nc" id="L1472">      }</span>
    };
<span class="nc" id="L1474">    customPanel.setLayout(new BorderLayout());</span>
<span class="nc" id="L1475">    customPanel.add(chooseButton, BorderLayout.WEST);</span>
<span class="nc" id="L1476">    customPanel.add(m_ObjectPropertyPanel, BorderLayout.CENTER);</span>
<span class="nc" id="L1477">    return customPanel;</span>
  }

  /**
   * Creates a button that when clicked will enable the user to change
   * the class of the object being edited.
   * 
   * @return the choose button
   */
  protected JButton createChooseClassButton() {

<span class="nc" id="L1488">    JButton setButton = new JButton(Messages.getInstance().getString(&quot;GenericObjectEditor_CreateChooseClassButton_SetButton_JButton_Text&quot;));</span>

    // anonymous action listener shows a JTree popup and allows the user
    // to choose the class they want
<span class="nc" id="L1492">    setButton.addActionListener(new ActionListener() {</span>
	public void actionPerformed(ActionEvent e) {

<span class="nc" id="L1495">	  JPopupMenu popup = getChooseClassPopupMenu();</span>

	  // show the popup where the source component is
<span class="nc bnc" id="L1498" title="All 2 branches missed.">	  if (e.getSource() instanceof Component) {</span>
<span class="nc" id="L1499">	    Component comp = (Component) e.getSource();</span>
<span class="nc" id="L1500">	    popup.show(comp, comp.getX(), comp.getY());</span>
<span class="nc" id="L1501">	    popup.pack();</span>
<span class="nc" id="L1502">	    popup.repaint();</span>
	  }
<span class="nc" id="L1504">	}</span>
      });

<span class="nc" id="L1507">    return setButton;</span>
  }

  /**
   * creates a classname from the given path.
   * 
   * @param path	the path to generate the classname from
   * @return		the generated classname
   */
  protected String getClassnameFromPath(TreePath path) {
<span class="nc" id="L1517">    StringBuffer classname = new StringBuffer();</span>
    
    // recreate class name from path
<span class="nc" id="L1520">    int start = 0;</span>
<span class="nc bnc" id="L1521" title="All 2 branches missed.">    if (m_ObjectNames.size() &gt; 1)</span>
<span class="nc" id="L1522">      start = 1;</span>

<span class="nc bnc" id="L1524" title="All 2 branches missed.">    for (int i = start; i &lt; path.getPathCount(); i++) {</span>
<span class="nc bnc" id="L1525" title="All 2 branches missed.">      if (i&gt;start) classname.append(&quot;.&quot;);</span>
<span class="nc" id="L1526">      classname.append(</span>
<span class="nc" id="L1527">	  (String) ((GOETreeNode) path.getPathComponent(i)).getUserObject());</span>
    }
    
<span class="nc" id="L1530">    return classname.toString();</span>
  }
  
  /**
   * Returns a popup menu that allows the user to change
   * the class of object.
   *
   * @return a JPopupMenu that when shown will let the user choose the class
   */
  public JPopupMenu getChooseClassPopupMenu() {

<span class="nc" id="L1541">    updateObjectNames();</span>

    // create the tree, and find the path to the current class
<span class="nc" id="L1544">    m_treeNodeOfCurrentObject = null;</span>
<span class="nc" id="L1545">    final JTree tree = createTree(m_ObjectNames);</span>
<span class="nc bnc" id="L1546" title="All 2 branches missed.">    if (m_treeNodeOfCurrentObject != null) {</span>
<span class="nc" id="L1547">      tree.setSelectionPath(new TreePath(m_treeNodeOfCurrentObject.getPath()));</span>
    }
<span class="nc" id="L1549">    tree.getSelectionModel().setSelectionMode</span>
<span class="nc" id="L1550">      (TreeSelectionModel.SINGLE_TREE_SELECTION);</span>

    // create the popup
<span class="nc" id="L1553">    final JPopupMenu popup = new JTreePopupMenu(tree);</span>

    // respond when the user chooses a class
<span class="nc" id="L1556">    tree.addTreeSelectionListener(new TreeSelectionListener() {</span>
	public void valueChanged(TreeSelectionEvent e) {
<span class="nc" id="L1558">	  GOETreeNode node = (GOETreeNode) tree.getLastSelectedPathComponent();</span>
	  
<span class="nc bnc" id="L1560" title="All 2 branches missed.">	  if (node == null) </span>
<span class="nc" id="L1561">	    return;</span>
	  
<span class="nc bnc" id="L1563" title="All 2 branches missed.">	  if (node.isLeaf()) {</span>
	    /*if (node.m_Capabilities != null &amp;&amp; m_CapabilitiesFilter != null) {
	      if (!node.m_Capabilities.supportsMaybe(m_CapabilitiesFilter) &amp;&amp; 
	          !node.m_Capabilities.supports(m_CapabilitiesFilter)) {
	        return;
	      }
	    } */
<span class="nc" id="L1570">	    classSelected(getClassnameFromPath(tree.getSelectionPath()));</span>
<span class="nc" id="L1571">	    popup.setVisible(false);</span>
	  }
<span class="nc" id="L1573">	}</span>
      });
    
<span class="nc" id="L1576">    return popup;</span>
  }

  /**
   * Creates a JTree from an object heirarchy.
   *
   * @param hpps the hierarchy of objects to mirror in the tree
   * @return a JTree representation of the hierarchy
   */
  protected JTree createTree(Hashtable hpps) {
    GOETreeNode             superRoot;
    Enumeration             enm;
    HierarchyPropertyParser hpp;
    
<span class="nc bnc" id="L1590" title="All 2 branches missed.">    if (hpps.size() &gt; 1)</span>
<span class="nc" id="L1591">      superRoot = new GOETreeNode(Messages.getInstance().getString(&quot;GenericObjectEditor_CreateTree_GOETreeNode_Text&quot;));</span>
    else
<span class="nc" id="L1593">      superRoot = null;</span>

<span class="nc" id="L1595">    enm = hpps.elements();</span>
<span class="nc bnc" id="L1596" title="All 2 branches missed.">    while (enm.hasMoreElements()) {</span>
<span class="nc" id="L1597">      hpp = (HierarchyPropertyParser) enm.nextElement();</span>
<span class="nc" id="L1598">      hpp.goToRoot();</span>
<span class="nc" id="L1599">      GOETreeNode root = new GOETreeNode(hpp.getValue());</span>
<span class="nc" id="L1600">      addChildrenToTree(root, hpp);</span>
      
<span class="nc bnc" id="L1602" title="All 2 branches missed.">      if (superRoot == null)</span>
<span class="nc" id="L1603">        superRoot = root;</span>
      else
<span class="nc" id="L1605">        superRoot.add(root);</span>
    }
    
<span class="nc" id="L1608">    JTree tree = new JTree(superRoot);</span>
    
<span class="nc" id="L1610">    return tree;</span>
  }

  /**
   * Recursively builds a JTree from an object heirarchy.
   * Also updates m_treeNodeOfCurrentObject if the current object
   * is discovered during creation.
   *
   * @param tree the root of the tree to add children to
   * @param hpp the hierarchy of objects to mirror in the tree
   */
  protected void addChildrenToTree(GOETreeNode tree,
				   HierarchyPropertyParser hpp) {

    try {
<span class="nc bnc" id="L1625" title="All 2 branches missed.">      for (int i=0; i&lt;hpp.numChildren(); i++) {</span>
<span class="nc" id="L1626">	hpp.goToChild(i);</span>
<span class="nc" id="L1627">	GOETreeNode child = new GOETreeNode(hpp.getValue());</span>
<span class="nc bnc" id="L1628" title="All 2 branches missed.">	if ((m_Object != null) &amp;&amp;</span>
<span class="nc bnc" id="L1629" title="All 2 branches missed.">	    m_Object.getClass().getName().equals(hpp.fullValue())) {</span>
<span class="nc" id="L1630">	  m_treeNodeOfCurrentObject = child;</span>
	}
<span class="nc" id="L1632">	tree.add(child);</span>
<span class="nc" id="L1633">	addChildrenToTree(child, hpp);</span>
<span class="nc" id="L1634">	hpp.goToParent();</span>
      }
<span class="nc" id="L1636">    } catch (Exception e) {</span>
<span class="nc" id="L1637">      e.printStackTrace();</span>
    }
<span class="nc" id="L1639">  }</span>

  /**
   * Called when the user selects an class type to change to.
   *
   * @param className the name of the class that was selected
   */
  protected void classSelected(String className) {

    try {		    
<span class="nc bnc" id="L1649" title="All 4 branches missed.">      if ((m_Object != null) &amp;&amp; m_Object.getClass().getName().equals(className)) {</span>
<span class="nc" id="L1650">	return;</span>
      }
      
<span class="nc" id="L1653">      setValue(Class.forName(className).newInstance());</span>
      //m_ObjectPropertyPanel.showPropertyDialog();
<span class="nc bnc" id="L1655" title="All 2 branches missed.">      if (m_EditorComponent != null) {</span>
<span class="nc" id="L1656">	m_EditorComponent.updateChildPropertySheet();</span>
      }
<span class="nc" id="L1658">    } catch (Exception ex) {</span>
<span class="nc" id="L1659">      JOptionPane.showMessageDialog(null,</span>
<span class="nc" id="L1660">    		  Messages.getInstance().getString(&quot;GenericObjectEditor_ClassSelected_Exception_JOptionPaneShowMessageDialog_Text_First&quot;)</span>
<span class="nc" id="L1661">				    + className + Messages.getInstance().getString(&quot;GenericObjectEditor_ClassSelected_Exception_JOptionPaneShowMessageDialog_Text_Second&quot;),</span>
<span class="nc" id="L1662">				    Messages.getInstance().getString(&quot;GenericObjectEditor_ClassSelected_Exception_JOptionPaneShowMessageDialog_Text_Third&quot;),</span>
<span class="nc" id="L1663">				    JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L1664">      ex.printStackTrace();</span>
      try {
<span class="nc bnc" id="L1666" title="All 2 branches missed.">	if(m_Backup != null)</span>
<span class="nc" id="L1667">	  setValue(m_Backup);</span>
	else
<span class="nc" id="L1669">	  setDefaultValue();			</span>
<span class="nc" id="L1670">      } catch(Exception e) {</span>
<span class="nc" id="L1671">	System.err.println(ex.getMessage());</span>
<span class="nc" id="L1672">	ex.printStackTrace();</span>
      }
    }
<span class="nc" id="L1675">  }</span>
  
  /**
   * Sets the capabilities to use for filtering.
   * 
   * @param value	the object to get the filter capabilities from
   */
  public void setCapabilitiesFilter(Capabilities value) {
<span class="nc" id="L1683">    m_CapabilitiesFilter = new Capabilities(null);</span>
<span class="nc" id="L1684">    m_CapabilitiesFilter.assign(value);</span>
<span class="nc" id="L1685">  }</span>
  
  /**
   * Returns the current Capabilities filter, can be null.
   * 
   * @return		the current Capabiliities used for filtering
   */
  public Capabilities getCapabilitiesFilter() {
<span class="nc" id="L1693">    return m_CapabilitiesFilter;</span>
  }
  
  /**
   * Removes the current Capabilities filter.
   */
  public void removeCapabilitiesFilter() {
<span class="nc" id="L1700">    m_CapabilitiesFilter = null;</span>
<span class="nc" id="L1701">  }</span>

  /**
   * Makes a copy of an object using serialization.
   * 
   * @param source the object to copy
   * @return a copy of the source object
   * @exception Exception if the copy fails
   */
  public static Object makeCopy(Object source) throws Exception {
<span class="nc" id="L1711">    SerializedObject so = new SerializedObject(source);</span>
<span class="nc" id="L1712">    Object result = so.getObject();</span>
<span class="nc" id="L1713">    return result;</span>
  }
  
  /**
   * Returns the available classnames for a certain property in the 
   * props file.
   * 
   * @param property	the property to get the classnames for
   * @return		the classnames
   */
  public static Vector&lt;String&gt; getClassnames(String property) {
    Vector&lt;String&gt;	result;
    String		value;
    String[]		items;
    int			i;
    
<span class="nc" id="L1729">    result = new Vector&lt;String&gt;();</span>
    
<span class="nc" id="L1731">    value = EDITOR_PROPERTIES.getProperty(property, &quot;&quot;).replaceAll(&quot; &quot;, &quot;&quot;).trim();</span>
<span class="nc bnc" id="L1732" title="All 2 branches missed.">    if (value.length() &gt; 0) {</span>
<span class="nc" id="L1733">      items = value.split(&quot;,&quot;);</span>
<span class="nc bnc" id="L1734" title="All 2 branches missed.">      for (i = 0; i &lt; items.length; i++)</span>
<span class="nc" id="L1735">	result.add(items[i]);</span>
    }
    
<span class="nc" id="L1738">    return result;</span>
  }

  /**
   * Tests out the Object editor from the command line.
   *
   * @param args may contain the class name of a Object to edit
   */
  public static void main(String [] args) {

    try {
<span class="nc" id="L1749">      GenericObjectEditor.registerEditors();</span>
<span class="nc" id="L1750">      GenericObjectEditor ce = new GenericObjectEditor(true);</span>
<span class="nc" id="L1751">      ce.setClassType(weka.classifiers.Classifier.class);</span>
<span class="nc" id="L1752">      Object initial = new weka.classifiers.rules.ZeroR();</span>
<span class="nc bnc" id="L1753" title="All 2 branches missed.">      if (args.length &gt; 0){</span>
<span class="nc" id="L1754">	ce.setClassType(Class.forName(args[0]));</span>
<span class="nc bnc" id="L1755" title="All 2 branches missed.">	if(args.length &gt; 1){</span>
<span class="nc" id="L1756">	  initial = (Object)Class.forName(args[1]).newInstance();</span>
<span class="nc" id="L1757">	  ce.setValue(initial);</span>
	}
	else
<span class="nc" id="L1760">	  ce.setDefaultValue();</span>
      }
      else	  
<span class="nc" id="L1763">	ce.setValue(initial);</span>
      
<span class="nc" id="L1765">      PropertyDialog pd = new PropertyDialog((Frame) null, ce, 100, 100);</span>
<span class="nc" id="L1766">      pd.addWindowListener(new WindowAdapter() {</span>
	  public void windowClosing(WindowEvent e) {
<span class="nc" id="L1768">	    PropertyEditor pe = ((PropertyDialog)e.getSource()).getEditor();</span>
<span class="nc" id="L1769">	    Object c = (Object)pe.getValue();</span>
<span class="nc" id="L1770">	    String options = &quot;&quot;;</span>
<span class="nc bnc" id="L1771" title="All 2 branches missed.">	    if (c instanceof OptionHandler) {</span>
<span class="nc" id="L1772">	      options = Utils.joinOptions(((OptionHandler)c).getOptions());</span>
	    }
<span class="nc" id="L1774">	    System.out.println(c.getClass().getName() + &quot; &quot; + options);</span>
<span class="nc" id="L1775">	    System.exit(0);</span>
<span class="nc" id="L1776">	  }</span>
	});
<span class="nc" id="L1778">      pd.setVisible(true);</span>
<span class="nc" id="L1779">    } catch (Exception ex) {</span>
<span class="nc" id="L1780">      ex.printStackTrace();</span>
<span class="nc" id="L1781">      System.err.println(ex.getMessage());</span>
    }
<span class="nc" id="L1783">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>