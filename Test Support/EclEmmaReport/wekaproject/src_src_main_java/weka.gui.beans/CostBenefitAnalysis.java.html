<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>CostBenefitAnalysis.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.gui.beans</a> &gt; <span class="el_source">CostBenefitAnalysis.java</span></div><h1>CostBenefitAnalysis.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">/*</span>
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 *    CostBenefitAnalysis.java
 *    Copyright (C) 2009 University of Waikato, Hamilton, New Zealand
 *
 */

package weka.gui.beans;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.GraphicsEnvironment;
import java.awt.GridLayout;
import java.awt.Graphics;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.FocusEvent;
import java.awt.event.FocusListener;
import java.beans.EventSetDescriptor;
import java.beans.PropertyVetoException;
import java.beans.VetoableChangeListener;
import java.beans.beancontext.BeanContext;
import java.beans.beancontext.BeanContextChild;
import java.beans.beancontext.BeanContextChildSupport;
import java.io.Serializable;
import java.util.Enumeration;
import java.util.Vector;

import javax.swing.BorderFactory;
import javax.swing.ButtonGroup;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JRadioButton;
import javax.swing.JSlider;
import javax.swing.JTextField;
import javax.swing.SwingConstants;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;

import weka.classifiers.evaluation.ThresholdCurve;
import weka.core.Attribute;
import weka.core.FastVector;
import weka.core.Instance;
import weka.core.Instances;
import weka.core.Utils;
import weka.gui.Logger;
import weka.gui.visualize.VisualizePanel;
import weka.gui.visualize.Plot2D;
import weka.gui.visualize.PlotData2D;


/**
 * Bean that aids in analyzing cost/benefit tradeoffs.
 * 
 * @author Mark Hall (mhall{[at]}pentaho{[dot]}com)
 * @version $Revision: 8896 $
 */
public class CostBenefitAnalysis extends JPanel 
  implements BeanCommon, ThresholdDataListener, Visible, UserRequestAcceptor,
  Serializable, BeanContextChild {
  
  /** For serialization */
  private static final long serialVersionUID = 8647471654613320469L;

  protected BeanVisual m_visual;
  
  protected transient JFrame m_popupFrame;

<span class="nc" id="L88">  protected boolean m_framePoppedUp = false;</span>
  
  private transient AnalysisPanel m_analysisPanel;
  
  /**
   * True if this bean's appearance is the design mode appearance
   */
  protected boolean m_design;

  /**
   * BeanContex that this bean might be contained within
   */
<span class="nc" id="L100">  protected transient BeanContext m_beanContext = null;</span>
  
  /**
   * BeanContextChild support
   */
<span class="nc" id="L105">  protected BeanContextChildSupport m_bcSupport = </span>
<span class="nc" id="L106">    new BeanContextChildSupport(this);</span>
  
  /**
   * The object sending us data (we allow only one connection at any one time)
   */
  protected Object m_listenee;
  
  /**
   * Inner class for displaying the plots and all control widgets.
   * 
   * @author Mark Hall (mhall{[at]}pentaho{[dot]}com)
   */
  protected static class AnalysisPanel extends JPanel {
    
    /** For serialization */
    private static final long serialVersionUID = 5364871945448769003L;

    /** Displays the performance graphs(s) */
<span class="nc" id="L124">    protected VisualizePanel m_performancePanel = new VisualizePanel();</span>
    
    /** Displays the cost/benefit (profit/loss) graph */
<span class="nc" id="L127">    protected VisualizePanel m_costBenefitPanel = new VisualizePanel();</span>
    
    /** 
     * The class attribute from the data that was used to generate
     * the threshold curve
     */
    protected Attribute m_classAttribute;
    
    /** Data for the threshold curve */
    protected PlotData2D m_masterPlot;
    
    /** Data for the cost/benefit curve */
    protected PlotData2D m_costBenefit;
    
    /** The size of the points being plotted */
    protected int[] m_shapeSizes;
    
    /** The index of the previous plotted point that was highlighted */
<span class="nc" id="L145">    protected int m_previousShapeIndex = -1;</span>
        
    /** The slider for adjusting the threshold */
<span class="nc" id="L148">    protected JSlider m_thresholdSlider = new JSlider(0,100,0);</span>
    
<span class="nc" id="L150">    protected JRadioButton m_percPop = new JRadioButton(Messages.getInstance().getString(&quot;CostBenefitAnalysis_PpercPop_JRadioButton_Text&quot;));</span>
<span class="nc" id="L151">    protected JRadioButton m_percOfTarget = new JRadioButton(Messages.getInstance().getString(&quot;CostBenefitAnalysis_PercOfTarget_JRadioButton_Text&quot;));</span>
<span class="nc" id="L152">    protected JRadioButton m_threshold = new JRadioButton(Messages.getInstance().getString(&quot;CostBenefitAnalysis_Threshold_JRadioButton_Text&quot;));</span>
    
<span class="nc" id="L154">    protected JLabel m_percPopLab = new JLabel();</span>
<span class="nc" id="L155">    protected JLabel m_percOfTargetLab = new JLabel();</span>
<span class="nc" id="L156">    protected JLabel m_thresholdLab = new JLabel();</span>
    
    // Confusion matrix stuff
<span class="nc" id="L159">    protected JLabel m_conf_predictedA = new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_Conf_PredictedA_JLabel_Text&quot;), SwingConstants.RIGHT);</span>
<span class="nc" id="L160">    protected JLabel m_conf_predictedB = new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_Conf_PredictedB_JLabel_Text&quot;), SwingConstants.RIGHT);</span>
<span class="nc" id="L161">    protected JLabel m_conf_actualA = new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_Conf_ActualA_JLabel_Text&quot;));</span>
<span class="nc" id="L162">    protected JLabel m_conf_actualB = new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_Conf_ActualB_JLabel_Text&quot;));</span>
<span class="nc" id="L163">    protected ConfusionCell m_conf_aa = new ConfusionCell();</span>
<span class="nc" id="L164">    protected ConfusionCell m_conf_ab = new ConfusionCell();</span>
<span class="nc" id="L165">    protected ConfusionCell m_conf_ba = new ConfusionCell();</span>
<span class="nc" id="L166">    protected ConfusionCell m_conf_bb = new ConfusionCell();</span>
    
    // Cost matrix stuff
<span class="nc" id="L169">    protected JLabel m_cost_predictedA = new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_Cost_PredictedA_JLabel_Text&quot;), SwingConstants.RIGHT);</span>
<span class="nc" id="L170">    protected JLabel m_cost_predictedB = new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_Cost_PredictedB_JLabel_Text&quot;), SwingConstants.RIGHT);</span>
<span class="nc" id="L171">    protected JLabel m_cost_actualA = new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_Cost_ActualA_JLabel_Text&quot;));</span>
<span class="nc" id="L172">    protected JLabel m_cost_actualB = new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_Cost_ActualB_JLabel_Text&quot;));</span>
<span class="nc" id="L173">    protected JTextField m_cost_aa = new JTextField(&quot;0.0&quot;, 5);</span>
<span class="nc" id="L174">    protected JTextField m_cost_ab = new JTextField(&quot;1.0&quot;, 5);</span>
<span class="nc" id="L175">    protected JTextField m_cost_ba = new JTextField(&quot;1.0&quot;, 5);</span>
<span class="nc" id="L176">    protected JTextField m_cost_bb = new JTextField(&quot;0.0&quot;, 5);</span>
<span class="nc" id="L177">    protected JButton m_maximizeCB = new JButton(Messages.getInstance().getString(&quot;CostBenefitAnalysis_MaximizeCB_JButton_Text&quot;));</span>
<span class="nc" id="L178">    protected JButton m_minimizeCB = new JButton(Messages.getInstance().getString(&quot;CostBenefitAnalysis_MinimizeCB_JButton_Text&quot;));</span>
<span class="nc" id="L179">    protected JRadioButton m_costR = new JRadioButton(Messages.getInstance().getString(&quot;CostBenefitAnalysis_CostR_JRadioButton_Text&quot;));</span>
<span class="nc" id="L180">    protected JRadioButton m_benefitR = new JRadioButton(Messages.getInstance().getString(&quot;CostBenefitAnalysis_BenefitR_JRadioButton_Text&quot;));</span>
<span class="nc" id="L181">    protected JLabel m_costBenefitL = new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_CostBenefitL_JLabel_Text&quot;), SwingConstants.RIGHT);</span>
<span class="nc" id="L182">    protected JLabel m_costBenefitV = new JLabel(&quot;0&quot;);</span>
<span class="nc" id="L183">    protected JLabel m_randomV = new JLabel(&quot;0&quot;);</span>
<span class="nc" id="L184">    protected JLabel m_gainV = new JLabel(&quot;0&quot;);</span>
    
    protected int m_originalPopSize;
    
    /** Population text field */
<span class="nc" id="L189">    protected JTextField m_totalPopField = new JTextField(6);</span>
    protected int m_totalPopPrevious;
    
    /** Classification accuracy */
<span class="nc" id="L193">    protected JLabel m_classificationAccV = new JLabel(&quot;-&quot;);</span>
    
    // Only update curve &amp; stats if values in cost matrix have changed
    protected double m_tpPrevious;
    protected double m_fpPrevious;
    protected double m_tnPrevious;
    protected double m_fnPrevious;
    
    /**
     * Inner class for handling a single cell in the confusion matrix.
     * Displays the value, value as a percentage of total population and
     * graphical depiction of percentage.
     * 
     * @author Mark Hall (mhall{[at]}pentaho{[dot]}com)
     */
    protected static class ConfusionCell extends JPanel {

      /** For serialization */
      private static final long serialVersionUID = 6148640235434494767L;
      
<span class="nc" id="L213">      private JLabel m_conf_cell = new JLabel(&quot;-&quot;, SwingConstants.RIGHT);</span>
<span class="nc" id="L214">      JLabel m_conf_perc = new JLabel(&quot;-&quot;, SwingConstants.RIGHT);</span>
      
      private JPanel m_percentageP;
      
<span class="nc" id="L218">      protected double m_percentage = 0;</span>
      
<span class="nc" id="L220">      public ConfusionCell() {</span>
<span class="nc" id="L221">        setLayout(new BorderLayout());</span>
<span class="nc" id="L222">        setBorder(BorderFactory.createEtchedBorder());</span>
        
<span class="nc" id="L224">        add(m_conf_cell, BorderLayout.NORTH);</span>
        
<span class="nc" id="L226">        m_percentageP = new JPanel() {</span>
          public void paintComponent(Graphics gx) {
<span class="nc" id="L228">            super.paintComponent(gx);</span>
            
<span class="nc bnc" id="L230" title="All 2 branches missed.">            if (m_percentage &gt; 0) {</span>
<span class="nc" id="L231">              gx.setColor(Color.BLUE);</span>
<span class="nc" id="L232">              int height = this.getHeight();</span>
<span class="nc" id="L233">              double width = this.getWidth();</span>
<span class="nc" id="L234">              int barWidth = (int)(m_percentage * width); </span>
<span class="nc" id="L235">              gx.fillRect(0, 0, barWidth, height);</span>
            }
<span class="nc" id="L237">          }</span>
        };
        
<span class="nc" id="L240">        Dimension d = new Dimension(30,5);</span>
<span class="nc" id="L241">        m_percentageP.setMinimumSize(d);</span>
<span class="nc" id="L242">        m_percentageP.setPreferredSize(d);</span>
<span class="nc" id="L243">        JPanel percHolder = new JPanel();</span>
<span class="nc" id="L244">        percHolder.setLayout(new BorderLayout());</span>
<span class="nc" id="L245">        percHolder.add(m_percentageP, BorderLayout.CENTER);</span>
<span class="nc" id="L246">        percHolder.add(m_conf_perc, BorderLayout.EAST);</span>
        
<span class="nc" id="L248">        add(percHolder, BorderLayout.SOUTH);</span>
<span class="nc" id="L249">      }</span>
      
      /**
       * Set the value of a cell.
       * 
       * @param cellValue the value of the cell
       * @param max the max (for setting value as a percentage)
       * @param scaleFactor scale the value by this amount
       * @param precision precision for the percentage value
       */
      public void setCellValue(double cellValue, double max, double scaleFactor, int precision) {
<span class="nc bnc" id="L260" title="All 2 branches missed.">        if (!Instance.isMissingValue(cellValue)) {</span>
<span class="nc" id="L261">          m_percentage = cellValue / max;</span>
        } else {
<span class="nc" id="L263">          m_percentage = 0;</span>
        }
        
<span class="nc" id="L266">        m_conf_cell.setText(Utils.doubleToString((cellValue * scaleFactor), 0));</span>
<span class="nc" id="L267">        m_conf_perc.setText(Utils.doubleToString(m_percentage * 100.0, precision) + &quot;%&quot;);</span>
        
        // refresh the percentage bar
<span class="nc" id="L270">        m_percentageP.repaint();</span>
<span class="nc" id="L271">      }</span>
    }
    
<span class="nc" id="L274">    public AnalysisPanel() {</span>
<span class="nc" id="L275">      setLayout(new BorderLayout());</span>
<span class="nc" id="L276">      m_performancePanel.setShowAttBars(false);</span>
<span class="nc" id="L277">      m_performancePanel.setShowClassPanel(false);</span>
<span class="nc" id="L278">      m_costBenefitPanel.setShowAttBars(false);</span>
<span class="nc" id="L279">      m_costBenefitPanel.setShowClassPanel(false);</span>
      
<span class="nc" id="L281">      Dimension size = new Dimension(500, 400);</span>
<span class="nc" id="L282">      m_performancePanel.setPreferredSize(size);</span>
<span class="nc" id="L283">      m_performancePanel.setMinimumSize(size);</span>
      
<span class="nc" id="L285">      size = new Dimension(500, 400);</span>
<span class="nc" id="L286">      m_costBenefitPanel.setMinimumSize(size);</span>
<span class="nc" id="L287">      m_costBenefitPanel.setPreferredSize(size);</span>
      
<span class="nc" id="L289">      m_thresholdSlider.addChangeListener(new ChangeListener() {</span>
        public void stateChanged(ChangeEvent e) {
<span class="nc" id="L291">          updateInfoForSliderValue((double)m_thresholdSlider.getValue() / 100.0);</span>
<span class="nc" id="L292">        }</span>
      });
      
<span class="nc" id="L295">      JPanel plotHolder = new JPanel();</span>
<span class="nc" id="L296">      plotHolder.setLayout(new GridLayout(1,2));      </span>
<span class="nc" id="L297">      plotHolder.add(m_performancePanel);</span>
<span class="nc" id="L298">      plotHolder.add(m_costBenefitPanel);</span>
<span class="nc" id="L299">      add(plotHolder, BorderLayout.CENTER);</span>
      
<span class="nc" id="L301">      JPanel lowerPanel = new JPanel();</span>
<span class="nc" id="L302">      lowerPanel.setLayout(new BorderLayout());</span>
      
<span class="nc" id="L304">      ButtonGroup bGroup = new ButtonGroup();</span>
<span class="nc" id="L305">      bGroup.add(m_percPop);</span>
<span class="nc" id="L306">      bGroup.add(m_percOfTarget);</span>
<span class="nc" id="L307">      bGroup.add(m_threshold);</span>
      
<span class="nc" id="L309">      ButtonGroup bGroup2 = new ButtonGroup();</span>
<span class="nc" id="L310">      bGroup2.add(m_costR);</span>
<span class="nc" id="L311">      bGroup2.add(m_benefitR);</span>
<span class="nc" id="L312">      ActionListener rl = new ActionListener() {</span>
        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L314" title="All 2 branches missed.">          if (m_costR.isSelected()) {</span>
<span class="nc" id="L315">            m_costBenefitL.setText(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_CostBenefitL_SetText_Text_First&quot;));</span>
          } else {
<span class="nc" id="L317">            m_costBenefitL.setText(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_CostBenefitL_SetText_Text_Second&quot;));</span>
          }

<span class="nc" id="L320">          double gain = Double.parseDouble(m_gainV.getText());</span>
<span class="nc" id="L321">          gain = -gain;</span>
<span class="nc" id="L322">          m_gainV.setText(Utils.doubleToString(gain, 2));</span>
<span class="nc" id="L323">        }</span>
      };
<span class="nc" id="L325">      m_costR.addActionListener(rl);</span>
<span class="nc" id="L326">      m_benefitR.addActionListener(rl);</span>
<span class="nc" id="L327">      m_costR.setSelected(true);</span>
      
<span class="nc" id="L329">      m_percPop.setSelected(true);</span>
<span class="nc" id="L330">      JPanel threshPanel = new JPanel();</span>
<span class="nc" id="L331">      threshPanel.setLayout(new BorderLayout());</span>
<span class="nc" id="L332">      JPanel radioHolder = new JPanel();</span>
<span class="nc" id="L333">      radioHolder.setLayout(new FlowLayout());</span>
<span class="nc" id="L334">      radioHolder.add(m_percPop);</span>
<span class="nc" id="L335">      radioHolder.add(m_percOfTarget);</span>
<span class="nc" id="L336">      radioHolder.add(m_threshold);</span>
<span class="nc" id="L337">      threshPanel.add(radioHolder, BorderLayout.NORTH);</span>
<span class="nc" id="L338">      threshPanel.add(m_thresholdSlider, BorderLayout.SOUTH);</span>
      
<span class="nc" id="L340">      JPanel threshInfoPanel = new JPanel();</span>
<span class="nc" id="L341">      threshInfoPanel.setLayout(new GridLayout(3,2));</span>
<span class="nc" id="L342">      threshInfoPanel.add(new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_ThreshInfoPanel_JLabel_Text_First&quot;), SwingConstants.RIGHT));</span>
<span class="nc" id="L343">      threshInfoPanel.add(m_percPopLab);</span>
<span class="nc" id="L344">      threshInfoPanel.add(new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_ThreshInfoPanel_JLabel_Text_Second&quot;), SwingConstants.RIGHT));</span>
<span class="nc" id="L345">      threshInfoPanel.add(m_percOfTargetLab);</span>
<span class="nc" id="L346">      threshInfoPanel.add(new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_ThreshInfoPanel_JLabel_Text_Third&quot;), SwingConstants.RIGHT));</span>
<span class="nc" id="L347">      threshInfoPanel.add(m_thresholdLab);</span>
      
<span class="nc" id="L349">      JPanel threshHolder = new JPanel();</span>
<span class="nc" id="L350">      threshHolder.setBorder(BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_ThreshInfoPanel_ThreshHolder_SetBorder_BorderFactory_CreateTitledBorder_Text&quot;)));</span>
<span class="nc" id="L351">      threshHolder.setLayout(new BorderLayout());</span>
<span class="nc" id="L352">      threshHolder.add(threshPanel, BorderLayout.CENTER);</span>
<span class="nc" id="L353">      threshHolder.add(threshInfoPanel, BorderLayout.EAST);</span>
      
<span class="nc" id="L355">      lowerPanel.add(threshHolder, BorderLayout.NORTH);</span>
      
      // holder for the two matrixes
<span class="nc" id="L358">      JPanel matrixHolder = new JPanel();</span>
<span class="nc" id="L359">      matrixHolder.setLayout(new GridLayout(1,2));</span>
      
      // confusion matrix
<span class="nc" id="L362">      JPanel confusionPanel = new JPanel();</span>
<span class="nc" id="L363">      confusionPanel.setLayout(new GridLayout(3,3));</span>
<span class="nc" id="L364">      confusionPanel.add(m_conf_predictedA);</span>
<span class="nc" id="L365">      confusionPanel.add(m_conf_predictedB);</span>
<span class="nc" id="L366">      confusionPanel.add(new JLabel()); // dummy</span>
<span class="nc" id="L367">      confusionPanel.add(m_conf_aa);</span>
<span class="nc" id="L368">      confusionPanel.add(m_conf_ab);</span>
<span class="nc" id="L369">      confusionPanel.add(m_conf_actualA);</span>
<span class="nc" id="L370">      confusionPanel.add(m_conf_ba);</span>
<span class="nc" id="L371">      confusionPanel.add(m_conf_bb);</span>
<span class="nc" id="L372">      confusionPanel.add(m_conf_actualB);</span>
<span class="nc" id="L373">      JPanel tempHolderCA = new JPanel();</span>
<span class="nc" id="L374">      tempHolderCA.setLayout(new BorderLayout());</span>
<span class="nc" id="L375">      tempHolderCA.setBorder(BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_ThreshInfoPanel_TempHolderCA_SetBorder_BorderFactory_CreateTitledBorder_Text&quot;)));</span>
<span class="nc" id="L376">      tempHolderCA.add(confusionPanel, BorderLayout.CENTER);</span>
      
<span class="nc" id="L378">      JPanel accHolder = new JPanel();</span>
<span class="nc" id="L379">      accHolder.setLayout(new FlowLayout(FlowLayout.LEFT));</span>
<span class="nc" id="L380">      accHolder.add(new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_ThreshInfoPanel_AccHolder_Add_JLabel_Text&quot;)));</span>
<span class="nc" id="L381">      accHolder.add(m_classificationAccV);</span>
<span class="nc" id="L382">      tempHolderCA.add(accHolder, BorderLayout.SOUTH);</span>
      
<span class="nc" id="L384">      matrixHolder.add(tempHolderCA);</span>
      
      // cost matrix
<span class="nc" id="L387">      JPanel costPanel = new JPanel();</span>
<span class="nc" id="L388">      costPanel.setBorder(BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_CostPanel_SetBorder_BorderFactory_CcreateTitledBorder_Text&quot;)));</span>
<span class="nc" id="L389">      costPanel.setLayout(new BorderLayout());</span>
      
<span class="nc" id="L391">      JPanel cmHolder = new JPanel();</span>
<span class="nc" id="L392">      cmHolder.setLayout(new GridLayout(3, 3));</span>
<span class="nc" id="L393">      cmHolder.add(m_cost_predictedA);      </span>
<span class="nc" id="L394">      cmHolder.add(m_cost_predictedB);</span>
<span class="nc" id="L395">      cmHolder.add(new JLabel()); // dummy</span>
<span class="nc" id="L396">      cmHolder.add(m_cost_aa);</span>
<span class="nc" id="L397">      cmHolder.add(m_cost_ab);</span>
<span class="nc" id="L398">      cmHolder.add(m_cost_actualA);</span>
<span class="nc" id="L399">      cmHolder.add(m_cost_ba);</span>
<span class="nc" id="L400">      cmHolder.add(m_cost_bb);</span>
<span class="nc" id="L401">      cmHolder.add(m_cost_actualB);</span>
<span class="nc" id="L402">      costPanel.add(cmHolder, BorderLayout.CENTER);</span>
      
<span class="nc" id="L404">      FocusListener fl = new FocusListener() {</span>
        public void focusGained(FocusEvent e) {
          
<span class="nc" id="L407">        }</span>
        
        public void focusLost(FocusEvent e) {
<span class="nc bnc" id="L410" title="All 2 branches missed.">          if (constructCostBenefitData()) {</span>
            try {
<span class="nc" id="L412">              m_costBenefitPanel.setMasterPlot(m_costBenefit);</span>
<span class="nc" id="L413">              m_costBenefitPanel.validate(); m_costBenefitPanel.repaint();</span>
<span class="nc" id="L414">            } catch (Exception ex) {</span>
<span class="nc" id="L415">              ex.printStackTrace();</span>
            }
<span class="nc" id="L417">            updateCostBenefit();</span>
          }
<span class="nc" id="L419">        }</span>
      };
      
<span class="nc" id="L422">      ActionListener al = new ActionListener() {</span>
        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L424" title="All 2 branches missed.">          if (constructCostBenefitData()) {</span>
            try {
<span class="nc" id="L426">              m_costBenefitPanel.setMasterPlot(m_costBenefit);</span>
<span class="nc" id="L427">              m_costBenefitPanel.validate(); m_costBenefitPanel.repaint();</span>
<span class="nc" id="L428">            } catch (Exception ex) {</span>
<span class="nc" id="L429">              ex.printStackTrace();</span>
            }
<span class="nc" id="L431">            updateCostBenefit();</span>
          }
<span class="nc" id="L433">        }</span>
      };
            
<span class="nc" id="L436">      m_cost_aa.addFocusListener(fl);</span>
<span class="nc" id="L437">      m_cost_aa.addActionListener(al);</span>
<span class="nc" id="L438">      m_cost_ab.addFocusListener(fl);</span>
<span class="nc" id="L439">      m_cost_ab.addActionListener(al);</span>
<span class="nc" id="L440">      m_cost_ba.addFocusListener(fl);</span>
<span class="nc" id="L441">      m_cost_ba.addActionListener(al);</span>
<span class="nc" id="L442">      m_cost_bb.addFocusListener(fl);</span>
<span class="nc" id="L443">      m_cost_bb.addActionListener(al);</span>
      
<span class="nc" id="L445">      m_totalPopField.addFocusListener(fl);</span>
<span class="nc" id="L446">      m_totalPopField.addActionListener(al);</span>
      
<span class="nc" id="L448">      JPanel cbHolder = new JPanel();</span>
<span class="nc" id="L449">      cbHolder.setLayout(new BorderLayout());</span>
<span class="nc" id="L450">      JPanel tempP = new JPanel();</span>
<span class="nc" id="L451">      tempP.setLayout(new GridLayout(3, 2));</span>
<span class="nc" id="L452">      tempP.add(m_costBenefitL);</span>
<span class="nc" id="L453">      tempP.add(m_costBenefitV);</span>
<span class="nc" id="L454">      tempP.add(new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_CbHolder_TempP_JPanel_Add_JLabel_Text_First&quot;), SwingConstants.RIGHT));</span>
<span class="nc" id="L455">      tempP.add(m_randomV);</span>
<span class="nc" id="L456">      tempP.add(new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_CbHolder_TempP_JPanel_Add_JLabel_Text_Second&quot;), SwingConstants.RIGHT));</span>
<span class="nc" id="L457">      tempP.add(m_gainV);</span>
<span class="nc" id="L458">      cbHolder.add(tempP, BorderLayout.NORTH);</span>
<span class="nc" id="L459">      JPanel butHolder = new JPanel();</span>
<span class="nc" id="L460">      butHolder.setLayout(new GridLayout(2, 1));</span>
<span class="nc" id="L461">      butHolder.add(m_maximizeCB);</span>
<span class="nc" id="L462">      butHolder.add(m_minimizeCB);</span>
<span class="nc" id="L463">      m_maximizeCB.addActionListener(new ActionListener() {</span>
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L465">          findMaxMinCB(true);</span>
<span class="nc" id="L466">        }</span>
      });
      
<span class="nc" id="L469">      m_minimizeCB.addActionListener(new ActionListener() {</span>
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L471">          findMaxMinCB(false);</span>
<span class="nc" id="L472">        }</span>
      });
      
<span class="nc" id="L475">      cbHolder.add(butHolder, BorderLayout.SOUTH);</span>
<span class="nc" id="L476">      costPanel.add(cbHolder, BorderLayout.EAST);</span>
      
<span class="nc" id="L478">      JPanel popCBR = new JPanel();</span>
<span class="nc" id="L479">      popCBR.setLayout(new GridLayout(1, 2));</span>
<span class="nc" id="L480">      JPanel popHolder = new JPanel();</span>
<span class="nc" id="L481">      popHolder.setLayout(new FlowLayout(FlowLayout.LEFT));</span>
<span class="nc" id="L482">      popHolder.add(new JLabel(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_PopHolder_Add_JLabel_Text&quot;)));</span>
<span class="nc" id="L483">      popHolder.add(m_totalPopField);</span>
      
<span class="nc" id="L485">      JPanel radioHolder2 = new JPanel();</span>
<span class="nc" id="L486">      radioHolder2.setLayout(new FlowLayout(FlowLayout.RIGHT));</span>
<span class="nc" id="L487">      radioHolder2.add(m_costR);</span>
<span class="nc" id="L488">      radioHolder2.add(m_benefitR);</span>
<span class="nc" id="L489">      popCBR.add(popHolder);</span>
<span class="nc" id="L490">      popCBR.add(radioHolder2);</span>
      
<span class="nc" id="L492">      costPanel.add(popCBR, BorderLayout.SOUTH);</span>
      
<span class="nc" id="L494">      matrixHolder.add(costPanel);</span>
      
      
<span class="nc" id="L497">      lowerPanel.add(matrixHolder, BorderLayout.SOUTH);</span>
      


//      popAccHolder.add(popHolder);
      
      //popAccHolder.add(accHolder);
      
      /*JPanel lowerPanel2 = new JPanel();
      lowerPanel2.setLayout(new BorderLayout());
      lowerPanel2.add(lowerPanel, BorderLayout.NORTH);
      lowerPanel2.add(popAccHolder, BorderLayout.SOUTH); */
      
<span class="nc" id="L510">      add(lowerPanel, BorderLayout.SOUTH);</span>
      
<span class="nc" id="L512">    }</span>
    
    private void findMaxMinCB(boolean max) {
<span class="nc bnc" id="L515" title="All 2 branches missed.">      double maxMin = (max) </span>
<span class="nc" id="L516">      ? Double.NEGATIVE_INFINITY </span>
<span class="nc" id="L517">          : Double.POSITIVE_INFINITY;</span>
      
<span class="nc" id="L519">      Instances cBCurve = m_costBenefit.getPlotInstances();</span>
<span class="nc" id="L520">      int maxMinIndex = 0;</span>
      
<span class="nc bnc" id="L522" title="All 2 branches missed.">      for (int i = 0; i &lt; cBCurve.numInstances(); i++) {</span>
<span class="nc" id="L523">        Instance current = cBCurve.instance(i);</span>
<span class="nc bnc" id="L524" title="All 2 branches missed.">        if (max) {</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">          if (current.value(1) &gt; maxMin) {</span>
<span class="nc" id="L526">            maxMin = current.value(1);</span>
<span class="nc" id="L527">            maxMinIndex = i;</span>
          }
        } else {
<span class="nc bnc" id="L530" title="All 2 branches missed.">          if (current.value(1) &lt; maxMin) {</span>
<span class="nc" id="L531">            maxMin = current.value(1);</span>
<span class="nc" id="L532">            maxMinIndex = i;</span>
          }
        }
      }
      
      
      // set the slider to the correct position
<span class="nc" id="L539">      int indexOfSampleSize = </span>
<span class="nc" id="L540">        m_masterPlot.getPlotInstances().attribute(ThresholdCurve.SAMPLE_SIZE_NAME).index();</span>
<span class="nc" id="L541">      int indexOfPercOfTarget = </span>
<span class="nc" id="L542">        m_masterPlot.getPlotInstances().attribute(ThresholdCurve.RECALL_NAME).index();</span>
<span class="nc" id="L543">      int indexOfThreshold =</span>
<span class="nc" id="L544">        m_masterPlot.getPlotInstances().attribute(ThresholdCurve.THRESHOLD_NAME).index();</span>
      int indexOfMetric;
      
<span class="nc bnc" id="L547" title="All 2 branches missed.">      if (m_percPop.isSelected()) {</span>
<span class="nc" id="L548">        indexOfMetric = indexOfSampleSize;           </span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">      } else if (m_percOfTarget.isSelected()) {</span>
<span class="nc" id="L550">        indexOfMetric = indexOfPercOfTarget;</span>
      } else {
<span class="nc" id="L552">        indexOfMetric = indexOfThreshold;</span>
      }
      
<span class="nc" id="L555">      double valueOfMetric = m_masterPlot.getPlotInstances().instance(maxMinIndex).value(indexOfMetric);</span>
<span class="nc" id="L556">      valueOfMetric *= 100.0;</span>
      
      // set the approximate location of the slider
<span class="nc" id="L559">      m_thresholdSlider.setValue((int)valueOfMetric);</span>
      
      // make sure the actual values relate to the true min/max rather
      // than being off due to slider location error.
<span class="nc" id="L563">      updateInfoGivenIndex(maxMinIndex);</span>
<span class="nc" id="L564">    }</span>
    
    private void updateCostBenefit() {
<span class="nc" id="L567">      double value = (double)m_thresholdSlider.getValue() / 100.0;</span>
<span class="nc" id="L568">      Instances plotInstances = m_masterPlot.getPlotInstances();</span>
<span class="nc" id="L569">      int indexOfSampleSize = </span>
<span class="nc" id="L570">        m_masterPlot.getPlotInstances().attribute(ThresholdCurve.SAMPLE_SIZE_NAME).index();</span>
<span class="nc" id="L571">      int indexOfPercOfTarget = </span>
<span class="nc" id="L572">        m_masterPlot.getPlotInstances().attribute(ThresholdCurve.RECALL_NAME).index();</span>
<span class="nc" id="L573">      int indexOfThreshold =</span>
<span class="nc" id="L574">        m_masterPlot.getPlotInstances().attribute(ThresholdCurve.THRESHOLD_NAME).index();</span>
      int indexOfMetric;
      
<span class="nc bnc" id="L577" title="All 2 branches missed.">      if (m_percPop.isSelected()) {</span>
<span class="nc" id="L578">        indexOfMetric = indexOfSampleSize;           </span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">      } else if (m_percOfTarget.isSelected()) {</span>
<span class="nc" id="L580">        indexOfMetric = indexOfPercOfTarget;</span>
      } else {
<span class="nc" id="L582">        indexOfMetric = indexOfThreshold;</span>
      }
      
<span class="nc" id="L585">      int index = findIndexForValue(value, plotInstances, indexOfMetric);</span>
<span class="nc" id="L586">      updateCBRandomGainInfo(index);</span>
<span class="nc" id="L587">    }</span>
    
    private void updateCBRandomGainInfo(int index) {
<span class="nc" id="L590">      double requestedPopSize = m_originalPopSize;</span>
      try {
<span class="nc" id="L592">        requestedPopSize = Double.parseDouble(m_totalPopField.getText());</span>
<span class="nc" id="L593">      } catch (NumberFormatException e) {}</span>
<span class="nc" id="L594">      double scaleFactor = requestedPopSize / m_originalPopSize;</span>
      
<span class="nc" id="L596">      double CB = m_costBenefit.</span>
<span class="nc" id="L597">        getPlotInstances().instance(index).value(1);</span>
<span class="nc" id="L598">      m_costBenefitV.setText(Utils.doubleToString(CB,2));</span>
      
<span class="nc" id="L600">      double totalRandomCB = 0.0;</span>
<span class="nc" id="L601">      Instance first = m_masterPlot.getPlotInstances().instance(0);</span>
<span class="nc" id="L602">      double totalPos = first.value(m_masterPlot.getPlotInstances().</span>
<span class="nc" id="L603">          attribute(ThresholdCurve.TRUE_POS_NAME).index()) * scaleFactor;</span>
<span class="nc" id="L604">      double totalNeg = first.value(m_masterPlot.getPlotInstances().</span>
<span class="nc" id="L605">          attribute(ThresholdCurve.FALSE_POS_NAME)) * scaleFactor;</span>

<span class="nc" id="L607">      double posInSample = (totalPos * (Double.parseDouble(m_percPopLab.getText()) / 100.0));</span>
<span class="nc" id="L608">      double negInSample = (totalNeg * (Double.parseDouble(m_percPopLab.getText()) / 100.0));</span>
<span class="nc" id="L609">      double posOutSample = totalPos - posInSample;</span>
<span class="nc" id="L610">      double negOutSample = totalNeg - negInSample;</span>
      
<span class="nc" id="L612">      double tpCost = 0.0;</span>
      try {
<span class="nc" id="L614">        tpCost = Double.parseDouble(m_cost_aa.getText());</span>
<span class="nc" id="L615">      } catch (NumberFormatException n) {}</span>
<span class="nc" id="L616">      double fpCost = 0.0;</span>
      try {
<span class="nc" id="L618">        fpCost = Double.parseDouble(m_cost_ba.getText());</span>
<span class="nc" id="L619">      } catch (NumberFormatException n) {}</span>
<span class="nc" id="L620">      double tnCost = 0.0;</span>
      try {
<span class="nc" id="L622">        tnCost = Double.parseDouble(m_cost_bb.getText());</span>
<span class="nc" id="L623">      } catch (NumberFormatException n) {}</span>
<span class="nc" id="L624">      double fnCost = 0.0;</span>
      try {
<span class="nc" id="L626">        fnCost = Double.parseDouble(m_cost_ab.getText());</span>
<span class="nc" id="L627">      } catch (NumberFormatException n) {}</span>
      
<span class="nc" id="L629">      totalRandomCB += posInSample * tpCost;</span>
<span class="nc" id="L630">      totalRandomCB += negInSample * fpCost;</span>
<span class="nc" id="L631">      totalRandomCB += posOutSample * fnCost;</span>
<span class="nc" id="L632">      totalRandomCB += negOutSample * tnCost;</span>
      
<span class="nc" id="L634">      m_randomV.setText(Utils.doubleToString(totalRandomCB, 2));</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">      double gain = (m_costR.isSelected()) </span>
<span class="nc" id="L636">      ? totalRandomCB - CB</span>
<span class="nc" id="L637">          : CB - totalRandomCB;</span>
<span class="nc" id="L638">      m_gainV.setText(Utils.doubleToString(gain, 2));</span>
      
      // update classification rate
<span class="nc" id="L641">      Instance currentInst = m_masterPlot.getPlotInstances().instance(index);</span>
<span class="nc" id="L642">      double tp = currentInst.value(m_masterPlot.getPlotInstances().</span>
<span class="nc" id="L643">          attribute(ThresholdCurve.TRUE_POS_NAME).index());</span>
<span class="nc" id="L644">      double tn = currentInst.value(m_masterPlot.getPlotInstances().</span>
<span class="nc" id="L645">          attribute(ThresholdCurve.TRUE_NEG_NAME).index());</span>
<span class="nc" id="L646">      m_classificationAccV.</span>
<span class="nc" id="L647">        setText(Utils.doubleToString((tp + tn) / (totalPos + totalNeg) * 100.0, 4) + &quot;%&quot;);      </span>
<span class="nc" id="L648">    }</span>
    
    private void updateInfoGivenIndex(int index) {
<span class="nc" id="L651">      Instances plotInstances = m_masterPlot.getPlotInstances();</span>
<span class="nc" id="L652">      int indexOfSampleSize = </span>
<span class="nc" id="L653">        m_masterPlot.getPlotInstances().attribute(ThresholdCurve.SAMPLE_SIZE_NAME).index();</span>
<span class="nc" id="L654">      int indexOfPercOfTarget = </span>
<span class="nc" id="L655">        m_masterPlot.getPlotInstances().attribute(ThresholdCurve.RECALL_NAME).index();</span>
<span class="nc" id="L656">      int indexOfThreshold =</span>
<span class="nc" id="L657">        m_masterPlot.getPlotInstances().attribute(ThresholdCurve.THRESHOLD_NAME).index();</span>
      
      // update labels
<span class="nc" id="L660">      m_percPopLab.setText(Utils.</span>
<span class="nc" id="L661">          doubleToString(100.0 * plotInstances.instance(index).value(indexOfSampleSize), 4));</span>
<span class="nc" id="L662">      m_percOfTargetLab.setText(Utils.doubleToString(</span>
<span class="nc" id="L663">          100.0 * plotInstances.instance(index).value(indexOfPercOfTarget), 4));</span>
<span class="nc" id="L664">      m_thresholdLab.setText(Utils.doubleToString(plotInstances.instance(index).value(indexOfThreshold), 4));</span>
      /*if (m_percPop.isSelected()) {
        m_percPopLab.setText(Utils.doubleToString(100.0 * value, 4));
      } else if (m_percOfTarget.isSelected()) {
        m_percOfTargetLab.setText(Utils.doubleToString(100.0 * value, 4));
      } else {
        m_thresholdLab.setText(Utils.doubleToString(value, 4));
      }*/
      
      // Update the highlighted point on the graphs */
<span class="nc bnc" id="L674" title="All 2 branches missed.">      if (m_previousShapeIndex &gt;= 0) {</span>
<span class="nc" id="L675">        m_shapeSizes[m_previousShapeIndex] = 1;</span>
      }
     
<span class="nc" id="L678">      m_shapeSizes[index] = 10;</span>
<span class="nc" id="L679">      m_previousShapeIndex = index;</span>
      
      // Update the confusion matrix
//      double totalInstances = 
<span class="nc" id="L683">      int tp = plotInstances.attribute(ThresholdCurve.TRUE_POS_NAME).index();</span>
<span class="nc" id="L684">      int fp = plotInstances.attribute(ThresholdCurve.FALSE_POS_NAME).index();</span>
<span class="nc" id="L685">      int tn = plotInstances.attribute(ThresholdCurve.TRUE_NEG_NAME).index();</span>
<span class="nc" id="L686">      int fn = plotInstances.attribute(ThresholdCurve.FALSE_NEG_NAME).index();</span>
<span class="nc" id="L687">      Instance temp = plotInstances.instance(index);</span>
<span class="nc" id="L688">      double totalInstances = temp.value(tp) + temp.value(fp) + temp.value(tn) + temp.value(fn);</span>
      // get the value out of the total pop field (if possible)
<span class="nc" id="L690">      double requestedPopSize = totalInstances;</span>
      try {
<span class="nc" id="L692">        requestedPopSize = Double.parseDouble(m_totalPopField.getText());</span>
<span class="nc" id="L693">      } catch (NumberFormatException e) {}</span>
      
<span class="nc" id="L695">      m_conf_aa.setCellValue(temp.value(tp), totalInstances, </span>
<span class="nc" id="L696">          requestedPopSize / totalInstances, 2);</span>
<span class="nc" id="L697">      m_conf_ab.setCellValue(temp.value(fn), totalInstances, </span>
<span class="nc" id="L698">          requestedPopSize / totalInstances, 2);</span>
<span class="nc" id="L699">      m_conf_ba.setCellValue(temp.value(fp), totalInstances, </span>
<span class="nc" id="L700">          requestedPopSize / totalInstances, 2);</span>
<span class="nc" id="L701">      m_conf_bb.setCellValue(temp.value(tn), totalInstances, </span>
<span class="nc" id="L702">            requestedPopSize / totalInstances, 2);</span>
      
<span class="nc" id="L704">      updateCBRandomGainInfo(index);</span>
      
<span class="nc" id="L706">      repaint();</span>
<span class="nc" id="L707">    }</span>
    
    private void updateInfoForSliderValue(double value) {
<span class="nc" id="L710">      int indexOfSampleSize = </span>
<span class="nc" id="L711">        m_masterPlot.getPlotInstances().attribute(ThresholdCurve.SAMPLE_SIZE_NAME).index();</span>
<span class="nc" id="L712">      int indexOfPercOfTarget = </span>
<span class="nc" id="L713">        m_masterPlot.getPlotInstances().attribute(ThresholdCurve.RECALL_NAME).index();</span>
<span class="nc" id="L714">      int indexOfThreshold =</span>
<span class="nc" id="L715">        m_masterPlot.getPlotInstances().attribute(ThresholdCurve.THRESHOLD_NAME).index();</span>
      int indexOfMetric;
      
<span class="nc bnc" id="L718" title="All 2 branches missed.">      if (m_percPop.isSelected()) {</span>
<span class="nc" id="L719">        indexOfMetric = indexOfSampleSize;           </span>
<span class="nc bnc" id="L720" title="All 2 branches missed.">      } else if (m_percOfTarget.isSelected()) {</span>
<span class="nc" id="L721">        indexOfMetric = indexOfPercOfTarget;</span>
      } else {
<span class="nc" id="L723">        indexOfMetric = indexOfThreshold;</span>
      }
      
<span class="nc" id="L726">      Instances plotInstances = m_masterPlot.getPlotInstances();</span>
<span class="nc" id="L727">      int index = findIndexForValue(value, plotInstances, indexOfMetric);</span>
<span class="nc" id="L728">      updateInfoGivenIndex(index);</span>
<span class="nc" id="L729">    }</span>
    
    private int findIndexForValue(double value, Instances plotInstances, int indexOfMetric) {
      // binary search
      // threshold curve is sorted ascending in the threshold (thus
      // descending for recall and pop size)
<span class="nc" id="L735">      int index = -1;</span>
<span class="nc" id="L736">      int lower = 0;</span>
<span class="nc" id="L737">      int upper = plotInstances.numInstances() - 1;</span>
<span class="nc" id="L738">      int mid = (upper - lower) / 2;</span>
<span class="nc" id="L739">      boolean done = false;</span>
<span class="nc bnc" id="L740" title="All 2 branches missed.">      while (!done) {</span>
<span class="nc bnc" id="L741" title="All 2 branches missed.">        if (upper - lower &lt;= 1) {</span>
          
          // choose the one closest to the value
<span class="nc" id="L744">          double comp1 = plotInstances.instance(upper).value(indexOfMetric);</span>
<span class="nc" id="L745">          double comp2 = plotInstances.instance(lower).value(indexOfMetric);</span>
<span class="nc bnc" id="L746" title="All 2 branches missed.">          if (Math.abs(comp1 - value) &lt; Math.abs(comp2 - value)) {</span>
<span class="nc" id="L747">            index = upper;</span>
          } else {
<span class="nc" id="L749">            index = lower;</span>
          }
          
<span class="nc" id="L752">          break;</span>
        }
<span class="nc" id="L754">        double comparisonVal = plotInstances.instance(mid).value(indexOfMetric);</span>
<span class="nc bnc" id="L755" title="All 2 branches missed.">        if (value &gt; comparisonVal) {</span>
<span class="nc bnc" id="L756" title="All 2 branches missed.">          if (m_threshold.isSelected()) {</span>
<span class="nc" id="L757">            lower = mid;</span>
<span class="nc" id="L758">            mid += (upper - lower) / 2;</span>
          } else {
<span class="nc" id="L760">            upper = mid;</span>
<span class="nc" id="L761">            mid -= (upper - lower) / 2;</span>
          }
<span class="nc bnc" id="L763" title="All 2 branches missed.">        } else if (value &lt; comparisonVal) {</span>
<span class="nc bnc" id="L764" title="All 2 branches missed.">          if (m_threshold.isSelected()) {</span>
<span class="nc" id="L765">            upper = mid;</span>
<span class="nc" id="L766">            mid -= (upper - lower) / 2;</span>
          } else {
<span class="nc" id="L768">            lower = mid;</span>
<span class="nc" id="L769">            mid += (upper - lower) / 2;</span>
          }
        } else {
<span class="nc" id="L772">          index = mid;</span>
<span class="nc" id="L773">          done = true;</span>
        }
      }
      
      // now check for ties in the appropriate direction
<span class="nc bnc" id="L778" title="All 2 branches missed.">      if (!m_threshold.isSelected()) {</span>
<span class="nc bnc" id="L779" title="All 2 branches missed.">        while (index + 1 &lt; plotInstances.numInstances()) {</span>
<span class="nc bnc" id="L780" title="All 2 branches missed.">          if (plotInstances.instance(index + 1).value(indexOfMetric) == </span>
<span class="nc" id="L781">            plotInstances.instance(index).value(indexOfMetric)) {</span>
<span class="nc" id="L782">            index++;</span>
          } else {
            break;
          }
        }
      } else {
<span class="nc bnc" id="L788" title="All 2 branches missed.">        while (index - 1 &gt;= 0) {</span>
<span class="nc bnc" id="L789" title="All 2 branches missed.">          if (plotInstances.instance(index - 1).value(indexOfMetric) == </span>
<span class="nc" id="L790">            plotInstances.instance(index).value(indexOfMetric)) {</span>
<span class="nc" id="L791">            index--;</span>
          } else {
            break;
          } 
        }
      }
<span class="nc" id="L797">      return index;</span>
    }
    
    /**
     * Set the threshold data for the panel to use.
     * 
     * @param data PlotData2D object encapsulating the threshold data.
     * @param classAtt the class attribute from the original data used to generate
     * the threshold data.
     * @throws Exception if something goes wrong.
     */
    public synchronized void setDataSet(PlotData2D data, Attribute classAtt) throws Exception {      
      // make a copy of the PlotData2D object
<span class="nc" id="L810">      m_masterPlot = new PlotData2D(data.getPlotInstances());</span>
<span class="nc" id="L811">      boolean[] connectPoints = new boolean[m_masterPlot.getPlotInstances().numInstances()];</span>
<span class="nc bnc" id="L812" title="All 2 branches missed.">      for (int i = 1; i &lt; connectPoints.length; i++) {</span>
<span class="nc" id="L813">        connectPoints[i] = true;</span>
      }
<span class="nc" id="L815">      m_masterPlot.setConnectPoints(connectPoints);</span>

<span class="nc" id="L817">      m_masterPlot.m_alwaysDisplayPointsOfThisSize = 10;</span>
<span class="nc" id="L818">      setClassForConfusionMatrix(classAtt);</span>
<span class="nc" id="L819">      m_performancePanel.setMasterPlot(m_masterPlot);</span>
<span class="nc" id="L820">      m_performancePanel.validate(); m_performancePanel.repaint();</span>

<span class="nc" id="L822">      m_shapeSizes = new int[m_masterPlot.getPlotInstances().numInstances()];</span>
<span class="nc bnc" id="L823" title="All 2 branches missed.">      for (int i = 0; i &lt; m_shapeSizes.length; i++) {</span>
<span class="nc" id="L824">        m_shapeSizes[i] = 1;</span>
      }
<span class="nc" id="L826">      m_masterPlot.setShapeSize(m_shapeSizes);</span>
<span class="nc" id="L827">      constructCostBenefitData();</span>
<span class="nc" id="L828">      m_costBenefitPanel.setMasterPlot(m_costBenefit);</span>
<span class="nc" id="L829">      m_costBenefitPanel.validate(); m_costBenefitPanel.repaint();</span>

<span class="nc" id="L831">      m_totalPopPrevious = 0;</span>
<span class="nc" id="L832">      m_fpPrevious = 0;</span>
<span class="nc" id="L833">      m_tpPrevious = 0;</span>
<span class="nc" id="L834">      m_tnPrevious = 0;</span>
<span class="nc" id="L835">      m_fnPrevious = 0;</span>
<span class="nc" id="L836">      m_previousShapeIndex = -1;</span>

      // set the total population size
<span class="nc" id="L839">      Instance first = m_masterPlot.getPlotInstances().instance(0);</span>
<span class="nc" id="L840">      double totalPos = first.value(m_masterPlot.getPlotInstances().</span>
<span class="nc" id="L841">          attribute(ThresholdCurve.TRUE_POS_NAME).index());</span>
<span class="nc" id="L842">      double totalNeg = first.value(m_masterPlot.getPlotInstances().</span>
<span class="nc" id="L843">          attribute(ThresholdCurve.FALSE_POS_NAME));</span>
<span class="nc" id="L844">      m_originalPopSize = (int)(totalPos + totalNeg);</span>
<span class="nc" id="L845">      m_totalPopField.setText(&quot;&quot; + m_originalPopSize);</span>

<span class="nc" id="L847">      m_performancePanel.setYIndex(5);</span>
<span class="nc" id="L848">      m_performancePanel.setXIndex(10);</span>
<span class="nc" id="L849">      m_costBenefitPanel.setXIndex(0);</span>
<span class="nc" id="L850">      m_costBenefitPanel.setYIndex(1);</span>
      //      System.err.println(m_masterPlot.getPlotInstances());
<span class="nc" id="L852">      updateInfoForSliderValue((double)m_thresholdSlider.getValue() / 100.0);</span>
<span class="nc" id="L853">    }</span>
    
    private void setClassForConfusionMatrix(Attribute classAtt) {
<span class="nc" id="L856">      m_classAttribute = classAtt;</span>
<span class="nc" id="L857">      m_conf_actualA.setText(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_SetClassForConfusionMatrix_Conf_ActualA_SetText_Text&quot;) + classAtt.value(0));</span>
<span class="nc" id="L858">      m_conf_actualA.setToolTipText(classAtt.value(0));</span>
<span class="nc" id="L859">      String negClasses = &quot;&quot;;</span>
<span class="nc bnc" id="L860" title="All 2 branches missed.">      for (int i = 1; i &lt; classAtt.numValues(); i++) {</span>
<span class="nc" id="L861">        negClasses += classAtt.value(i);</span>
<span class="nc bnc" id="L862" title="All 2 branches missed.">        if (i &lt; classAtt.numValues() - 1) {</span>
<span class="nc" id="L863">          negClasses += &quot;,&quot;;</span>
        }
      }
<span class="nc" id="L866">      m_conf_actualB.setText(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AnalysisPanel_SetClassForConfusionMatrix_Conf_ActualB_SetText_Text&quot;) + negClasses);</span>
<span class="nc" id="L867">      m_conf_actualB.setToolTipText(negClasses);</span>
<span class="nc" id="L868">    }</span>
    
    private boolean constructCostBenefitData() {
<span class="nc" id="L871">      double tpCost = 0.0;</span>
      try {
<span class="nc" id="L873">        tpCost = Double.parseDouble(m_cost_aa.getText());</span>
<span class="nc" id="L874">      } catch (NumberFormatException n) {}</span>
<span class="nc" id="L875">      double fpCost = 0.0;</span>
      try {
<span class="nc" id="L877">        fpCost = Double.parseDouble(m_cost_ba.getText());</span>
<span class="nc" id="L878">      } catch (NumberFormatException n) {}</span>
<span class="nc" id="L879">      double tnCost = 0.0;</span>
      try {
<span class="nc" id="L881">        tnCost = Double.parseDouble(m_cost_bb.getText());</span>
<span class="nc" id="L882">      } catch (NumberFormatException n) {}</span>
<span class="nc" id="L883">      double fnCost = 0.0;</span>
      try {
<span class="nc" id="L885">        fnCost = Double.parseDouble(m_cost_ab.getText());</span>
<span class="nc" id="L886">      } catch (NumberFormatException n) {}</span>
      
<span class="nc" id="L888">      double requestedPopSize = m_originalPopSize;</span>
      try {
<span class="nc" id="L890">        requestedPopSize = Double.parseDouble(m_totalPopField.getText());</span>
<span class="nc" id="L891">      } catch (NumberFormatException e) {}</span>
      
<span class="nc" id="L893">      double scaleFactor = 1.0;</span>
<span class="nc bnc" id="L894" title="All 2 branches missed.">      if (m_originalPopSize != 0) {</span>
<span class="nc" id="L895">        scaleFactor = requestedPopSize / m_originalPopSize;</span>
      }
      
<span class="nc bnc" id="L898" title="All 4 branches missed.">      if (tpCost == m_tpPrevious &amp;&amp; fpCost == m_fpPrevious &amp;&amp;</span>
<span class="nc bnc" id="L899" title="All 4 branches missed.">          tnCost == m_tnPrevious &amp;&amp; fnCost == m_fnPrevious &amp;&amp;</span>
<span class="nc bnc" id="L900" title="All 2 branches missed.">          requestedPopSize == m_totalPopPrevious) {</span>
<span class="nc" id="L901">        return false;</span>
      }
      
      // First construct some Instances for the curve
<span class="nc" id="L905">      FastVector fv = new FastVector();</span>
<span class="nc" id="L906">      fv.addElement(new Attribute(&quot;Sample Size&quot;));</span>
<span class="nc" id="L907">      fv.addElement(new Attribute(&quot;Cost/Benefit&quot;));</span>
<span class="nc" id="L908">      fv.addElement(new Attribute(&quot;Threshold&quot;));</span>
<span class="nc" id="L909">      Instances costBenefitI = new Instances(&quot;Cost/Benefit Curve&quot;, fv, 100);</span>
      
      // process the performance data to make this curve
<span class="nc" id="L912">      Instances performanceI = m_masterPlot.getPlotInstances();</span>
      
<span class="nc bnc" id="L914" title="All 2 branches missed.">      for (int i = 0; i &lt; performanceI.numInstances(); i++) {</span>
<span class="nc" id="L915">        Instance current = performanceI.instance(i);</span>
        
<span class="nc" id="L917">        double[] vals = new double[3];</span>
<span class="nc" id="L918">        vals[0] = current.value(10); // sample size</span>
<span class="nc" id="L919">        vals[1] = (current.value(0) * tpCost</span>
<span class="nc" id="L920">            + current.value(1) * fnCost</span>
<span class="nc" id="L921">            + current.value(2) * fpCost</span>
<span class="nc" id="L922">            + current.value(3) * tnCost) * scaleFactor;</span>
<span class="nc" id="L923">        vals[2] = current.value(current.numAttributes() - 1);</span>
<span class="nc" id="L924">        Instance newInst = new Instance(1.0, vals);</span>
<span class="nc" id="L925">        costBenefitI.add(newInst);</span>
      }
      
<span class="nc" id="L928">      costBenefitI.compactify();</span>
      
      // now set up the plot data
<span class="nc" id="L931">      m_costBenefit = new PlotData2D(costBenefitI);</span>
<span class="nc" id="L932">      m_costBenefit.m_alwaysDisplayPointsOfThisSize = 10;</span>
<span class="nc" id="L933">      m_costBenefit.setPlotName(&quot;Cost/benefit curve&quot;);</span>
<span class="nc" id="L934">      boolean[] connectPoints = new boolean[costBenefitI.numInstances()];</span>
      
<span class="nc bnc" id="L936" title="All 2 branches missed.">      for (int i = 0; i &lt; connectPoints.length; i++) {</span>
<span class="nc" id="L937">        connectPoints[i] = true;</span>
      }
      try {
<span class="nc" id="L940">        m_costBenefit.setConnectPoints(connectPoints);</span>
<span class="nc" id="L941">        m_costBenefit.setShapeSize(m_shapeSizes);</span>
<span class="nc" id="L942">      } catch (Exception ex) {</span>
        // ignore
      }
      
<span class="nc" id="L946">      m_tpPrevious = tpCost;</span>
<span class="nc" id="L947">      m_fpPrevious = fpCost;</span>
<span class="nc" id="L948">      m_tnPrevious = tnCost;</span>
<span class="nc" id="L949">      m_fnPrevious = fnCost;</span>
      
<span class="nc" id="L951">      return true;</span>
    }
  }
  
  /**
   * Constructor.
   */
<span class="nc" id="L958">  public CostBenefitAnalysis() {</span>
<span class="nc" id="L959">    java.awt.GraphicsEnvironment ge = </span>
<span class="nc" id="L960">      java.awt.GraphicsEnvironment.getLocalGraphicsEnvironment();</span>
<span class="nc bnc" id="L961" title="All 2 branches missed.">    if (!ge.isHeadless()) {</span>
<span class="nc" id="L962">      appearanceFinal();</span>
    }
<span class="nc" id="L964">  }</span>
  
  /**
   * Global info for this bean
   *
   * @return a &lt;code&gt;String&lt;/code&gt; value
   */
  public String globalInfo() {
<span class="nc" id="L972">    return Messages.getInstance().getString(&quot;CostBenefitAnalysis_GlobalInfo_Text&quot;);</span>
  }

  /**
   * Accept a threshold data event and set up the visualization.
   * @param e a threshold data event
   */
  public void acceptDataSet(ThresholdDataEvent e) {
<span class="nc bnc" id="L980" title="All 2 branches missed.">    if (!GraphicsEnvironment.isHeadless()) {</span>
      try {
<span class="nc" id="L982">        setCurveData(e.getDataSet(), e.getClassAttribute());</span>
<span class="nc" id="L983">      } catch (Exception ex) {</span>
<span class="nc" id="L984">        System.err.println(Messages.getInstance().getString(&quot;CostBenefitAnalysis_AcceptDataSet_Error_Text&quot;));</span>
<span class="nc" id="L985">        ex.printStackTrace();</span>
      }
    }
<span class="nc" id="L988">  }</span>
  
  /**
   * Set the threshold curve data to use.
   * 
   * @param curveData a PlotData2D object set up with the curve data.
   * @param origClassAtt the class attribute from the original data used to
   * generate the curve.
   * @throws Exception if somthing goes wrong during the setup process.
   */
  public void setCurveData(PlotData2D curveData, Attribute origClassAtt) 
    throws Exception {
<span class="nc bnc" id="L1000" title="All 2 branches missed.">    if (m_analysisPanel == null) {</span>
<span class="nc" id="L1001">      m_analysisPanel = new AnalysisPanel();</span>
    }
<span class="nc" id="L1003">    m_analysisPanel.setDataSet(curveData, origClassAtt);</span>
<span class="nc" id="L1004">  }</span>

  public BeanVisual getVisual() {
<span class="nc" id="L1007">    return m_visual;</span>
  }

  public void setVisual(BeanVisual newVisual) {
<span class="nc" id="L1011">    m_visual = newVisual;</span>
<span class="nc" id="L1012">  }</span>

  public void useDefaultVisual() {
<span class="nc" id="L1015">    m_visual.loadIcons(BeanVisual.ICON_PATH+&quot;DefaultDataVisualizer.gif&quot;,</span>
<span class="nc" id="L1016">        BeanVisual.ICON_PATH+&quot;DefaultDataVisualizer_animated.gif&quot;);</span>
<span class="nc" id="L1017">  }</span>

  public Enumeration enumerateRequests() {
<span class="nc" id="L1020">    Vector newVector = new Vector(0);</span>
<span class="nc bnc" id="L1021" title="All 2 branches missed.">    if (m_analysisPanel != null) {</span>
<span class="nc bnc" id="L1022" title="All 2 branches missed.">      if (m_analysisPanel.m_masterPlot != null) {</span>
<span class="nc" id="L1023">        newVector.addElement(&quot;Show analysis&quot;);</span>
      }
    }
<span class="nc" id="L1026">    return newVector.elements();</span>
  }

  public void performRequest(String request) {
<span class="nc bnc" id="L1030" title="All 2 branches missed.">    if (request.compareTo(&quot;Show analysis&quot;) == 0) {</span>
      try {
        // popup visualize panel
<span class="nc bnc" id="L1033" title="All 2 branches missed.">        if (!m_framePoppedUp) {</span>
<span class="nc" id="L1034">          m_framePoppedUp = true;</span>

<span class="nc" id="L1036">          final javax.swing.JFrame jf = </span>
<span class="nc" id="L1037">            new javax.swing.JFrame(Messages.getInstance().getString(&quot;CostBenefitAnalysis_PerformRequest_Jf_JFrame_Text&quot;));</span>
<span class="nc" id="L1038">          jf.setSize(1000,600);</span>
<span class="nc" id="L1039">          jf.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L1040">          jf.getContentPane().add(m_analysisPanel, BorderLayout.CENTER);</span>
<span class="nc" id="L1041">          jf.addWindowListener(new java.awt.event.WindowAdapter() {</span>
              public void windowClosing(java.awt.event.WindowEvent e) {
<span class="nc" id="L1043">                jf.dispose();</span>
<span class="nc" id="L1044">                m_framePoppedUp = false;</span>
<span class="nc" id="L1045">              }</span>
            });
<span class="nc" id="L1047">          jf.setVisible(true);</span>
<span class="nc" id="L1048">          m_popupFrame = jf;</span>
        } else {
<span class="nc" id="L1050">          m_popupFrame.toFront();</span>
        }
<span class="nc" id="L1052">      } catch (Exception ex) {</span>
<span class="nc" id="L1053">        ex.printStackTrace();</span>
<span class="nc" id="L1054">        m_framePoppedUp = false;</span>
      }
    } else {
<span class="nc" id="L1057">      throw new IllegalArgumentException(request</span>
<span class="nc" id="L1058">          + Messages.getInstance().getString(&quot;CostBenefitAnalysis_PerformRequest_IllegalArgumentException_Text&quot;));</span>
    }
<span class="nc" id="L1060">  }</span>

  public void addVetoableChangeListener(String name, VetoableChangeListener vcl) {
<span class="nc" id="L1063">    m_bcSupport.addVetoableChangeListener(name, vcl);</span>
<span class="nc" id="L1064">  }</span>

  public BeanContext getBeanContext() {
<span class="nc" id="L1067">    return m_beanContext;</span>
  }

  public void removeVetoableChangeListener(String name,
      VetoableChangeListener vcl) {
<span class="nc" id="L1072">    m_bcSupport.removeVetoableChangeListener(name, vcl);</span>
<span class="nc" id="L1073">  }</span>
  
  protected void appearanceFinal() {
<span class="nc" id="L1076">    removeAll();</span>
<span class="nc" id="L1077">    setLayout(new BorderLayout());</span>
<span class="nc" id="L1078">    setUpFinal();</span>
<span class="nc" id="L1079">  }</span>
  
  protected void setUpFinal() {
<span class="nc bnc" id="L1082" title="All 2 branches missed.">    if (m_analysisPanel == null) {</span>
<span class="nc" id="L1083">      m_analysisPanel = new AnalysisPanel();</span>
    }
<span class="nc" id="L1085">    add(m_analysisPanel, BorderLayout.CENTER);</span>
<span class="nc" id="L1086">  }</span>
  
  protected void appearanceDesign() {
<span class="nc" id="L1089">    removeAll();</span>
<span class="nc" id="L1090">    m_visual = new BeanVisual(&quot;CostBenefitAnalysis&quot;, </span>
<span class="nc" id="L1091">                              BeanVisual.ICON_PATH+&quot;ModelPerformanceChart.gif&quot;,</span>
<span class="nc" id="L1092">                              BeanVisual.ICON_PATH</span>
                              +&quot;ModelPerformanceChart_animated.gif&quot;);
<span class="nc" id="L1094">    setLayout(new BorderLayout());</span>
<span class="nc" id="L1095">    add(m_visual, BorderLayout.CENTER);</span>
<span class="nc" id="L1096">  }</span>

  public void setBeanContext(BeanContext bc) throws PropertyVetoException {
<span class="nc" id="L1099">    m_beanContext = bc;</span>
<span class="nc" id="L1100">    m_design = m_beanContext.isDesignTime();</span>
<span class="nc bnc" id="L1101" title="All 2 branches missed.">    if (m_design) {</span>
<span class="nc" id="L1102">      appearanceDesign();</span>
    } else {
<span class="nc" id="L1104">      java.awt.GraphicsEnvironment ge = </span>
<span class="nc" id="L1105">        java.awt.GraphicsEnvironment.getLocalGraphicsEnvironment(); </span>
<span class="nc bnc" id="L1106" title="All 2 branches missed.">      if (!ge.isHeadless()) {</span>
<span class="nc" id="L1107">        appearanceFinal();</span>
      }
    }
<span class="nc" id="L1110">  }</span>
  
  /**
   * Returns true if, at this time, 
   * the object will accept a connection via the named event
   *
   * @param eventName the name of the event in question
   * @return true if the object will accept a connection
   */
  public boolean connectionAllowed(String eventName) {
<span class="nc bnc" id="L1120" title="All 2 branches missed.">    return (m_listenee == null);</span>
  }

  /**
   * Notify this object that it has been registered as a listener with
   * a source for recieving events described by the named event
   * This object is responsible for recording this fact.
   *
   * @param eventName the event
   * @param source the source with which this object has been registered as
   * a listener
   */
  public void connectionNotification(String eventName, Object source) {
<span class="nc bnc" id="L1133" title="All 2 branches missed.">    if (connectionAllowed(eventName)) {</span>
<span class="nc" id="L1134">      m_listenee = source;</span>
    }
<span class="nc" id="L1136">  }</span>
  
  /**
   * Returns true if, at this time, 
   * the object will accept a connection according to the supplied
   * EventSetDescriptor
   *
   * @param esd the EventSetDescriptor
   * @return true if the object will accept a connection
   */
  public boolean connectionAllowed(EventSetDescriptor esd) {
<span class="nc" id="L1147">    return connectionAllowed(esd.getName());</span>
  }

  /**
   * Notify this object that it has been deregistered as a listener with
   * a source for named event. This object is responsible
   * for recording this fact.
   *
   * @param eventName the event
   * @param source the source with which this object has been registered as
   * a listener
   */
  public void disconnectionNotification(String eventName, Object source) {
<span class="nc bnc" id="L1160" title="All 2 branches missed.">    if (m_listenee == source) {</span>
<span class="nc" id="L1161">      m_listenee = null;</span>
    }
    
<span class="nc" id="L1164">  }</span>

  /**
   * Get the custom (descriptive) name for this bean (if one has been set)
   * 
   * @return the custom name (or the default name)
   */
  public String getCustomName() {
<span class="nc" id="L1172">    return m_visual.getText();</span>
  }

  /**
   * Returns true if. at this time, the bean is busy with some
   * (i.e. perhaps a worker thread is performing some calculation).
   * 
   * @return true if the bean is busy.
   */
  public boolean isBusy() {
<span class="nc" id="L1182">    return false;</span>
  }

  /**
   * Set a custom (descriptive) name for this bean
   * 
   * @param name the name to use
   */
  public void setCustomName(String name) {
<span class="nc" id="L1191">    m_visual.setText(name);</span>
<span class="nc" id="L1192">  }</span>

  /**
   * Set a logger
   *
   * @param logger a &lt;code&gt;weka.gui.Logger&lt;/code&gt; value
   */
  public void setLog(Logger logger) {
    // we don't need to do any logging    
<span class="nc" id="L1201">  }</span>

  /**
   * Stop any processing that the bean might be doing.
   */
  public void stop() {
    // nothing to do here
<span class="nc" id="L1208">  }</span>
    
  public static void main(String[] args) {
    try {
<span class="nc" id="L1212">      Instances train = new Instances(new java.io.BufferedReader(new java.io.FileReader(args[0])));</span>
<span class="nc" id="L1213">      train.setClassIndex(train.numAttributes() - 1);</span>
<span class="nc" id="L1214">      weka.classifiers.evaluation.ThresholdCurve tc = </span>
<span class="nc" id="L1215">        new weka.classifiers.evaluation.ThresholdCurve();</span>
<span class="nc" id="L1216">      weka.classifiers.evaluation.EvaluationUtils eu = </span>
<span class="nc" id="L1217">        new weka.classifiers.evaluation.EvaluationUtils();</span>
      //weka.classifiers.Classifier classifier = new weka.classifiers.functions.Logistic();
<span class="nc" id="L1219">      weka.classifiers.Classifier classifier = new weka.classifiers.bayes.NaiveBayes();</span>
<span class="nc" id="L1220">      FastVector predictions = new FastVector();</span>
<span class="nc" id="L1221">      eu.setSeed(1);</span>
<span class="nc" id="L1222">      predictions.appendElements(eu.getCVPredictions(classifier, train, 10));</span>
<span class="nc" id="L1223">      Instances result = tc.getCurve(predictions, 0);</span>
<span class="nc" id="L1224">      PlotData2D pd = new PlotData2D(result);</span>
<span class="nc" id="L1225">      pd.m_alwaysDisplayPointsOfThisSize = 10;</span>

<span class="nc" id="L1227">      boolean[] connectPoints = new boolean[result.numInstances()];</span>
<span class="nc bnc" id="L1228" title="All 2 branches missed.">      for (int i = 1; i &lt; connectPoints.length; i++) {</span>
<span class="nc" id="L1229">        connectPoints[i] = true;</span>
      }
<span class="nc" id="L1231">      pd.setConnectPoints(connectPoints);</span>
<span class="nc" id="L1232">      final javax.swing.JFrame jf = </span>
<span class="nc" id="L1233">        new javax.swing.JFrame(Messages.getInstance().getString(&quot;CostBenefitAnalysis_PerformRequest_Main_JF_JFrame_Text&quot;));</span>
<span class="nc" id="L1234">      jf.setSize(1000,600);</span>
      //jf.pack();
<span class="nc" id="L1236">      jf.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L1237">      final CostBenefitAnalysis.AnalysisPanel analysisPanel = </span>
<span class="nc" id="L1238">        new CostBenefitAnalysis.AnalysisPanel();</span>
      
<span class="nc" id="L1240">      jf.getContentPane().add(analysisPanel, BorderLayout.CENTER);</span>
<span class="nc" id="L1241">      jf.addWindowListener(new java.awt.event.WindowAdapter() {</span>
        public void windowClosing(java.awt.event.WindowEvent e) {
<span class="nc" id="L1243">          jf.dispose();</span>
<span class="nc" id="L1244">          System.exit(0);</span>
<span class="nc" id="L1245">        }</span>
      });
      
<span class="nc" id="L1248">      jf.setVisible(true);</span>
      
<span class="nc" id="L1250">      analysisPanel.setDataSet(pd, train.classAttribute());</span>
      
<span class="nc" id="L1252">    } catch (Exception ex) {</span>
<span class="nc" id="L1253">      ex.printStackTrace();</span>
    }
 
<span class="nc" id="L1256">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>