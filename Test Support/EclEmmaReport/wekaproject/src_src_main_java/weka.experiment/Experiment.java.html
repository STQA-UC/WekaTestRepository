<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>Experiment.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.experiment</a> &gt; <span class="el_source">Experiment.java</span></div><h1>Experiment.java</h1><pre class="source lang-java linenums">/*
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 *    Experiment.java
 *    Copyright (C) 1999 University of Waikato, Hamilton, New Zealand
 *
 */


package weka.experiment;

import weka.core.AdditionalMeasureProducer;
import weka.core.FastVector;
import weka.core.Instances;
import weka.core.Option;
import weka.core.OptionHandler;
import weka.core.RevisionHandler;
import weka.core.RevisionUtils;
import weka.core.Utils;
import weka.core.converters.AbstractFileLoader;
import weka.core.converters.ConverterUtils;
import weka.core.xml.KOML;
import weka.core.xml.XMLOptions;
import weka.experiment.xml.XMLExperiment;

import java.beans.PropertyDescriptor;
import java.io.BufferedInputStream;
import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.io.Serializable;
import java.lang.reflect.Array;
import java.lang.reflect.Method;
import java.util.Enumeration;
import java.util.Vector;

import javax.swing.DefaultListModel;

/**
 * Holds all the necessary configuration information for a standard
 * type experiment. This object is able to be serialized for storage
 * on disk.
 *
 &lt;!-- options-start --&gt;
 * Valid options are: &lt;p/&gt;
 * 
 * &lt;pre&gt; -L &amp;lt;num&amp;gt;
 *  The lower run number to start the experiment from.
 *  (default 1)&lt;/pre&gt;
 * 
 * &lt;pre&gt; -U &amp;lt;num&amp;gt;
 *  The upper run number to end the experiment at (inclusive).
 *  (default 10)&lt;/pre&gt;
 * 
 * &lt;pre&gt; -T &amp;lt;arff file&amp;gt;
 *  The dataset to run the experiment on.
 *  (required, may be specified multiple times)&lt;/pre&gt;
 * 
 * &lt;pre&gt; -P &amp;lt;class name&amp;gt;
 *  The full class name of a ResultProducer (required).
 *  eg: weka.experiment.RandomSplitResultProducer&lt;/pre&gt;
 * 
 * &lt;pre&gt; -D &amp;lt;class name&amp;gt;
 *  The full class name of a ResultListener (required).
 *  eg: weka.experiment.CSVResultListener&lt;/pre&gt;
 * 
 * &lt;pre&gt; -N &amp;lt;string&amp;gt;
 *  A string containing any notes about the experiment.
 *  (default none)&lt;/pre&gt;
 * 
 * &lt;pre&gt; 
 * Options specific to result producer weka.experiment.RandomSplitResultProducer:
 * &lt;/pre&gt;
 * 
 * &lt;pre&gt; -P &amp;lt;percent&amp;gt;
 *  The percentage of instances to use for training.
 *  (default 66)&lt;/pre&gt;
 * 
 * &lt;pre&gt; -D
 * Save raw split evaluator output.&lt;/pre&gt;
 * 
 * &lt;pre&gt; -O &amp;lt;file/directory name/path&amp;gt;
 *  The filename where raw output will be stored.
 *  If a directory name is specified then then individual
 *  outputs will be gzipped, otherwise all output will be
 *  zipped to the named file. Use in conjuction with -D. (default splitEvalutorOut.zip)&lt;/pre&gt;
 * 
 * &lt;pre&gt; -W &amp;lt;class name&amp;gt;
 *  The full class name of a SplitEvaluator.
 *  eg: weka.experiment.ClassifierSplitEvaluator&lt;/pre&gt;
 * 
 * &lt;pre&gt; -R
 *  Set when data is not to be randomized and the data sets' size.
 *  Is not to be determined via probabilistic rounding.&lt;/pre&gt;
 * 
 * &lt;pre&gt; 
 * Options specific to split evaluator weka.experiment.ClassifierSplitEvaluator:
 * &lt;/pre&gt;
 * 
 * &lt;pre&gt; -W &amp;lt;class name&amp;gt;
 *  The full class name of the classifier.
 *  eg: weka.classifiers.bayes.NaiveBayes&lt;/pre&gt;
 * 
 * &lt;pre&gt; -C &amp;lt;index&amp;gt;
 *  The index of the class for which IR statistics
 *  are to be output. (default 1)&lt;/pre&gt;
 * 
 * &lt;pre&gt; -I &amp;lt;index&amp;gt;
 *  The index of an attribute to output in the
 *  results. This attribute should identify an
 *  instance in order to know which instances are
 *  in the test set of a cross validation. if 0
 *  no output (default 0).&lt;/pre&gt;
 * 
 * &lt;pre&gt; -P
 *  Add target and prediction columns to the result
 *  for each fold.&lt;/pre&gt;
 * 
 * &lt;pre&gt; 
 * Options specific to classifier weka.classifiers.rules.ZeroR:
 * &lt;/pre&gt;
 * 
 * &lt;pre&gt; -D
 *  If set, classifier is run in debug mode and
 *  may output additional info to the console&lt;/pre&gt;
 * 
 &lt;!-- options-end --&gt;
 *
 * All options after -- will be passed to the result producer. &lt;p&gt;
 *
 * @author Len Trigg (trigg@cs.waikato.ac.nz)
 * @version $Revision: 5401 $
 */
<span class="pc" id="L151">public class Experiment </span>
  implements Serializable, OptionHandler, RevisionHandler {
  
  /** for serialization */
  static final long serialVersionUID = 44945596742646663L;
  
  /** The filename extension that should be used for experiment files */
<span class="fc" id="L158">  public static String FILE_EXTENSION = &quot;.exp&quot;;</span>

  /** Where results will be sent */
<span class="nc" id="L161">  protected ResultListener m_ResultListener = new InstancesResultListener();</span>
  
  /** The result producer */
<span class="nc" id="L164">  protected ResultProducer m_ResultProducer = new RandomSplitResultProducer();</span>

  /** Lower run number */
<span class="nc" id="L167">  protected int m_RunLower = 1;</span>

  /** Upper run number */
<span class="nc" id="L170">  protected int m_RunUpper = 10;</span>

  /** An array of dataset files */
<span class="nc" id="L173">  protected DefaultListModel m_Datasets = new DefaultListModel();</span>

  /** True if the exp should also iterate over a property of the RP */
<span class="nc" id="L176">  protected boolean m_UsePropertyIterator = false;</span>
  
  /** The path to the iterator property */
  protected PropertyNode [] m_PropertyPath;
  
  /** The array of values to set the property to */
  protected Object m_PropertyArray;

  /** User notes about the experiment */
<span class="nc" id="L185">  protected String m_Notes = &quot;&quot;;</span>

  /** Method names of additional measures of objects contained in the 
      custom property iterator. Only methods names beginning with &quot;measure&quot;
      and returning doubles are recognised */
<span class="nc" id="L190">  protected String [] m_AdditionalMeasures = null;</span>

  /** True if the class attribute is the first attribute for all
      datasets involved in this experiment. */
<span class="nc" id="L194">  protected boolean m_ClassFirst = false;</span>

  /** If true an experiment will advance the current data set befor
      any custom itererator */
<span class="nc" id="L198">  protected boolean m_AdvanceDataSetFirst = true;</span>

  /**
   * Sets whether the first attribute is treated as the class
   * for all datasets involved in the experiment. This information
   * is not output with the result of the experiments!
   * 
   * @param flag	whether the class attribute is the first and not the last
   */
  public void classFirst(boolean flag) {
    
<span class="nc" id="L209">    m_ClassFirst = flag;</span>
<span class="nc" id="L210">  }</span>
  
  /**
   * Get the value of m_DataSetFirstFirst.
   *
   * @return Value of m_DataSetFirstFirst.
   */
  public boolean getAdvanceDataSetFirst() {
    
<span class="nc" id="L219">    return m_AdvanceDataSetFirst;</span>
  }
  
  /**
   * Set the value of m_AdvanceDataSetFirst.
   *
   * @param newAdvanceDataSetFirst Value to assign to m_AdvanceRunFirst.
   */
  public void setAdvanceDataSetFirst(boolean newAdvanceDataSetFirst) {
    
<span class="nc" id="L229">    m_AdvanceDataSetFirst = newAdvanceDataSetFirst;</span>
<span class="nc" id="L230">  }</span>
  
  /**
   * Gets whether the custom property iterator should be used.
   *
   * @return true if so
   */
  public boolean getUsePropertyIterator() {
    
<span class="nc" id="L239">    return m_UsePropertyIterator;</span>
  }

  /**
   * Sets whether the custom property iterator should be used.
   *
   * @param newUsePropertyIterator true if so
   */
  public void setUsePropertyIterator(boolean newUsePropertyIterator) {
    
<span class="nc" id="L249">    m_UsePropertyIterator = newUsePropertyIterator;</span>
<span class="nc" id="L250">  }</span>

  /**
   * Gets the path of properties taken to get to the custom property
   * to iterate over.
   *
   * @return an array of PropertyNodes
   */
  public PropertyNode [] getPropertyPath() {
    
<span class="nc" id="L260">    return m_PropertyPath;</span>
  }
  
  /**
   * Sets the path of properties taken to get to the custom property
   * to iterate over.
   *
   * @param newPropertyPath an array of PropertyNodes
   */
  public void setPropertyPath(PropertyNode [] newPropertyPath) {
    
<span class="nc" id="L271">    m_PropertyPath = newPropertyPath;</span>
<span class="nc" id="L272">  }</span>
  
  /**
   * Sets the array of values to set the custom property to.
   *
   * @param newPropArray a value of type Object which should be an
   * array of the appropriate values.
   */
  public void setPropertyArray(Object newPropArray) {

<span class="nc" id="L282">    m_PropertyArray = newPropArray;</span>
<span class="nc" id="L283">  }</span>

  /**
   * Gets the array of values to set the custom property to.
   *
   * @return a value of type Object which should be an
   * array of the appropriate values.
   */
  public Object getPropertyArray() {

<span class="nc" id="L293">    return m_PropertyArray;</span>
  }

  /**
   * Gets the number of custom iterator values that have been defined
   * for the experiment.
   *
   * @return the number of custom property iterator values.
   */
  public int getPropertyArrayLength() {

<span class="nc" id="L304">    return Array.getLength(m_PropertyArray);</span>
  }

  /**
   * Gets a specified value from the custom property iterator array.
   *
   * @param index the index of the value wanted
   * @return the property array value
   */
  public Object getPropertyArrayValue(int index) {

<span class="nc" id="L315">    return Array.get(m_PropertyArray, index);</span>
  }
  
  /* These may potentially want to be made un-transient if it is decided
   * that experiments may be saved mid-run and later resumed
   */
  /** The current run number when the experiment is running */
  protected transient int m_RunNumber;
  /** The current dataset number when the experiment is running */
  protected transient int m_DatasetNumber;
  /** The current custom property value index when the experiment is running */
  protected transient int m_PropertyNumber;
  /** True if the experiment has finished running */
<span class="nc" id="L328">  protected transient boolean m_Finished = true;</span>
  /** The dataset currently being used */
  protected transient Instances m_CurrentInstances;
  /** The custom property value that has actually been set */
  protected transient int m_CurrentProperty;

  /**
   * When an experiment is running, this returns the current run number.
   *
   * @return the current run number.
   */
  public int getCurrentRunNumber() {
<span class="nc" id="L340">    return m_RunNumber;</span>
  }

  /**
   * When an experiment is running, this returns the current dataset number.
   *
   * @return the current dataset number.
   */
  public int getCurrentDatasetNumber() {
<span class="nc" id="L349">    return m_DatasetNumber;</span>
  }

  /**
   * When an experiment is running, this returns the index of the
   * current custom property value.
   *
   * @return the index of the current custom property value.
   */
  public int getCurrentPropertyNumber() {
<span class="nc" id="L359">    return m_PropertyNumber;</span>
  }
  
  /**
   * Prepares an experiment for running, initializing current iterator
   * settings.
   *
   * @throws Exception if an error occurs
   */
  public void initialize() throws Exception {
    
<span class="nc" id="L370">    m_RunNumber = getRunLower();</span>
<span class="nc" id="L371">    m_DatasetNumber = 0;</span>
<span class="nc" id="L372">    m_PropertyNumber = 0;</span>
<span class="nc" id="L373">    m_CurrentProperty = -1;</span>
<span class="nc" id="L374">    m_CurrentInstances = null;</span>
<span class="nc" id="L375">    m_Finished = false;</span>
<span class="nc bnc" id="L376" title="All 4 branches missed.">    if (m_UsePropertyIterator &amp;&amp; (m_PropertyArray == null)) {</span>
<span class="nc" id="L377">      throw new Exception(&quot;Null array for property iterator&quot;);</span>
    }
<span class="nc bnc" id="L379" title="All 2 branches missed.">    if (getRunLower() &gt; getRunUpper()) {</span>
<span class="nc" id="L380">      throw new Exception(&quot;Lower run number is greater than upper run number&quot;);</span>
    }
<span class="nc bnc" id="L382" title="All 2 branches missed.">    if (getDatasets().size() == 0) {</span>
<span class="nc" id="L383">      throw new Exception(&quot;No datasets have been specified&quot;);</span>
    }
<span class="nc bnc" id="L385" title="All 2 branches missed.">    if (m_ResultProducer == null) {</span>
<span class="nc" id="L386">      throw new Exception(&quot;No ResultProducer set&quot;);</span>
    }
<span class="nc bnc" id="L388" title="All 2 branches missed.">    if (m_ResultListener == null) {</span>
<span class="nc" id="L389">      throw new Exception(&quot;No ResultListener set&quot;);</span>
    }

    //    if (m_UsePropertyIterator &amp;&amp; (m_PropertyArray != null)) {
<span class="nc" id="L393">    determineAdditionalResultMeasures();</span>
      //    }

<span class="nc" id="L396">    m_ResultProducer.setResultListener(m_ResultListener);</span>
<span class="nc" id="L397">    m_ResultProducer.setAdditionalMeasures(m_AdditionalMeasures);</span>
<span class="nc" id="L398">    m_ResultProducer.preProcess();</span>

    // constrain the additional measures to be only those allowable
    // by the ResultListener
<span class="nc" id="L402">    String [] columnConstraints = m_ResultListener.</span>
<span class="nc" id="L403">      determineColumnConstraints(m_ResultProducer);</span>

<span class="nc bnc" id="L405" title="All 2 branches missed.">    if (columnConstraints != null) {</span>
<span class="nc" id="L406">      m_ResultProducer.setAdditionalMeasures(columnConstraints);</span>
    }
<span class="nc" id="L408">  }</span>

  /**
   * Iterate over the objects in the property array to determine what
   * (if any) additional measures they support
   * 
   * @throws Exception 	if additional measures don't comply to the naming 
   * 			convention (starting with &quot;measure&quot;)
   */
  private void determineAdditionalResultMeasures() throws Exception {
<span class="nc" id="L418">    m_AdditionalMeasures = null;</span>
<span class="nc" id="L419">    FastVector measureNames = new FastVector();</span>

    // first try the result producer, then property array if applicable
<span class="nc bnc" id="L422" title="All 2 branches missed.">    if (m_ResultProducer instanceof AdditionalMeasureProducer) {</span>
<span class="nc" id="L423">      Enumeration am = ((AdditionalMeasureProducer)m_ResultProducer).</span>
<span class="nc" id="L424">	enumerateMeasures();</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">      while (am.hasMoreElements()) {</span>
<span class="nc" id="L426">	String mname = (String)am.nextElement();</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">	if (mname.startsWith(&quot;measure&quot;)) {</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">	  if (measureNames.indexOf(mname) == -1) {</span>
<span class="nc" id="L429">	    measureNames.addElement(mname);</span>
	  }
	} else {
<span class="nc" id="L432">	  throw new Exception (&quot;Additional measures in &quot;</span>
<span class="nc" id="L433">			       + m_ResultProducer.getClass().getName()</span>
<span class="nc" id="L434">			       +&quot; must obey the naming convention&quot;</span>
<span class="nc" id="L435">			       +&quot; of starting with \&quot;measure\&quot;&quot;);</span>
	}
      }
    }

<span class="nc bnc" id="L440" title="All 4 branches missed.">    if (m_UsePropertyIterator &amp;&amp; (m_PropertyArray != null)) {</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">      for (int i = 0; i &lt; Array.getLength(m_PropertyArray); i++) {</span>
<span class="nc" id="L442">	Object current = Array.get(m_PropertyArray, i);</span>

<span class="nc bnc" id="L444" title="All 2 branches missed.">	if (current instanceof AdditionalMeasureProducer) {</span>
<span class="nc" id="L445">	  Enumeration am = ((AdditionalMeasureProducer)current).</span>
<span class="nc" id="L446">	    enumerateMeasures();</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">	  while (am.hasMoreElements()) {</span>
<span class="nc" id="L448">	    String mname = (String)am.nextElement();</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">	    if (mname.startsWith(&quot;measure&quot;)) {</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">	      if (measureNames.indexOf(mname) == -1) {</span>
<span class="nc" id="L451">		measureNames.addElement(mname);</span>
	      }
	    } else {
<span class="nc" id="L454">	      throw new Exception (&quot;Additional measures in &quot;</span>
<span class="nc" id="L455">				   + current.getClass().getName()</span>
<span class="nc" id="L456">				   +&quot; must obey the naming convention&quot;</span>
<span class="nc" id="L457">				   +&quot; of starting with \&quot;measure\&quot;&quot;);</span>
	    }
	  }
	}
      }
    }
<span class="nc bnc" id="L463" title="All 2 branches missed.">    if (measureNames.size() &gt; 0) {</span>
<span class="nc" id="L464">      m_AdditionalMeasures = new String [measureNames.size()];</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">      for (int i=0;i&lt;measureNames.size();i++) {</span>
<span class="nc" id="L466">	m_AdditionalMeasures[i] = (String)measureNames.elementAt(i);</span>
      }
    }
<span class="nc" id="L469">  }</span>

  
  /**
   * Recursively sets the custom property value, by setting all values
   * along the property path.
   *
   * @param propertyDepth the current position along the property path
   * @param origValue the value to set the property to
   * @throws Exception if an error occurs
   */
  protected void setProperty(int propertyDepth, Object origValue)
    throws Exception {
    
<span class="nc" id="L483">    PropertyDescriptor current = m_PropertyPath[propertyDepth].property;</span>
<span class="nc" id="L484">    Object subVal = null;</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">    if (propertyDepth &lt; m_PropertyPath.length - 1) {</span>
<span class="nc" id="L486">      Method getter = current.getReadMethod();</span>
<span class="nc" id="L487">      Object getArgs [] = { };</span>
<span class="nc" id="L488">      subVal = getter.invoke(origValue, getArgs);</span>
<span class="nc" id="L489">      setProperty(propertyDepth + 1, subVal);</span>
    } else {
<span class="nc" id="L491">      subVal = Array.get(m_PropertyArray, m_PropertyNumber);</span>
    }
<span class="nc" id="L493">    Method setter = current.getWriteMethod();</span>
<span class="nc" id="L494">    Object [] args = { subVal };</span>
<span class="nc" id="L495">    setter.invoke(origValue, args);</span>
<span class="nc" id="L496">  }</span>

  /**
   * Returns true if there are more iterations to carry out in the experiment.
   *
   * @return true if so
   */
  public boolean hasMoreIterations() {

<span class="nc bnc" id="L505" title="All 2 branches missed.">    return !m_Finished;</span>
  }
  
  /**
   * Carries out the next iteration of the experiment.
   *
   * @throws Exception if an error occurs
   */
  public void nextIteration() throws Exception {
    
<span class="nc bnc" id="L515" title="All 2 branches missed.">    if (m_UsePropertyIterator) {</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">      if (m_CurrentProperty != m_PropertyNumber) {</span>
<span class="nc" id="L517">	setProperty(0, m_ResultProducer);</span>
<span class="nc" id="L518">	m_CurrentProperty = m_PropertyNumber;</span>
      }
    }
    
<span class="nc bnc" id="L522" title="All 2 branches missed.">    if (m_CurrentInstances == null) {</span>
<span class="nc" id="L523">      File currentFile = (File) getDatasets().elementAt(m_DatasetNumber);</span>
<span class="nc" id="L524">      AbstractFileLoader loader = ConverterUtils.getLoaderForFile(currentFile);</span>
<span class="nc" id="L525">      loader.setFile(currentFile);</span>
<span class="nc" id="L526">      Instances data = new Instances(loader.getDataSet());</span>
      // only set class attribute if not already done by loader
<span class="nc bnc" id="L528" title="All 2 branches missed.">      if (data.classIndex() == -1) {</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">	if (m_ClassFirst) {</span>
<span class="nc" id="L530">	  data.setClassIndex(0);</span>
	} else {
<span class="nc" id="L532">	  data.setClassIndex(data.numAttributes() - 1);</span>
	}
      }
<span class="nc" id="L535">      m_CurrentInstances = data;</span>
<span class="nc" id="L536">      m_ResultProducer.setInstances(m_CurrentInstances);</span>
    }
    
<span class="nc" id="L539">    m_ResultProducer.doRun(m_RunNumber);</span>

<span class="nc" id="L541">    advanceCounters();</span>
<span class="nc" id="L542">  }</span>

  /**
   * Increments iteration counters appropriately.
   */
  public void advanceCounters() {

<span class="nc bnc" id="L549" title="All 2 branches missed.">    if (m_AdvanceDataSetFirst) {</span>
<span class="nc" id="L550">      m_RunNumber ++;</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">      if (m_RunNumber &gt; getRunUpper()) {</span>
<span class="nc" id="L552">	m_RunNumber = getRunLower();</span>
<span class="nc" id="L553">	m_DatasetNumber ++;</span>
<span class="nc" id="L554">	m_CurrentInstances = null;</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">	if (m_DatasetNumber &gt;= getDatasets().size()) {</span>
<span class="nc" id="L556">	  m_DatasetNumber = 0;</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">	  if (m_UsePropertyIterator) {</span>
<span class="nc" id="L558">	    m_PropertyNumber ++;</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">	    if (m_PropertyNumber &gt;= Array.getLength(m_PropertyArray)) {</span>
<span class="nc" id="L560">	      m_Finished = true;</span>
	    }
	  } else {
<span class="nc" id="L563">	    m_Finished = true;</span>
	  }
	}
      }
    } else { // advance by custom iterator before data set
<span class="nc" id="L568">      m_RunNumber ++;</span>
<span class="nc bnc" id="L569" title="All 2 branches missed.">      if (m_RunNumber &gt; getRunUpper()) {</span>
<span class="nc" id="L570">	m_RunNumber = getRunLower();</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">	if (m_UsePropertyIterator) {</span>
<span class="nc" id="L572">	  m_PropertyNumber ++;</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">	  if (m_PropertyNumber &gt;= Array.getLength(m_PropertyArray)) {</span>
<span class="nc" id="L574">	    m_PropertyNumber = 0;</span>
<span class="nc" id="L575">	    m_DatasetNumber ++;</span>
<span class="nc" id="L576">	    m_CurrentInstances = null;</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">	    if (m_DatasetNumber &gt;= getDatasets().size()) {</span>
<span class="nc" id="L578">	      m_Finished = true;</span>
	    } 
	  }
	} else {
<span class="nc" id="L582">	  m_DatasetNumber ++;</span>
<span class="nc" id="L583">	  m_CurrentInstances = null;</span>
<span class="nc bnc" id="L584" title="All 2 branches missed.">	  if (m_DatasetNumber &gt;= getDatasets().size()) {</span>
<span class="nc" id="L585">	    m_Finished = true;</span>
	  }
	}
      }
    }
<span class="nc" id="L590">  }</span>

  /**
   * Runs all iterations of the experiment, continuing past errors.
   */
  public void runExperiment() {

<span class="nc bnc" id="L597" title="All 2 branches missed.">    while (hasMoreIterations()) {</span>
      try {
<span class="nc" id="L599">	nextIteration();</span>
<span class="nc" id="L600">      } catch (Exception ex) {</span>
<span class="nc" id="L601">	ex.printStackTrace();</span>
<span class="nc" id="L602">	System.err.println(ex.getMessage());</span>
<span class="nc" id="L603">	advanceCounters(); // Try to keep plowing through</span>
      }
    }
<span class="nc" id="L606">  }</span>

  /**
   * Signals that the experiment is finished running, so that cleanup
   * can be done.
   *
   * @throws Exception if an error occurs
   */
  public void postProcess() throws Exception {

<span class="nc" id="L616">    m_ResultProducer.postProcess();</span>
<span class="nc" id="L617">  }</span>
  
  /**
   * Gets the datasets in the experiment.
   *
   * @return the datasets in the experiment.
   */
  public DefaultListModel getDatasets() {
<span class="nc" id="L625">    return m_Datasets;</span>
  }

  /**
   * Set the datasets to use in the experiment
   * @param ds the list of datasets to use
   */
  public void setDatasets(DefaultListModel ds) {
<span class="nc" id="L633">    m_Datasets = ds;</span>
<span class="nc" id="L634">  }</span>

  /**
   * Gets the result listener where results will be sent.
   *
   * @return the result listener where results will be sent.
   */
  public ResultListener getResultListener() {
    
<span class="nc" id="L643">    return m_ResultListener;</span>
  }
  
  /**
   * Sets the result listener where results will be sent.
   *
   * @param newResultListener the result listener where results will be sent.
   */
  public void setResultListener(ResultListener newResultListener) {
    
<span class="nc" id="L653">    m_ResultListener = newResultListener;</span>
<span class="nc" id="L654">  }</span>
  
  /**
   * Get the result producer used for the current experiment.
   *
   * @return the result producer used for the current experiment.
   */
  public ResultProducer getResultProducer() {
    
<span class="nc" id="L663">    return m_ResultProducer;</span>
  }
  
  /**
   * Set the result producer used for the current experiment.
   *
   * @param newResultProducer result producer to use for the current 
   * experiment.
   */
  public void setResultProducer(ResultProducer newResultProducer) {
    
<span class="nc" id="L674">    m_ResultProducer = newResultProducer;</span>
<span class="nc" id="L675">  }</span>
  
  /**
   * Get the upper run number for the experiment.
   *
   * @return the upper run number for the experiment.
   */
  public int getRunUpper() {
    
<span class="nc" id="L684">    return m_RunUpper;</span>
  }
  
  /**
   * Set the upper run number for the experiment.
   *
   * @param newRunUpper the upper run number for the experiment.
   */
  public void setRunUpper(int newRunUpper) {
    
<span class="nc" id="L694">    m_RunUpper = newRunUpper;</span>
<span class="nc" id="L695">  }</span>
  
  /**
   * Get the lower run number for the experiment.
   *
   * @return the lower run number for the experiment.
   */
  public int getRunLower() {
    
<span class="nc" id="L704">    return m_RunLower;</span>
  }
  
  /**
   * Set the lower run number for the experiment.
   *
   * @param newRunLower the lower run number for the experiment.
   */
  public void setRunLower(int newRunLower) {
    
<span class="nc" id="L714">    m_RunLower = newRunLower;</span>
<span class="nc" id="L715">  }</span>

  
  /**
   * Get the user notes.
   *
   * @return User notes associated with the experiment.
   */
  public String getNotes() {
    
<span class="nc" id="L725">    return m_Notes;</span>
  }
  
  /**
   * Set the user notes.
   *
   * @param newNotes New user notes.
   */
  public void setNotes(String newNotes) {
    
<span class="nc" id="L735">    m_Notes = newNotes;</span>
<span class="nc" id="L736">  }</span>
  
  /**
   * Returns an enumeration describing the available options..
   *
   * @return an enumeration of all the available options.
   */
  public Enumeration listOptions() {

<span class="nc" id="L745">    Vector newVector = new Vector(6);</span>

<span class="nc" id="L747">    newVector.addElement(new Option(</span>
<span class="nc" id="L748">	     &quot;\tThe lower run number to start the experiment from.\n&quot;</span>
	      +&quot;\t(default 1)&quot;, 
<span class="nc" id="L750">	     &quot;L&quot;, 1, </span>
<span class="nc" id="L751">	     &quot;-L &lt;num&gt;&quot;));</span>
<span class="nc" id="L752">    newVector.addElement(new Option(</span>
<span class="nc" id="L753">	     &quot;\tThe upper run number to end the experiment at (inclusive).\n&quot;</span>
	      +&quot;\t(default 10)&quot;, 
<span class="nc" id="L755">	     &quot;U&quot;, 1, </span>
<span class="nc" id="L756">	     &quot;-U &lt;num&gt;&quot;));</span>
<span class="nc" id="L757">    newVector.addElement(new Option(</span>
<span class="nc" id="L758">	     &quot;\tThe dataset to run the experiment on.\n&quot;</span>
	     + &quot;\t(required, may be specified multiple times)&quot;, 
<span class="nc" id="L760">	     &quot;T&quot;, 1, </span>
<span class="nc" id="L761">	     &quot;-T &lt;arff file&gt;&quot;));</span>
<span class="nc" id="L762">    newVector.addElement(new Option(</span>
<span class="nc" id="L763">	     &quot;\tThe full class name of a ResultProducer (required).\n&quot;</span>
	      +&quot;\teg: weka.experiment.RandomSplitResultProducer&quot;, 
<span class="nc" id="L765">	     &quot;P&quot;, 1, </span>
<span class="nc" id="L766">	     &quot;-P &lt;class name&gt;&quot;));</span>
<span class="nc" id="L767">    newVector.addElement(new Option(</span>
<span class="nc" id="L768">	     &quot;\tThe full class name of a ResultListener (required).\n&quot;</span>
	      +&quot;\teg: weka.experiment.CSVResultListener&quot;, 
<span class="nc" id="L770">	     &quot;D&quot;, 1, </span>
<span class="nc" id="L771">	     &quot;-D &lt;class name&gt;&quot;));</span>
<span class="nc" id="L772">    newVector.addElement(new Option(</span>
<span class="nc" id="L773">	     &quot;\tA string containing any notes about the experiment.\n&quot;</span>
	      +&quot;\t(default none)&quot;, 
<span class="nc" id="L775">	     &quot;N&quot;, 1, </span>
<span class="nc" id="L776">	     &quot;-N &lt;string&gt;&quot;));</span>

<span class="nc bnc" id="L778" title="All 2 branches missed.">    if ((m_ResultProducer != null) &amp;&amp;</span>
<span class="nc bnc" id="L779" title="All 2 branches missed.">	(m_ResultProducer instanceof OptionHandler)) {</span>
<span class="nc" id="L780">      newVector.addElement(new Option(</span>
<span class="nc" id="L781">	     &quot;&quot;,</span>
<span class="nc" id="L782">	     &quot;&quot;, 0, &quot;\nOptions specific to result producer &quot;</span>
<span class="nc" id="L783">	     + m_ResultProducer.getClass().getName() + &quot;:&quot;));</span>
<span class="nc" id="L784">      Enumeration enm = ((OptionHandler)m_ResultProducer).listOptions();</span>
<span class="nc bnc" id="L785" title="All 2 branches missed.">      while (enm.hasMoreElements()) {</span>
<span class="nc" id="L786">	newVector.addElement(enm.nextElement());</span>
      }
    }
<span class="nc" id="L789">    return newVector.elements();</span>
  }

  /**
   * Parses a given list of options. &lt;p/&gt;
   *
   &lt;!-- options-start --&gt;
   * Valid options are: &lt;p/&gt;
   * 
   * &lt;pre&gt; -L &amp;lt;num&amp;gt;
   *  The lower run number to start the experiment from.
   *  (default 1)&lt;/pre&gt;
   * 
   * &lt;pre&gt; -U &amp;lt;num&amp;gt;
   *  The upper run number to end the experiment at (inclusive).
   *  (default 10)&lt;/pre&gt;
   * 
   * &lt;pre&gt; -T &amp;lt;arff file&amp;gt;
   *  The dataset to run the experiment on.
   *  (required, may be specified multiple times)&lt;/pre&gt;
   * 
   * &lt;pre&gt; -P &amp;lt;class name&amp;gt;
   *  The full class name of a ResultProducer (required).
   *  eg: weka.experiment.RandomSplitResultProducer&lt;/pre&gt;
   * 
   * &lt;pre&gt; -D &amp;lt;class name&amp;gt;
   *  The full class name of a ResultListener (required).
   *  eg: weka.experiment.CSVResultListener&lt;/pre&gt;
   * 
   * &lt;pre&gt; -N &amp;lt;string&amp;gt;
   *  A string containing any notes about the experiment.
   *  (default none)&lt;/pre&gt;
   * 
   * &lt;pre&gt; 
   * Options specific to result producer weka.experiment.RandomSplitResultProducer:
   * &lt;/pre&gt;
   * 
   * &lt;pre&gt; -P &amp;lt;percent&amp;gt;
   *  The percentage of instances to use for training.
   *  (default 66)&lt;/pre&gt;
   * 
   * &lt;pre&gt; -D
   * Save raw split evaluator output.&lt;/pre&gt;
   * 
   * &lt;pre&gt; -O &amp;lt;file/directory name/path&amp;gt;
   *  The filename where raw output will be stored.
   *  If a directory name is specified then then individual
   *  outputs will be gzipped, otherwise all output will be
   *  zipped to the named file. Use in conjuction with -D. (default splitEvalutorOut.zip)&lt;/pre&gt;
   * 
   * &lt;pre&gt; -W &amp;lt;class name&amp;gt;
   *  The full class name of a SplitEvaluator.
   *  eg: weka.experiment.ClassifierSplitEvaluator&lt;/pre&gt;
   * 
   * &lt;pre&gt; -R
   *  Set when data is not to be randomized and the data sets' size.
   *  Is not to be determined via probabilistic rounding.&lt;/pre&gt;
   * 
   * &lt;pre&gt; 
   * Options specific to split evaluator weka.experiment.ClassifierSplitEvaluator:
   * &lt;/pre&gt;
   * 
   * &lt;pre&gt; -W &amp;lt;class name&amp;gt;
   *  The full class name of the classifier.
   *  eg: weka.classifiers.bayes.NaiveBayes&lt;/pre&gt;
   * 
   * &lt;pre&gt; -C &amp;lt;index&amp;gt;
   *  The index of the class for which IR statistics
   *  are to be output. (default 1)&lt;/pre&gt;
   * 
   * &lt;pre&gt; -I &amp;lt;index&amp;gt;
   *  The index of an attribute to output in the
   *  results. This attribute should identify an
   *  instance in order to know which instances are
   *  in the test set of a cross validation. if 0
   *  no output (default 0).&lt;/pre&gt;
   * 
   * &lt;pre&gt; -P
   *  Add target and prediction columns to the result
   *  for each fold.&lt;/pre&gt;
   * 
   * &lt;pre&gt; 
   * Options specific to classifier weka.classifiers.rules.ZeroR:
   * &lt;/pre&gt;
   * 
   * &lt;pre&gt; -D
   *  If set, classifier is run in debug mode and
   *  may output additional info to the console&lt;/pre&gt;
   * 
   &lt;!-- options-end --&gt;
   *
   * All options after -- will be passed to the result producer. &lt;p&gt;
   *
   * @param options the list of options as an array of strings
   * @throws Exception if an option is not supported
   */
  public void setOptions(String [] options) throws Exception {

<span class="nc" id="L887">    String lowerString = Utils.getOption('L', options);</span>
<span class="nc bnc" id="L888" title="All 2 branches missed.">    if (lowerString.length() != 0) {</span>
<span class="nc" id="L889">      setRunLower(Integer.parseInt(lowerString));</span>
    } else {
<span class="nc" id="L891">      setRunLower(1);</span>
    }
<span class="nc" id="L893">    String upperString = Utils.getOption('U', options);</span>
<span class="nc bnc" id="L894" title="All 2 branches missed.">    if (upperString.length() != 0) {</span>
<span class="nc" id="L895">      setRunUpper(Integer.parseInt(upperString));</span>
    } else {
<span class="nc" id="L897">      setRunUpper(10);</span>
    }
<span class="nc bnc" id="L899" title="All 2 branches missed.">    if (getRunLower() &gt; getRunUpper()) {</span>
<span class="nc" id="L900">      throw new Exception(&quot;Lower (&quot; + getRunLower() </span>
<span class="nc" id="L901">			  + &quot;) is greater than upper (&quot; </span>
<span class="nc" id="L902">			  + getRunUpper() + &quot;)&quot;);</span>
    }
    
<span class="nc" id="L905">    setNotes(Utils.getOption('N', options));</span>
    
<span class="nc" id="L907">    getDatasets().removeAllElements();</span>
    String dataName;
    do {
<span class="nc" id="L910">      dataName = Utils.getOption('T', options);</span>
<span class="nc bnc" id="L911" title="All 2 branches missed.">      if (dataName.length() != 0) {</span>
<span class="nc" id="L912">	File dataset = new File(dataName);</span>
<span class="nc" id="L913">	getDatasets().addElement(dataset);</span>
      }
<span class="nc bnc" id="L915" title="All 2 branches missed.">    } while (dataName.length() != 0);</span>
<span class="nc bnc" id="L916" title="All 2 branches missed.">    if (getDatasets().size() == 0) {</span>
<span class="nc" id="L917">      throw new Exception(&quot;Required: -T &lt;arff file name&gt;&quot;);</span>
    }

<span class="nc" id="L920">    String rlName = Utils.getOption('D', options);</span>
<span class="nc bnc" id="L921" title="All 2 branches missed.">    if (rlName.length() == 0) {</span>
<span class="nc" id="L922">      throw new Exception(&quot;Required: -D &lt;ResultListener class name&gt;&quot;);</span>
    }
<span class="nc" id="L924">    rlName = rlName.trim();</span>
    // split off any options
<span class="nc" id="L926">    int breakLoc = rlName.indexOf(' ');</span>
<span class="nc" id="L927">    String clName = rlName;</span>
<span class="nc" id="L928">    String rlOptionsString = &quot;&quot;;</span>
<span class="nc" id="L929">    String [] rlOptions = null;</span>
<span class="nc bnc" id="L930" title="All 2 branches missed.">    if (breakLoc != -1) {</span>
<span class="nc" id="L931">      clName = rlName.substring(0, breakLoc);</span>
<span class="nc" id="L932">      rlOptionsString = rlName.substring(breakLoc).trim();</span>
<span class="nc" id="L933">      rlOptions = Utils.splitOptions(rlOptionsString);</span>
    }
<span class="nc" id="L935">    setResultListener((ResultListener)Utils.forName(ResultListener.class,</span>
<span class="nc" id="L936">						    clName, rlOptions));</span>

<span class="nc" id="L938">    String rpName = Utils.getOption('P', options);</span>
<span class="nc bnc" id="L939" title="All 2 branches missed.">    if (rpName.length() == 0) {</span>
<span class="nc" id="L940">      throw new Exception(&quot;Required: -P &lt;ResultProducer class name&gt;&quot;);</span>
    }
    // Do it first without options, so if an exception is thrown during
    // the option setting, listOptions will contain options for the actual
    // RP.
    //GHF -- nice idea, but it prevents you from using result producers that
    //       have *required* parameters
<span class="nc" id="L947">    setResultProducer((ResultProducer)Utils.forName(</span>
<span class="nc" id="L948">		      ResultProducer.class,</span>
<span class="nc" id="L949">		      rpName,</span>
<span class="nc" id="L950">		      Utils.partitionOptions(options) )); //GHF</span>
    //GHF if (getResultProducer() instanceof OptionHandler) {
    //GHF  ((OptionHandler) getResultProducer())
    //GHF  .setOptions(Utils.partitionOptions(options));
    //GHF }
<span class="nc" id="L955">  }</span>

  /**
   * Gets the current settings of the experiment iterator.
   *
   * @return an array of strings suitable for passing to setOptions
   */
  public String [] getOptions() {

    // Currently no way to set custompropertyiterators from the command line

<span class="nc" id="L966">    m_UsePropertyIterator = false;</span>
<span class="nc" id="L967">    m_PropertyPath = null;</span>
<span class="nc" id="L968">    m_PropertyArray = null;</span>
    
<span class="nc" id="L970">    String [] rpOptions = new String [0];</span>
<span class="nc bnc" id="L971" title="All 2 branches missed.">    if ((m_ResultProducer != null) &amp;&amp; </span>
<span class="nc bnc" id="L972" title="All 2 branches missed.">	(m_ResultProducer instanceof OptionHandler)) {</span>
<span class="nc" id="L973">      rpOptions = ((OptionHandler)m_ResultProducer).getOptions();</span>
    }
    
<span class="nc" id="L976">    String [] options = new String [rpOptions.length </span>
<span class="nc" id="L977">				   + getDatasets().size() * 2</span>
<span class="nc" id="L978">				   + 11];</span>
<span class="nc" id="L979">    int current = 0;</span>

<span class="nc" id="L981">    options[current++] = &quot;-L&quot;; options[current++] = &quot;&quot; + getRunLower();</span>
<span class="nc" id="L982">    options[current++] = &quot;-U&quot;; options[current++] = &quot;&quot; + getRunUpper();</span>
<span class="nc bnc" id="L983" title="All 2 branches missed.">    if (getDatasets().size() != 0) {</span>
<span class="nc bnc" id="L984" title="All 2 branches missed.">      for (int i = 0; i &lt; getDatasets().size(); i++) {</span>
<span class="nc" id="L985">	options[current++] = &quot;-T&quot;;</span>
<span class="nc" id="L986">	options[current++] = getDatasets().elementAt(i).toString();</span>
      }
    }
<span class="nc bnc" id="L989" title="All 2 branches missed.">    if (getResultListener() != null) {</span>
<span class="nc" id="L990">      options[current++] = &quot;-D&quot;;</span>
<span class="nc" id="L991">      options[current++] = getResultListener().getClass().getName();</span>
    }
<span class="nc bnc" id="L993" title="All 2 branches missed.">    if (getResultProducer() != null) {</span>
<span class="nc" id="L994">      options[current++] = &quot;-P&quot;;</span>
<span class="nc" id="L995">      options[current++] = getResultProducer().getClass().getName();</span>
    }
<span class="nc bnc" id="L997" title="All 2 branches missed.">    if (!getNotes().equals(&quot;&quot;)) {</span>
<span class="nc" id="L998">      options[current++] = &quot;-N&quot;; options[current++] = getNotes();</span>
    }
<span class="nc" id="L1000">    options[current++] = &quot;--&quot;;</span>

<span class="nc" id="L1002">    System.arraycopy(rpOptions, 0, options, current, </span>
<span class="nc" id="L1003">		     rpOptions.length);</span>
<span class="nc" id="L1004">    current += rpOptions.length;</span>
<span class="nc bnc" id="L1005" title="All 2 branches missed.">    while (current &lt; options.length) {</span>
<span class="nc" id="L1006">      options[current++] = &quot;&quot;;</span>
    }
<span class="nc" id="L1008">    return options;</span>
  }

  /**
   * Gets a string representation of the experiment configuration.
   *
   * @return a value of type 'String'
   */
  public String toString() {

<span class="nc" id="L1018">    String result = &quot;Runs from: &quot; + m_RunLower + &quot; to: &quot; + m_RunUpper + '\n';</span>
<span class="nc" id="L1019">    result += &quot;Datasets:&quot;;</span>
<span class="nc bnc" id="L1020" title="All 2 branches missed.">    for (int i = 0; i &lt; m_Datasets.size(); i ++) {</span>
<span class="nc" id="L1021">      result += &quot; &quot; + m_Datasets.elementAt(i);</span>
    }
<span class="nc" id="L1023">    result += '\n';</span>
<span class="nc" id="L1024">    result += &quot;Custom property iterator: &quot;</span>
<span class="nc bnc" id="L1025" title="All 2 branches missed.">      + (m_UsePropertyIterator ? &quot;on&quot; : &quot;off&quot;)</span>
<span class="nc" id="L1026">      + &quot;\n&quot;;</span>
<span class="nc bnc" id="L1027" title="All 2 branches missed.">    if (m_UsePropertyIterator) {</span>
<span class="nc bnc" id="L1028" title="All 2 branches missed.">      if (m_PropertyPath == null) {</span>
<span class="nc" id="L1029">	throw new Error(&quot;*** null propertyPath ***&quot;);</span>
      }
<span class="nc bnc" id="L1031" title="All 2 branches missed.">      if (m_PropertyArray == null) {</span>
<span class="nc" id="L1032">	throw new Error(&quot;*** null propertyArray ***&quot;);</span>
      }
<span class="nc bnc" id="L1034" title="All 2 branches missed.">      if (m_PropertyPath.length &gt; 1) {</span>
<span class="nc" id="L1035">	result += &quot;Custom property path:\n&quot;;</span>
<span class="nc bnc" id="L1036" title="All 2 branches missed.">	for (int i = 0; i &lt; m_PropertyPath.length - 1; i++) {</span>
<span class="nc" id="L1037">	  PropertyNode pn = m_PropertyPath[i];</span>
<span class="nc" id="L1038">	  result += &quot;&quot; + (i + 1) + &quot;  &quot; + pn.parentClass.getName()</span>
<span class="nc" id="L1039">	    + &quot;::&quot; + pn.toString()</span>
<span class="nc" id="L1040">	    + ' ' + pn.value.toString() + '\n';</span>
	}
      }
<span class="nc" id="L1043">      result += &quot;Custom property name:&quot;</span>
<span class="nc" id="L1044">	+ m_PropertyPath[m_PropertyPath.length - 1].toString() + '\n';</span>
<span class="nc" id="L1045">      result += &quot;Custom property values:\n&quot;;</span>
<span class="nc bnc" id="L1046" title="All 2 branches missed.">      for (int i = 0; i &lt; Array.getLength(m_PropertyArray); i++) {</span>
<span class="nc" id="L1047">	Object current = Array.get(m_PropertyArray, i);</span>
<span class="nc" id="L1048">	result += &quot; &quot; + (i + 1)</span>
<span class="nc" id="L1049">	  + &quot; &quot; + current.getClass().getName()</span>
<span class="nc" id="L1050">	  + &quot; &quot; + current.toString() + '\n';</span>
      }
    }
<span class="nc" id="L1053">    result += &quot;ResultProducer: &quot; + m_ResultProducer + '\n';</span>
<span class="nc" id="L1054">    result += &quot;ResultListener: &quot; + m_ResultListener + '\n';</span>
<span class="nc bnc" id="L1055" title="All 2 branches missed.">    if (!getNotes().equals(&quot;&quot;)) {</span>
<span class="nc" id="L1056">      result += &quot;Notes: &quot; + getNotes();</span>
    }
<span class="nc" id="L1058">    return result;</span>
  }

  /**
   * Loads an experiment from a file.
   * 
   * @param filename	the file to load the experiment from
   * @return		the experiment
   * @throws Exception	if loading fails
   */
  public static Experiment read(String filename) throws Exception {
    Experiment	result;
    
    // KOML?
<span class="nc bnc" id="L1072" title="All 4 branches missed.">    if ( (KOML.isPresent()) &amp;&amp; (filename.toLowerCase().endsWith(KOML.FILE_EXTENSION)) ) {</span>
<span class="nc" id="L1073">      result = (Experiment) KOML.read(filename);</span>
    }
    // XML?
<span class="nc bnc" id="L1076" title="All 2 branches missed.">    else if (filename.toLowerCase().endsWith(&quot;.xml&quot;)) {</span>
<span class="nc" id="L1077">      XMLExperiment xml = new XMLExperiment(); </span>
<span class="nc" id="L1078">      result = (Experiment) xml.read(filename);</span>
    }
    // binary
    else {
<span class="nc" id="L1082">      FileInputStream fi = new FileInputStream(filename);</span>
<span class="nc" id="L1083">      ObjectInputStream oi = new ObjectInputStream(</span>
<span class="nc" id="L1084">	  new BufferedInputStream(fi));</span>
<span class="nc" id="L1085">      result = (Experiment)oi.readObject();</span>
<span class="nc" id="L1086">      oi.close();</span>
    }
    
<span class="nc" id="L1089">    return result;</span>
  }
  
  /**
   * Writes the experiment to disk.
   * 
   * @param filename	the file to write to
   * @param exp		the experiment to save
   * @throws Exception	if writing fails
   */
  public static void write(String filename, Experiment exp) throws Exception {
    // KOML?
<span class="nc bnc" id="L1101" title="All 4 branches missed.">    if ( (KOML.isPresent()) &amp;&amp; (filename.toLowerCase().endsWith(KOML.FILE_EXTENSION)) ) {</span>
<span class="nc" id="L1102">      KOML.write(filename, exp);</span>
    }
    // XML?
<span class="nc bnc" id="L1105" title="All 2 branches missed.">    else if (filename.toLowerCase().endsWith(&quot;.xml&quot;)) {</span>
<span class="nc" id="L1106">      XMLExperiment xml = new XMLExperiment(); </span>
<span class="nc" id="L1107">      xml.write(filename, exp);</span>
    }
    // binary
    else {
<span class="nc" id="L1111">      FileOutputStream fo = new FileOutputStream(filename);</span>
<span class="nc" id="L1112">      ObjectOutputStream oo = new ObjectOutputStream(</span>
<span class="nc" id="L1113">	  new BufferedOutputStream(fo));</span>
<span class="nc" id="L1114">      oo.writeObject(exp);</span>
<span class="nc" id="L1115">      oo.close();</span>
    }
<span class="nc" id="L1117">  }</span>
  
  /**
   * Configures/Runs the Experiment from the command line.
   *
   * @param args command line arguments to the Experiment.
   */
  public static void main(String[] args) {

    try {
<span class="nc" id="L1127">      Experiment exp = null;</span>
      // get options from XML?
<span class="nc" id="L1129">      String xmlOption = Utils.getOption(&quot;xml&quot;, args);</span>
<span class="nc bnc" id="L1130" title="All 2 branches missed.">      if (!xmlOption.equals(&quot;&quot;))</span>
<span class="nc" id="L1131">         args = new XMLOptions(xmlOption).toArray();</span>
      
<span class="nc" id="L1133">      String expFile = Utils.getOption('l', args);</span>
<span class="nc" id="L1134">      String saveFile = Utils.getOption('s', args);</span>
<span class="nc" id="L1135">      boolean runExp = Utils.getFlag('r', args);</span>
<span class="nc bnc" id="L1136" title="All 2 branches missed.">      if (expFile.length() == 0) {</span>
<span class="nc" id="L1137">	exp = new Experiment();</span>
	try {
<span class="nc" id="L1139">	  exp.setOptions(args);</span>
<span class="nc" id="L1140">	  Utils.checkForRemainingOptions(args);</span>
<span class="nc" id="L1141">	} catch (Exception ex) {</span>
<span class="nc" id="L1142">	  ex.printStackTrace();</span>
<span class="nc" id="L1143">	  String result = &quot;Usage:\n\n&quot;</span>
	    + &quot;-l &lt;exp|xml file&gt;\n&quot;
	    + &quot;\tLoad experiment from file (default use cli options).\n&quot;
      + &quot;\tThe type is determined, based on the extension (&quot; 
<span class="nc" id="L1147">        + FILE_EXTENSION + &quot; or .xml)\n&quot;</span>
<span class="nc" id="L1148">	    + &quot;-s &lt;exp|xml file&gt;\n&quot;</span>
<span class="nc" id="L1149">	    + &quot;\tSave experiment to file after setting other options.\n&quot;</span>
<span class="nc" id="L1150">      + &quot;\tThe type is determined, based on the extension (&quot; </span>
<span class="nc" id="L1151">        + FILE_EXTENSION + &quot; or .xml)\n&quot;</span>
<span class="nc" id="L1152">	    + &quot;\t(default don't save)\n&quot;</span>
<span class="nc" id="L1153">	    + &quot;-r\n&quot;</span>
<span class="nc" id="L1154">	    + &quot;\tRun experiment (default don't run)\n&quot;</span>
<span class="nc" id="L1155">	    + &quot;-xml &lt;filename | xml-string&gt;\n&quot;</span>
<span class="nc" id="L1156">	    + &quot;\tget options from XML-Data instead from parameters\n&quot;</span>
<span class="nc" id="L1157">            + &quot;\n&quot;;</span>
<span class="nc" id="L1158">	  Enumeration enm = ((OptionHandler)exp).listOptions();</span>
<span class="nc bnc" id="L1159" title="All 2 branches missed.">	  while (enm.hasMoreElements()) {</span>
<span class="nc" id="L1160">	    Option option = (Option) enm.nextElement();</span>
<span class="nc" id="L1161">	    result += option.synopsis() + &quot;\n&quot;;</span>
<span class="nc" id="L1162">	    result += option.description() + &quot;\n&quot;;</span>
	  }
<span class="nc" id="L1164">	  throw new Exception(result + &quot;\n&quot; + ex.getMessage());</span>
	}
      } else {
<span class="nc" id="L1167">	exp = read(expFile);</span>

	// allow extra datasets to be added to pre-loaded experiment from command line
	String dataName;
	do {
<span class="nc" id="L1172">	  dataName = Utils.getOption('T', args);</span>
<span class="nc bnc" id="L1173" title="All 2 branches missed.">	  if (dataName.length() != 0) {</span>
<span class="nc" id="L1174">	    File dataset = new File(dataName);</span>
<span class="nc" id="L1175">	    exp.getDatasets().addElement(dataset);</span>
	  }
<span class="nc bnc" id="L1177" title="All 2 branches missed.">	} while (dataName.length() != 0);</span>
	
      }
<span class="nc" id="L1180">      System.err.println(&quot;Experiment:\n&quot; + exp.toString());</span>

<span class="nc bnc" id="L1182" title="All 2 branches missed.">      if (saveFile.length() != 0)</span>
<span class="nc" id="L1183">	write(saveFile, exp);</span>
      
<span class="nc bnc" id="L1185" title="All 2 branches missed.">      if (runExp) {</span>
<span class="nc" id="L1186">	System.err.println(&quot;Initializing...&quot;);</span>
<span class="nc" id="L1187">	exp.initialize();</span>
<span class="nc" id="L1188">	System.err.println(&quot;Iterating...&quot;);</span>
<span class="nc" id="L1189">	exp.runExperiment();</span>
<span class="nc" id="L1190">	System.err.println(&quot;Postprocessing...&quot;);</span>
<span class="nc" id="L1191">	exp.postProcess();</span>
      }
      
<span class="nc" id="L1194">    } catch (Exception ex) {</span>
<span class="nc" id="L1195">      System.err.println(ex.getMessage());</span>
    }
<span class="nc" id="L1197">  }</span>
  
  /**
   * Returns the revision string.
   * 
   * @return		the revision
   */
  public String getRevision() {
<span class="nc" id="L1205">    return RevisionUtils.extract(&quot;$Revision: 5401 $&quot;);</span>
  }
} // Experiment
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>