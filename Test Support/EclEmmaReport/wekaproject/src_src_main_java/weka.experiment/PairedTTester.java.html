<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>PairedTTester.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.experiment</a> &gt; <span class="el_source">PairedTTester.java</span></div><h1>PairedTTester.java</h1><pre class="source lang-java linenums">/*
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 *    PairedTTester.java
 *    Copyright (C) 1999 University of Waikato, Hamilton, New Zealand
 *
 */


package weka.experiment;

import weka.core.Attribute;
import weka.core.FastVector;
import weka.core.Instance;
import weka.core.Instances;
import weka.core.Option;
import weka.core.OptionHandler;
import weka.core.Range;
import weka.core.RevisionHandler;
import weka.core.RevisionUtils;
import weka.core.Utils;

import java.io.BufferedReader;
import java.io.FileReader;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Enumeration;
import java.util.Vector;

/**
 * Calculates T-Test statistics on data stored in a set of instances. &lt;p/&gt;
 *
 &lt;!-- options-start --&gt;
 * Valid options are: &lt;p/&gt;
 * 
 * &lt;pre&gt; -D &amp;lt;index,index2-index4,...&amp;gt;
 *  Specify list of columns that specify a unique
 *  dataset.
 *  First and last are valid indexes. (default none)&lt;/pre&gt;
 * 
 * &lt;pre&gt; -R &amp;lt;index&amp;gt;
 *  Set the index of the column containing the run number&lt;/pre&gt;
 * 
 * &lt;pre&gt; -F &amp;lt;index&amp;gt;
 *  Set the index of the column containing the fold number&lt;/pre&gt;
 * 
 * &lt;pre&gt; -G &amp;lt;index1,index2-index4,...&amp;gt;
 *  Specify list of columns that specify a unique
 *  'result generator' (eg: classifier name and options).
 *  First and last are valid indexes. (default none)&lt;/pre&gt;
 * 
 * &lt;pre&gt; -S &amp;lt;significance level&amp;gt;
 *  Set the significance level for comparisons (default 0.05)&lt;/pre&gt;
 * 
 * &lt;pre&gt; -V
 *  Show standard deviations&lt;/pre&gt;
 * 
 * &lt;pre&gt; -L
 *  Produce table comparisons in Latex table format&lt;/pre&gt;
 * 
 * &lt;pre&gt; -csv
 *  Produce table comparisons in CSV table format&lt;/pre&gt;
 * 
 * &lt;pre&gt; -html
 *  Produce table comparisons in HTML table format&lt;/pre&gt;
 * 
 * &lt;pre&gt; -significance
 *  Produce table comparisons with only the significance values&lt;/pre&gt;
 * 
 * &lt;pre&gt; -gnuplot
 *  Produce table comparisons output suitable for GNUPlot&lt;/pre&gt;
 * 
 &lt;!-- options-end --&gt;
 *
 * @author Len Trigg (trigg@cs.waikato.ac.nz)
 * @version $Revision: 6431 $
 */
<span class="nc" id="L92">public class PairedTTester </span>
  implements OptionHandler, Tester, RevisionHandler {
  
  /** for serialization */
  static final long serialVersionUID = 8370014624008728610L;

  /** The set of instances we will analyse */
  protected Instances m_Instances;

  /** The index of the column containing the run number */
<span class="nc" id="L102">  protected int m_RunColumn = 0;</span>

  /** The option setting for the run number column (-1 means last) */
<span class="nc" id="L105">  protected int m_RunColumnSet = -1;</span>

  /** The option setting for the fold number column (-1 means none) */
<span class="nc" id="L108">  protected int m_FoldColumn = -1;</span>

  /** The column to sort on (-1 means default sorting) */
<span class="nc" id="L111">  protected int m_SortColumn = -1;</span>

  /** The sorting of the datasets (according to the sort column) */
<span class="nc" id="L114">  protected int[] m_SortOrder = null;</span>

  /** The sorting of the columns (test base is always first) */
<span class="nc" id="L117">  protected int[] m_ColOrder = null;</span>

  /** The significance level for comparisons */
<span class="nc" id="L120">  protected double m_SignificanceLevel = 0.05;</span>

  /**
   * The range of columns that specify a unique &quot;dataset&quot;
   * (eg: scheme plus configuration)
   */
<span class="nc" id="L126">  protected Range m_DatasetKeyColumnsRange = new Range();</span>

  /** An array containing the indexes of just the selected columns */ 
  protected int [] m_DatasetKeyColumns;

  /** The list of dataset specifiers */
<span class="nc" id="L132">  protected DatasetSpecifiers m_DatasetSpecifiers = </span>
<span class="nc" id="L133">    new DatasetSpecifiers();</span>

  /**
   * The range of columns that specify a unique result set
   * (eg: scheme plus configuration)
   */
<span class="nc" id="L139">  protected Range m_ResultsetKeyColumnsRange = new Range();</span>

  /** An array containing the indexes of just the selected columns */ 
  protected int [] m_ResultsetKeyColumns;

  /** An array containing the indexes of the datasets to display */
<span class="nc" id="L145">  protected int[] m_DisplayedResultsets = null;</span>

  /** Stores a vector for each resultset holding all instances in each set */
<span class="nc" id="L148">  protected FastVector m_Resultsets = new FastVector();</span>

  /** Indicates whether the instances have been partitioned */
  protected boolean m_ResultsetsValid;

  /** Indicates whether standard deviations should be displayed */
<span class="nc" id="L154">  protected boolean m_ShowStdDevs = false;</span>
  
  /** the instance of the class to produce the output. */
<span class="nc" id="L157">  protected ResultMatrix m_ResultMatrix = new ResultMatrixPlainText();</span>
  
  /** A list of unique &quot;dataset&quot; specifiers that have been observed */
<span class="nc" id="L160">  protected class DatasetSpecifiers</span>
    implements RevisionHandler {

    /** the specifiers that have been observed */
<span class="nc" id="L164">    FastVector m_Specifiers = new FastVector();</span>

    /**
     * Removes all specifiers.
     */
    protected void removeAllSpecifiers() {

<span class="nc" id="L171">      m_Specifiers.removeAllElements();</span>
<span class="nc" id="L172">    }</span>

    /** 
     * Add an instance to the list of specifiers (if necessary)
     * 
     * @param inst	the instance to add
     */
    protected void add(Instance inst) {
      
<span class="nc bnc" id="L181" title="All 2 branches missed.">      for (int i = 0; i &lt; m_Specifiers.size(); i++) {</span>
<span class="nc" id="L182">	Instance specifier = (Instance)m_Specifiers.elementAt(i);</span>
<span class="nc" id="L183">	boolean found = true;</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">	for (int j = 0; j &lt; m_DatasetKeyColumns.length; j++) {</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">	  if (inst.value(m_DatasetKeyColumns[j]) !=</span>
<span class="nc" id="L186">	      specifier.value(m_DatasetKeyColumns[j])) {</span>
<span class="nc" id="L187">	    found = false;</span>
	  }
	}
<span class="nc bnc" id="L190" title="All 2 branches missed.">	if (found) {</span>
<span class="nc" id="L191">	  return;</span>
	}
      }
<span class="nc" id="L194">      m_Specifiers.addElement(inst);</span>
<span class="nc" id="L195">    }</span>

    /**
     * Get the template at the given position.
     * 
     * @param i		the index
     * @return		the template
     */
    protected Instance specifier(int i) {

<span class="nc" id="L205">      return (Instance)m_Specifiers.elementAt(i);</span>
    }

    /**
     * Gets the number of specifiers.
     * 
     * @return		the current number of specifiers
     */
    protected int numSpecifiers() {

<span class="nc" id="L215">      return m_Specifiers.size();</span>
    }
    
    /**
     * Returns the revision string.
     * 
     * @return		the revision
     */
    public String getRevision() {
<span class="nc" id="L224">      return RevisionUtils.extract(&quot;$Revision: 6431 $&quot;);</span>
    }
  }

  /** Utility class to store the instances pertaining to a dataset */
  protected class Dataset
    implements RevisionHandler {

    /** the template */
    Instance m_Template;

    /** the dataset */
    FastVector m_Dataset;

    /**
     * Constructor
     * 
     * @param template	the template
     */
<span class="nc" id="L243">    public Dataset(Instance template) {</span>

<span class="nc" id="L245">      m_Template = template;</span>
<span class="nc" id="L246">      m_Dataset = new FastVector();</span>
<span class="nc" id="L247">      add(template);</span>
<span class="nc" id="L248">    }</span>
    
    /**
     * Returns true if the two instances match on those attributes that have
     * been designated key columns (eg: scheme name and scheme options)
     *
     * @param first the first instance
     * @return true if first and second match on the currently set key columns
     */
    protected boolean matchesTemplate(Instance first) {
      
<span class="nc bnc" id="L259" title="All 2 branches missed.">      for (int i = 0; i &lt; m_DatasetKeyColumns.length; i++) {</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">	if (first.value(m_DatasetKeyColumns[i]) !=</span>
<span class="nc" id="L261">	    m_Template.value(m_DatasetKeyColumns[i])) {</span>
<span class="nc" id="L262">	  return false;</span>
	}
      }
<span class="nc" id="L265">      return true;</span>
    }

    /**
     * Adds the given instance to the dataset
     * 
     * @param inst	the instance to add
     */
    protected void add(Instance inst) {
      
<span class="nc" id="L275">      m_Dataset.addElement(inst);</span>
<span class="nc" id="L276">    }</span>

    /**
     * Returns a vector containing the instances in the dataset
     * 
     * @return 		the current contents
     */
    protected FastVector contents() {

<span class="nc" id="L285">      return m_Dataset;</span>
    }

    /**
     * Sorts the instances in the dataset by the run number.
     *
     * @param runColumn a value of type 'int'
     */
    public void sort(int runColumn) {

<span class="nc" id="L295">      double [] runNums = new double [m_Dataset.size()];</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">      for (int j = 0; j &lt; runNums.length; j++) {</span>
<span class="nc" id="L297">	runNums[j] = ((Instance) m_Dataset.elementAt(j)).value(runColumn);</span>
      }
<span class="nc" id="L299">      int [] index = Utils.stableSort(runNums);</span>
<span class="nc" id="L300">      FastVector newDataset = new FastVector(runNums.length);</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">      for (int j = 0; j &lt; index.length; j++) {</span>
<span class="nc" id="L302">	newDataset.addElement(m_Dataset.elementAt(index[j]));</span>
      }
<span class="nc" id="L304">      m_Dataset = newDataset;</span>
<span class="nc" id="L305">    }</span>
    
    /**
     * Returns the revision string.
     * 
     * @return		the revision
     */
    public String getRevision() {
<span class="nc" id="L313">      return RevisionUtils.extract(&quot;$Revision: 6431 $&quot;);</span>
    }
  }
 
  /** Utility class to store the instances in a resultset */
  protected class Resultset
    implements RevisionHandler {

    /** the template */
    Instance m_Template;
    
    /** the dataset */
    FastVector m_Datasets;

    /**
     * Constructir
     * 
     * @param template		the template
     */
<span class="nc" id="L332">    public Resultset(Instance template) {</span>

<span class="nc" id="L334">      m_Template = template;</span>
<span class="nc" id="L335">      m_Datasets = new FastVector();</span>
<span class="nc" id="L336">      add(template);</span>
<span class="nc" id="L337">    }</span>
    
    /**
     * Returns true if the two instances match on those attributes that have
     * been designated key columns (eg: scheme name and scheme options)
     *
     * @param first the first instance
     * @return true if first and second match on the currently set key columns
     */
    protected boolean matchesTemplate(Instance first) {
      
<span class="nc bnc" id="L348" title="All 2 branches missed.">      for (int i = 0; i &lt; m_ResultsetKeyColumns.length; i++) {</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">	if (first.value(m_ResultsetKeyColumns[i]) !=</span>
<span class="nc" id="L350">	    m_Template.value(m_ResultsetKeyColumns[i])) {</span>
<span class="nc" id="L351">	  return false;</span>
	}
      }
<span class="nc" id="L354">      return true;</span>
    }

    /**
     * Returns a string descriptive of the resultset key column values
     * for this resultset
     *
     * @return a value of type 'String'
     */
    protected String templateString() {

<span class="nc" id="L365">      String result = &quot;&quot;;</span>
<span class="nc" id="L366">      String tempResult = &quot;&quot;;</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">      for (int i = 0; i &lt; m_ResultsetKeyColumns.length; i++) {</span>
<span class="nc" id="L368">	tempResult = m_Template.toString(m_ResultsetKeyColumns[i]) + ' ';</span>

	// compact the string
<span class="nc" id="L371">        tempResult = Utils.removeSubstring(tempResult, &quot;weka.classifiers.&quot;);</span>
<span class="nc" id="L372">        tempResult = Utils.removeSubstring(tempResult, &quot;weka.filters.&quot;);</span>
<span class="nc" id="L373">        tempResult = Utils.removeSubstring(tempResult, &quot;weka.attributeSelection.&quot;);</span>
<span class="nc" id="L374">	result += tempResult;</span>
      }
<span class="nc" id="L376">      return result.trim();</span>
    }
    
    /**
     * Returns a vector containing all instances belonging to one dataset.
     *
     * @param inst a template instance
     * @return a value of type 'FastVector'
     */
    public FastVector dataset(Instance inst) {

<span class="nc bnc" id="L387" title="All 2 branches missed.">      for (int i = 0; i &lt; m_Datasets.size(); i++) {</span>
<span class="nc bnc" id="L388" title="All 2 branches missed.">	if (((Dataset)m_Datasets.elementAt(i)).matchesTemplate(inst)) {</span>
<span class="nc" id="L389">	  return ((Dataset)m_Datasets.elementAt(i)).contents();</span>
	} 
      }
<span class="nc" id="L392">      return null;</span>
    }
    
    /**
     * Adds an instance to this resultset
     *
     * @param newInst a value of type 'Instance'
     */
    public void add(Instance newInst) {
      
<span class="nc bnc" id="L402" title="All 2 branches missed.">      for (int i = 0; i &lt; m_Datasets.size(); i++) {</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">	if (((Dataset)m_Datasets.elementAt(i)).matchesTemplate(newInst)) {</span>
<span class="nc" id="L404">	  ((Dataset)m_Datasets.elementAt(i)).add(newInst);</span>
<span class="nc" id="L405">	  return;</span>
	}
      }
<span class="nc" id="L408">      Dataset newDataset = new Dataset(newInst);</span>
<span class="nc" id="L409">      m_Datasets.addElement(newDataset);</span>
<span class="nc" id="L410">    }</span>

    /**
     * Sorts the instances in each dataset by the run number.
     *
     * @param runColumn a value of type 'int'
     */
    public void sort(int runColumn) {

<span class="nc bnc" id="L419" title="All 2 branches missed.">      for (int i = 0; i &lt; m_Datasets.size(); i++) {</span>
<span class="nc" id="L420">	((Dataset)m_Datasets.elementAt(i)).sort(runColumn);</span>
      }
<span class="nc" id="L422">    }</span>
    
    /**
     * Returns the revision string.
     * 
     * @return		the revision
     */
    public String getRevision() {
<span class="nc" id="L430">      return RevisionUtils.extract(&quot;$Revision: 6431 $&quot;);</span>
    }
  } // Resultset


  /**
   * Returns a string descriptive of the key column values for
   * the &quot;datasets
   *
   * @param template the template
   * @return a value of type 'String'
   */
  protected String templateString(Instance template) {
    
<span class="nc" id="L444">    String result = &quot;&quot;;</span>
<span class="nc bnc" id="L445" title="All 2 branches missed.">    for (int i = 0; i &lt; m_DatasetKeyColumns.length; i++) {</span>
<span class="nc" id="L446">      result += template.toString(m_DatasetKeyColumns[i]) + ' ';</span>
    }
<span class="nc bnc" id="L448" title="All 2 branches missed.">    if (result.startsWith(&quot;weka.classifiers.&quot;)) {</span>
<span class="nc" id="L449">      result = result.substring(&quot;weka.classifiers.&quot;.length());</span>
    }
<span class="nc" id="L451">    return result.trim();</span>
  }

  /**
   * Sets the matrix to use to produce the output.
   * @param matrix the instance to use to produce the output
   * @see ResultMatrix
   */
  public void setResultMatrix(ResultMatrix matrix) {
<span class="nc" id="L460">    m_ResultMatrix = matrix;</span>
<span class="nc" id="L461">  }</span>

  /**
   * Gets the instance that produces the output.
   * @return the instance to produce the output
   */
  public ResultMatrix getResultMatrix() {
<span class="nc" id="L468">    return m_ResultMatrix;</span>
  }

  /**
   * Set whether standard deviations are displayed or not.
   * @param s true if standard deviations are to be displayed
   */
  public void setShowStdDevs(boolean s) {
<span class="nc" id="L476">    m_ShowStdDevs = s;</span>
<span class="nc" id="L477">  }</span>

  /**
   * Returns true if standard deviations have been requested.
   * @return true if standard deviations are to be displayed.
   */
  public boolean getShowStdDevs() {
<span class="nc" id="L484">    return m_ShowStdDevs;</span>
  }
  
  /**
   * Separates the instances into resultsets and by dataset/run.
   *
   * @throws Exception if the TTest parameters have not been set.
   */
  protected void prepareData() throws Exception {

<span class="nc bnc" id="L494" title="All 2 branches missed.">    if (m_Instances == null) {</span>
<span class="nc" id="L495">      throw new Exception(&quot;No instances have been set&quot;);</span>
    }
<span class="nc bnc" id="L497" title="All 2 branches missed.">    if (m_RunColumnSet == -1) {</span>
<span class="nc" id="L498">      m_RunColumn = m_Instances.numAttributes() - 1;</span>
    } else {
<span class="nc" id="L500">      m_RunColumn = m_RunColumnSet;</span>
    }

<span class="nc bnc" id="L503" title="All 2 branches missed.">    if (m_ResultsetKeyColumnsRange == null) {</span>
<span class="nc" id="L504">      throw new Exception(&quot;No result specifier columns have been set&quot;);</span>
    }
<span class="nc" id="L506">    m_ResultsetKeyColumnsRange.setUpper(m_Instances.numAttributes() - 1);</span>
<span class="nc" id="L507">    m_ResultsetKeyColumns = m_ResultsetKeyColumnsRange.getSelection();</span>

<span class="nc bnc" id="L509" title="All 2 branches missed.">    if (m_DatasetKeyColumnsRange == null) {</span>
<span class="nc" id="L510">      throw new Exception(&quot;No dataset specifier columns have been set&quot;);</span>
    }
<span class="nc" id="L512">    m_DatasetKeyColumnsRange.setUpper(m_Instances.numAttributes() - 1);</span>
<span class="nc" id="L513">    m_DatasetKeyColumns = m_DatasetKeyColumnsRange.getSelection();</span>
    
    //  Split the data up into result sets
<span class="nc" id="L516">    m_Resultsets.removeAllElements();  </span>
<span class="nc" id="L517">    m_DatasetSpecifiers.removeAllSpecifiers();</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">    for (int i = 0; i &lt; m_Instances.numInstances(); i++) {</span>
<span class="nc" id="L519">      Instance current = m_Instances.instance(i);</span>
<span class="nc bnc" id="L520" title="All 2 branches missed.">      if (current.isMissing(m_RunColumn)) {</span>
<span class="nc" id="L521">	throw new Exception(&quot;Instance has missing value in run &quot;</span>
<span class="nc" id="L522">			    + &quot;column!\n&quot; + current);</span>
      } 
<span class="nc bnc" id="L524" title="All 2 branches missed.">      for (int j = 0; j &lt; m_ResultsetKeyColumns.length; j++) {</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">	if (current.isMissing(m_ResultsetKeyColumns[j])) {</span>
<span class="nc" id="L526">	  throw new Exception(&quot;Instance has missing value in resultset key &quot;</span>
<span class="nc" id="L527">			      + &quot;column &quot; + (m_ResultsetKeyColumns[j] + 1)</span>
<span class="nc" id="L528">			      + &quot;!\n&quot; + current);</span>
	}
      }
<span class="nc bnc" id="L531" title="All 2 branches missed.">      for (int j = 0; j &lt; m_DatasetKeyColumns.length; j++) {</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">	if (current.isMissing(m_DatasetKeyColumns[j])) {</span>
<span class="nc" id="L533">	  throw new Exception(&quot;Instance has missing value in dataset key &quot;</span>
<span class="nc" id="L534">			      + &quot;column &quot; + (m_DatasetKeyColumns[j] + 1)</span>
<span class="nc" id="L535">			      + &quot;!\n&quot; + current);</span>
	}
      }
<span class="nc" id="L538">      boolean found = false;</span>
<span class="nc bnc" id="L539" title="All 2 branches missed.">      for (int j = 0; j &lt; m_Resultsets.size(); j++) {</span>
<span class="nc" id="L540">	Resultset resultset = (Resultset) m_Resultsets.elementAt(j);</span>
<span class="nc bnc" id="L541" title="All 2 branches missed.">	if (resultset.matchesTemplate(current)) {</span>
<span class="nc" id="L542">	  resultset.add(current);</span>
<span class="nc" id="L543">	  found = true;</span>
<span class="nc" id="L544">	  break;</span>
	}
      }
<span class="nc bnc" id="L547" title="All 2 branches missed.">      if (!found) {</span>
<span class="nc" id="L548">	Resultset resultset = new Resultset(current);</span>
<span class="nc" id="L549">	m_Resultsets.addElement(resultset);</span>
      }

<span class="nc" id="L552">      m_DatasetSpecifiers.add(current);</span>
    }

    // Tell each resultset to sort on the run column
<span class="nc bnc" id="L556" title="All 2 branches missed.">    for (int j = 0; j &lt; m_Resultsets.size(); j++) {</span>
<span class="nc" id="L557">      Resultset resultset = (Resultset) m_Resultsets.elementAt(j);</span>
<span class="nc bnc" id="L558" title="All 2 branches missed.">      if (m_FoldColumn &gt;= 0) {</span>
        // sort on folds first in case they are out of order
<span class="nc" id="L560">        resultset.sort(m_FoldColumn);</span>
      }
<span class="nc" id="L562">      resultset.sort(m_RunColumn);</span>
    }

<span class="nc" id="L565">    m_ResultsetsValid = true;</span>
<span class="nc" id="L566">  }</span>

  /**
   * Gets the number of datasets in the resultsets
   *
   * @return the number of datasets in the resultsets
   */
  public int getNumDatasets() {

<span class="nc bnc" id="L575" title="All 2 branches missed.">    if (!m_ResultsetsValid) {</span>
      try {
<span class="nc" id="L577">	prepareData();</span>
<span class="nc" id="L578">      } catch (Exception ex) {</span>
<span class="nc" id="L579">	ex.printStackTrace();</span>
<span class="nc" id="L580">	return 0;</span>
      }
    }
<span class="nc" id="L583">    return m_DatasetSpecifiers.numSpecifiers();</span>
  }

  /**
   * Gets the number of resultsets in the data.
   *
   * @return the number of resultsets in the data
   */
  public int getNumResultsets() {

<span class="nc bnc" id="L593" title="All 2 branches missed.">    if (!m_ResultsetsValid) {</span>
      try {
<span class="nc" id="L595">  prepareData();</span>
<span class="nc" id="L596">      } catch (Exception ex) {</span>
<span class="nc" id="L597">  ex.printStackTrace();</span>
<span class="nc" id="L598">  return 0;</span>
      }
    }
<span class="nc" id="L601">    return m_Resultsets.size();</span>
  }

  /**
   * Gets a string descriptive of the specified resultset.
   *
   * @param index the index of the resultset
   * @return a descriptive string for the resultset
   */
  public String getResultsetName(int index) {

<span class="nc bnc" id="L612" title="All 2 branches missed.">    if (!m_ResultsetsValid) {</span>
      try {
<span class="nc" id="L614">	prepareData();</span>
<span class="nc" id="L615">      } catch (Exception ex) {</span>
<span class="nc" id="L616">	ex.printStackTrace();</span>
<span class="nc" id="L617">	return null;</span>
      }
    }
<span class="nc" id="L620">    return ((Resultset) m_Resultsets.elementAt(index)).templateString();</span>
  }
  
  /**
   * Checks whether the resultset with the given index shall be displayed.
   * 
   * @param index the index of the resultset to check whether it shall be displayed 
   * @return whether the specified resultset is displayed 
   */
  public boolean displayResultset(int index) {
    boolean       result;
    int           i;
    
<span class="nc" id="L633">    result = true;</span>

<span class="nc bnc" id="L635" title="All 2 branches missed.">    if (m_DisplayedResultsets != null) {</span>
<span class="nc" id="L636">      result = false;</span>
<span class="nc bnc" id="L637" title="All 2 branches missed.">      for (i = 0; i &lt; m_DisplayedResultsets.length; i++) {</span>
<span class="nc bnc" id="L638" title="All 2 branches missed.">        if (m_DisplayedResultsets[i] == index) {</span>
<span class="nc" id="L639">          result = true;</span>
<span class="nc" id="L640">          break;</span>
        }
      }
    }
      
<span class="nc" id="L645">    return result;</span>
  }
  
  /**
   * Computes a paired t-test comparison for a specified dataset between
   * two resultsets.
   *
   * @param datasetSpecifier the dataset specifier
   * @param resultset1Index the index of the first resultset
   * @param resultset2Index the index of the second resultset
   * @param comparisonColumn the column containing values to compare
   * @return the results of the paired comparison
   * @throws Exception if an error occurs
   */
  public PairedStats calculateStatistics(Instance datasetSpecifier,
					 int resultset1Index,
					 int resultset2Index,
					 int comparisonColumn) throws Exception {

<span class="nc bnc" id="L664" title="All 2 branches missed.">    if (m_Instances.attribute(comparisonColumn).type()</span>
	!= Attribute.NUMERIC) {
<span class="nc" id="L666">      throw new Exception(&quot;Comparison column &quot; + (comparisonColumn + 1)</span>
<span class="nc" id="L667">			  + &quot; (&quot;</span>
<span class="nc" id="L668">			  + m_Instances.attribute(comparisonColumn).name()</span>
<span class="nc" id="L669">			  + &quot;) is not numeric&quot;);</span>
    }
<span class="nc bnc" id="L671" title="All 2 branches missed.">    if (!m_ResultsetsValid) {</span>
<span class="nc" id="L672">      prepareData();</span>
    }

<span class="nc" id="L675">    Resultset resultset1 = (Resultset) m_Resultsets.elementAt(resultset1Index);</span>
<span class="nc" id="L676">    Resultset resultset2 = (Resultset) m_Resultsets.elementAt(resultset2Index);</span>
<span class="nc" id="L677">    FastVector dataset1 = resultset1.dataset(datasetSpecifier);</span>
<span class="nc" id="L678">    FastVector dataset2 = resultset2.dataset(datasetSpecifier);</span>
<span class="nc" id="L679">    String datasetName = templateString(datasetSpecifier);</span>
<span class="nc bnc" id="L680" title="All 2 branches missed.">    if (dataset1 == null) {</span>
<span class="nc" id="L681">      throw new Exception(&quot;No results for dataset=&quot; + datasetName</span>
<span class="nc" id="L682">			 + &quot; for resultset=&quot; + resultset1.templateString());</span>
<span class="nc bnc" id="L683" title="All 2 branches missed.">    } else if (dataset2 == null) {</span>
<span class="nc" id="L684">      throw new Exception(&quot;No results for dataset=&quot; + datasetName</span>
<span class="nc" id="L685">			 + &quot; for resultset=&quot; + resultset2.templateString());</span>
<span class="nc bnc" id="L686" title="All 2 branches missed.">    } else if (dataset1.size() != dataset2.size()) {</span>
<span class="nc" id="L687">      throw new Exception(&quot;Results for dataset=&quot; + datasetName</span>
<span class="nc" id="L688">			  + &quot; differ in size for resultset=&quot;</span>
<span class="nc" id="L689">			  + resultset1.templateString()</span>
<span class="nc" id="L690">			  + &quot; and resultset=&quot;</span>
<span class="nc" id="L691">			  + resultset2.templateString()</span>
			  );
    }
    
<span class="nc" id="L695">    PairedStats pairedStats = new PairedStats(m_SignificanceLevel);</span>

<span class="nc bnc" id="L697" title="All 2 branches missed.">    for (int k = 0; k &lt; dataset1.size(); k ++) {</span>
<span class="nc" id="L698">      Instance current1 = (Instance) dataset1.elementAt(k);</span>
<span class="nc" id="L699">      Instance current2 = (Instance) dataset2.elementAt(k);</span>
<span class="nc bnc" id="L700" title="All 2 branches missed.">      if (current1.isMissing(comparisonColumn)) {</span>
<span class="nc" id="L701">	System.err.println(&quot;Instance has missing value in comparison &quot;</span>
<span class="nc" id="L702">			   + &quot;column!\n&quot; + current1);</span>
<span class="nc" id="L703">	continue;</span>
      }
<span class="nc bnc" id="L705" title="All 2 branches missed.">      if (current2.isMissing(comparisonColumn)) {</span>
<span class="nc" id="L706">	System.err.println(&quot;Instance has missing value in comparison &quot;</span>
<span class="nc" id="L707">			   + &quot;column!\n&quot; + current2);</span>
<span class="nc" id="L708">	continue;</span>
      }
<span class="nc bnc" id="L710" title="All 2 branches missed.">      if (current1.value(m_RunColumn) != current2.value(m_RunColumn)) {</span>
<span class="nc" id="L711">	System.err.println(&quot;Run numbers do not match!\n&quot;</span>
<span class="nc" id="L712">			    + current1 + current2);</span>
      }
<span class="nc bnc" id="L714" title="All 2 branches missed.">      if (m_FoldColumn != -1) {</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">	if (current1.value(m_FoldColumn) != current2.value(m_FoldColumn)) {</span>
<span class="nc" id="L716">	  System.err.println(&quot;Fold numbers do not match!\n&quot;</span>
<span class="nc" id="L717">			     + current1 + current2);</span>
	}
      }
<span class="nc" id="L720">      double value1 = current1.value(comparisonColumn);</span>
<span class="nc" id="L721">      double value2 = current2.value(comparisonColumn);</span>
<span class="nc" id="L722">      pairedStats.add(value1, value2);</span>
    }
<span class="nc" id="L724">    pairedStats.calculateDerived();</span>
    //System.err.println(&quot;Differences stats:\n&quot; + pairedStats.differencesStats);
<span class="nc" id="L726">    return pairedStats;</span>

  }
  
  /**
   * Creates a key that maps resultset numbers to their descriptions.
   *
   * @return a value of type 'String'
   */
  public String resultsetKey() {

<span class="nc bnc" id="L737" title="All 2 branches missed.">    if (!m_ResultsetsValid) {</span>
      try {
<span class="nc" id="L739">	prepareData();</span>
<span class="nc" id="L740">      } catch (Exception ex) {</span>
<span class="nc" id="L741">	ex.printStackTrace();</span>
<span class="nc" id="L742">	return ex.getMessage();</span>
      }
    }
<span class="nc" id="L745">    String result = &quot;&quot;;</span>
<span class="nc bnc" id="L746" title="All 2 branches missed.">    for (int j = 0; j &lt; getNumResultsets(); j++) {</span>
<span class="nc" id="L747">      result += &quot;(&quot; + (j + 1) + &quot;) &quot; + getResultsetName(j) + '\n';</span>
    }
<span class="nc" id="L749">    return result + '\n';</span>
  }
  
  /**
   * Creates a &quot;header&quot; string describing the current resultsets.
   *
   * @param comparisonColumn a value of type 'int'
   * @return a value of type 'String'
   */
  public String header(int comparisonColumn) {

<span class="nc bnc" id="L760" title="All 2 branches missed.">    if (!m_ResultsetsValid) {</span>
      try {
<span class="nc" id="L762">	prepareData();</span>
<span class="nc" id="L763">      } catch (Exception ex) {</span>
<span class="nc" id="L764">	ex.printStackTrace();</span>
<span class="nc" id="L765">	return ex.getMessage();</span>
      }
    }
    
<span class="nc" id="L769">    initResultMatrix();</span>
<span class="nc" id="L770">    m_ResultMatrix.addHeader(&quot;Tester&quot;, getClass().getName());</span>
<span class="nc" id="L771">    m_ResultMatrix.addHeader(&quot;Analysing&quot;, m_Instances.attribute(comparisonColumn).name());</span>
<span class="nc" id="L772">    m_ResultMatrix.addHeader(&quot;Datasets&quot;, Integer.toString(getNumDatasets()));</span>
<span class="nc" id="L773">    m_ResultMatrix.addHeader(&quot;Resultsets&quot;, Integer.toString(getNumResultsets()));</span>
<span class="nc" id="L774">    m_ResultMatrix.addHeader(&quot;Confidence&quot;, getSignificanceLevel() + &quot; (two tailed)&quot;);</span>
<span class="nc" id="L775">    m_ResultMatrix.addHeader(&quot;Sorted by&quot;, getSortColumnName());</span>
<span class="nc" id="L776">    m_ResultMatrix.addHeader(&quot;Date&quot;, (new SimpleDateFormat()).format(new Date()));</span>

<span class="nc" id="L778">    return m_ResultMatrix.toStringHeader() + &quot;\n&quot;;</span>
  }

  /**
   * Carries out a comparison between all resultsets, counting the number
   * of datsets where one resultset outperforms the other.
   *
   * @param comparisonColumn the index of the comparison column
   * @param nonSigWin for storing the non-significant wins
   * @return a 2d array where element [i][j] is the number of times resultset
   * j performed significantly better than resultset i.
   * @throws Exception if an error occurs
   */
  public int [][] multiResultsetWins(int comparisonColumn, int [][] nonSigWin)
    throws Exception {

<span class="nc" id="L794">    int numResultsets = getNumResultsets();</span>
<span class="nc" id="L795">    int [][] win = new int [numResultsets][numResultsets];</span>
    //    int [][] nonSigWin = new int [numResultsets][numResultsets];
<span class="nc bnc" id="L797" title="All 2 branches missed.">    for (int i = 0; i &lt; numResultsets; i++) {</span>
<span class="nc bnc" id="L798" title="All 2 branches missed.">      for (int j = i + 1; j &lt; numResultsets; j++) {</span>
<span class="nc" id="L799">	System.err.print(&quot;Comparing (&quot; + (i + 1) + &quot;) with (&quot;</span>
<span class="nc" id="L800">			 + (j + 1) + &quot;)\r&quot;);</span>
<span class="nc" id="L801">	System.err.flush();</span>
<span class="nc bnc" id="L802" title="All 2 branches missed.">	for (int k = 0; k &lt; getNumDatasets(); k++) {</span>
	  try {
<span class="nc" id="L804">	    PairedStats pairedStats = </span>
<span class="nc" id="L805">	      calculateStatistics(m_DatasetSpecifiers.specifier(k), i, j,</span>
<span class="nc" id="L806">				  comparisonColumn);</span>
<span class="nc bnc" id="L807" title="All 2 branches missed.">	    if (pairedStats.differencesSignificance &lt; 0) {</span>
<span class="nc" id="L808">	      win[i][j]++;</span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">	    } else if (pairedStats.differencesSignificance &gt; 0) {</span>
<span class="nc" id="L810">	      win[j][i]++;</span>
	    }

<span class="nc bnc" id="L813" title="All 2 branches missed.">	    if (pairedStats.differencesStats.mean &lt; 0) {</span>
<span class="nc" id="L814">	      nonSigWin[i][j]++;</span>
<span class="nc bnc" id="L815" title="All 2 branches missed.">	    } else if (pairedStats.differencesStats.mean &gt; 0) {</span>
<span class="nc" id="L816">	      nonSigWin[j][i]++;</span>
	    }
<span class="nc" id="L818">	  } catch (Exception ex) {</span>
	    //ex.printStackTrace();
<span class="nc" id="L820">	    System.err.println(ex.getMessage());</span>
	  }
	}
      }
    }
<span class="nc" id="L825">    return win;</span>
  }

  /**
   * clears the content and fills the column and row names according to the
   * given sorting
   */
  protected void initResultMatrix() {
<span class="nc" id="L833">    m_ResultMatrix.setSize(getNumResultsets(), getNumDatasets());</span>
<span class="nc" id="L834">    m_ResultMatrix.setShowStdDev(m_ShowStdDevs);</span>

<span class="nc bnc" id="L836" title="All 2 branches missed.">    for (int i = 0; i &lt; getNumDatasets(); i++)</span>
<span class="nc" id="L837">      m_ResultMatrix.setRowName(i, </span>
<span class="nc" id="L838">          templateString(m_DatasetSpecifiers.specifier(i)));</span>

<span class="nc bnc" id="L840" title="All 2 branches missed.">    for (int j = 0; j &lt; getNumResultsets(); j++) {</span>
<span class="nc" id="L841">      m_ResultMatrix.setColName(j, getResultsetName(j));</span>
<span class="nc bnc" id="L842" title="All 2 branches missed.">      m_ResultMatrix.setColHidden(j, !displayResultset(j));</span>
    }
<span class="nc" id="L844">  }</span>
  
  /**
   * Carries out a comparison between all resultsets, counting the number
   * of datsets where one resultset outperforms the other. The results
   * are summarized in a table.
   *
   * @param comparisonColumn the index of the comparison column
   * @return the results in a string
   * @throws Exception if an error occurs
   */
  public String multiResultsetSummary(int comparisonColumn)
    throws Exception {
    
<span class="nc" id="L858">    int[][] nonSigWin = new int [getNumResultsets()][getNumResultsets()];</span>
<span class="nc" id="L859">    int[][] win = multiResultsetWins(comparisonColumn, nonSigWin);</span>
    
<span class="nc" id="L861">    initResultMatrix();    </span>
<span class="nc" id="L862">    m_ResultMatrix.setSummary(nonSigWin, win);</span>
    
<span class="nc" id="L864">    return m_ResultMatrix.toStringSummary();</span>
  }

  /**
   * returns a ranking of the resultsets
   * 
   * @param comparisonColumn	the column to compare with
   * @return			the ranking
   * @throws Exception		if something goes wrong
   */
  public String multiResultsetRanking(int comparisonColumn)
    throws Exception {
    
<span class="nc" id="L877">    int[][] nonSigWin = new int [getNumResultsets()][getNumResultsets()];</span>
<span class="nc" id="L878">    int[][] win       = multiResultsetWins(comparisonColumn, nonSigWin);</span>
    
<span class="nc" id="L880">    initResultMatrix();    </span>
<span class="nc" id="L881">    m_ResultMatrix.setRanking(win);</span>

<span class="nc" id="L883">    return m_ResultMatrix.toStringRanking();</span>
  }
				    
  /**
   * Creates a comparison table where a base resultset is compared to the
   * other resultsets. Results are presented for every dataset.
   *
   * @param baseResultset the index of the base resultset
   * @param comparisonColumn the index of the column to compare over
   * @return the comparison table string
   * @throws Exception if an error occurs
   */
  public String multiResultsetFull(int baseResultset,
				   int comparisonColumn) throws Exception {

<span class="nc" id="L898">    int maxWidthMean = 2;</span>
<span class="nc" id="L899">    int maxWidthStdDev = 2;</span>
    
<span class="nc" id="L901">    double[] sortValues = new double[getNumDatasets()];</span>
      
    // determine max field width
<span class="nc bnc" id="L904" title="All 2 branches missed.">    for (int i = 0; i &lt; getNumDatasets(); i++) {</span>
<span class="nc" id="L905">      sortValues[i] = Double.POSITIVE_INFINITY;  // sorts skipped cols to end</span>
      
<span class="nc bnc" id="L907" title="All 2 branches missed.">      for (int j = 0; j &lt; getNumResultsets(); j++) {</span>
<span class="nc bnc" id="L908" title="All 2 branches missed.">        if (!displayResultset(j))</span>
<span class="nc" id="L909">          continue;</span>
	try {
<span class="nc" id="L911">	  PairedStats pairedStats = </span>
<span class="nc" id="L912">	    calculateStatistics(m_DatasetSpecifiers.specifier(i), </span>
<span class="nc" id="L913">				baseResultset, j, comparisonColumn);</span>
<span class="nc bnc" id="L914" title="All 2 branches missed.">          if (!Double.isInfinite(pairedStats.yStats.mean) &amp;&amp;</span>
<span class="nc bnc" id="L915" title="All 2 branches missed.">              !Double.isNaN(pairedStats.yStats.mean)) {</span>
<span class="nc" id="L916">            double width = ((Math.log(Math.abs(pairedStats.yStats.mean)) / </span>
<span class="nc" id="L917">                             Math.log(10))+1);</span>
<span class="nc bnc" id="L918" title="All 2 branches missed.">            if (width &gt; maxWidthMean) {</span>
<span class="nc" id="L919">              maxWidthMean = (int)width;</span>
            }
          }

<span class="nc bnc" id="L923" title="All 2 branches missed.">          if (j == baseResultset) {</span>
<span class="nc bnc" id="L924" title="All 2 branches missed.">            if (getSortColumn() != -1)</span>
<span class="nc" id="L925">              sortValues[i] = calculateStatistics(</span>
<span class="nc" id="L926">                                m_DatasetSpecifiers.specifier(i), </span>
<span class="nc" id="L927">                                baseResultset, j, getSortColumn()).xStats.mean;</span>
            else
<span class="nc" id="L929">              sortValues[i] = i;</span>
          }
	  
<span class="nc bnc" id="L932" title="All 2 branches missed.">	  if (m_ShowStdDevs &amp;&amp;</span>
<span class="nc bnc" id="L933" title="All 2 branches missed.">              !Double.isInfinite(pairedStats.yStats.stdDev) &amp;&amp;</span>
<span class="nc bnc" id="L934" title="All 2 branches missed.">              !Double.isNaN(pairedStats.yStats.stdDev)) {</span>
<span class="nc" id="L935">	    double width = ((Math.log(Math.abs(pairedStats.yStats.stdDev)) / </span>
<span class="nc" id="L936">                             Math.log(10))+1);</span>
<span class="nc bnc" id="L937" title="All 2 branches missed.">	    if (width &gt; maxWidthStdDev) {</span>
<span class="nc" id="L938">	      maxWidthStdDev = (int)width;</span>
	    }
	  }
<span class="nc" id="L941">	}  catch (Exception ex) {</span>
	  //ex.printStackTrace();
<span class="nc" id="L943">          System.err.println(ex);</span>
	}
      }
    }

    // sort rows according to sort column
<span class="nc" id="L949">    m_SortOrder = Utils.sort(sortValues);</span>

    // determine column order
<span class="nc" id="L952">    m_ColOrder = new int[getNumResultsets()];</span>
<span class="nc" id="L953">    m_ColOrder[0] = baseResultset;</span>
<span class="nc" id="L954">    int index = 1;</span>
<span class="nc bnc" id="L955" title="All 2 branches missed.">    for (int i = 0; i &lt; getNumResultsets(); i++) {</span>
<span class="nc bnc" id="L956" title="All 2 branches missed.">      if (i == baseResultset)</span>
<span class="nc" id="L957">        continue;</span>
<span class="nc" id="L958">      m_ColOrder[index] = i;</span>
<span class="nc" id="L959">      index++;</span>
    }

    // setup matrix
<span class="nc" id="L963">    initResultMatrix();    </span>
<span class="nc" id="L964">    m_ResultMatrix.setRowOrder(m_SortOrder);</span>
<span class="nc" id="L965">    m_ResultMatrix.setColOrder(m_ColOrder);</span>
<span class="nc" id="L966">    m_ResultMatrix.setMeanWidth(maxWidthMean);</span>
<span class="nc" id="L967">    m_ResultMatrix.setStdDevWidth(maxWidthStdDev);</span>
<span class="nc" id="L968">    m_ResultMatrix.setSignificanceWidth(1);</span>

    // make sure that test base is displayed, even though it might not be
    // selected
<span class="nc bnc" id="L972" title="All 2 branches missed.">    for (int i = 0; i &lt; m_ResultMatrix.getColCount(); i++) {</span>
<span class="nc bnc" id="L973" title="All 2 branches missed.">      if (    (i == baseResultset)</span>
<span class="nc bnc" id="L974" title="All 2 branches missed.">           &amp;&amp; (m_ResultMatrix.getColHidden(i)) ) {</span>
<span class="nc" id="L975">        m_ResultMatrix.setColHidden(i, false);</span>
<span class="nc" id="L976">        System.err.println(&quot;Note: test base was hidden - set visible!&quot;);</span>
      }
    }
    
    // the data
<span class="nc bnc" id="L981" title="All 2 branches missed.">    for (int i = 0; i &lt; getNumDatasets(); i++) {</span>
<span class="nc" id="L982">      m_ResultMatrix.setRowName(i, </span>
<span class="nc" id="L983">          templateString(m_DatasetSpecifiers.specifier(i)));</span>

<span class="nc bnc" id="L985" title="All 2 branches missed.">      for (int j = 0; j &lt; getNumResultsets(); j++) {</span>
        try {
          // calc stats
<span class="nc" id="L988">          PairedStats pairedStats = </span>
<span class="nc" id="L989">            calculateStatistics(m_DatasetSpecifiers.specifier(i), </span>
<span class="nc" id="L990">                baseResultset, j, comparisonColumn);</span>

          // count
<span class="nc" id="L993">          m_ResultMatrix.setCount(i, pairedStats.count);</span>

          // mean
<span class="nc" id="L996">          m_ResultMatrix.setMean(j, i, pairedStats.yStats.mean);</span>
          
          // std dev
<span class="nc" id="L999">          m_ResultMatrix.setStdDev(j, i, pairedStats.yStats.stdDev);</span>

          // significance
<span class="nc bnc" id="L1002" title="All 2 branches missed.">          if (pairedStats.differencesSignificance &lt; 0)</span>
<span class="nc" id="L1003">            m_ResultMatrix.setSignificance(j, i, ResultMatrix.SIGNIFICANCE_WIN);</span>
<span class="nc bnc" id="L1004" title="All 2 branches missed.">          else if (pairedStats.differencesSignificance &gt; 0)</span>
<span class="nc" id="L1005">            m_ResultMatrix.setSignificance(j, i, ResultMatrix.SIGNIFICANCE_LOSS);</span>
          else
<span class="nc" id="L1007">            m_ResultMatrix.setSignificance(j, i, ResultMatrix.SIGNIFICANCE_TIE);</span>
        }
<span class="nc" id="L1009">        catch (Exception e) {</span>
          //e.printStackTrace();
<span class="nc" id="L1011">          System.err.println(e);</span>
        }
      }
    }

    // generate output
<span class="nc" id="L1017">    StringBuffer result = new StringBuffer(1000);</span>
    try {
<span class="nc" id="L1019">      result.append(m_ResultMatrix.toStringMatrix());</span>
    }
<span class="nc" id="L1021">    catch (Exception e) {</span>
<span class="nc" id="L1022">      e.printStackTrace();</span>
    }
    
    // append a key so that we can tell the difference between long
    // scheme+option names
<span class="nc" id="L1027">    result.append(&quot;\n\n&quot; + m_ResultMatrix.toStringKey());</span>

<span class="nc" id="L1029">    return result.toString();</span>
  }

  /**
   * Lists options understood by this object.
   *
   * @return an enumeration of Options.
   */
  public Enumeration listOptions() {
    
<span class="nc" id="L1039">    Vector newVector = new Vector();</span>

<span class="nc" id="L1041">    newVector.addElement(new Option(</span>
<span class="nc" id="L1042">             &quot;\tSpecify list of columns that specify a unique\n&quot;</span>
	      + &quot;\tdataset.\n&quot;
	      + &quot;\tFirst and last are valid indexes. (default none)&quot;,
<span class="nc" id="L1045">              &quot;D&quot;, 1, &quot;-D &lt;index,index2-index4,...&gt;&quot;));</span>
<span class="nc" id="L1046">    newVector.addElement(new Option(</span>
<span class="nc" id="L1047">	      &quot;\tSet the index of the column containing the run number&quot;,</span>
<span class="nc" id="L1048">              &quot;R&quot;, 1, &quot;-R &lt;index&gt;&quot;));</span>
<span class="nc" id="L1049">    newVector.addElement(new Option(</span>
<span class="nc" id="L1050">	      &quot;\tSet the index of the column containing the fold number&quot;,</span>
<span class="nc" id="L1051">              &quot;F&quot;, 1, &quot;-F &lt;index&gt;&quot;));</span>
<span class="nc" id="L1052">    newVector.addElement(new Option(</span>
<span class="nc" id="L1053">              &quot;\tSpecify list of columns that specify a unique\n&quot;</span>
	      + &quot;\t'result generator' (eg: classifier name and options).\n&quot;
	      + &quot;\tFirst and last are valid indexes. (default none)&quot;,
<span class="nc" id="L1056">              &quot;G&quot;, 1, &quot;-G &lt;index1,index2-index4,...&gt;&quot;));</span>
<span class="nc" id="L1057">    newVector.addElement(new Option(</span>
<span class="nc" id="L1058">	      &quot;\tSet the significance level for comparisons (default 0.05)&quot;,</span>
<span class="nc" id="L1059">              &quot;S&quot;, 1, &quot;-S &lt;significance level&gt;&quot;));</span>
<span class="nc" id="L1060">    newVector.addElement(new Option(</span>
<span class="nc" id="L1061">	      &quot;\tShow standard deviations&quot;,</span>
<span class="nc" id="L1062">              &quot;V&quot;, 0, &quot;-V&quot;));</span>
<span class="nc" id="L1063">    newVector.addElement(new Option(</span>
<span class="nc" id="L1064">	      &quot;\tProduce table comparisons in Latex table format&quot;,</span>
<span class="nc" id="L1065">              &quot;L&quot;, 0, &quot;-L&quot;));</span>
<span class="nc" id="L1066">    newVector.addElement(new Option(</span>
<span class="nc" id="L1067">         &quot;\tProduce table comparisons in CSV table format&quot;,</span>
<span class="nc" id="L1068">         &quot;csv&quot;, 0, &quot;-csv&quot;));</span>
<span class="nc" id="L1069">    newVector.addElement(new Option(</span>
<span class="nc" id="L1070">         &quot;\tProduce table comparisons in HTML table format&quot;,</span>
<span class="nc" id="L1071">         &quot;html&quot;, 0, &quot;-html&quot;));</span>
<span class="nc" id="L1072">    newVector.addElement(new Option(</span>
<span class="nc" id="L1073">         &quot;\tProduce table comparisons with only the significance values&quot;,</span>
<span class="nc" id="L1074">         &quot;significance&quot;, 0, &quot;-significance&quot;));</span>
<span class="nc" id="L1075">    newVector.addElement(new Option(</span>
<span class="nc" id="L1076">         &quot;\tProduce table comparisons output suitable for GNUPlot&quot;,</span>
<span class="nc" id="L1077">         &quot;gnuplot&quot;, 0, &quot;-gnuplot&quot;));</span>

<span class="nc" id="L1079">    return newVector.elements();</span>
  }

  /**
   * Parses a given list of options. &lt;p/&gt;
   *
   &lt;!-- options-start --&gt;
   * Valid options are: &lt;p/&gt;
   * 
   * &lt;pre&gt; -D &amp;lt;index,index2-index4,...&amp;gt;
   *  Specify list of columns that specify a unique
   *  dataset.
   *  First and last are valid indexes. (default none)&lt;/pre&gt;
   * 
   * &lt;pre&gt; -R &amp;lt;index&amp;gt;
   *  Set the index of the column containing the run number&lt;/pre&gt;
   * 
   * &lt;pre&gt; -F &amp;lt;index&amp;gt;
   *  Set the index of the column containing the fold number&lt;/pre&gt;
   * 
   * &lt;pre&gt; -G &amp;lt;index1,index2-index4,...&amp;gt;
   *  Specify list of columns that specify a unique
   *  'result generator' (eg: classifier name and options).
   *  First and last are valid indexes. (default none)&lt;/pre&gt;
   * 
   * &lt;pre&gt; -S &amp;lt;significance level&amp;gt;
   *  Set the significance level for comparisons (default 0.05)&lt;/pre&gt;
   * 
   * &lt;pre&gt; -V
   *  Show standard deviations&lt;/pre&gt;
   * 
   * &lt;pre&gt; -L
   *  Produce table comparisons in Latex table format&lt;/pre&gt;
   * 
   * &lt;pre&gt; -csv
   *  Produce table comparisons in CSV table format&lt;/pre&gt;
   * 
   * &lt;pre&gt; -html
   *  Produce table comparisons in HTML table format&lt;/pre&gt;
   * 
   * &lt;pre&gt; -significance
   *  Produce table comparisons with only the significance values&lt;/pre&gt;
   * 
   * &lt;pre&gt; -gnuplot
   *  Produce table comparisons output suitable for GNUPlot&lt;/pre&gt;
   * 
   &lt;!-- options-end --&gt;
   *
   * @param options an array containing options to set.
   * @throws Exception if invalid options are given
   */
  public void setOptions(String[] options) throws Exception {

<span class="nc" id="L1132">    setShowStdDevs(Utils.getFlag('V', options));</span>
<span class="nc bnc" id="L1133" title="All 2 branches missed.">    if (Utils.getFlag('L', options))</span>
<span class="nc" id="L1134">      setResultMatrix(new ResultMatrixLatex());</span>
<span class="nc bnc" id="L1135" title="All 2 branches missed.">    if (Utils.getFlag(&quot;csv&quot;, options))</span>
<span class="nc" id="L1136">      setResultMatrix(new ResultMatrixCSV());</span>
<span class="nc bnc" id="L1137" title="All 2 branches missed.">    if (Utils.getFlag(&quot;html&quot;, options))</span>
<span class="nc" id="L1138">      setResultMatrix(new ResultMatrixHTML());</span>
<span class="nc bnc" id="L1139" title="All 2 branches missed.">    if (Utils.getFlag(&quot;significance&quot;, options))</span>
<span class="nc" id="L1140">      setResultMatrix(new ResultMatrixSignificance());</span>

<span class="nc" id="L1142">    String datasetList = Utils.getOption('D', options);</span>
<span class="nc" id="L1143">    Range datasetRange = new Range();</span>
<span class="nc bnc" id="L1144" title="All 2 branches missed.">    if (datasetList.length() != 0) {</span>
<span class="nc" id="L1145">      datasetRange.setRanges(datasetList);</span>
    }
<span class="nc" id="L1147">    setDatasetKeyColumns(datasetRange);</span>

<span class="nc" id="L1149">    String indexStr = Utils.getOption('R', options);</span>
<span class="nc bnc" id="L1150" title="All 2 branches missed.">    if (indexStr.length() != 0) {</span>
<span class="nc bnc" id="L1151" title="All 2 branches missed.">      if (indexStr.equals(&quot;first&quot;)) {</span>
<span class="nc" id="L1152">	setRunColumn(0);</span>
<span class="nc bnc" id="L1153" title="All 2 branches missed.">      } else if (indexStr.equals(&quot;last&quot;)) {</span>
<span class="nc" id="L1154">	setRunColumn(-1);</span>
      } else {
<span class="nc" id="L1156">	setRunColumn(Integer.parseInt(indexStr) - 1);</span>
      }    
    } else {
<span class="nc" id="L1159">      setRunColumn(-1);</span>
    }

<span class="nc" id="L1162">    String foldStr = Utils.getOption('F', options);</span>
<span class="nc bnc" id="L1163" title="All 2 branches missed.">    if (foldStr.length() != 0) {</span>
<span class="nc" id="L1164">      setFoldColumn(Integer.parseInt(foldStr) - 1);</span>
    } else {
<span class="nc" id="L1166">      setFoldColumn(-1);</span>
    }

<span class="nc" id="L1169">    String sigStr = Utils.getOption('S', options);</span>
<span class="nc bnc" id="L1170" title="All 2 branches missed.">    if (sigStr.length() != 0) {</span>
<span class="nc" id="L1171">      setSignificanceLevel((new Double(sigStr)).doubleValue());</span>
    } else {
<span class="nc" id="L1173">      setSignificanceLevel(0.05);</span>
    }
    
<span class="nc" id="L1176">    String resultsetList = Utils.getOption('G', options);</span>
<span class="nc" id="L1177">    Range generatorRange = new Range();</span>
<span class="nc bnc" id="L1178" title="All 2 branches missed.">    if (resultsetList.length() != 0) {</span>
<span class="nc" id="L1179">      generatorRange.setRanges(resultsetList);</span>
    }
<span class="nc" id="L1181">    setResultsetKeyColumns(generatorRange);</span>
<span class="nc" id="L1182">  }</span>
  
  /**
   * Gets current settings of the PairedTTester.
   *
   * @return an array of strings containing current options.
   */
  public String[] getOptions() {

<span class="nc" id="L1191">    String [] options = new String [11];</span>
<span class="nc" id="L1192">    int current = 0;</span>

<span class="nc bnc" id="L1194" title="All 2 branches missed.">    if (!getResultsetKeyColumns().getRanges().equals(&quot;&quot;)) {</span>
<span class="nc" id="L1195">      options[current++] = &quot;-G&quot;;</span>
<span class="nc" id="L1196">      options[current++] = getResultsetKeyColumns().getRanges();</span>
    }
<span class="nc bnc" id="L1198" title="All 2 branches missed.">    if (!getDatasetKeyColumns().getRanges().equals(&quot;&quot;)) {</span>
<span class="nc" id="L1199">      options[current++] = &quot;-D&quot;;</span>
<span class="nc" id="L1200">      options[current++] = getDatasetKeyColumns().getRanges();</span>
    }
<span class="nc" id="L1202">    options[current++] = &quot;-R&quot;;</span>
<span class="nc" id="L1203">    options[current++] = &quot;&quot; + (getRunColumn() + 1);</span>
<span class="nc" id="L1204">    options[current++] = &quot;-S&quot;;</span>
<span class="nc" id="L1205">    options[current++] = &quot;&quot; + getSignificanceLevel();</span>
    
<span class="nc bnc" id="L1207" title="All 2 branches missed.">    if (getShowStdDevs()) {</span>
<span class="nc" id="L1208">      options[current++] = &quot;-V&quot;;</span>
    }

<span class="nc bnc" id="L1211" title="All 2 branches missed.">    if (getResultMatrix() instanceof ResultMatrixLatex)</span>
<span class="nc" id="L1212">      options[current++] = &quot;-L&quot;;</span>

<span class="nc bnc" id="L1214" title="All 2 branches missed.">    if (getResultMatrix() instanceof ResultMatrixCSV)</span>
<span class="nc" id="L1215">      options[current++] = &quot;-csv&quot;;</span>
   
<span class="nc bnc" id="L1217" title="All 2 branches missed.">    if (getResultMatrix() instanceof ResultMatrixHTML)</span>
<span class="nc" id="L1218">      options[current++] = &quot;-html&quot;;</span>
   
<span class="nc bnc" id="L1220" title="All 2 branches missed.">    if (getResultMatrix() instanceof ResultMatrixSignificance)</span>
<span class="nc" id="L1221">      options[current++] = &quot;-significance&quot;;</span>
   
<span class="nc bnc" id="L1223" title="All 2 branches missed.">    while (current &lt; options.length) {</span>
<span class="nc" id="L1224">      options[current++] = &quot;&quot;;</span>
    }
<span class="nc" id="L1226">    return options;</span>
  }

  /**
   * Get the value of ResultsetKeyColumns.
   *
   * @return Value of ResultsetKeyColumns.
   */
  public Range getResultsetKeyColumns() {
    
<span class="nc" id="L1236">    return m_ResultsetKeyColumnsRange;</span>
  }
  
  /**
   * Set the value of ResultsetKeyColumns.
   *
   * @param newResultsetKeyColumns Value to assign to ResultsetKeyColumns.
   */
  public void setResultsetKeyColumns(Range newResultsetKeyColumns) {
    
<span class="nc" id="L1246">    m_ResultsetKeyColumnsRange = newResultsetKeyColumns;</span>
<span class="nc" id="L1247">    m_ResultsetsValid = false;</span>
<span class="nc" id="L1248">  }</span>
  
  /**
   * Gets the indices of the the datasets that are displayed (if &lt;code&gt;null&lt;/code&gt;
   * then all are displayed). The base is always displayed.
   * 
   * @return the indices of the datasets to display
   */
  public int[] getDisplayedResultsets() {
<span class="nc" id="L1257">    return m_DisplayedResultsets;</span>
  }
  
  /**
   * Sets the indicies of the datasets to display (&lt;code&gt;null&lt;/code&gt; means all).
   * The base is always displayed.
   * 
   * @param cols the indices of the datasets to display
   */
  public void setDisplayedResultsets(int[] cols) {
<span class="nc" id="L1267">    m_DisplayedResultsets = cols;</span>
<span class="nc" id="L1268">  }</span>
  
  /**
   * Get the value of SignificanceLevel.
   *
   * @return Value of SignificanceLevel.
   */
  public double getSignificanceLevel() {
    
<span class="nc" id="L1277">    return m_SignificanceLevel;</span>
  }
  
  /**
   * Set the value of SignificanceLevel.
   *
   * @param newSignificanceLevel Value to assign to SignificanceLevel.
   */
  public void setSignificanceLevel(double newSignificanceLevel) {
    
<span class="nc" id="L1287">    m_SignificanceLevel = newSignificanceLevel;</span>
<span class="nc" id="L1288">  }</span>

  /**
   * Get the value of DatasetKeyColumns.
   *
   * @return Value of DatasetKeyColumns.
   */
  public Range getDatasetKeyColumns() {
    
<span class="nc" id="L1297">    return m_DatasetKeyColumnsRange;</span>
  }
  
  /**
   * Set the value of DatasetKeyColumns.
   *
   * @param newDatasetKeyColumns Value to assign to DatasetKeyColumns.
   */
  public void setDatasetKeyColumns(Range newDatasetKeyColumns) {
    
<span class="nc" id="L1307">    m_DatasetKeyColumnsRange = newDatasetKeyColumns;</span>
<span class="nc" id="L1308">    m_ResultsetsValid = false;</span>
<span class="nc" id="L1309">  }</span>
  
  /**
   * Get the value of RunColumn.
   *
   * @return Value of RunColumn.
   */
  public int getRunColumn() {
    
<span class="nc" id="L1318">    return m_RunColumnSet;</span>
  }
  
  /**
   * Set the value of RunColumn.
   *
   * @param newRunColumn Value to assign to RunColumn.
   */
  public void setRunColumn(int newRunColumn) {
    
<span class="nc" id="L1328">    m_RunColumnSet = newRunColumn;</span>
<span class="nc" id="L1329">    m_ResultsetsValid = false;</span>
<span class="nc" id="L1330">  }</span>

  /**
   * Get the value of FoldColumn.
   *
   * @return Value of FoldColumn.
   */
  public int getFoldColumn() {
    
<span class="nc" id="L1339">    return m_FoldColumn;</span>
  }
  
  /**
   * Set the value of FoldColumn.
   *
   * @param newFoldColumn Value to assign to FoldColumn.
   */
  public void setFoldColumn(int newFoldColumn) {
    
<span class="nc" id="L1349">    m_FoldColumn = newFoldColumn;</span>
<span class="nc" id="L1350">    m_ResultsetsValid = false;</span>
<span class="nc" id="L1351">  }</span>

  /**
   * Returns the name of the column to sort on.
   *
   * @return the name of the column to sort on.
   */
  public String getSortColumnName() {
<span class="nc bnc" id="L1359" title="All 2 branches missed.">    if (getSortColumn() == -1)</span>
<span class="nc" id="L1360">      return &quot;-&quot;;</span>
    else
<span class="nc" id="L1362">      return m_Instances.attribute(getSortColumn()).name();</span>
  }

  /**
   * Returns the column to sort on, -1 means the default sorting.
   *
   * @return the column to sort on.
   */
  public int getSortColumn() {
<span class="nc" id="L1371">    return m_SortColumn;</span>
  }
  
  /**
   * Set the column to sort on, -1 means the default sorting.
   *
   * @param newSortColumn the new sort column.
   */
  public void setSortColumn(int newSortColumn) {
<span class="nc bnc" id="L1380" title="All 2 branches missed.">    if (newSortColumn &gt;= -1)</span>
<span class="nc" id="L1381">      m_SortColumn = newSortColumn;</span>
<span class="nc" id="L1382">  }</span>
  
  /**
   * Get the value of Instances.
   *
   * @return Value of Instances.
   */
  public Instances getInstances() {
    
<span class="nc" id="L1391">    return m_Instances;</span>
  }
  
  /**
   * Set the value of Instances.
   *
   * @param newInstances Value to assign to Instances.
   */
  public void setInstances(Instances newInstances) {
    
<span class="nc" id="L1401">    m_Instances = newInstances;</span>
<span class="nc" id="L1402">    m_ResultsetsValid = false;</span>
<span class="nc" id="L1403">  }</span>

  /**
   * retrieves all the settings from the given Tester
   *
   * @param tester      the Tester to get the settings from
   */
  public void assign(Tester tester) {
<span class="nc" id="L1411">    setInstances(tester.getInstances());</span>
<span class="nc" id="L1412">    setResultMatrix(tester.getResultMatrix());</span>
<span class="nc" id="L1413">    setShowStdDevs(tester.getShowStdDevs());</span>
<span class="nc" id="L1414">    setResultsetKeyColumns(tester.getResultsetKeyColumns());</span>
<span class="nc" id="L1415">    setDisplayedResultsets(tester.getDisplayedResultsets());</span>
<span class="nc" id="L1416">    setSignificanceLevel(tester.getSignificanceLevel());</span>
<span class="nc" id="L1417">    setDatasetKeyColumns(tester.getDatasetKeyColumns());</span>
<span class="nc" id="L1418">    setRunColumn(tester.getRunColumn());</span>
<span class="nc" id="L1419">    setFoldColumn(tester.getFoldColumn());</span>
<span class="nc" id="L1420">    setSortColumn(tester.getSortColumn());</span>
<span class="nc" id="L1421">  }</span>

  /**
   * returns a string that is displayed as tooltip on the &quot;perform test&quot;
   * button in the experimenter
   * 
   * @return	the tool tip
   */
  public String getToolTipText() {
<span class="nc" id="L1430">    return &quot;Performs test using t-test statistic&quot;;</span>
  }

  /**
   * returns the name of the tester
   * 
   * @return	the display name
   */
  public String getDisplayName() {
<span class="nc" id="L1439">    return &quot;Paired T-Tester&quot;;</span>
  }
  
  /**
   * Returns the revision string.
   * 
   * @return		the revision
   */
  public String getRevision() {
<span class="nc" id="L1448">    return RevisionUtils.extract(&quot;$Revision: 6431 $&quot;);</span>
  }
  
  /**
   * Test the class from the command line.
   *
   * @param args contains options for the instance ttests
   */
  public static void main(String args[]) {

    try {
<span class="nc" id="L1459">      PairedTTester tt = new PairedTTester();</span>
<span class="nc" id="L1460">      String datasetName = Utils.getOption('t', args);</span>
<span class="nc" id="L1461">      String compareColStr = Utils.getOption('c', args);</span>
<span class="nc" id="L1462">      String baseColStr = Utils.getOption('b', args);</span>
<span class="nc" id="L1463">      boolean summaryOnly = Utils.getFlag('s', args);</span>
<span class="nc" id="L1464">      boolean rankingOnly = Utils.getFlag('r', args);</span>
      try {
<span class="nc bnc" id="L1466" title="All 2 branches missed.">	if ((datasetName.length() == 0)</span>
<span class="nc bnc" id="L1467" title="All 2 branches missed.">	    || (compareColStr.length() == 0)) {</span>
<span class="nc" id="L1468">	  throw new Exception(&quot;-t and -c options are required&quot;);</span>
	}
<span class="nc" id="L1470">	tt.setOptions(args);</span>
<span class="nc" id="L1471">	Utils.checkForRemainingOptions(args);</span>
<span class="nc" id="L1472">      } catch (Exception ex) {</span>
<span class="nc" id="L1473">	String result = &quot;&quot;;</span>
<span class="nc" id="L1474">	Enumeration enu = tt.listOptions();</span>
<span class="nc bnc" id="L1475" title="All 2 branches missed.">	while (enu.hasMoreElements()) {</span>
<span class="nc" id="L1476">	  Option option = (Option) enu.nextElement();</span>
<span class="nc" id="L1477">	  result += option.synopsis() + '\n'</span>
<span class="nc" id="L1478">	    + option.description() + '\n';</span>
	}
<span class="nc" id="L1480">	throw new Exception(</span>
<span class="nc" id="L1481">	      &quot;Usage:\n\n&quot;</span>
	      + &quot;-t &lt;file&gt;\n&quot;
	      + &quot;\tSet the dataset containing data to evaluate\n&quot;
	      + &quot;-b &lt;index&gt;\n&quot;
	      + &quot;\tSet the resultset to base comparisons against (optional)\n&quot;
	      + &quot;-c &lt;index&gt;\n&quot;
	      + &quot;\tSet the column to perform a comparison on\n&quot;
	      + &quot;-s\n&quot;
	      + &quot;\tSummarize wins over all resultset pairs\n\n&quot;
	      + &quot;-r\n&quot;
	      + &quot;\tGenerate a resultset ranking\n\n&quot;
<span class="nc" id="L1492">	      + result);</span>
      }
<span class="nc" id="L1494">      Instances data = new Instances(new BufferedReader(</span>
<span class="nc" id="L1495">				  new FileReader(datasetName)));</span>
<span class="nc" id="L1496">      tt.setInstances(data);</span>
      //      tt.prepareData();
<span class="nc" id="L1498">      int compareCol = Integer.parseInt(compareColStr) - 1;</span>
<span class="nc" id="L1499">      System.out.println(tt.header(compareCol));</span>
<span class="nc bnc" id="L1500" title="All 2 branches missed.">      if (rankingOnly) {</span>
<span class="nc" id="L1501">	System.out.println(tt.multiResultsetRanking(compareCol));</span>
<span class="nc bnc" id="L1502" title="All 2 branches missed.">      } else if (summaryOnly) {</span>
<span class="nc" id="L1503">	System.out.println(tt.multiResultsetSummary(compareCol));</span>
      } else {
<span class="nc" id="L1505">	System.out.println(tt.resultsetKey());</span>
<span class="nc bnc" id="L1506" title="All 2 branches missed.">	if (baseColStr.length() == 0) {</span>
<span class="nc bnc" id="L1507" title="All 2 branches missed.">	  for (int i = 0; i &lt; tt.getNumResultsets(); i++) {</span>
<span class="nc bnc" id="L1508" title="All 2 branches missed.">            if (!tt.displayResultset(i))</span>
<span class="nc" id="L1509">              continue;</span>
<span class="nc" id="L1510">	    System.out.println(tt.multiResultsetFull(i, compareCol));</span>
	  }
	} else {
<span class="nc" id="L1513">	  int baseCol = Integer.parseInt(baseColStr) - 1;</span>
<span class="nc" id="L1514">	  System.out.println(tt.multiResultsetFull(baseCol, compareCol));</span>
	}
      }
<span class="nc" id="L1517">    } catch(Exception e) {</span>
<span class="nc" id="L1518">      e.printStackTrace();</span>
<span class="nc" id="L1519">      System.err.println(e.getMessage());</span>
    }
<span class="nc" id="L1521">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>