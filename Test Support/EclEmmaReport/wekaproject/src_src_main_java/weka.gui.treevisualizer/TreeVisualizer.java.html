<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>TreeVisualizer.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.gui.treevisualizer</a> &gt; <span class="el_source">TreeVisualizer.java</span></div><h1>TreeVisualizer.java</h1><pre class="source lang-java linenums">/*
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 *    TreeVisualizer.java
 *    Copyright (C) 1999 University of Waikato, Hamilton, New Zealand
 *
 */

package weka.gui.treevisualizer;

import weka.core.Instances;
import weka.core.Utils;
import weka.gui.visualize.PrintablePanel;
import weka.gui.visualize.VisualizePanel;
import weka.gui.visualize.VisualizeUtils;

import java.awt.Color;
import java.awt.Container;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.FontMetrics;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.ItemEvent;
import java.awt.event.ItemListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.awt.event.MouseMotionListener;
import java.io.FileReader;
import java.io.IOException;
import java.io.StringReader;
import java.util.Properties;

import javax.swing.BorderFactory;
import javax.swing.ButtonGroup;
import javax.swing.JDialog;
import javax.swing.JFrame;
import javax.swing.JMenu;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPopupMenu;
import javax.swing.JRadioButton;
import javax.swing.JRadioButtonMenuItem;
import javax.swing.JTextField;
import javax.swing.Timer;

/**
 * Class for displaying a Node structure in Swing. &lt;p&gt;
 *
 * To work this class simply create an instance of it.&lt;p&gt;
 *
 * Assign it to a window or other such object.&lt;p&gt;
 *
 * Resize it to the desired size.&lt;p&gt;
 *
 *
 * When using the Displayer hold the left mouse button to drag the 
 * tree around. &lt;p&gt;
 *
 * Click the left mouse button with ctrl to shrink the size of the tree 
 * by half. &lt;p&gt;
 *
 * Click and drag with the left mouse button and shift to draw a box,
 * when the left mouse button is released the contents of the box 
 * will be magnified 
 * to fill the screen. &lt;p&gt; &lt;p&gt;
 *
 * Click the right mouse button to bring up a menu. &lt;p&gt;
 * Most options are self explanatory.&lt;p&gt;
 *
 * Select Auto Scale to set the tree to it's optimal display size.
 *
 * @author Malcolm Ware (mfw4@cs.waikato.ac.nz)
 * @version $Revision: 7386 $
 */
public class TreeVisualizer
  extends PrintablePanel
  implements MouseMotionListener, MouseListener, ActionListener, ItemListener {

  /** for serialization */
  private static final long serialVersionUID = -8668637962504080749L;

  /** the props file. */
  public final static String PROPERTIES_FILE = &quot;weka/gui/treevisualizer/TreeVisualizer.props&quot;;
  
  /** The placement algorithm for the Node structure. */
  private NodePlace m_placer;  

  /** The top Node. */
  private Node m_topNode;
  
  /** The postion of the view relative to the tree. */
  private Dimension m_viewPos;        

  /** The size of the tree in pixels. */
  private Dimension m_viewSize;      
  
  /** The font used to display the tree. */
  private Font m_currentFont;        

  /** The size information for the current font. */
  private FontMetrics m_fontSize;    

  /** The number of Nodes in the tree. */
  private int m_numNodes;

  /** The number of levels in the tree. */
  private int m_numLevels;     

  /** An array with the Nodes sorted into it and display information 
   * about the Nodes. */
  private NodeInfo[] m_nodes;

  /** An array with the Edges sorted into it and display information 
   * about the Edges. */
  private EdgeInfo[] m_edges;
                     
  /** A timer to keep the frame rate constant. */
  private Timer m_frameLimiter;      
                         
  /** Describes the action the user is performing. */
  private int m_mouseState;           

  /** A variable used to tag the start pos of a user action. */
  private Dimension m_oldMousePos;

  /** A variable used to tag the most current point of a user action. */
  private Dimension m_newMousePos;

  /** A variable used to determine for the clicked method if any other 
   * mouse state has already taken place. */
  private boolean m_clickAvailable;

  /** A variable used to remember the desired view pos. */
  private Dimension m_nViewPos;     

  /** A variable used to remember the desired tree size. */
  private Dimension m_nViewSize;       

  /** The number of frames left to calculate. */
  private int m_scaling;         

  /** A right (or middle) click popup menu. */
  private JPopupMenu m_winMenu;

  /** An option on the win_menu */
  private JMenuItem m_topN;

  /** An option on the win_menu*/
  private JMenuItem m_fitToScreen;

  /** An option on the win_menu */
  private JMenuItem m_autoScale;

  /** A sub group on the win_menu */
  private JMenu m_selectFont;

  /** A grouping for the font choices */
  private ButtonGroup m_selectFontGroup;

  /** A font choice. */
  private JRadioButtonMenuItem m_size24;

  /** A font choice. */
  private JRadioButtonMenuItem m_size22;

  /** A font choice. */
  private JRadioButtonMenuItem m_size20;

  /** A font choice. */
  private JRadioButtonMenuItem m_size18;

  /** A font choice. */
  private JRadioButtonMenuItem m_size16;

  /** A font choice. */
  private JRadioButtonMenuItem m_size14;

  /** A font choice. */
  private JRadioButtonMenuItem m_size12;

  /** A font choice. */
  private JRadioButtonMenuItem m_size10;

  /** A font choice. */
  private JRadioButtonMenuItem m_size8;

  /** A font choice. */
  private JRadioButtonMenuItem m_size6;

  /** A font choice. */
  private JRadioButtonMenuItem m_size4;

  /** A font choice. */
  private JRadioButtonMenuItem m_size2;

  /** A font choice. */
  private JRadioButtonMenuItem m_size1;

  /** An option on the win menu. */
  private JMenuItem m_accept;

  /** A right or middle click popup menu for nodes. */
  private JPopupMenu m_nodeMenu;

  /** A visualize choice for the node, may not be available. */
  private JMenuItem m_visualise;

  /** 
   * An add children to Node choice, This is only available if the tree
   * display has a treedisplay listerner added to it.
   */
  private JMenuItem m_addChildren;

  /** Similar to add children but now it removes children. */
  private JMenuItem m_remChildren;

  /** Use this to have J48 classify this node. */
  private JMenuItem m_classifyChild;
  
  /** Use this to dump the instances from this node to the vis panel. */
  private JMenuItem m_sendInstances;

  /** The subscript for the currently selected node (this is an internal 
   * thing, so the user is unaware of this). */
  private int m_focusNode;

  /**
   * The Node the user is currently focused on , this is similar to 
   * focus node except that it is used by other 
   * classes rather than this one.
   */
  private int m_highlightNode;
  
  /* A pointer to this tree's classifier if a classifier is using it. */
  //private UserClassifier classer;
  private TreeDisplayListener m_listener;

  private JTextField m_searchString;
  private JDialog m_searchWin;
  private JRadioButton m_caseSen;

  /** the font color. */
<span class="nc" id="L260">  protected Color m_FontColor = null;</span>

  /** the background color. */
<span class="nc" id="L263">  protected Color m_BackgroundColor = null;</span>

  /** the node color. */
<span class="nc" id="L266">  protected Color m_NodeColor = null;</span>

  /** the line color. */
<span class="nc" id="L269">  protected Color m_LineColor = null;</span>

  /** the color of the zoombox. */
<span class="nc" id="L272">  protected Color m_ZoomBoxColor = null;</span>

  /** the XOR color of the zoombox. */
<span class="nc" id="L275">  protected Color m_ZoomBoxXORColor = null;</span>
  
  /** whether to show the border or not. */
<span class="nc" id="L278">  protected boolean m_ShowBorder = true;</span>
  
  ///////////////////

  //this is the event fireing stuff


  /**
   * Constructs Displayer to display a tree provided in a dot format.
   * Uses the NodePlacer to place the Nodes.
   * @param tdl listener 
   * @param dot string containing the dot representation of the tree to
   * display
   * @param p the algorithm to be used to position the nodes.
   */
  public TreeVisualizer(TreeDisplayListener tdl, String dot, NodePlace p) {
<span class="nc" id="L294">    super();</span>

<span class="nc" id="L296">    initialize();</span>
    
    //generate the node structure in here
<span class="nc bnc" id="L299" title="All 2 branches missed.">    if (m_ShowBorder)</span>
<span class="nc" id="L300">      setBorder(BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;TreeVisualizer_BorderFactoryCreateTitledBorder_Text_First&quot;))); </span>
<span class="nc" id="L301">    m_listener = tdl;</span>

<span class="nc" id="L303">    TreeBuild builder = new TreeBuild();</span>
    
<span class="nc" id="L305">    Node n = null;</span>
<span class="nc" id="L306">    NodePlace arrange = new PlaceNode2();</span>
<span class="nc" id="L307">    n = builder.create(new StringReader(dot));</span>
    //    System.out.println(n.getCount(n, 0));
    //if the size needs to be automatically alocated I will do it here
<span class="nc" id="L310">    m_highlightNode = 5;</span>
<span class="nc" id="L311">    m_topNode = n;</span>
<span class="nc" id="L312">    m_placer = p;</span>
<span class="nc" id="L313">    m_placer.place(m_topNode);</span>
<span class="nc" id="L314">    m_viewPos = new Dimension(0, 0);    //will be adjusted </span>
<span class="nc" id="L315">    m_viewSize = new Dimension(800, 600);   //I allocate this now so that</span>
    //the tree will be visible
    //when the panel is enlarged

<span class="nc" id="L319">    m_nViewPos = new Dimension(0, 0);            </span>
<span class="nc" id="L320">    m_nViewSize = new Dimension(800, 600);          </span>
                                      
<span class="nc" id="L322">    m_scaling = 0;</span>
    
<span class="nc" id="L324">    m_numNodes = m_topNode.getCount(m_topNode,0);   //note the second </span>
    //argument must be a zero, this is a 
    //recursive function

<span class="nc" id="L328">    m_numLevels = m_topNode.getHeight(m_topNode,0);</span>
  
<span class="nc" id="L330">    m_nodes = new NodeInfo[m_numNodes];</span>
<span class="nc" id="L331">    m_edges = new EdgeInfo[m_numNodes-1];</span>
    

<span class="nc" id="L334">    arrayFill(m_topNode, m_nodes, m_edges);</span>
    
<span class="nc" id="L336">    changeFontSize(12);</span>

<span class="nc" id="L338">    m_mouseState = 0;</span>
<span class="nc" id="L339">    m_oldMousePos = new Dimension(0, 0);</span>
<span class="nc" id="L340">    m_newMousePos = new Dimension(0, 0);</span>
<span class="nc" id="L341">    m_frameLimiter = new Timer(120, this);</span>



<span class="nc" id="L345">    m_winMenu = new JPopupMenu();</span>
<span class="nc" id="L346">    m_topN = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_TopN_JMenuItem_Text_First&quot;));           //note to change </span>
    //language change this line
<span class="nc" id="L348">    m_topN.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_TopN_JMenuItem_SetActionCommand_Text_First&quot;));          //but not this one,</span>
    //same for all menu items
<span class="nc" id="L350">    m_fitToScreen = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_FitToScreen_JMenuItem_Text_First&quot;));</span>
<span class="nc" id="L351">    m_fitToScreen.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_FitToScreen_JMenuItem_SetActionCommand_Text_First&quot;));</span>
    //unhide = new JMenuItem(&quot;Unhide all Nodes&quot;);
<span class="nc" id="L353">    m_selectFont = new JMenu(Messages.getInstance().getString(&quot;TreeVisualizer_SelectFont_JMenu_Text_First&quot;));</span>
<span class="nc" id="L354">    m_selectFont.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_SelectFont_JMenu_SetActionCommand_Text_First&quot;));</span>
<span class="nc" id="L355">    m_autoScale = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_AutoScale_JMenuItem_Text_First&quot;));</span>
<span class="nc" id="L356">    m_autoScale.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_AutoScale_JMenuItem_SetActionCommand_Text_First&quot;));</span>
<span class="nc" id="L357">    m_selectFontGroup = new ButtonGroup();</span>
    
<span class="nc" id="L359">    m_accept = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Accept_JMenuItem_Text_First&quot;));</span>
<span class="nc" id="L360">    m_accept.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Accept_JMenuItem_SetActionCommand_Text_First&quot;));</span>
    
<span class="nc" id="L362">    m_winMenu.add(m_topN);</span>
<span class="nc" id="L363">    m_winMenu.addSeparator();</span>
<span class="nc" id="L364">    m_winMenu.add(m_fitToScreen);</span>
<span class="nc" id="L365">    m_winMenu.add(m_autoScale);</span>
    //m_winMenu.addSeparator();
    //m_winMenu.add(unhide);
<span class="nc" id="L368">    m_winMenu.addSeparator();</span>
<span class="nc" id="L369">    m_winMenu.add(m_selectFont);</span>

<span class="nc bnc" id="L371" title="All 2 branches missed.">    if (m_listener != null) {</span>
<span class="nc" id="L372">      m_winMenu.addSeparator();</span>
<span class="nc" id="L373">      m_winMenu.add(m_accept);</span>
    }
    
<span class="nc" id="L376">    m_topN.addActionListener(this);</span>
<span class="nc" id="L377">    m_fitToScreen.addActionListener(this);</span>
    //unhide.addActionListener(this);
<span class="nc" id="L379">    m_autoScale.addActionListener(this);</span>
<span class="nc" id="L380">    m_accept.addActionListener(this);</span>
        
<span class="nc" id="L382">    m_size24 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size24_Text_First&quot;),false);//,select_font_group);</span>
<span class="nc" id="L383">    m_size22 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size22_JRadioButtonMenuItem_Size22_Text_First&quot;),false);//,select_font_group);</span>
<span class="nc" id="L384">    m_size20 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size20_JRadioButtonMenuItem_Size20_Text_First&quot;),false);//,select_font_group);</span>
<span class="nc" id="L385">    m_size18 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size18_JRadioButtonMenuItem_Size18_Text_First&quot;),false);//,select_font_group);</span>
<span class="nc" id="L386">    m_size16 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size16_JRadioButtonMenuItem_Size16_Text_First&quot;),false);//,select_font_group);</span>
<span class="nc" id="L387">    m_size14 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size14_JRadioButtonMenuItem_Size14_Text_First&quot;),false);//,select_font_group);</span>
<span class="nc" id="L388">    m_size12 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size12_JRadioButtonMenuItem_Size12_Text_First&quot;),true);//,select_font_group);</span>
<span class="nc" id="L389">    m_size10 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size10_JRadioButtonMenuItem_Size10_Text_First&quot;),false);//,select_font_group);</span>
<span class="nc" id="L390">    m_size8 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size8_JRadioButtonMenuItem_Size8_Text_First&quot;),false);//,select_font_group);</span>
<span class="nc" id="L391">    m_size6 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size6_JRadioButtonMenuItem_Size6_Text_First&quot;),false);//,select_font_group);</span>
<span class="nc" id="L392">    m_size4 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size4_JRadioButtonMenuItem_Size4_Text_First&quot;),false);//,select_font_group);</span>
<span class="nc" id="L393">    m_size2 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size2_JRadioButtonMenuItem_Size2_Text_First&quot;),false);//,select_font_group);</span>
<span class="nc" id="L394">    m_size1 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_Size1_Text_First&quot;),false);//,select_font_group);</span>

<span class="nc" id="L396">    m_size24.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_SetActionCommand_Size24_Text_First&quot;));//,select_font_group);</span>
<span class="nc" id="L397">    m_size22.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size22_JRadioButtonMenuItem_SetActionCommand_Size22_Text_First&quot;));//,select_font_group);</span>
<span class="nc" id="L398">    m_size20.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size20_JRadioButtonMenuItem_SetActionCommand_Size20_Text_First&quot;));//,select_font_group);</span>
<span class="nc" id="L399">    m_size18.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size18_JRadioButtonMenuItem_SetActionCommand_Size18_Text_First&quot;));//,select_font_group);</span>
<span class="nc" id="L400">    m_size16.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size16_JRadioButtonMenuItem_SetActionCommand_Size16_Text_First&quot;));//,select_font_group);</span>
<span class="nc" id="L401">    m_size14.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size14_JRadioButtonMenuItem_SetActionCommand_Size14_Text_First&quot;));//,select_font_group);</span>
<span class="nc" id="L402">    m_size12.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size12_JRadioButtonMenuItem_SetActionCommand_Size12_Text_First&quot;));//,select_font_group);</span>
<span class="nc" id="L403">    m_size10.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size10_JRadioButtonMenuItem_SetActionCommand_Size10_Text_First&quot;));//,select_font_group);</span>
<span class="nc" id="L404">    m_size8.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size8_JRadioButtonMenuItem_SetActionCommand_Size8_Text_First&quot;));//,select_font_group);</span>
<span class="nc" id="L405">    m_size6.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size6_JRadioButtonMenuItem_SetActionCommand_Size6_Text_First&quot;));//,select_font_group);</span>
<span class="nc" id="L406">    m_size4.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size4_JRadioButtonMenuItem_SetActionCommand_Size4_Text_First&quot;));//,select_font_group);</span>
<span class="nc" id="L407">    m_size2.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size2_JRadioButtonMenuItem_SetActionCommand_Size2_Text_First&quot;));//,select_font_group);</span>
<span class="nc" id="L408">    m_size1.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size1_Text_First&quot;));//,select_font_group);</span>
    
    
<span class="nc" id="L411">    m_selectFontGroup.add(m_size24);</span>
<span class="nc" id="L412">    m_selectFontGroup.add(m_size22);</span>
<span class="nc" id="L413">    m_selectFontGroup.add(m_size20);</span>
<span class="nc" id="L414">    m_selectFontGroup.add(m_size18);</span>
<span class="nc" id="L415">    m_selectFontGroup.add(m_size16);</span>
<span class="nc" id="L416">    m_selectFontGroup.add(m_size14);</span>
<span class="nc" id="L417">    m_selectFontGroup.add(m_size12);</span>
<span class="nc" id="L418">    m_selectFontGroup.add(m_size10);</span>
<span class="nc" id="L419">    m_selectFontGroup.add(m_size8);</span>
<span class="nc" id="L420">    m_selectFontGroup.add(m_size6);</span>
<span class="nc" id="L421">    m_selectFontGroup.add(m_size4);</span>
<span class="nc" id="L422">    m_selectFontGroup.add(m_size2);</span>
<span class="nc" id="L423">    m_selectFontGroup.add(m_size1);</span>

    
<span class="nc" id="L426">    m_selectFont.add(m_size24);</span>
<span class="nc" id="L427">    m_selectFont.add(m_size22);</span>
<span class="nc" id="L428">    m_selectFont.add(m_size20);</span>
<span class="nc" id="L429">    m_selectFont.add(m_size18);</span>
<span class="nc" id="L430">    m_selectFont.add(m_size16);</span>
<span class="nc" id="L431">    m_selectFont.add(m_size14);</span>
<span class="nc" id="L432">    m_selectFont.add(m_size12);</span>
<span class="nc" id="L433">    m_selectFont.add(m_size10);</span>
<span class="nc" id="L434">    m_selectFont.add(m_size8);</span>
<span class="nc" id="L435">    m_selectFont.add(m_size6);</span>
<span class="nc" id="L436">    m_selectFont.add(m_size4);</span>
<span class="nc" id="L437">    m_selectFont.add(m_size2);</span>
<span class="nc" id="L438">    m_selectFont.add(m_size1);</span>


<span class="nc" id="L441">    m_size24.addItemListener(this);</span>
<span class="nc" id="L442">    m_size22.addItemListener(this);</span>
<span class="nc" id="L443">    m_size20.addItemListener(this);</span>
<span class="nc" id="L444">    m_size18.addItemListener(this);</span>
<span class="nc" id="L445">    m_size16.addItemListener(this);</span>
<span class="nc" id="L446">    m_size14.addItemListener(this);</span>
<span class="nc" id="L447">    m_size12.addItemListener(this);</span>
<span class="nc" id="L448">    m_size10.addItemListener(this);</span>
<span class="nc" id="L449">    m_size8.addItemListener(this);</span>
<span class="nc" id="L450">    m_size6.addItemListener(this);</span>
<span class="nc" id="L451">    m_size4.addItemListener(this);</span>
<span class="nc" id="L452">    m_size2.addItemListener(this);</span>
<span class="nc" id="L453">    m_size1.addItemListener(this);</span>

    /*
      search_string = new JTextField(22);
      search_win = new JDialog();
      case_sen = new JRadioButton(&quot;Case Sensitive&quot;);



      search_win.getContentPane().setLayout(null);
      search_win.setSize(300, 200);
 
      search_win.getContentPane().add(search_string);
      search_win.getContentPane().add(case_sen);

      search_string.setLocation(50, 70);
      case_sen.setLocation(50, 120);
      case_sen.setSize(100, 24); 
      search_string.setSize(100, 24);
      //search_string.setVisible(true);
      //case_sen.setVisible(true);

      //search_win.setVisible(true);
    */

<span class="nc" id="L478">    m_nodeMenu = new JPopupMenu();</span>
    /* A visualize choice for the node, may not be available. */
<span class="nc" id="L480">    m_visualise = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Visualise_JMenuItem_Text_First&quot;));</span>
<span class="nc" id="L481">    m_visualise.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Visualise_JMenuItem_SetActionCommand_Text_First&quot;));</span>
<span class="nc" id="L482">    m_visualise.addActionListener(this);</span>
<span class="nc" id="L483">    m_nodeMenu.add(m_visualise);</span>
   
<span class="nc bnc" id="L485" title="All 2 branches missed.">    if (m_listener != null) {</span>
<span class="nc" id="L486">      m_remChildren = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_RemChildren_JMenuItem_Text_First&quot;));</span>
<span class="nc" id="L487">      m_remChildren.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_RemChildren_JMenuItem_SetActionCommand_Text_First&quot;));</span>
<span class="nc" id="L488">      m_remChildren.addActionListener(this);</span>
<span class="nc" id="L489">      m_nodeMenu.add(m_remChildren);</span>
      
      
<span class="nc" id="L492">      m_classifyChild = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_ClassifyChild_JMenuItem_Text_First&quot;));</span>
<span class="nc" id="L493">      m_classifyChild.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_ClassifyChild_JMenuItem_SetActionCommand_Text_First&quot;));</span>
<span class="nc" id="L494">      m_classifyChild.addActionListener(this);</span>
<span class="nc" id="L495">      m_nodeMenu.add(m_classifyChild);</span>
      
      /*m_sendInstances = new JMenuItem(&quot;Add Instances To Viewer&quot;);
      m_sendInstances.setActionCommand(&quot;send_instances&quot;);
      m_sendInstances.addActionListener(this);
      m_nodeMenu.add(m_sendInstances); */
      
    }
    
<span class="nc" id="L504">    m_focusNode = -1;</span>
<span class="nc" id="L505">    m_highlightNode = -1;</span>
    
<span class="nc" id="L507">    addMouseMotionListener(this);</span>
<span class="nc" id="L508">    addMouseListener(this);</span>
    //repaint();
    //frame_limiter.setInitialDelay();
<span class="nc" id="L511">    m_frameLimiter.setRepeats(false);</span>
<span class="nc" id="L512">    m_frameLimiter.start();</span>
<span class="nc" id="L513">  }</span>
  
  /**
   * Constructs Displayer with the specified Node as the top 
   * of the tree, and uses the NodePlacer to place the Nodes.
   * @param tdl listener.
   * @param n the top Node of the tree to be displayed.
   * @param p the algorithm to be used to position the nodes.
   */  
  public TreeVisualizer(TreeDisplayListener tdl, Node n, NodePlace p) {
<span class="nc" id="L523">    super();</span>

<span class="nc" id="L525">    initialize();</span>
    
    //if the size needs to be automatically alocated I will do it here
<span class="nc bnc" id="L528" title="All 2 branches missed.">    if (m_ShowBorder)</span>
<span class="nc" id="L529">      setBorder(BorderFactory.createTitledBorder(Messages.getInstance().getString(&quot;TreeVisualizer_BorderFactoryCreateTitledBorder_Text_Second&quot;))); </span>
<span class="nc" id="L530">    m_listener = tdl;</span>
<span class="nc" id="L531">    m_topNode = n;</span>
<span class="nc" id="L532">    m_placer = p;</span>
<span class="nc" id="L533">    m_placer.place(m_topNode);</span>
<span class="nc" id="L534">    m_viewPos = new Dimension(0, 0);    //will be adjusted </span>
<span class="nc" id="L535">    m_viewSize = new Dimension(800, 600);   //I allocate this now so that</span>
    //the tree will be visible
    //when the panel is enlarged

<span class="nc" id="L539">    m_nViewPos = new Dimension(0, 0);            </span>
<span class="nc" id="L540">    m_nViewSize = new Dimension(800, 600);          </span>
                                      
<span class="nc" id="L542">    m_scaling = 0;</span>
    
<span class="nc" id="L544">    m_numNodes = m_topNode.getCount(m_topNode,0);   //note the second argument </span>
    //must be a zero, this is a 
    //recursive function

<span class="nc" id="L548">    m_numLevels = m_topNode.getHeight(m_topNode,0);</span>
  
<span class="nc" id="L550">    m_nodes = new NodeInfo[m_numNodes];</span>
<span class="nc" id="L551">    m_edges = new EdgeInfo[m_numNodes-1];</span>

<span class="nc" id="L553">    arrayFill(m_topNode, m_nodes, m_edges);</span>
    
<span class="nc" id="L555">    changeFontSize(12);</span>

<span class="nc" id="L557">    m_mouseState = 0;</span>
<span class="nc" id="L558">    m_oldMousePos = new Dimension(0, 0);</span>
<span class="nc" id="L559">    m_newMousePos = new Dimension(0, 0);</span>
<span class="nc" id="L560">    m_frameLimiter = new Timer(120, this);</span>

<span class="nc" id="L562">    m_winMenu = new JPopupMenu();</span>
<span class="nc" id="L563">    m_topN = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_TopN_JMenuItem_Text_Second&quot;));           //note to change </span>
    //language change this line
<span class="nc" id="L565">    m_topN.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_TopN_JMenuItem_SetActionCommand_Text_Second&quot;));          //but not this </span>
    //one, same for all menu items
<span class="nc" id="L567">    m_fitToScreen = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_FitToScreen_JMenuItem_Text_Second&quot;));</span>
<span class="nc" id="L568">    m_fitToScreen.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_FitToScreen_JMenuItem_SetActionCommand_Text_Second&quot;));</span>
    //unhide = new JMenuItem(&quot;Unhide all Nodes&quot;);
<span class="nc" id="L570">    m_selectFont = new JMenu(Messages.getInstance().getString(&quot;TreeVisualizer_SelectFont_JMenu_Text_Second&quot;));</span>
<span class="nc" id="L571">    m_selectFont.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_SelectFont_JMenu_SetActionCommand_Text_Second&quot;));</span>
<span class="nc" id="L572">    m_autoScale = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_AutoScale_JMenuItem_Text_Second&quot;));</span>
<span class="nc" id="L573">    m_autoScale.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_AutoScale_JMenuItem_SetActionCommand_Text_Second&quot;));</span>
<span class="nc" id="L574">    m_selectFontGroup = new ButtonGroup();</span>
    
<span class="nc" id="L576">    m_accept = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Accept_JMenuItem_Text_Second&quot;));</span>
<span class="nc" id="L577">    m_accept.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Accept_JMenuItem_SetActionCommand_Text_Second&quot;));</span>
    
<span class="nc" id="L579">    m_winMenu.add(m_topN);</span>
<span class="nc" id="L580">    m_winMenu.addSeparator();</span>
<span class="nc" id="L581">    m_winMenu.add(m_fitToScreen);</span>
<span class="nc" id="L582">    m_winMenu.add(m_autoScale);</span>
<span class="nc" id="L583">    m_winMenu.addSeparator();</span>
    //m_winMenu.add(unhide);
<span class="nc" id="L585">    m_winMenu.addSeparator();</span>
<span class="nc" id="L586">    m_winMenu.add(m_selectFont);</span>
<span class="nc" id="L587">    m_winMenu.addSeparator();</span>

<span class="nc bnc" id="L589" title="All 2 branches missed.">    if (m_listener != null) {</span>
<span class="nc" id="L590">      m_winMenu.add(m_accept);</span>
    }
    
<span class="nc" id="L593">    m_topN.addActionListener(this);</span>
<span class="nc" id="L594">    m_fitToScreen.addActionListener(this);</span>
    //unhide.addActionListener(this);
<span class="nc" id="L596">    m_autoScale.addActionListener(this);</span>
<span class="nc" id="L597">    m_accept.addActionListener(this);</span>
        
<span class="nc" id="L599">    m_size24 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size24_Text_Second&quot;),false);//,select_font_group);</span>
<span class="nc" id="L600">    m_size22 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size22_Text_Second&quot;),false);//,select_font_group);</span>
<span class="nc" id="L601">    m_size20 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size20_Text_Second&quot;),false);//,select_font_group);</span>
<span class="nc" id="L602">    m_size18 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size18_Text_Second&quot;),false);//,select_font_group);</span>
<span class="nc" id="L603">    m_size16 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size16_Text_Second&quot;),false);//,select_font_group);</span>
<span class="nc" id="L604">    m_size14 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size14_Text_Second&quot;),false);//,select_font_group);</span>
<span class="nc" id="L605">    m_size12 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size12_Text_Second&quot;),true);//,select_font_group);</span>
<span class="nc" id="L606">    m_size10 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size10_Text_Second&quot;),false);//,select_font_group);</span>
<span class="nc" id="L607">    m_size8 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size8_Text_Second&quot;),false);//,select_font_group);</span>
<span class="nc" id="L608">    m_size6 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size6_Text_Second&quot;),false);//,select_font_group);</span>
<span class="nc" id="L609">    m_size4 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size4_Text_Second&quot;),false);//,select_font_group);</span>
<span class="nc" id="L610">    m_size2 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size2_Text_Second&quot;),false);//,select_font_group);</span>
<span class="nc" id="L611">    m_size1 = new JRadioButtonMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Size24_JRadioButtonMenuItem_Size1_Text_Second&quot;),false);//,select_font_group);</span>

<span class="nc" id="L613">    m_size24.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size24_Text_Second&quot;));//,select_font_group);</span>
<span class="nc" id="L614">    m_size22.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size22_Text_Second&quot;));//,select_font_group);</span>
<span class="nc" id="L615">    m_size20.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size20_Text_Second&quot;));//,select_font_group);</span>
<span class="nc" id="L616">    m_size18.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size18_Text_Second&quot;));//,select_font_group);</span>
<span class="nc" id="L617">    m_size16.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size16_Text_Second&quot;));//,select_font_group);</span>
<span class="nc" id="L618">    m_size14.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size14_Text_Second&quot;));//,select_font_group);</span>
<span class="nc" id="L619">    m_size12.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size12_Text_Second&quot;));//,select_font_group);</span>
<span class="nc" id="L620">    m_size10.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size10_Text_Second&quot;));//,select_font_group);</span>
<span class="nc" id="L621">    m_size8.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size8_Text_Second&quot;));//,select_font_group);</span>
<span class="nc" id="L622">    m_size6.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size6_Text_Second&quot;));//,select_font_group);</span>
<span class="nc" id="L623">    m_size4.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size4_Text_Second&quot;));//,select_font_group);</span>
<span class="nc" id="L624">    m_size2.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size2_Text_Second&quot;));//,select_font_group);</span>
<span class="nc" id="L625">    m_size1.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Size1_JRadioButtonMenuItem_SetActionCommand_Size1_Text_Second&quot;));//,select_font_group);</span>



    
    
<span class="nc" id="L631">    m_selectFontGroup.add(m_size24);</span>
<span class="nc" id="L632">    m_selectFontGroup.add(m_size22);</span>
<span class="nc" id="L633">    m_selectFontGroup.add(m_size20);</span>
<span class="nc" id="L634">    m_selectFontGroup.add(m_size18);</span>
<span class="nc" id="L635">    m_selectFontGroup.add(m_size16);</span>
<span class="nc" id="L636">    m_selectFontGroup.add(m_size14);</span>
<span class="nc" id="L637">    m_selectFontGroup.add(m_size12);</span>
<span class="nc" id="L638">    m_selectFontGroup.add(m_size10);</span>
<span class="nc" id="L639">    m_selectFontGroup.add(m_size8);</span>
<span class="nc" id="L640">    m_selectFontGroup.add(m_size6);</span>
<span class="nc" id="L641">    m_selectFontGroup.add(m_size4);</span>
<span class="nc" id="L642">    m_selectFontGroup.add(m_size2);</span>
<span class="nc" id="L643">    m_selectFontGroup.add(m_size1);</span>



    
<span class="nc" id="L648">    m_selectFont.add(m_size24);</span>
<span class="nc" id="L649">    m_selectFont.add(m_size22);</span>
<span class="nc" id="L650">    m_selectFont.add(m_size20);</span>
<span class="nc" id="L651">    m_selectFont.add(m_size18);</span>
<span class="nc" id="L652">    m_selectFont.add(m_size16);</span>
<span class="nc" id="L653">    m_selectFont.add(m_size14);</span>
<span class="nc" id="L654">    m_selectFont.add(m_size12);</span>
<span class="nc" id="L655">    m_selectFont.add(m_size10);</span>
<span class="nc" id="L656">    m_selectFont.add(m_size8);</span>
<span class="nc" id="L657">    m_selectFont.add(m_size6);</span>
<span class="nc" id="L658">    m_selectFont.add(m_size4);</span>
<span class="nc" id="L659">    m_selectFont.add(m_size2);</span>
<span class="nc" id="L660">    m_selectFont.add(m_size1);</span>


<span class="nc" id="L663">    m_size24.addItemListener(this);</span>
<span class="nc" id="L664">    m_size22.addItemListener(this);</span>
<span class="nc" id="L665">    m_size20.addItemListener(this);</span>
<span class="nc" id="L666">    m_size18.addItemListener(this);</span>
<span class="nc" id="L667">    m_size16.addItemListener(this);</span>
<span class="nc" id="L668">    m_size14.addItemListener(this);</span>
<span class="nc" id="L669">    m_size12.addItemListener(this);</span>
<span class="nc" id="L670">    m_size10.addItemListener(this);</span>
<span class="nc" id="L671">    m_size8.addItemListener(this);</span>
<span class="nc" id="L672">    m_size6.addItemListener(this);</span>
<span class="nc" id="L673">    m_size4.addItemListener(this);</span>
<span class="nc" id="L674">    m_size2.addItemListener(this);</span>
<span class="nc" id="L675">    m_size1.addItemListener(this);</span>




    /*
      search_string = new JTextField(22);
      search_win = new JDialog();
      case_sen = new JRadioButton(&quot;Case Sensitive&quot;);



      search_win.getContentPane().setLayout(null);
      search_win.setSize(300, 200);
 
      search_win.getContentPane().add(search_string);
      search_win.getContentPane().add(case_sen);

      search_string.setLocation(50, 70);
      case_sen.setLocation(50, 120);
      case_sen.setSize(100, 24); 
      search_string.setSize(100, 24);
      //search_string.setVisible(true);
      //case_sen.setVisible(true);

      search_win.setVisible(true);
    */


<span class="nc" id="L704">    m_nodeMenu = new JPopupMenu();</span>
    /* A visualize choice for the node, may not be available. */
<span class="nc" id="L706">    m_visualise = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_Visualise_JMenuItem_Text_Second&quot;));</span>
<span class="nc" id="L707">    m_visualise.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_Visualise_JMenuItem_SetActionCommand_Text_Second&quot;));</span>
<span class="nc" id="L708">    m_visualise.addActionListener(this);</span>
<span class="nc" id="L709">    m_nodeMenu.add(m_visualise);</span>

<span class="nc bnc" id="L711" title="All 2 branches missed.">    if (m_listener != null) {</span>
<span class="nc" id="L712">      m_remChildren = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_RemChildren_JMenuItem_Text_Second&quot;));</span>
<span class="nc" id="L713">      m_remChildren.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_RemChildren_JMenuItem_SetActionCommand_Text_Second&quot;));</span>
<span class="nc" id="L714">      m_remChildren.addActionListener(this);</span>
<span class="nc" id="L715">      m_nodeMenu.add(m_remChildren);</span>
      
<span class="nc" id="L717">      m_classifyChild = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_ClassifyChild_JMenuItem_Text_Second&quot;));</span>
<span class="nc" id="L718">      m_classifyChild.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_ClassifyChild_JMenuItem_SetActionCommand_Text_Second&quot;));</span>
<span class="nc" id="L719">      m_classifyChild.addActionListener(this);</span>
<span class="nc" id="L720">      m_nodeMenu.add(m_classifyChild);</span>
      
<span class="nc" id="L722">      m_sendInstances = new JMenuItem(Messages.getInstance().getString(&quot;TreeVisualizer_SendInstances_JMenuItem_Text&quot;));</span>
<span class="nc" id="L723">      m_sendInstances.setActionCommand(Messages.getInstance().getString(&quot;TreeVisualizer_SendInstances_JMenuItem_SetActionCommand_Text&quot;));</span>
<span class="nc" id="L724">      m_sendInstances.addActionListener(this);</span>
<span class="nc" id="L725">      m_nodeMenu.add(m_sendInstances);</span>
      
      
    }
  
<span class="nc" id="L730">    m_focusNode = -1;</span>
<span class="nc" id="L731">    m_highlightNode = -1;</span>
    

<span class="nc" id="L734">    addMouseMotionListener(this);</span>
<span class="nc" id="L735">    addMouseListener(this);</span>

  
    //repaint();

    //frame_limiter.setInitialDelay();
<span class="nc" id="L741">    m_frameLimiter.setRepeats(false);</span>
<span class="nc" id="L742">    m_frameLimiter.start();</span>
<span class="nc" id="L743">  }</span>

  /**
   * Processes the color string. Returns null if empty.
   * 
   * @param colorStr	the string to process
   * @return		the processed color or null
   */
  protected Color getColor(String colorStr) {
    Color	result;
    
<span class="nc" id="L754">    result = null;</span>
    
<span class="nc bnc" id="L756" title="All 4 branches missed.">    if ((colorStr != null) &amp;&amp; (colorStr.length() &gt; 0))</span>
<span class="nc" id="L757">      result = VisualizeUtils.processColour(colorStr, result);</span>
    
<span class="nc" id="L759">    return result;</span>
  }
  
  /**
   * Performs some initialization.
   */
  protected void initialize() {
    Properties	props;
    
    try {
<span class="nc" id="L769">      props = Utils.readProperties(PROPERTIES_FILE);</span>
    }
<span class="nc" id="L771">    catch (Exception e) {</span>
<span class="nc" id="L772">      e.printStackTrace();</span>
<span class="nc" id="L773">      props = new Properties();</span>
    }
    
<span class="nc" id="L776">    m_FontColor       = getColor(props.getProperty(&quot;FontColor&quot;, &quot;&quot;));</span>
<span class="nc" id="L777">    m_BackgroundColor = getColor(props.getProperty(&quot;BackgroundColor&quot;, &quot;&quot;));</span>
<span class="nc" id="L778">    m_NodeColor       = getColor(props.getProperty(&quot;NodeColor&quot;, &quot;&quot;));</span>
<span class="nc" id="L779">    m_LineColor       = getColor(props.getProperty(&quot;LineColor&quot;, &quot;&quot;));</span>
<span class="nc" id="L780">    m_ZoomBoxColor    = getColor(props.getProperty(&quot;ZoomBoxColor&quot;, &quot;&quot;));</span>
<span class="nc" id="L781">    m_ZoomBoxXORColor = getColor(props.getProperty(&quot;ZoomBoxXORColor&quot;, &quot;&quot;));</span>
<span class="nc" id="L782">    m_ShowBorder      = Boolean.parseBoolean(props.getProperty(&quot;ShowBorder&quot;, &quot;true&quot;));</span>
<span class="nc" id="L783">  }</span>

  /**
   * Fits the tree to the current screen size. Call this after
   * window has been created to get the entrire tree to be in view
   * upon launch.
   */
  public void fitToScreen() {

<span class="nc" id="L792">    getScreenFit(m_viewPos, m_viewSize);</span>
<span class="nc" id="L793">    repaint();</span>
<span class="nc" id="L794">  }</span>

  /**
   * Calculates the dimensions needed to fit the entire tree into view.
   */
  private void getScreenFit(Dimension np, Dimension ns) {

<span class="nc" id="L801">    int leftmost = 1000000, rightmost = -1000000;</span>
<span class="nc" id="L802">    int leftCenter = 1000000, rightCenter = -1000000, rightNode = 0;</span>
<span class="nc" id="L803">    int highest = -1000000, highTop = -1000000;</span>
<span class="nc bnc" id="L804" title="All 2 branches missed.">    for (int noa = 0; noa &lt; m_numNodes; noa++) {</span>
<span class="nc" id="L805">      calcScreenCoords(noa);</span>
<span class="nc bnc" id="L806" title="All 2 branches missed.">      if (m_nodes[noa].m_center - m_nodes[noa].m_side &lt; leftmost) {</span>
<span class="nc" id="L807">	leftmost = m_nodes[noa].m_center - m_nodes[noa].m_side;</span>
      }
<span class="nc bnc" id="L809" title="All 2 branches missed.">      if (m_nodes[noa].m_center &lt; leftCenter) {</span>
<span class="nc" id="L810">	leftCenter = m_nodes[noa].m_center;</span>
      }
      
<span class="nc bnc" id="L813" title="All 2 branches missed.">      if (m_nodes[noa].m_center + m_nodes[noa].m_side &gt; rightmost) {</span>
<span class="nc" id="L814">	rightmost = m_nodes[noa].m_center + m_nodes[noa].m_side;	  </span>
      }
<span class="nc bnc" id="L816" title="All 2 branches missed.">      if (m_nodes[noa].m_center &gt; rightCenter) {</span>
<span class="nc" id="L817">	rightCenter = m_nodes[noa].m_center;</span>
<span class="nc" id="L818">	rightNode = noa;</span>
      }
<span class="nc bnc" id="L820" title="All 2 branches missed.">	if (m_nodes[noa].m_top + m_nodes[noa].m_height &gt; highest) {</span>
<span class="nc" id="L821">	  highest = m_nodes[noa].m_top + m_nodes[noa].m_height;</span>
	}
<span class="nc bnc" id="L823" title="All 2 branches missed.">	if (m_nodes[noa].m_top &gt; highTop) {</span>
<span class="nc" id="L824">	  highTop = m_nodes[noa].m_top;</span>
	}
    }
    
<span class="nc" id="L828">    ns.width = getWidth();</span>
<span class="nc" id="L829">    ns.width -= leftCenter - leftmost + rightmost - rightCenter + 30;</span>
<span class="nc" id="L830">    ns.height = getHeight() - highest + highTop - 40;</span>
    
<span class="nc bnc" id="L832" title="All 2 branches missed.">    if (m_nodes[rightNode].m_node.getCenter() != 0 </span>
<span class="nc bnc" id="L833" title="All 2 branches missed.">	&amp;&amp; leftCenter != rightCenter) {</span>
<span class="nc" id="L834">	ns.width /= m_nodes[rightNode].m_node.getCenter();</span>
    }
<span class="nc bnc" id="L836" title="All 2 branches missed.">    if (ns.width &lt; 10)</span>
      {
<span class="nc" id="L838">	ns.width = 10;</span>
      }
<span class="nc bnc" id="L840" title="All 2 branches missed.">    if (ns.height &lt; 10)</span>
      {
<span class="nc" id="L842">	ns.height = 10;</span>
      }
    
<span class="nc" id="L845">    np.width = (leftCenter - leftmost + rightmost - rightCenter) / 2 + 15;</span>
<span class="nc" id="L846">    np.height = (highest - highTop) / 2 + 20;</span>
<span class="nc" id="L847">  }</span>

  /**
   * Performs the action associated with the ActionEvent.
   *
   * @param e the action event.
   */
  public void actionPerformed(ActionEvent e) {
    
    //JMenuItem m = (JMenuItem)e.getSource();
    
<span class="nc bnc" id="L858" title="All 2 branches missed.">    if (e.getActionCommand() == null) {</span>
<span class="nc bnc" id="L859" title="All 2 branches missed.">      if (m_scaling == 0) {</span>
<span class="nc" id="L860">	repaint();</span>
      }
      else {
<span class="nc" id="L863">	animateScaling(m_nViewPos, m_nViewSize, m_scaling);</span>
      }
    }
<span class="nc bnc" id="L866" title="All 2 branches missed.">    else if (e.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_FitToScreen_Text&quot;))) {</span>
      
<span class="nc" id="L868">      Dimension np = new Dimension();</span>
<span class="nc" id="L869">      Dimension ns = new Dimension();</span>

<span class="nc" id="L871">      getScreenFit(np, ns);</span>

<span class="nc" id="L873">      animateScaling(np, ns, 10);</span>
      
    }
<span class="nc bnc" id="L876" title="All 2 branches missed.">    else if (e.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_CenterOnTopNode_Text&quot;))) {</span>
      
<span class="nc" id="L878">      int tpx = (int)(m_topNode.getCenter() * m_viewSize.width);   //calculate</span>
      //the top nodes postion but don't adjust for where 
<span class="nc" id="L880">      int tpy = (int)(m_topNode.getTop() * m_viewSize.height);     //view is</span>
      
      
      
<span class="nc" id="L884">      Dimension np = new Dimension(getSize().width / 2 - tpx, </span>
<span class="nc" id="L885">				   getSize().width / 6 - tpy);</span>
      
<span class="nc" id="L887">      animateScaling(np, m_viewSize, 10);</span>
      
    }
<span class="nc bnc" id="L890" title="All 2 branches missed.">    else if (e.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_AutoScale_JMenuItem_SetActionCommand_Text_Second&quot;))) {</span>
<span class="nc" id="L891">      autoScale();  //this will figure the best scale value </span>
      //keep the focus on the middle of the screen and call animate
    }
<span class="nc bnc" id="L894" title="All 2 branches missed.">    else if (e.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_VisualizeTheNode_Text&quot;))) {</span>
      //send the node data to the visualizer 
<span class="nc bnc" id="L896" title="All 2 branches missed.">      if (m_focusNode &gt;= 0) {</span>
	Instances inst;
<span class="nc bnc" id="L898" title="All 2 branches missed.">	if ((inst = m_nodes[m_focusNode].m_node.getInstances()) != null) {</span>
<span class="nc" id="L899">	  VisualizePanel pan = new VisualizePanel();</span>
<span class="nc" id="L900">	  pan.setInstances(inst);</span>
<span class="nc" id="L901">	  JFrame nf = new JFrame();</span>
<span class="nc" id="L902">	  nf.setSize(400, 300);</span>
<span class="nc" id="L903">	  nf.getContentPane().add(pan);</span>
<span class="nc" id="L904">	  nf.setVisible(true);</span>
	}
	else {
<span class="nc" id="L907">	  JOptionPane.showMessageDialog(this, Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_First&quot;), </span>
<span class="nc" id="L908">			  Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Second&quot;),</span>
<span class="nc" id="L909">					JOptionPane.WARNING_MESSAGE); </span>
	}
      }
      else {
<span class="nc" id="L913">	JOptionPane.showMessageDialog(this, Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Third&quot;), </span>
<span class="nc" id="L914">			Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Fourth&quot;),</span>
<span class="nc" id="L915">				      JOptionPane.ERROR_MESSAGE); </span>
      }
    }
<span class="nc bnc" id="L918" title="All 2 branches missed.">    else if (e.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_CreateChildNodes_Text&quot;))) {</span>
<span class="nc bnc" id="L919" title="All 2 branches missed.">      if (m_focusNode &gt;= 0) {</span>
<span class="nc bnc" id="L920" title="All 2 branches missed.">	if (m_listener != null) {</span>
	  //then send message to the listener
<span class="nc" id="L922">	  m_listener.userCommand(new TreeDisplayEvent</span>
<span class="nc" id="L923">	    (TreeDisplayEvent.ADD_CHILDREN, </span>
<span class="nc" id="L924">	     m_nodes[m_focusNode].m_node.getRefer()));</span>
	}
	else {
<span class="nc" id="L927">	  JOptionPane.showMessageDialog(this, Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Sixth&quot;),</span>
<span class="nc" id="L928">					Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Seventh&quot;), </span>
<span class="nc" id="L929">					JOptionPane.WARNING_MESSAGE);</span>
	}
      }
      else {
<span class="nc" id="L933">	JOptionPane.showMessageDialog(this, Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Eighth&quot;), </span>
<span class="nc" id="L934">			Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Eighth&quot;),</span>
<span class="nc" id="L935">				      JOptionPane.ERROR_MESSAGE);</span>
      }
    }
<span class="nc bnc" id="L938" title="All 2 branches missed.">    else if (e.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_RemoveChildNodes_Text&quot;))) {</span>
<span class="nc bnc" id="L939" title="All 2 branches missed.">      if (m_focusNode &gt;= 0) {</span>
<span class="nc bnc" id="L940" title="All 2 branches missed.">	if (m_listener != null) {</span>
	  //then send message to the listener
<span class="nc" id="L942">	  m_listener.userCommand(new </span>
<span class="nc" id="L943">	    TreeDisplayEvent(TreeDisplayEvent.REMOVE_CHILDREN, </span>
<span class="nc" id="L944">			     m_nodes[m_focusNode].m_node.getRefer()));</span>
	}
	else {
<span class="nc" id="L947">	  JOptionPane.showMessageDialog(this, Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Nineth&quot;),</span>
<span class="nc" id="L948">					Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Tenth&quot;), </span>
<span class="nc" id="L949">					JOptionPane.WARNING_MESSAGE);</span>
	}
      }
      else {
<span class="nc" id="L953">	JOptionPane.showMessageDialog(this, Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Eleventh&quot;), </span>
<span class="nc" id="L954">			Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Twelveth&quot;),</span>
<span class="nc" id="L955">				      JOptionPane.ERROR_MESSAGE);</span>
      }
    }
<span class="nc bnc" id="L958" title="All 2 branches missed.">    else if (e.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_Classify_Child_Text&quot;))) {</span>
<span class="nc bnc" id="L959" title="All 2 branches missed.">      if (m_focusNode &gt;= 0) {</span>
<span class="nc bnc" id="L960" title="All 2 branches missed.">	if (m_listener != null) {</span>
	  //then send message to the listener
<span class="nc" id="L962">	  m_listener.userCommand(new TreeDisplayEvent</span>
<span class="nc" id="L963">	    (TreeDisplayEvent.CLASSIFY_CHILD, </span>
<span class="nc" id="L964">	     m_nodes[m_focusNode].m_node.getRefer()));</span>
	}
	else {
<span class="nc" id="L967">	  JOptionPane.showMessageDialog(this, Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Thirteenth&quot;),</span>
<span class="nc" id="L968">					Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Fourteenth&quot;), </span>
<span class="nc" id="L969">					JOptionPane.WARNING_MESSAGE);</span>
	}
      }
      else {
<span class="nc" id="L973">	JOptionPane.showMessageDialog(this, Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Fifteenth&quot;),</span>
<span class="nc" id="L974">			&quot;			&quot; + Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Sixteenth&quot;),</span>
<span class="nc" id="L975">				      JOptionPane.ERROR_MESSAGE);</span>
      }
    }
<span class="nc bnc" id="L978" title="All 2 branches missed.">    else if (e.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_Send_Instances_Text&quot;))) {</span>
<span class="nc bnc" id="L979" title="All 2 branches missed.">      if (m_focusNode &gt;= 0) {</span>
<span class="nc bnc" id="L980" title="All 2 branches missed.">	if (m_listener != null) {</span>
	  //then send message to the listener
<span class="nc" id="L982">	  m_listener.userCommand(new TreeDisplayEvent</span>
<span class="nc" id="L983">	    (TreeDisplayEvent.SEND_INSTANCES, </span>
<span class="nc" id="L984">	     m_nodes[m_focusNode].m_node.getRefer()));</span>
	}
	else {
<span class="nc" id="L987">	  JOptionPane.showMessageDialog(this, Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Seventeenth&quot;),</span>
<span class="nc" id="L988">					Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Eighteenth&quot;), </span>
<span class="nc" id="L989">					JOptionPane.WARNING_MESSAGE);</span>
	}
      }
      else {
<span class="nc" id="L993">	JOptionPane.showMessageDialog(this, Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Nineteenth&quot;), </span>
<span class="nc" id="L994">			Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_Twentyth&quot;),</span>
<span class="nc" id="L995">				      JOptionPane.ERROR_MESSAGE);</span>
      }
    }
<span class="nc bnc" id="L998" title="All 2 branches missed.">    else if (e.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_AcceptTheTree_Text&quot;))) {</span>
<span class="nc bnc" id="L999" title="All 2 branches missed.">      if (m_listener != null) {</span>
	//then send message to the listener saying that the tree is done
<span class="nc" id="L1001">	m_listener.userCommand(new TreeDisplayEvent(TreeDisplayEvent.ACCEPT,</span>
<span class="nc" id="L1002">						  null));</span>
      }
      else {
<span class="nc" id="L1005">	JOptionPane.showMessageDialog(this, Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_TwentyFirst&quot;),</span>
<span class="nc" id="L1006">				      Messages.getInstance().getString(&quot;TreeVisualizer_ActionPerformed_JOptionPaneShowMessageDialog_Text_TwentySecond&quot;), </span>
<span class="nc" id="L1007">				      JOptionPane.WARNING_MESSAGE);</span>
      }
    }
<span class="nc" id="L1010">  }</span>

  /**
   * Performs the action associated with the ItemEvent.
   *
   * @param e the item event.
   */
  public void itemStateChanged(ItemEvent e)
  {
<span class="nc" id="L1019">    JRadioButtonMenuItem c = (JRadioButtonMenuItem)e.getSource();</span>
<span class="nc bnc" id="L1020" title="All 2 branches missed.">    if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size24_Text&quot;))) {</span>
<span class="nc" id="L1021">      changeFontSize(24);</span>
    }
<span class="nc bnc" id="L1023" title="All 2 branches missed.">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size22_Text&quot;))) {</span>
<span class="nc" id="L1024">      changeFontSize(22);</span>
    }
<span class="nc bnc" id="L1026" title="All 2 branches missed.">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size20_Text&quot;))) {</span>
<span class="nc" id="L1027">      changeFontSize(20);</span>
    }
<span class="nc bnc" id="L1029" title="All 2 branches missed.">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size18_Text&quot;))) {</span>
<span class="nc" id="L1030">      changeFontSize(18);</span>
    } 
<span class="nc bnc" id="L1032" title="All 2 branches missed.">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size16_Text&quot;))) {</span>
<span class="nc" id="L1033">      changeFontSize(16);</span>
    }
<span class="nc bnc" id="L1035" title="All 2 branches missed.">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size14_Text&quot;))) {</span>
<span class="nc" id="L1036">      changeFontSize(14);</span>
    }
<span class="nc bnc" id="L1038" title="All 2 branches missed.">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size12_Text&quot;))) {</span>
<span class="nc" id="L1039">      changeFontSize(12);</span>
    }
<span class="nc bnc" id="L1041" title="All 2 branches missed.">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size10_Text&quot;))) {</span>
<span class="nc" id="L1042">      changeFontSize(10);</span>
    }
<span class="nc bnc" id="L1044" title="All 2 branches missed.">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size8_Text&quot;))) {</span>
<span class="nc" id="L1045">      changeFontSize(8);</span>
    }
<span class="nc bnc" id="L1047" title="All 2 branches missed.">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size6_Text&quot;))) {</span>
<span class="nc" id="L1048">      changeFontSize(6);</span>
    }
<span class="nc bnc" id="L1050" title="All 2 branches missed.">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size4_Text&quot;))) {</span>
<span class="nc" id="L1051">      changeFontSize(4);</span>
    }
<span class="nc bnc" id="L1053" title="All 2 branches missed.">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size2_Text&quot;))) {</span>
<span class="nc" id="L1054">      changeFontSize(2);</span>
    }
<span class="nc bnc" id="L1056" title="All 2 branches missed.">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_Size1_Text&quot;))) {</span>
<span class="nc" id="L1057">      changeFontSize(1);</span>
    }
<span class="nc" id="L1059">    else if (c.getActionCommand().equals(Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_HideDescendants_Text&quot;))) {</span>
      //focus_node.setCVisible(!c.isSelected());
      //no longer used...
    }
<span class="nc" id="L1063">  }</span>

  /**
   * Does nothing.
   * @param e the mouse event.
   */
  public void mouseClicked(MouseEvent e) {
    //if the mouse was left clicked on 
    //the node then 
<span class="nc bnc" id="L1072" title="All 2 branches missed.">    if (m_clickAvailable) {</span>
      //determine if the click was on a node or not
<span class="nc" id="L1074">      int s = -1;</span>
      
<span class="nc bnc" id="L1076" title="All 2 branches missed.">      for (int noa = 0; noa &lt; m_numNodes;noa++) {</span>
<span class="nc bnc" id="L1077" title="All 2 branches missed.">	if (m_nodes[noa].m_quad == 18) {</span>
	  //then is on the screen
<span class="nc" id="L1079">	  calcScreenCoords(noa);</span>
<span class="nc bnc" id="L1080" title="All 2 branches missed.">	  if (e.getX() &lt;= m_nodes[noa].m_center + m_nodes[noa].m_side </span>
<span class="nc" id="L1081">	      &amp;&amp; e.getX() </span>
<span class="nc bnc" id="L1082" title="All 2 branches missed.">	      &gt;= m_nodes[noa].m_center - m_nodes[noa].m_side &amp;&amp;</span>
<span class="nc bnc" id="L1083" title="All 2 branches missed.">	      e.getY() &gt;= m_nodes[noa].m_top &amp;&amp; e.getY() </span>
<span class="nc bnc" id="L1084" title="All 2 branches missed.">	      &lt;= m_nodes[noa].m_top + m_nodes[noa].m_height) {</span>
	    //then it is this node that the mouse was clicked on
<span class="nc" id="L1086">	    s = noa;</span>
	  }
<span class="nc" id="L1088">	  m_nodes[noa].m_top = 32000;</span>
	}
      }
<span class="nc" id="L1091">      m_focusNode = s;</span>
      
<span class="nc bnc" id="L1093" title="All 2 branches missed.">      if (m_focusNode != -1) {</span>
<span class="nc bnc" id="L1094" title="All 2 branches missed.">	if (m_listener != null) {</span>
	  //then set this to be the selected node for editing
<span class="nc" id="L1096">	  actionPerformed(new ActionEvent(this, 32000, Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_ActionPerformed_Text_First&quot;)));</span>
	  
	}
	else {
	  //then open a visualize to display this nodes instances if possible
<span class="nc" id="L1101">	  actionPerformed(new ActionEvent(this, 32000, Messages.getInstance().getString(&quot;TreeVisualizer_ItemStateChanged_GetActionCommand_ActionPerformed_Text_Second&quot;)));</span>
	}
      }
    }
<span class="nc" id="L1105">  }</span>
  
  /**
   * Determines what action the user wants to perform.
   *
   * @param e the mouse event.
   */  
  public void mousePressed(MouseEvent e) {
<span class="nc" id="L1113">    m_frameLimiter.setRepeats(true);</span>
<span class="nc bnc" id="L1114" title="All 4 branches missed.">    if ((e.getModifiers() &amp; e.BUTTON1_MASK) != 0 &amp;&amp; !e.isAltDown() &amp;&amp; </span>
<span class="nc bnc" id="L1115" title="All 2 branches missed.">	m_mouseState == 0 </span>
<span class="nc bnc" id="L1116" title="All 2 branches missed.">	&amp;&amp; m_scaling == 0) {</span>
      //then the left mouse button has been pressed
      //check for modifiers
      
<span class="nc bnc" id="L1120" title="All 4 branches missed.">      if (((e.getModifiers() &amp; e.CTRL_MASK) != 0) &amp;&amp; ((e.getModifiers() &amp; e.SHIFT_MASK) == 0)) {</span>
	//then is in zoom out mode
<span class="nc" id="L1122">	m_mouseState = 2;</span>
      }
<span class="nc bnc" id="L1124" title="All 4 branches missed.">      else if (((e.getModifiers() &amp; e.SHIFT_MASK) != 0) &amp;&amp; ((e.getModifiers() &amp; e.CTRL_MASK) == 0)) {</span>
	//then is in zoom mode
	//note if both are pressed default action is to zoom out
<span class="nc" id="L1127">	m_oldMousePos.width = e.getX();</span>
<span class="nc" id="L1128">	m_oldMousePos.height = e.getY();</span>
<span class="nc" id="L1129">	m_newMousePos.width = e.getX();</span>
<span class="nc" id="L1130">	m_newMousePos.height = e.getY();</span>
<span class="nc" id="L1131">	m_mouseState = 3;</span>
	
<span class="nc" id="L1133">	Graphics g = getGraphics();</span>
<span class="nc bnc" id="L1134" title="All 2 branches missed.">	if (m_ZoomBoxColor == null)</span>
<span class="nc" id="L1135">	  g.setColor(Color.black);</span>
	else
<span class="nc" id="L1137">	  g.setColor(m_ZoomBoxColor);</span>
<span class="nc bnc" id="L1138" title="All 2 branches missed.">	if (m_ZoomBoxXORColor == null)</span>
<span class="nc" id="L1139">	  g.setXORMode(Color.white);</span>
	else
<span class="nc" id="L1141">	  g.setXORMode(m_ZoomBoxXORColor);</span>
<span class="nc" id="L1142">	g.drawRect(m_oldMousePos.width, m_oldMousePos.height,</span>
<span class="nc" id="L1143">		   m_newMousePos.width - m_oldMousePos.width, </span>
<span class="nc" id="L1144">		   m_newMousePos.height - m_oldMousePos.height);</span>
<span class="nc" id="L1145">	g.dispose();</span>
      }
      else {
	//no modifiers drag area around
<span class="nc" id="L1149">	m_oldMousePos.width = e.getX();</span>
<span class="nc" id="L1150">	m_oldMousePos.height = e.getY();</span>
<span class="nc" id="L1151">	m_newMousePos.width = e.getX();</span>
<span class="nc" id="L1152">	m_newMousePos.height = e.getY();</span>
<span class="nc" id="L1153">	m_mouseState = 1;</span>
<span class="nc" id="L1154">	m_frameLimiter.start();</span>
      }
      
    }
    // pop up save dialog explicitly (is somehow overridden...)
<span class="nc bnc" id="L1159" title="All 8 branches missed.">    else if ( (e.getButton() == MouseEvent.BUTTON1) &amp;&amp; e.isAltDown() &amp;&amp; e.isShiftDown() &amp;&amp; !e.isControlDown() ) {</span>
<span class="nc" id="L1160">      saveComponent();</span>
    }
<span class="nc bnc" id="L1162" title="All 2 branches missed.">    else if (m_mouseState == 0 &amp;&amp; m_scaling == 0) {</span>
      //either middle or right mouse button pushed
      //determine menu to use
      
    }
<span class="nc" id="L1167">  }</span>
  
  /**
   * Performs the final stages of what the user wants to perform.
   *
   * @param e the mouse event.
   */
  public void mouseReleased(MouseEvent e) {
<span class="nc bnc" id="L1175" title="All 2 branches missed.">    if (m_mouseState == 1) {</span>
      //this is used by mouseClicked to determine if it is alright to do 
      //something
<span class="nc" id="L1178">      m_clickAvailable = true;</span>
	//note that a standard click with the left mouse is pretty much the 
      //only safe input left to be assigned anything.
    }
    else {
<span class="nc" id="L1183">      m_clickAvailable = false;</span>
    }
<span class="nc bnc" id="L1185" title="All 4 branches missed.">    if (m_mouseState == 2 &amp;&amp; mouseInBounds(e)) {</span>
      //then zoom out;
<span class="nc" id="L1187">      m_mouseState = 0;</span>
<span class="nc" id="L1188">      Dimension ns = new Dimension(m_viewSize.width / 2, m_viewSize.height </span>
<span class="nc" id="L1189">				   / 2);</span>
<span class="nc bnc" id="L1190" title="All 2 branches missed.">      if (ns.width &lt; 10) {</span>
<span class="nc" id="L1191">	ns.width = 10;</span>
      }
<span class="nc bnc" id="L1193" title="All 2 branches missed.">      if (ns.height &lt; 10) {</span>
<span class="nc" id="L1194">	ns.height = 10;</span>
      }
      
<span class="nc" id="L1197">      Dimension d = getSize();</span>
<span class="nc" id="L1198">      Dimension np = new Dimension((int)(d.width / 2 </span>
<span class="nc" id="L1199">					 - ((double)d.width / 2 </span>
<span class="nc" id="L1200">					    - m_viewPos.width) / 2),</span>
<span class="nc" id="L1201">				   (int)(d.height / 2 </span>
<span class="nc" id="L1202">					 - ((double)d.height / 2</span>
<span class="nc" id="L1203">					    - m_viewPos.height) / 2));</span>
      
<span class="nc" id="L1205">      animateScaling(np, ns, 10);</span>
      
      //view_pos.width += view_size.width / 2;
      //view_pos.height += view_size.height / 2;
      
    }
<span class="nc bnc" id="L1211" title="All 2 branches missed.">    else if (m_mouseState == 3) {</span>
      //then zoom in
<span class="nc" id="L1213">      m_mouseState = 0;</span>
<span class="nc" id="L1214">      Graphics g = getGraphics();</span>
<span class="nc bnc" id="L1215" title="All 2 branches missed.">      if (m_ZoomBoxColor == null)</span>
<span class="nc" id="L1216">	g.setColor(Color.black);</span>
      else
<span class="nc" id="L1218">	g.setColor(m_ZoomBoxColor);</span>
<span class="nc bnc" id="L1219" title="All 2 branches missed.">      if (m_ZoomBoxXORColor == null)</span>
<span class="nc" id="L1220">	g.setXORMode(Color.white);</span>
      else
<span class="nc" id="L1222">	g.setXORMode(m_ZoomBoxXORColor);</span>
<span class="nc" id="L1223">      g.drawRect(m_oldMousePos.width, m_oldMousePos.height, </span>
<span class="nc" id="L1224">		 m_newMousePos.width - m_oldMousePos.width, </span>
<span class="nc" id="L1225">		 m_newMousePos.height - m_oldMousePos.height);</span>
<span class="nc" id="L1226">      g.dispose();</span>
      
      
      
<span class="nc" id="L1230">      int cw = m_newMousePos.width - m_oldMousePos.width;</span>
<span class="nc" id="L1231">      int ch = m_newMousePos.height - m_oldMousePos.height;</span>
<span class="nc bnc" id="L1232" title="All 4 branches missed.">      if (cw &gt;= 1 &amp;&amp; ch &gt;= 1) {</span>
<span class="nc bnc" id="L1233" title="All 2 branches missed.">	if (mouseInBounds(e) &amp;&amp; </span>
<span class="nc bnc" id="L1234" title="All 2 branches missed.">	    (getSize().width / cw) &lt;= 6 &amp;&amp;</span>
<span class="nc bnc" id="L1235" title="All 2 branches missed.">	    (getSize().height / ch) &lt;= 6) {</span>
	  
	  //now calculate new position and size
<span class="nc" id="L1238">	  Dimension ns = new Dimension();</span>
<span class="nc" id="L1239">	  Dimension np = new Dimension();</span>
<span class="nc" id="L1240">	  double nvsw = getSize().width / (double)(cw);</span>
<span class="nc" id="L1241">	  double nvsh = getSize().height / (double)(ch);</span>
<span class="nc" id="L1242">	  np.width = (int)((m_oldMousePos.width - m_viewPos.width) * -nvsw);</span>
<span class="nc" id="L1243">	  np.height = (int)((m_oldMousePos.height - m_viewPos.height) * -nvsh);</span>
<span class="nc" id="L1244">	  ns.width = (int)(m_viewSize.width * nvsw);</span>
<span class="nc" id="L1245">	  ns.height = (int)(m_viewSize.height * nvsh);</span>
	  
<span class="nc" id="L1247">	  animateScaling(np, ns, 10);</span>
	  
	  
	}
      }
    }
<span class="nc bnc" id="L1253" title="All 4 branches missed.">    else if (m_mouseState == 0 &amp;&amp; m_scaling == 0) {</span>
      //menu
<span class="nc" id="L1255">      m_mouseState = 0;</span>
<span class="nc" id="L1256">      setFont(new Font(&quot;A Name&quot;, 0, 12));</span>
      //determine if the click was on a node or not
<span class="nc" id="L1258">      int s = -1;</span>
      
<span class="nc bnc" id="L1260" title="All 2 branches missed.">      for (int noa = 0; noa &lt; m_numNodes;noa++) {</span>
<span class="nc bnc" id="L1261" title="All 2 branches missed.">	if (m_nodes[noa].m_quad == 18) {</span>
	  //then is on the screen
<span class="nc" id="L1263">	  calcScreenCoords(noa);</span>
<span class="nc bnc" id="L1264" title="All 2 branches missed.">	  if (e.getX() &lt;= m_nodes[noa].m_center + m_nodes[noa].m_side </span>
<span class="nc" id="L1265">	      &amp;&amp; e.getX() </span>
<span class="nc bnc" id="L1266" title="All 2 branches missed.">	      &gt;= m_nodes[noa].m_center - m_nodes[noa].m_side &amp;&amp;</span>
<span class="nc bnc" id="L1267" title="All 2 branches missed.">	      e.getY() &gt;= m_nodes[noa].m_top &amp;&amp; e.getY() </span>
<span class="nc bnc" id="L1268" title="All 2 branches missed.">	      &lt;= m_nodes[noa].m_top + m_nodes[noa].m_height) {</span>
	    //then it is this node that the mouse was clicked on
<span class="nc" id="L1270">	    s = noa;</span>
	  }
<span class="nc" id="L1272">	  m_nodes[noa].m_top = 32000;</span>
	}
      }
<span class="nc bnc" id="L1275" title="All 2 branches missed.">      if (s == -1) {</span>
	//the mouse wasn't clicked on a node
<span class="nc" id="L1277">	m_winMenu.show(this,e.getX(),e.getY());</span>
      }
      else {
	//the mouse was clicked on a node
<span class="nc" id="L1281">	m_focusNode = s;</span>
<span class="nc" id="L1282">	m_nodeMenu.show(this, e.getX(), e.getY());</span>
	
      }
<span class="nc" id="L1285">      setFont(m_currentFont);</span>
    }
<span class="nc bnc" id="L1287" title="All 2 branches missed.">    else if (m_mouseState == 1) {</span>
      //dragging
<span class="nc" id="L1289">      m_mouseState = 0;</span>
<span class="nc" id="L1290">      m_frameLimiter.stop();</span>
<span class="nc" id="L1291">      repaint();</span>
    }
    
<span class="nc" id="L1294">  }</span>
  
  /**
   * Checks to see if the coordinates of the mouse lie on this JPanel.
   *
   * @param e the mouse event.
   * @return true if the mouse lies on this JPanel. 
   */
  private boolean mouseInBounds(MouseEvent e) {
    //this returns true if the mouse is currently over the canvas otherwise 
    //false
    
<span class="nc bnc" id="L1306" title="All 6 branches missed.">    if (e.getX() &lt; 0 || e.getY() &lt; 0 || e.getX() &gt; getSize().width </span>
<span class="nc bnc" id="L1307" title="All 2 branches missed.">	|| e.getY() &gt; getSize().height) {</span>
<span class="nc" id="L1308">      return false;</span>
    }
<span class="nc" id="L1310">    return true;</span>
  }
  
  /**
   * Performs intermediate updates to what the user wishes to do.
   *
   * @param e the mouse event.
   */
  public void mouseDragged(MouseEvent e) {
    //use mouse state to determine what to do to the view of the tree
    
<span class="nc bnc" id="L1321" title="All 2 branches missed.">    if (m_mouseState == 1) {</span>
      //then dragging view
<span class="nc" id="L1323">      m_oldMousePos.width = m_newMousePos.width;</span>
<span class="nc" id="L1324">      m_oldMousePos.height = m_newMousePos.height;</span>
<span class="nc" id="L1325">      m_newMousePos.width = e.getX();</span>
<span class="nc" id="L1326">      m_newMousePos.height = e.getY();</span>
<span class="nc" id="L1327">      m_viewPos.width += m_newMousePos.width - m_oldMousePos.width;</span>
<span class="nc" id="L1328">      m_viewPos.height += m_newMousePos.height - m_oldMousePos.height;</span>
      
      
    }
<span class="nc bnc" id="L1332" title="All 2 branches missed.">    else if (m_mouseState == 3) {</span>
      //then zoom box being created
      //redraw the zoom box
<span class="nc" id="L1335">      Graphics g = getGraphics();</span>
<span class="nc bnc" id="L1336" title="All 2 branches missed.">      if (m_ZoomBoxColor == null)</span>
<span class="nc" id="L1337">	g.setColor(Color.black);</span>
      else
<span class="nc" id="L1339">	g.setColor(m_ZoomBoxColor);</span>
<span class="nc bnc" id="L1340" title="All 2 branches missed.">      if (m_ZoomBoxXORColor == null)</span>
<span class="nc" id="L1341">	g.setXORMode(Color.white);</span>
      else
<span class="nc" id="L1343">	g.setXORMode(m_ZoomBoxXORColor);</span>
<span class="nc" id="L1344">      g.drawRect(m_oldMousePos.width, m_oldMousePos.height,</span>
<span class="nc" id="L1345">		 m_newMousePos.width - m_oldMousePos.width, </span>
<span class="nc" id="L1346">		 m_newMousePos.height - m_oldMousePos.height);</span>
      
<span class="nc" id="L1348">      m_newMousePos.width = e.getX();</span>
<span class="nc" id="L1349">      m_newMousePos.height = e.getY();</span>
      
<span class="nc" id="L1351">      g.drawRect(m_oldMousePos.width, m_oldMousePos.height,</span>
<span class="nc" id="L1352">		 m_newMousePos.width - m_oldMousePos.width, </span>
<span class="nc" id="L1353">		 m_newMousePos.height - m_oldMousePos.height);</span>
<span class="nc" id="L1354">      g.dispose();</span>
    }
    
    
<span class="nc" id="L1358">  }</span>
  
  /**
   * Does nothing.
   *
   * @param e the mouse event.
   */
  public void mouseMoved(MouseEvent e) {
<span class="nc" id="L1366">  }</span>

  /**
   * Does nothing.
   *
   * @param e the mouse event.
   */
  public void mouseEntered(MouseEvent e) {
<span class="nc" id="L1374">  }</span>
  
  /**
   * Does nothing.
   * 
   * @param e the mouse event.
   */
  public void mouseExited(MouseEvent e) {
<span class="nc" id="L1382">  }</span>

  /**
   * Set the highlight for the node with the given id
   * @param id the id of the node to set the highlight for
   */
  public void setHighlight(String id) {
    //set the highlight for the node with the given id
    
<span class="nc bnc" id="L1391" title="All 2 branches missed.">    for (int noa = 0; noa &lt; m_numNodes; noa++) {</span>
<span class="nc bnc" id="L1392" title="All 2 branches missed.">      if (id.equals(m_nodes[noa].m_node.getRefer())) {</span>
	//then highlight this node
<span class="nc" id="L1394">	m_highlightNode = noa;</span>
      }
    }
    //System.out.println(&quot;ahuh &quot; + highlight_node + &quot; &quot; + 
    //nodes[0].node.getRefer());
<span class="nc" id="L1399">    repaint();</span>
    
<span class="nc" id="L1401">  }</span>
  
  /**
   * Updates the screen contents.
   *
   * @param g the drawing surface.
   */
  public void paintComponent(Graphics g) {
<span class="nc" id="L1409">    Color oldBackground = ((Graphics2D) g).getBackground();</span>
<span class="nc bnc" id="L1410" title="All 2 branches missed.">    if (m_BackgroundColor != null)</span>
<span class="nc" id="L1411">      ((Graphics2D) g).setBackground(m_BackgroundColor);</span>
<span class="nc" id="L1412">    g.clearRect(0, 0, getSize().width, getSize().height);</span>
<span class="nc" id="L1413">    ((Graphics2D) g).setBackground(oldBackground);</span>
<span class="nc" id="L1414">    g.setClip(3, 7, getWidth() - 6, getHeight() - 10);</span>
<span class="nc" id="L1415">    painter(g);</span>
<span class="nc" id="L1416">    g.setClip(0, 0, getWidth(), getHeight());</span>
    
<span class="nc" id="L1418">  }</span>

  /**
   * Draws the tree to the graphics context
   *
   * @param g the drawing surface.
   */
  private void painter(Graphics g) {
    //I have moved what would normally be in the paintComponent 
    //function to here 
    //for now so that if I do in fact need to do double 
    //buffering or the like it will be easier

    //this will go through the table of edges and draw the edge if it deems the
    //two nodes attached to it could cause it to cut the screen or be on it.
    
    //in the process flagging all nodes so that they can quickly be put to the
    //screen if they lie on it

    //I do it in this order because in some circumstances I have seen a line
    //cut through a node , to make things look better the line will
    //be drawn under the node


    //converting the screen edges to the node scale so that they 
    //can be positioned relative to the screen
    //note I give a buffer around the edges of the screen.
    
    //when seeing
    //if a node is on screen I only bother to check the nodes top centre 
    //if it has large enough size it may still fall onto the screen
<span class="nc" id="L1449">    double left_clip = (double)(-m_viewPos.width - 50) / m_viewSize.width;</span>
<span class="nc" id="L1450">    double right_clip = (double)(getSize().width - m_viewPos.width + 50) / </span>
<span class="nc" id="L1451">      m_viewSize.width;</span>
<span class="nc" id="L1452">    double top_clip = (double)(-m_viewPos.height - 50) / m_viewSize.height;</span>
<span class="nc" id="L1453">    double bottom_clip = (double)(getSize().height - m_viewPos.height + 50) / </span>
<span class="nc" id="L1454">      m_viewSize.height;</span>
  

    
    //  12 10  9           //the quadrants
    //  20 18 17
    //  36 34 33


    //first the edges must be rendered

    Edge e;
    Node r,s;
    double ncent,ntop;    

<span class="nc" id="L1469">    int row = 0, col = 0, pq, cq;</span>
<span class="nc bnc" id="L1470" title="All 2 branches missed.">    for (int noa = 0 ; noa &lt; m_numNodes ; noa++) {</span>
<span class="nc" id="L1471">      r = m_nodes[noa].m_node;</span>
<span class="nc bnc" id="L1472" title="All 2 branches missed.">      if (m_nodes[noa].m_change) {</span>
	//then recalc row component of quadrant
<span class="nc" id="L1474">	ntop = r.getTop();</span>
<span class="nc bnc" id="L1475" title="All 2 branches missed.">	if (ntop &lt; top_clip) {</span>
<span class="nc" id="L1476">	  row = 8;</span>
	}
<span class="nc bnc" id="L1478" title="All 2 branches missed.">	else if (ntop &gt; bottom_clip) {</span>
<span class="nc" id="L1479">	  row = 32;</span>
	}
	else {
<span class="nc" id="L1482">	  row = 16;</span>
	}
      }
      
      //calc the column the node falls in for the quadrant
<span class="nc" id="L1487">      ncent = r.getCenter();</span>
<span class="nc bnc" id="L1488" title="All 2 branches missed.">      if (ncent &lt; left_clip) {</span>
<span class="nc" id="L1489">	col = 4;</span>
      }
<span class="nc bnc" id="L1491" title="All 2 branches missed.">      else if (ncent &gt; right_clip) {</span>
<span class="nc" id="L1492">	col = 1;</span>
      }
      else {
<span class="nc" id="L1495">	col = 2;</span>
      }
      
<span class="nc" id="L1498">      m_nodes[noa].m_quad = row | col;</span>
      
<span class="nc bnc" id="L1500" title="All 2 branches missed.">      if (m_nodes[noa].m_parent &gt;= 0) {</span>
	//this will draw the edge if it should be drawn 
	//It will do this by eliminating all edges that definitely won't enter
	//the screen and then draw the rest
	
<span class="nc" id="L1505">	pq = m_nodes[m_edges[m_nodes[noa].m_parent].m_parent].m_quad;</span>
<span class="nc" id="L1506">	cq = m_nodes[noa].m_quad;</span>
	
	//note that this will need to be altered if more than 1 parent exists
<span class="nc bnc" id="L1509" title="All 2 branches missed.">	if ((cq &amp; 8) == 8) {</span>
	  //then child exists above screen
	}
<span class="nc bnc" id="L1512" title="All 2 branches missed.">	else if ((pq &amp; 32) == 32) {</span>
	  //then parent exists below screen
	}
<span class="nc bnc" id="L1515" title="All 4 branches missed.">	else if ((cq &amp; 4) == 4 &amp;&amp; (pq &amp; 4) == 4) {</span>
	  //then both child and parent exist to the left of the screen
	}
<span class="nc bnc" id="L1518" title="All 4 branches missed.">	else if ((cq &amp; 1) == 1 &amp;&amp; (pq &amp; 1) == 1) {</span>
	  //then both child and parent exist to the right of the screen
	}
	else {
	  //then draw the line
<span class="nc" id="L1523">	  drawLine(m_nodes[noa].m_parent, g);</span>
	}
      }
      
      //now draw the nodes
    }
    
<span class="nc bnc" id="L1530" title="All 2 branches missed.">    for (int noa = 0 ;noa &lt; m_numNodes; noa++) {</span>
<span class="nc bnc" id="L1531" title="All 2 branches missed.">      if (m_nodes[noa].m_quad == 18) {</span>
	//then the node is on the screen , draw it
<span class="nc" id="L1533">	drawNode(noa, g);</span>
      }
    }
    
<span class="nc bnc" id="L1537" title="All 4 branches missed.">    if (m_highlightNode &gt;= 0 &amp;&amp; m_highlightNode &lt; m_numNodes) {</span>
      //then draw outline
<span class="nc bnc" id="L1539" title="All 2 branches missed.">      if (m_nodes[m_highlightNode].m_quad == 18) {</span>
	Color acol;
<span class="nc bnc" id="L1541" title="All 2 branches missed.">	if (m_NodeColor == null)</span>
<span class="nc" id="L1542">	  acol = m_nodes[m_highlightNode].m_node.getColor();</span>
	else
<span class="nc" id="L1544">	  acol = m_NodeColor;</span>
<span class="nc" id="L1545">	g.setColor(new Color((acol.getRed() + 125) % 256, </span>
<span class="nc" id="L1546">			     (acol.getGreen() + 125) % 256, </span>
<span class="nc" id="L1547">			     (acol.getBlue() + 125) % 256));</span>
	//g.setXORMode(Color.white);
<span class="nc bnc" id="L1549" title="All 2 branches missed.">	if (m_nodes[m_highlightNode].m_node.getShape() == 1) {</span>
<span class="nc" id="L1550">	  g.drawRect(m_nodes[m_highlightNode].m_center </span>
<span class="nc" id="L1551">		     - m_nodes[m_highlightNode].m_side,</span>
<span class="nc" id="L1552">		     m_nodes[m_highlightNode].m_top, </span>
<span class="nc" id="L1553">		     m_nodes[m_highlightNode].m_width, </span>
<span class="nc" id="L1554">		     m_nodes[m_highlightNode].m_height);</span>
	  
<span class="nc" id="L1556">	  g.drawRect(m_nodes[m_highlightNode].m_center </span>
<span class="nc" id="L1557">		     - m_nodes[m_highlightNode].m_side </span>
<span class="nc" id="L1558">		     + 1, m_nodes[m_highlightNode].m_top + 1,</span>
<span class="nc" id="L1559">		     m_nodes[m_highlightNode].m_width - 2, </span>
<span class="nc" id="L1560">		     m_nodes[m_highlightNode].m_height - 2);</span>
	}
<span class="nc bnc" id="L1562" title="All 2 branches missed.">	else if (m_nodes[m_highlightNode].m_node.getShape() == 2) {</span>
<span class="nc" id="L1563">	  g.drawOval(m_nodes[m_highlightNode].m_center </span>
<span class="nc" id="L1564">		     - m_nodes[m_highlightNode].m_side,</span>
<span class="nc" id="L1565">		     m_nodes[m_highlightNode].m_top, </span>
<span class="nc" id="L1566">		     m_nodes[m_highlightNode].m_width, </span>
<span class="nc" id="L1567">		     m_nodes[m_highlightNode].m_height);</span>
	  
<span class="nc" id="L1569">	  g.drawOval(m_nodes[m_highlightNode].m_center </span>
<span class="nc" id="L1570">		     - m_nodes[m_highlightNode].m_side </span>
<span class="nc" id="L1571">		     + 1, m_nodes[m_highlightNode].m_top + 1,</span>
<span class="nc" id="L1572">		     m_nodes[m_highlightNode].m_width - 2, </span>
<span class="nc" id="L1573">		     m_nodes[m_highlightNode].m_height - 2);</span>
	}
      }
    }
    
<span class="nc bnc" id="L1578" title="All 2 branches missed.">    for (int noa = 0;noa &lt; m_numNodes;noa++) {</span>
      //this resets the coords so that next time a refresh occurs 
      //they don't accidentally get used
      //I will use 32000 to signify that they are invalid, even if this 
      //coordinate occurs it doesn't
      //matter as it is only for the sake of the caching
      
<span class="nc" id="L1585">      m_nodes[noa].m_top = 32000;</span>
    }
<span class="nc" id="L1587">  }</span>
  
  /**
   * Determines the attributes of the node and draws it.
   *
   * @param n A subscript identifying the node in &lt;i&gt;nodes&lt;/i&gt; array
   * @param g The drawing surface
   */
  private void drawNode(int n, Graphics g) {
    //this will draw a node and then print text on it
    
<span class="nc bnc" id="L1598" title="All 2 branches missed.">    if (m_NodeColor == null)</span>
<span class="nc" id="L1599">      g.setColor(m_nodes[n].m_node.getColor());</span>
    else
<span class="nc" id="L1601">      g.setColor(m_NodeColor);</span>
<span class="nc" id="L1602">    g.setPaintMode();</span>
<span class="nc" id="L1603">    calcScreenCoords(n);</span>
<span class="nc" id="L1604">    int x = m_nodes[n].m_center - m_nodes[n].m_side;</span>
<span class="nc" id="L1605">    int y = m_nodes[n].m_top;</span>
<span class="nc bnc" id="L1606" title="All 2 branches missed.">    if (m_nodes[n].m_node.getShape() == 1) {</span>
<span class="nc" id="L1607">      g.fill3DRect(x, y, m_nodes[n].m_width, m_nodes[n].m_height, true);</span>
<span class="nc" id="L1608">      drawText(x, y, n, false, g);</span>
      
    }
<span class="nc bnc" id="L1611" title="All 2 branches missed.">    else if (m_nodes[n].m_node.getShape() == 2) {</span>
      
<span class="nc" id="L1613">      g.fillOval(x, y, m_nodes[n].m_width, m_nodes[n].m_height);</span>
<span class="nc" id="L1614">      drawText(x, y + (int)(m_nodes[n].m_height * .15), n, false, g);</span>
    }
<span class="nc" id="L1616">  }</span>
  
  /**
   * Determines the attributes of the edge and draws it.
   *
   * @param e A subscript identifying the edge in &lt;i&gt;edges&lt;/i&gt; array.
   * @param g The drawing surface.
   */
  private void drawLine(int e, Graphics g) {
    //this will draw a line taking in the edge number and then getting 
    //the nodes subscript for the parent and child entries
    
    //this will draw a line that has been broken in the middle 
    //for the edge text to be displayed 
    //if applicable
    
    //first convert both parent and child node coords to screen coords
<span class="nc" id="L1633">    int p = m_edges[e].m_parent;</span>
<span class="nc" id="L1634">    int c = m_edges[e].m_child;</span>
<span class="nc" id="L1635">    calcScreenCoords(c);</span>
<span class="nc" id="L1636">    calcScreenCoords(p);</span>
    
<span class="nc bnc" id="L1638" title="All 2 branches missed.">    if (m_LineColor == null)</span>
<span class="nc" id="L1639">      g.setColor(Color.black);</span>
    else
<span class="nc" id="L1641">      g.setColor(m_LineColor);</span>
<span class="nc" id="L1642">    g.setPaintMode();</span>
    
<span class="nc bnc" id="L1644" title="All 2 branches missed.">    if (m_currentFont.getSize() &lt; 2) {</span>
      //text to small to bother cutting the edge
<span class="nc" id="L1646">      g.drawLine(m_nodes[p].m_center, m_nodes[p].m_top + m_nodes[p].m_height, </span>
<span class="nc" id="L1647">		 m_nodes[c].m_center, m_nodes[c].m_top); </span>
      
    }
    else {
      //find where to cut the edge to insert text
<span class="nc" id="L1652">      int e_width = m_nodes[c].m_center - m_nodes[p].m_center;</span>
<span class="nc" id="L1653">      int e_height = m_nodes[c].m_top - (m_nodes[p].m_top </span>
<span class="nc" id="L1654">					 + m_nodes[p].m_height);</span>
<span class="nc" id="L1655">      int e_width2 = e_width / 2;</span>
<span class="nc" id="L1656">      int e_height2 = e_height / 2;</span>
<span class="nc" id="L1657">      int e_centerx = m_nodes[p].m_center + e_width2;</span>
<span class="nc" id="L1658">      int e_centery = m_nodes[p].m_top + m_nodes[p].m_height + e_height2;</span>
<span class="nc" id="L1659">      int e_offset = m_edges[e].m_tb;</span>
      
<span class="nc" id="L1661">      int tmp = (int)(((double)e_width / e_height) * </span>
<span class="nc" id="L1662">		      (e_height2 - e_offset)) + m_nodes[p].m_center;</span>
      //System.out.println(edges[e].m_height);
      
      //draw text now
      
<span class="nc" id="L1667">      drawText(e_centerx - m_edges[e].m_side, e_centery - e_offset, e, true</span>
<span class="nc" id="L1668">	       , g);</span>
      
      
<span class="nc bnc" id="L1671" title="All 2 branches missed.">      if (tmp &gt; (e_centerx - m_edges[e].m_side) &amp;&amp; tmp </span>
<span class="nc bnc" id="L1672" title="All 2 branches missed.">	  &lt; (e_centerx + m_edges[e].m_side)) {</span>
	//then cut line on top and bottom of text
<span class="nc" id="L1674">	g.drawLine(m_nodes[p].m_center, m_nodes[p].m_top + m_nodes[p].m_height</span>
<span class="nc" id="L1675">		   , tmp, e_centery - e_offset);  //first segment</span>
<span class="nc" id="L1676">	g.drawLine(e_centerx * 2 - tmp, e_centery + e_offset, </span>
<span class="nc" id="L1677">		   m_nodes[c].m_center, m_nodes[c].m_top);    //second segment</span>
      }
      else {
<span class="nc" id="L1680">	e_offset = m_edges[e].m_side;</span>
<span class="nc bnc" id="L1681" title="All 2 branches missed.">	if (e_width &lt; 0) {</span>
<span class="nc" id="L1682">	  e_offset *= -1;   //adjusting for direction which could otherwise </span>
	  //screw up the calculation
	}
<span class="nc" id="L1685">	tmp = (int)(((double)e_height / e_width) * (e_width2 - e_offset)) + </span>
<span class="nc" id="L1686">	  m_nodes[p].m_top + m_nodes[p].m_height;</span>
	
<span class="nc" id="L1688">	g.drawLine(m_nodes[p].m_center, m_nodes[p].m_top + m_nodes[p].m_height</span>
<span class="nc" id="L1689">		   , e_centerx - e_offset, tmp);   //first segment</span>
<span class="nc" id="L1690">	g.drawLine(e_centerx + e_offset, e_centery * 2 - tmp, </span>
<span class="nc" id="L1691">		   m_nodes[c].m_center, m_nodes[c].m_top);  //second segment</span>
	
      }
    }
    //System.out.println(&quot;here&quot; + nodes[p].center);
<span class="nc" id="L1696">  }</span>

  /**
   * Draws the text for either an Edge or a Node.
   *
   * @param x1 the left side of the text area.
   * @param y1 the top of the text area.
   * @param s A subscript identifying either a Node or Edge.
   * @param e_or_n Distinguishes whether it is a node or edge.
   * @param g The drawing surface.
   */
  private void drawText(int x1, int y1, int s, boolean e_or_n, Graphics g) {
    //this function will take in the rectangle that the text should be 
    //drawn in as well as the subscript
    //for either the edge or node and a boolean variable to tell which
    
    // backup color
<span class="nc" id="L1713">    Color oldColor = g.getColor();</span>

<span class="nc" id="L1715">    g.setPaintMode();</span>
<span class="nc bnc" id="L1716" title="All 2 branches missed.">    if (m_FontColor == null)</span>
<span class="nc" id="L1717">      g.setColor(Color.black);</span>
    else
<span class="nc" id="L1719">      g.setColor(m_FontColor);</span>
    String st;
<span class="nc bnc" id="L1721" title="All 2 branches missed.">    if (e_or_n) {</span>
      //then paint for edge
<span class="nc" id="L1723">      Edge e = m_edges[s].m_edge;</span>
<span class="nc bnc" id="L1724" title="All 2 branches missed.">      for (int noa = 0;(st = e.getLine(noa)) != null; noa++) {</span>
<span class="nc" id="L1725">	g.drawString(st, (m_edges[s].m_width - m_fontSize.stringWidth(st)) / 2 </span>
<span class="nc" id="L1726">		     + x1,</span>
<span class="nc" id="L1727">		     y1 + (noa + 1) * m_fontSize.getHeight()); </span>
      }
    }
    else {
      //then paint for node
<span class="nc" id="L1732">      Node e = m_nodes[s].m_node;</span>
<span class="nc bnc" id="L1733" title="All 2 branches missed.">      for (int noa = 0;(st = e.getLine(noa)) != null; noa++) {</span>
<span class="nc" id="L1734">	g.drawString(st, (m_nodes[s].m_width - m_fontSize.stringWidth(st)) / 2 </span>
<span class="nc" id="L1735">		     + x1,</span>
<span class="nc" id="L1736">		     y1 + (noa + 1) * m_fontSize.getHeight()); </span>
      }
    }
    
    // restore color
<span class="nc" id="L1741">    g.setColor(oldColor);</span>
<span class="nc" id="L1742">  }</span>
  
  /**
   * Converts the internal coordinates of the node found from &lt;i&gt;n&lt;/i&gt;
   * and converts them to the actual screen coordinates.
   *
   * @param n A subscript identifying the Node.
   */
  private void calcScreenCoords(int n) {
    //this converts the coordinate system the Node uses into screen coordinates
    // System.out.println(n + &quot; &quot; + view_pos.height + &quot; &quot; + 
    //nodes[n].node.getCenter());
<span class="nc bnc" id="L1754" title="All 2 branches missed.">    if (m_nodes[n].m_top == 32000) {</span>
<span class="nc" id="L1755">      m_nodes[n].m_top = ((int)(m_nodes[n].m_node.getTop() </span>
<span class="nc" id="L1756">				* m_viewSize.height)) + m_viewPos.height;</span>
<span class="nc" id="L1757">      m_nodes[n].m_center = ((int)(m_nodes[n].m_node.getCenter() </span>
<span class="nc" id="L1758">				   * m_viewSize.width)) + m_viewPos.width;</span>
    }
<span class="nc" id="L1760">  }</span>

  /**
   * This Calculates the minimum size of the tree which will prevent any text
   * overlapping and make it readable, and then set the size of the tree to 
   * this.
   */
  private void autoScale() {
    //this function will determine the smallest scale value that keeps the text
    //from overlapping
    //it will leave the view centered
    
    int dist;
    Node ln,rn;
<span class="nc" id="L1774">    Dimension temp = new Dimension(10, 10);</span>
    
<span class="nc bnc" id="L1776" title="All 2 branches missed.">    if (m_numNodes &lt;= 1) {</span>
<span class="nc" id="L1777">      return;</span>
    }
    
    //calc height needed by first node
<span class="nc" id="L1781">    dist = (m_nodes[0].m_height + 40) * m_numLevels;</span>
<span class="nc bnc" id="L1782" title="All 2 branches missed.">    if (dist &gt; temp.height) {</span>
<span class="nc" id="L1783">      temp.height = dist;</span>
    }
    
<span class="nc bnc" id="L1786" title="All 2 branches missed.">    for (int noa = 0;noa &lt; m_numNodes - 1;noa++) {</span>
<span class="nc" id="L1787">      calcScreenCoords(noa);  </span>
<span class="nc" id="L1788">      calcScreenCoords(noa+1);</span>
<span class="nc bnc" id="L1789" title="All 2 branches missed.">      if (m_nodes[noa+1].m_change) {</span>
	//then on a new level so don't check width this time round
      }
      else {
	
<span class="nc" id="L1794">	dist = m_nodes[noa+1].m_center - m_nodes[noa].m_center; </span>
	//the distance between the node centers, along horiz
<span class="nc bnc" id="L1796" title="All 2 branches missed.">	if (dist &lt;= 0) {</span>
<span class="nc" id="L1797">	  dist = 1;</span>
	}
<span class="nc" id="L1799">	dist = ((6 + m_nodes[noa].m_side + m_nodes[noa+1].m_side) </span>
<span class="nc" id="L1800">		* m_viewSize.width) / dist; //calc optimal size for width</span>
	
<span class="nc bnc" id="L1802" title="All 2 branches missed.">	if (dist &gt; temp.width) {</span>
	  
<span class="nc" id="L1804">	  temp.width = dist;</span>
	}
      }
      //now calc.. minimun hieght needed by nodes
      
<span class="nc" id="L1809">      dist = (m_nodes[noa+1].m_height + 40) * m_numLevels;</span>
<span class="nc bnc" id="L1810" title="All 2 branches missed.">      if (dist &gt; temp.height) {</span>
	
<span class="nc" id="L1812">	temp.height = dist;</span>
      }
    }
    
    int y1, y2, xa, xb;
    
<span class="nc" id="L1818">    y1 = m_nodes[m_edges[0].m_parent].m_top;</span>
<span class="nc" id="L1819">    y2 = m_nodes[m_edges[0].m_child].m_top;</span>
    
<span class="nc" id="L1821">    dist = y2 - y1;</span>
<span class="nc bnc" id="L1822" title="All 2 branches missed.">    if (dist &lt;= 0) {</span>
<span class="nc" id="L1823">      dist = 1;</span>
    }
<span class="nc" id="L1825">    dist = ((60 + m_edges[0].m_height + m_nodes[m_edges[0].m_parent].m_height) </span>
<span class="nc" id="L1826">	    * m_viewSize.height) / dist;</span>
<span class="nc bnc" id="L1827" title="All 2 branches missed.">    if (dist &gt; temp.height) {</span>
      
<span class="nc" id="L1829">      temp.height = dist;</span>
    }
    
<span class="nc bnc" id="L1832" title="All 2 branches missed.">    for (int noa = 0;noa &lt; m_numNodes - 2; noa++) {</span>
      //check the edges now
<span class="nc bnc" id="L1834" title="All 2 branches missed.">      if (m_nodes[m_edges[noa+1].m_child].m_change) {</span>
	//then edge is on a different level , so skip this one
      }
      else {
	//calc the width requirements of this pair of edges
	
<span class="nc" id="L1840">	xa = m_nodes[m_edges[noa].m_child].m_center </span>
<span class="nc" id="L1841">	  - m_nodes[m_edges[noa].m_parent].m_center;</span>
<span class="nc" id="L1842">	xa /= 2;</span>
<span class="nc" id="L1843">	xa += m_nodes[m_edges[noa].m_parent].m_center;</span>
	
<span class="nc" id="L1845">	xb = m_nodes[m_edges[noa+1].m_child].m_center - </span>
<span class="nc" id="L1846">	  m_nodes[m_edges[noa+1].m_parent].m_center;</span>
<span class="nc" id="L1847">	xb /= 2;</span>
<span class="nc" id="L1848">	xb += m_nodes[m_edges[noa+1].m_parent].m_center;</span>
	
<span class="nc" id="L1850">	dist = xb - xa;</span>
<span class="nc bnc" id="L1851" title="All 2 branches missed.">	if (dist &lt;= 0) {</span>
<span class="nc" id="L1852">	  dist = 1;</span>
	}
<span class="nc" id="L1854">	dist = ((12 + m_edges[noa].m_side + m_edges[noa+1].m_side) </span>
<span class="nc" id="L1855">		* m_viewSize.width) </span>
<span class="nc" id="L1856">	  / dist;</span>
<span class="nc bnc" id="L1857" title="All 2 branches missed.">	if (dist &gt; temp.width) {</span>
	  
<span class="nc" id="L1859">	  temp.width = dist;</span>
	}
      }
      //now calc height need by the edges
<span class="nc" id="L1863">      y1 = m_nodes[m_edges[noa+1].m_parent].m_top;</span>
<span class="nc" id="L1864">      y2 = m_nodes[m_edges[noa+1].m_child].m_top;</span>
      
<span class="nc" id="L1866">      dist = y2 - y1;</span>
<span class="nc bnc" id="L1867" title="All 2 branches missed.">      if (dist &lt;= 0) {</span>
	
<span class="nc" id="L1869">	dist = 1;</span>
      }
<span class="nc" id="L1871">      dist = ((60 + m_edges[noa+1].m_height </span>
<span class="nc" id="L1872">	       + m_nodes[m_edges[noa+1].m_parent].m_height) </span>
<span class="nc" id="L1873">	      * m_viewSize.height) / dist;</span>
      
<span class="nc bnc" id="L1875" title="All 2 branches missed.">      if (dist &gt; temp.height) {</span>
	
<span class="nc" id="L1877">	temp.height = dist;</span>
      }
    }

<span class="nc" id="L1881">    Dimension e = getSize();</span>
    
<span class="nc" id="L1883">    Dimension np = new Dimension();</span>
<span class="nc" id="L1884">    np.width = (int)(e.width / 2 -  (((double)e.width / 2) - m_viewPos.width) /</span>
<span class="nc" id="L1885">		     ((double)m_viewSize.width) * (double)temp.width);</span>
<span class="nc" id="L1886">    np.height = (int)(e.height / 2 -  (((double)e.height / 2) - </span>
<span class="nc" id="L1887">				       m_viewPos.height) /       </span>
<span class="nc" id="L1888">		      ((double)m_viewSize.height) * (double)temp.height);</span>
    //animate_scaling(c_size,c_pos,25);
    
<span class="nc bnc" id="L1891" title="All 2 branches missed.">    for (int noa = 0;noa &lt; m_numNodes;noa++) {</span>
      //this resets the coords so that next time a refresh occurs they don't 
      //accidentally get used
      //I will use 32000 to signify that they are invalid, even if this 
      //coordinate occurs it doesn't
      //matter as it is only for the sake of the caching
      
<span class="nc" id="L1898">      m_nodes[noa].m_top = 32000;</span>
      
    }
<span class="nc" id="L1901">    animateScaling(np, temp, 10);</span>
<span class="nc" id="L1902">  }</span>

  /**
   * This will increment the size and position of the tree towards the 
   * desired size and position
   * a little (depending on the value of &lt;i&gt;frames&lt;/i&gt;) everytime it is called.
   *
   * @param n_pos The final position of the tree wanted.
   * @param n_size The final size of the tree wanted.
   * @param frames The number of frames that shall occur before the final 
   * size and pos is reached.
   */
  private void animateScaling(Dimension n_pos,Dimension n_size,int frames) {
    //this function will take new size and position coords , and incrementally
    //scale the view to these
    //since I will be tying it in with the framelimiter I will simply call 
    //this function and increment it once
    //I will have to use a global variable since I am doing it proportionally

<span class="nc bnc" id="L1921" title="All 2 branches missed.">    if (frames == 0) {</span>
<span class="nc" id="L1922">      System.out.println(Messages.getInstance().getString(&quot;TreeVisualizer_AnimateScaling_Text&quot;));</span>
<span class="nc" id="L1923">      m_scaling = 0;</span>
    }
    else {
<span class="nc bnc" id="L1926" title="All 2 branches missed.">      if (m_scaling == 0) {</span>
	//new animate session
	//start timer and set scaling
<span class="nc" id="L1929">	m_frameLimiter.start();</span>
<span class="nc" id="L1930">	m_nViewPos.width = n_pos.width;</span>
<span class="nc" id="L1931">	m_nViewPos.height = n_pos.height;</span>
<span class="nc" id="L1932">	m_nViewSize.width = n_size.width;</span>
<span class="nc" id="L1933">	m_nViewSize.height = n_size.height;</span>
	
<span class="nc" id="L1935">	m_scaling = frames;</span>
      }
      
<span class="nc" id="L1938">      int s_w = (n_size.width - m_viewSize.width) / frames;</span>
<span class="nc" id="L1939">      int s_h = (n_size.height - m_viewSize.height) / frames;</span>
<span class="nc" id="L1940">      int p_w = (n_pos.width - m_viewPos.width) / frames;</span>
<span class="nc" id="L1941">      int p_h = (n_pos.height - m_viewPos.height) / frames;</span>
      
<span class="nc" id="L1943">      m_viewSize.width += s_w;</span>
<span class="nc" id="L1944">      m_viewSize.height += s_h;</span>
      
<span class="nc" id="L1946">      m_viewPos.width += p_w;</span>
<span class="nc" id="L1947">      m_viewPos.height += p_h;</span>
      
<span class="nc" id="L1949">      repaint();</span>
      
<span class="nc" id="L1951">      m_scaling--;</span>
<span class="nc bnc" id="L1952" title="All 2 branches missed.">      if (m_scaling == 0) {</span>
	//all done 
<span class="nc" id="L1954">	m_frameLimiter.stop();</span>
      }
    }
<span class="nc" id="L1957">  }</span>
  
  /**
   * This will change the font size for displaying the tree to the one 
   * specified.
   *
   * @param s The new pointsize of the font.
   */
  private void changeFontSize(int s) {
    //this will set up the new font that shall be used
    //it will also recalculate the size of the nodes as these will change as 
    //a result of 
    //the new font size
<span class="nc" id="L1970">    setFont(m_currentFont = new Font(&quot;A Name&quot;, 0, s));             </span>

<span class="nc" id="L1972">    m_fontSize = getFontMetrics(getFont());</span>
    
    Dimension d;

<span class="nc bnc" id="L1976" title="All 2 branches missed.">    for (int noa = 0; noa &lt; m_numNodes; noa++) {</span>
      //this will set the size info for each node and edge
      
<span class="nc" id="L1979">      d = m_nodes[noa].m_node.stringSize(m_fontSize);</span>
      
<span class="nc bnc" id="L1981" title="All 2 branches missed.">      if (m_nodes[noa].m_node.getShape() == 1) {</span>
<span class="nc" id="L1982">	m_nodes[noa].m_height = d.height + 10;</span>
<span class="nc" id="L1983">	m_nodes[noa].m_width = d.width + 8;</span>
<span class="nc" id="L1984">	m_nodes[noa].m_side = m_nodes[noa].m_width / 2;</span>
      }
<span class="nc bnc" id="L1986" title="All 2 branches missed.">      else if (m_nodes[noa].m_node.getShape() == 2) {</span>
<span class="nc" id="L1987">	m_nodes[noa].m_height = (int)((d.height + 2) * 1.6);</span>
<span class="nc" id="L1988">	m_nodes[noa].m_width = (int)((d.width + 2) * 1.6);</span>
<span class="nc" id="L1989">	m_nodes[noa].m_side = m_nodes[noa].m_width / 2;</span>
      }
      
<span class="nc bnc" id="L1992" title="All 2 branches missed.">      if (noa &lt; m_numNodes - 1) {</span>
	//this will do the same for edges
	
<span class="nc" id="L1995">	d = m_edges[noa].m_edge.stringSize(m_fontSize);</span>
	
<span class="nc" id="L1997">	m_edges[noa].m_height =  d.height + 8;</span>
<span class="nc" id="L1998">	m_edges[noa].m_width = d.width + 8;</span>
<span class="nc" id="L1999">	m_edges[noa].m_side = m_edges[noa].m_width / 2;</span>
<span class="nc" id="L2000">	m_edges[noa].m_tb = m_edges[noa].m_height / 2;</span>
      }
    }
<span class="nc" id="L2003">  }</span>

  /**
   * This will fill two arrays with the Nodes and Edges from the tree
   * into a particular order.
   *
   * @param t The top Node of the tree.
   * @param l An array that has already been allocated, to be filled.
   * @param k An array that has already been allocated, to be filled.
   */
  private void arrayFill(Node t, NodeInfo[] l, EdgeInfo[] k) {
    
    //this will take the top node and the array to fill
    //it will go through the tree structure and and fill the array with the 
    //nodes 
    //from top to bottom left to right
    
    //note I do not believe this function will be able to deal with multiple 
    //parents

<span class="nc bnc" id="L2023" title="All 4 branches missed.">    if (t == null || l == null) {</span>
<span class="nc" id="L2024">      System.exit(1);      //this is just a preliminary safety check </span>
      //(i shouldn' need it)
    }
    
    Edge e;
    Node r,s;
<span class="nc" id="L2030">    l[0] = new NodeInfo();</span>
<span class="nc" id="L2031">    l[0].m_node = t;</span>
<span class="nc" id="L2032">    l[0].m_parent = -1;</span>
<span class="nc" id="L2033">    l[0].m_change = true;</span>
    
    int floater;       //this will point at a node that has previously been 
    //put in the list 
    //all of the children that this node has shall be put in the list , 
    //once this is done the floater shall point at the next node in the list
    //this will allow the nodes to be put into order from closest to top node
    //to furtherest from top node

<span class="nc" id="L2042">    int free_space = 1; //the next empty array position</span>

<span class="nc" id="L2044">    double height = t.getTop(); //this will be used to determine if the node </span>
    //has a 
    //new height compared to the
    //previous one

<span class="nc bnc" id="L2049" title="All 2 branches missed.">    for (floater = 0;floater &lt; free_space;floater++) {</span>
<span class="nc" id="L2050">      r = l[floater].m_node;</span>
<span class="nc bnc" id="L2051" title="All 2 branches missed.">      for (int noa = 0;(e = r.getChild(noa)) != null;noa++) {</span>
	//this loop pulls out each child of r
	
	//e points to a child edge, getTarget will return that edges child node
<span class="nc" id="L2055">	s = e.getTarget();</span>
<span class="nc" id="L2056">	l[free_space] = new NodeInfo();</span>
<span class="nc" id="L2057">	l[free_space].m_node = s;</span>
<span class="nc" id="L2058">	l[free_space].m_parent = free_space - 1;</span>
	
<span class="nc" id="L2060">	k[free_space - 1] = new EdgeInfo();</span>
<span class="nc" id="L2061">	k[free_space - 1].m_edge = e;</span>
<span class="nc" id="L2062">	k[free_space - 1].m_parent = floater;</span>
<span class="nc" id="L2063">	k[free_space - 1].m_child = free_space;     //note although it's child </span>
	//will always have a subscript
	//of 1 more , I may not nessecarily have access to that
	//and it will need the subscr.. for multiple parents
	
	//determine if level of node has changed from previous one
<span class="nc bnc" id="L2069" title="All 2 branches missed.">	if (height != s.getTop()) {</span>
<span class="nc" id="L2070">	  l[free_space].m_change = true;</span>
<span class="nc" id="L2071">	  height = s.getTop();</span>
	}
	else {
<span class="nc" id="L2074">	  l[free_space].m_change = false;</span>
	}
<span class="nc" id="L2076">	free_space++;</span>
      }
    }
<span class="nc" id="L2079">  }</span>

  /**
   * Internal Class for containing display information about a Node. 
   */
<span class="nc" id="L2084">  private class NodeInfo {</span>
    //this class contains a pointer to the node itself along with extra 
    //information
    //about the node used by the Displayer class

    /** The y pos of the node on screen. */
<span class="nc" id="L2090">    int m_top = 32000;           //the main node coords calculated out</span>

    /** The x pos of the node on screen. */
    int m_center;        // these coords will probably change each refresh 

    //and are the positioning coords
    //which the rest of the offsets use
    
    /** The offset to get to the left or right of the node. */
    int m_side;          //these are the screen offset for the dimensions of 

    //the node relative to the nodes 
    //internal top and center values (after they have been converted to 
    //screen coords
    /** The width of the node. */
    int m_width;

    /** The height of the node. */
    int m_height;

    /** True if the node is at the start (left) of a new level (not sibling 
     * group). */
    boolean m_change;    //this is quickly used to identify whether the node 
    //has chenged height from the
    //previous one to help speed up the calculation of what row it lies in

    /** The subscript number of the Nodes parent. */
    int m_parent;     //this is the index of the nodes parent edge in an array

    /** The rough position of the node relative to the screen. */
    int m_quad;       //what of nine quadrants is it in

    /*
      12 10  9
      20 18 17          //18 being the screen
      36 34 33          //this arrangement uses 6 bits, each bit represents a 
      row or column
    */

    /** The Node itself. */
    Node m_node;
  }

  /**
   * Internal Class for containing display information about an Edge. 
   */
<span class="nc" id="L2136">  private class EdgeInfo {</span>
    //this class contains a pointer to the edge along with all the other
    //extra info about the edge
    
    /** The parent subscript (for a Node). */
    int m_parent;            //array indexs for its two connections

    /** The child subscript (for a Node). */
    int m_child;
    

    /** The distance from the center of the text to either side. */
    int m_side;            //these are used to describe the dimensions of the 
    //text

    /** The distance from the center of the text to top or bottom. */
    int m_tb;              //tb stands for top , bottom, this is simply the 
    //distance from the middle to top bottom

    /** The width of the text. */
    int m_width;

    /** The height of the text. */
    int m_height;

    /** The Edge itself. */
    Edge m_edge;
  }

  /**
   * Main method for testing this class.
   * @param args first argument should be the name of a file that contains
   * a tree discription in dot format.
   */
  public static void main(String[] args) {
    try {
<span class="nc" id="L2172">      weka.core.logging.Logger.log(weka.core.logging.Logger.Level.INFO, Messages.getInstance().getString(&quot;TreeVisualizer_Main_Logger_Text&quot;));</span>
      //put in the random data generator right here
      // this call with import java.lang gives me between 0 and 1 Math.random
<span class="nc" id="L2175">      TreeBuild builder = new TreeBuild();</span>
<span class="nc" id="L2176">      Node top = null;</span>
<span class="nc" id="L2177">      NodePlace arrange = new PlaceNode2();</span>
      //top = builder.create(new StringReader(&quot;digraph atree { top [label=\&quot;the top\&quot;] a [label=\&quot;the first node\&quot;] b [label=\&quot;the second nodes\&quot;] c [label=\&quot;comes off of first\&quot;] top-&gt;a top-&gt;b b-&gt;c }&quot;));
<span class="nc" id="L2179">      top = builder.create(new FileReader(args[0]));</span>

<span class="nc" id="L2181">      int num = top.getCount(top,0);</span>
      //System.out.println(&quot;counter counted &quot; + num + &quot; nodes&quot;);
      //System.out.println(&quot;there are &quot; + num + &quot; nodes&quot;);
<span class="nc" id="L2184">      TreeVisualizer a = new TreeVisualizer(null, top, arrange);</span>
<span class="nc" id="L2185">      a.setSize(800 ,600);</span>
      //a.setTree(top);
      JFrame f;
<span class="nc" id="L2188">      f = new JFrame();</span>
      //a.addMouseMotionListener(a);
      //a.addMouseListener(a);
      //f.add(a);
<span class="nc" id="L2192">      Container contentPane = f.getContentPane();</span>
<span class="nc" id="L2193">      contentPane.add(a);</span>
<span class="nc" id="L2194">      f.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);</span>
<span class="nc" id="L2195">      f.setSize(800,600);</span>
<span class="nc" id="L2196">      f.setVisible(true);</span>
      //f.
      //find_prop(top);
      //a.setTree(top,arrange);//,(num + 1000), num / 2 + 1000);
    }
<span class="nc" id="L2201">    catch(IOException e) {</span>
      // ignored
    }
<span class="nc" id="L2204">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>