<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>GUI.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.classifiers.bayes.net</a> &gt; <span class="el_source">GUI.java</span></div><h1>GUI.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">/*</span>
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 *    GUI.java
 *    Copyright (C) 2007 University of Waikato, Hamilton, New Zealand
 *
 */
package weka.classifiers.bayes.net;

import weka.classifiers.bayes.net.MarginCalculator.JunctionTreeNode;
import weka.core.FastVector;
import weka.core.Instances;
import weka.core.OptionHandler;
import weka.core.SerializedObject;
import weka.core.Utils;
import weka.core.converters.AbstractFileLoader;
import weka.core.converters.AbstractFileSaver;
import weka.core.converters.ArffSaver;
import weka.core.converters.ConverterUtils;
import weka.gui.ConverterFileChooser;
import weka.gui.ExtensionFileFilter;
import weka.gui.GenericObjectEditor;
import weka.gui.LookAndFeel;
import weka.gui.PropertyDialog;
import weka.gui.graphvisualizer.BIFFormatException;
import weka.gui.graphvisualizer.BIFParser;
import weka.gui.graphvisualizer.GraphNode;
import weka.gui.graphvisualizer.HierarchicalBCEngine;
import weka.gui.graphvisualizer.LayoutCompleteEvent;
import weka.gui.graphvisualizer.LayoutCompleteEventListener;
import weka.gui.graphvisualizer.LayoutEngine;
import weka.gui.visualize.PrintablePanel;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Container;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.FontMetrics;
import java.awt.Frame;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.GridLayout;
import java.awt.Insets;
import java.awt.Rectangle;
import java.awt.RenderingHints;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.MouseMotionAdapter;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.awt.image.BufferedImage;
import java.awt.print.PageFormat;
import java.awt.print.Printable;
import java.awt.print.PrinterException;
import java.awt.print.PrinterJob;
import java.beans.PropertyEditor;
import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Random;

import javax.swing.AbstractAction;
import javax.swing.Action;
import javax.swing.BorderFactory;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JCheckBoxMenuItem;
import javax.swing.JDialog;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JPopupMenu;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.JToolBar;
import javax.swing.KeyStroke;
import javax.swing.table.AbstractTableModel;

/**
 * GUI interface to Bayesian Networks. Allows editing Bayesian networks
 * on screen and provides GUI interface to various Bayesian network facilities
 * in Weka, including random network generation, data set generation and
 * Bayesion network inference.
 * 
 * @author Remco Bouckaert (remco@cs.waikato.ac.nz)
 * @version $Revision: 4905 $
 */
public class GUI extends JPanel implements LayoutCompleteEventListener {

	/** for serialization */
	private static final long serialVersionUID = -2038911085935515624L;

	/** The current LayoutEngine */
	protected LayoutEngine m_layoutEngine;

	/** Panel actually displaying the graph */
	protected GraphPanel m_GraphPanel;

	/** Container of Bayesian network */
<span class="nc" id="L127">	EditableBayesNet m_BayesNet = new EditableBayesNet(true);</span>

	/** String containing file name storing current network */
<span class="nc" id="L130">	protected String m_sFileName = &quot;&quot;;</span>
	/** used for calculating marginals in Bayesian netwowrks */
<span class="nc" id="L132">	MarginCalculator m_marginCalculator = null;</span>

	/**
	 * used for calculating marginals in Bayesian netwowrks when evidence is
	 * present
	 */
<span class="nc" id="L138">	MarginCalculator m_marginCalculatorWithEvidence = null;</span>

	/** flag indicating whether marginal distributions of each of the nodes 
	 * should be shown in display.
	 */
<span class="nc" id="L143">	boolean m_bViewMargins = false;</span>
<span class="nc" id="L144">	boolean m_bViewCliques = false;</span>
	
	/** The menu bar */
	private JMenuBar m_menuBar;

	/** data selected from file. Used to train a Bayesian network on */
<span class="nc" id="L150">	Instances m_Instances = null;</span>

	/** Text field for specifying zoom */
	final JTextField m_jTfZoom;
	/** toolbar containing buttons at top of window */
	final JToolBar m_jTbTools;
	/** status bar at bottom of window */
	final JLabel m_jStatusBar;
	/** TextField for node's width */
<span class="nc" id="L159">	private final JTextField m_jTfNodeWidth = new JTextField(3);</span>
	/** TextField for nodes height */
<span class="nc" id="L161">	private final JTextField m_jTfNodeHeight = new JTextField(3);</span>
	/** this contains the m_GraphPanel GraphPanel */
	JScrollPane m_jScrollPane;

	/** path for icons */
<span class="nc" id="L166">	private final String ICONPATH = &quot;weka/classifiers/bayes/net/icons/&quot;;</span>

	/** current zoom value */
<span class="nc" id="L169">	private double m_fScale = 1;</span>

	/** standard width of node */
<span class="nc" id="L172">	private int m_nNodeHeight = 2 * getFontMetrics(getFont()).getHeight();</span>
	/** standard height of node */
	final static int DEFAULT_NODE_WIDTH = 50;
<span class="nc" id="L175">	private int m_nNodeWidth = DEFAULT_NODE_WIDTH;</span>
	/** width of node, allowing for some padding */	
	final static int PADDING = 10;
<span class="nc" id="L178">	private int m_nPaddedNodeWidth = DEFAULT_NODE_WIDTH + PADDING;</span>


	/** used when using zoomIn and zoomOut buttons */
<span class="nc" id="L182">	private int [] m_nZoomPercents = { 10, 25, 50, 75, 100, 125, 150, 175, 200, 225, 250, 275, 300, 350, 400, 450, 500,</span>
<span class="nc" id="L183">			550, 600, 650, 700, 800, 900, 999 };</span>

	/** actions triggered by GUI events */
<span class="nc" id="L186">	Action a_new = new ActionNew();</span>

<span class="nc" id="L188">	Action a_quit = new ActionQuit();</span>
<span class="nc" id="L189">	Action a_save = new ActionSave();</span>
<span class="nc" id="L190">	ActionExport a_export = new ActionExport();</span>
<span class="nc" id="L191">	ActionPrint a_print = new ActionPrint();</span>
<span class="nc" id="L192">	Action a_load = new ActionLoad();</span>
<span class="nc" id="L193">	Action a_zoomin = new ActionZoomIn();</span>
<span class="nc" id="L194">	Action a_zoomout = new ActionZoomOut();</span>
<span class="nc" id="L195">	Action a_layout = new ActionLayout();</span>

<span class="nc" id="L197">	Action a_saveas = new ActionSaveAs();</span>

<span class="nc" id="L199">	Action a_viewtoolbar = new ActionViewToolbar();</span>

<span class="nc" id="L201">	Action a_viewstatusbar = new ActionViewStatusbar();</span>

<span class="nc" id="L203">	Action a_networkgenerator = new ActionGenerateNetwork();</span>

<span class="nc" id="L205">	Action a_datagenerator = new ActionGenerateData();</span>

<span class="nc" id="L207">	Action a_datasetter = new ActionSetData();</span>

<span class="nc" id="L209">	Action a_learn = new ActionLearn();</span>
<span class="nc" id="L210">	Action a_learnCPT = new ActionLearnCPT();</span>

<span class="nc" id="L212">	Action a_help = new ActionHelp();</span>

<span class="nc" id="L214">	Action a_about = new ActionAbout();</span>

<span class="nc" id="L216">	ActionAddNode a_addnode = new ActionAddNode();</span>

<span class="nc" id="L218">	Action a_delnode = new ActionDeleteNode();</span>
<span class="nc" id="L219">	Action a_cutnode = new ActionCutNode();</span>
<span class="nc" id="L220">	Action a_copynode = new ActionCopyNode();</span>
<span class="nc" id="L221">	Action a_pastenode = new ActionPasteNode();</span>
<span class="nc" id="L222">	Action a_selectall = new ActionSelectAll();</span>

<span class="nc" id="L224">	Action a_addarc = new ActionAddArc();</span>

<span class="nc" id="L226">	Action a_delarc = new ActionDeleteArc();</span>

<span class="nc" id="L228">	Action a_undo = new ActionUndo();</span>

<span class="nc" id="L230">	Action a_redo= new ActionRedo();</span>
	
<span class="nc" id="L232">	Action a_alignleft = new ActionAlignLeft();</span>
<span class="nc" id="L233">	Action a_alignright = new ActionAlignRight();</span>
<span class="nc" id="L234">	Action a_aligntop = new ActionAlignTop();</span>
<span class="nc" id="L235">	Action a_alignbottom = new ActionAlignBottom();</span>
<span class="nc" id="L236">	Action a_centerhorizontal = new ActionCenterHorizontal();</span>
<span class="nc" id="L237">	Action a_centervertical = new ActionCenterVertical();</span>
<span class="nc" id="L238">	Action a_spacehorizontal = new ActionSpaceHorizontal();</span>
<span class="nc" id="L239">	Action a_spacevertical = new ActionSpaceVertical();</span>
	
	/** node currently selected through right clicking */
<span class="nc" id="L242">	int m_nCurrentNode = -1;</span>
	/** selection of nodes */
<span class="nc" id="L244">	Selection m_Selection = new Selection();</span>
	/** selection rectangle drawn through dragging with left mouse button */
<span class="nc" id="L246">	Rectangle m_nSelectedRect = null;</span>

	
	class Selection {
		FastVector m_selected;
<span class="nc" id="L251">		public Selection() {</span>
<span class="nc" id="L252">			m_selected = new FastVector();</span>
<span class="nc" id="L253">		} // c'tor</span>
<span class="nc" id="L254">		public FastVector getSelected() {return m_selected;}</span>
		void updateGUI() {
<span class="nc bnc" id="L256" title="All 2 branches missed.">			if (m_selected.size() &gt; 0) {</span>
<span class="nc" id="L257">				a_cutnode.setEnabled(true);</span>
<span class="nc" id="L258">				a_copynode.setEnabled(true);</span>
			} else {
<span class="nc" id="L260">				a_cutnode.setEnabled(false);</span>
<span class="nc" id="L261">				a_copynode.setEnabled(false);</span>
			}
<span class="nc bnc" id="L263" title="All 2 branches missed.">			if (m_selected.size() &gt; 1) {</span>
<span class="nc" id="L264">				a_alignleft.setEnabled(true);</span>
<span class="nc" id="L265">				a_alignright.setEnabled(true);</span>
<span class="nc" id="L266">				a_aligntop.setEnabled(true);</span>
<span class="nc" id="L267">				a_alignbottom.setEnabled(true);</span>
<span class="nc" id="L268">				a_centerhorizontal.setEnabled(true);</span>
<span class="nc" id="L269">				a_centervertical.setEnabled(true);</span>
<span class="nc" id="L270">				a_spacehorizontal.setEnabled(true);</span>
<span class="nc" id="L271">				a_spacevertical.setEnabled(true);</span>
			} else {
<span class="nc" id="L273">				a_alignleft.setEnabled(false);</span>
<span class="nc" id="L274">				a_alignright.setEnabled(false);</span>
<span class="nc" id="L275">				a_aligntop.setEnabled(false);</span>
<span class="nc" id="L276">				a_alignbottom.setEnabled(false);</span>
<span class="nc" id="L277">				a_centerhorizontal.setEnabled(false);</span>
<span class="nc" id="L278">				a_centervertical.setEnabled(false);</span>
<span class="nc" id="L279">				a_spacehorizontal.setEnabled(false);</span>
<span class="nc" id="L280">				a_spacevertical.setEnabled(false);</span>
			}
<span class="nc" id="L282">		} // updateGUI</span>
		
		public void addToSelection(int nNode) {
<span class="nc bnc" id="L285" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_selected.size(); iNode++) {</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">				if (nNode == (Integer) m_selected.elementAt(iNode)) {</span>
<span class="nc" id="L287">					return;</span>
				}
			}
<span class="nc" id="L290">			m_selected.addElement(nNode);</span>
<span class="nc" id="L291">			updateGUI();</span>
<span class="nc" id="L292">		} // addToSelection</span>
		
		public void addToSelection(int [] iNodes) {
<span class="nc bnc" id="L295" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; iNodes.length; iNode++) {</span>
<span class="nc" id="L296">				addToSelection(iNodes[iNode]);</span>
			}
<span class="nc" id="L298">			updateGUI();</span>
<span class="nc" id="L299">		} // addToSelection</span>
		
		public void addToSelection(Rectangle selectedRect) {
<span class="nc bnc" id="L302" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">				if (contains(selectedRect, iNode)) {</span>
<span class="nc" id="L304">					addToSelection(iNode);</span>
				}
			}
<span class="nc" id="L307">		} // addToSelection</span>
		
		public void selectAll() {
<span class="nc" id="L310">			m_selected.removeAllElements();</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc" id="L312">				m_selected.addElement(iNode);</span>
			}
<span class="nc" id="L314">			updateGUI();</span>
<span class="nc" id="L315">		} // selectAll</span>

		boolean contains(Rectangle rect, int iNode) {
<span class="nc" id="L318">			return rect.intersects((m_BayesNet.getPositionX(iNode)) * m_fScale,</span>
<span class="nc" id="L319">					(m_BayesNet.getPositionY(iNode)) * m_fScale,</span>
<span class="nc" id="L320">					m_nPaddedNodeWidth * m_fScale, m_nNodeHeight * m_fScale);</span>
		} // contains
		
		public void removeFromSelection(int nNode) {
<span class="nc bnc" id="L324" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_selected.size(); iNode++) {</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">				if (nNode == (Integer) m_selected.elementAt(iNode)) {</span>
<span class="nc" id="L326">					m_selected.removeElementAt(iNode);</span>
				}
			}
<span class="nc" id="L329">			updateGUI();</span>
<span class="nc" id="L330">		} // removeFromSelection</span>

		public void toggleSelection(int nNode) {
<span class="nc bnc" id="L333" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_selected.size(); iNode++) {</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">				if (nNode == (Integer) m_selected.elementAt(iNode)) {</span>
<span class="nc" id="L335">					m_selected.removeElementAt(iNode);</span>
<span class="nc" id="L336">					updateGUI();</span>
<span class="nc" id="L337">					return;</span>
				}
			}
<span class="nc" id="L340">			addToSelection(nNode);</span>
<span class="nc" id="L341">		} // toggleSelection</span>

		public void toggleSelection(Rectangle selectedRect)	{
<span class="nc bnc" id="L344" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">				if (contains(selectedRect, iNode)) {</span>
<span class="nc" id="L346">					toggleSelection(iNode);</span>
				}
			}
<span class="nc" id="L349">		} // toggleSelection</span>
		
		public void clear() {
<span class="nc" id="L352">			m_selected.removeAllElements();</span>
<span class="nc" id="L353">			updateGUI();</span>
<span class="nc" id="L354">		}</span>
		
		public void draw(Graphics g) {
<span class="nc bnc" id="L357" title="All 2 branches missed.">			if (m_selected.size() == 0) {</span>
<span class="nc" id="L358">				return;</span>
			}

<span class="nc bnc" id="L361" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_selected.size(); iNode++) {</span>
<span class="nc" id="L362">				int nNode = (Integer) m_selected.elementAt(iNode);</span>
<span class="nc" id="L363">				int nPosX = m_BayesNet.getPositionX(nNode);</span>
<span class="nc" id="L364">				int nPosY = m_BayesNet.getPositionY(nNode);</span>
<span class="nc" id="L365">				g.setColor(Color.BLACK);</span>
<span class="nc" id="L366">				int nXRC = nPosX + m_nPaddedNodeWidth - m_nNodeWidth - (m_nPaddedNodeWidth - m_nNodeWidth) / 2;</span>
<span class="nc" id="L367">				int nYRC = nPosY;</span>
<span class="nc" id="L368">				int d = 5;</span>
<span class="nc" id="L369">				g.fillRect(nXRC, nYRC, d, d); </span>
<span class="nc" id="L370">				g.fillRect(nXRC, nYRC + m_nNodeHeight, d, d); </span>
<span class="nc" id="L371">				g.fillRect(nXRC + m_nNodeWidth, nYRC, d, d); </span>
<span class="nc" id="L372">				g.fillRect(nXRC + m_nNodeWidth, nYRC + m_nNodeHeight, d, d); </span>
			}
<span class="nc" id="L374">		} // draw</span>
	} // Selection

<span class="nc" id="L377">	ClipBoard m_clipboard = new ClipBoard();</span>
	
	class ClipBoard {
<span class="nc" id="L380">		String m_sText = null;</span>
<span class="nc" id="L381">		public ClipBoard() {</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">			if (a_pastenode != null) {</span>
<span class="nc" id="L383">				a_pastenode.setEnabled(false);</span>
			}
<span class="nc" id="L385">		}</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">		public boolean hasText() {return m_sText != null;}</span>
		public String getText() { 
<span class="nc" id="L388">			return m_sText;</span>
		}
		public void setText(String sText) {
<span class="nc" id="L391">			m_sText = sText;</span>
<span class="nc" id="L392">			a_pastenode.setEnabled(true);</span>
<span class="nc" id="L393">		}</span>
	} // class ClipBoard
	
	/** Base class used for definining actions
	 * with a name, tool tip text, possibly an icon and accelerator key. 
	 * */
	class MyAction extends AbstractAction {
		/** for serialization */
		private static final long serialVersionUID = -2038911111935517L;

		public MyAction(String sName, String sToolTipText, String sIcon, String sAcceleratorKey) {
<span class="nc" id="L404">			super(sName);</span>
			//setToolTipText(sToolTipText);
<span class="nc" id="L406">			putValue(Action.SHORT_DESCRIPTION, sToolTipText);</span>
<span class="nc" id="L407">			putValue(Action.LONG_DESCRIPTION, sToolTipText);</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">			if (sAcceleratorKey.length() &gt; 0) {</span>
<span class="nc" id="L409">				KeyStroke keyStroke = KeyStroke.getKeyStroke(sAcceleratorKey);</span>
<span class="nc" id="L410">				putValue(Action.ACCELERATOR_KEY, keyStroke);</span>
			}
<span class="nc" id="L412">			putValue(Action.MNEMONIC_KEY, (int) sName.charAt(0));</span>
<span class="nc" id="L413">			java.net.URL tempURL = ClassLoader.getSystemResource(ICONPATH + sIcon + &quot;.png&quot;);</span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">			if (tempURL != null) {</span>
<span class="nc" id="L415">				putValue(Action.SMALL_ICON, new ImageIcon(tempURL));</span>
			} else {
<span class="nc" id="L417">				putValue(Action.SMALL_ICON, new ImageIcon(new BufferedImage(20,20, BufferedImage.TYPE_4BYTE_ABGR)));</span>
				//System.err.println(ICONPATH + sIcon + &quot;.png not found for weka.gui.graphvisualizer.Graph&quot;);
			}
<span class="nc" id="L420">		} // c'tor</span>

		/* Place holder. Should be implemented by derived classes.
		 *  (non-Javadoc)
		 * @see java.awt.event.ActionListener#actionPerformed(java.awt.event.ActionEvent)
		 */
<span class="nc" id="L426">		public void actionPerformed(ActionEvent ae) {}</span>
	} // class MyAction

	class ActionGenerateNetwork extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038911085935517L;

		public ActionGenerateNetwork() {
<span class="nc" id="L434">			super(&quot;Generate Network&quot;, &quot;Generate Random Bayesian Network&quot;, &quot;generate.network&quot;, &quot;ctrl N&quot;);</span>
<span class="nc" id="L435">		} // c'tor</span>

<span class="nc" id="L437">		int m_nNrOfNodes = 10;</span>

<span class="nc" id="L439">		int m_nNrOfArcs = 15;</span>

<span class="nc" id="L441">		int m_nCardinality = 2;</span>

<span class="nc" id="L443">		int m_nSeed = 123;</span>

<span class="nc" id="L445">		JDialog dlg = null;</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L448" title="All 2 branches missed.">			if (dlg == null) {</span>
<span class="nc" id="L449">				dlg = new JDialog();</span>
<span class="nc" id="L450">				dlg.setTitle(&quot;Generate Random Bayesian Network Options&quot;);</span>

<span class="nc" id="L452">				final JLabel jLbNrOfNodes = new JLabel(&quot;Nr of nodes&quot;);</span>
<span class="nc" id="L453">				final JTextField jTfNrOfNodes = new JTextField(3);</span>
<span class="nc" id="L454">				jTfNrOfNodes.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L455">				jTfNrOfNodes.setText(&quot;&quot; + m_nNrOfNodes);</span>
<span class="nc" id="L456">				final JLabel jLbNrOfArcs = new JLabel(&quot;Nr of arcs&quot;);</span>
<span class="nc" id="L457">				final JTextField jTfNrOfArcs = new JTextField(3);</span>
<span class="nc" id="L458">				jTfNrOfArcs.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L459">				jTfNrOfArcs.setText(&quot;&quot; + m_nNrOfArcs);</span>
<span class="nc" id="L460">				final JLabel jLbCardinality = new JLabel(&quot;Cardinality&quot;);</span>
<span class="nc" id="L461">				final JTextField jTfCardinality = new JTextField(3);</span>
<span class="nc" id="L462">				jTfCardinality.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L463">				jTfCardinality.setText(&quot;&quot; + m_nCardinality);</span>
<span class="nc" id="L464">				final JLabel jLbSeed = new JLabel(&quot;Random seed&quot;);</span>
<span class="nc" id="L465">				final JTextField jTfSeed = new JTextField(3);</span>
<span class="nc" id="L466">				jTfSeed.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L467">				jTfSeed.setText(&quot;&quot; + m_nSeed);</span>

				JButton jBtGo;
<span class="nc" id="L470">				jBtGo = new JButton(&quot;Generate Network&quot;);</span>

<span class="nc" id="L472">				jBtGo.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
						try {
<span class="nc" id="L475">							BayesNetGenerator generator = new BayesNetGenerator();</span>
<span class="nc" id="L476">							m_BayesNet = generator;</span>
<span class="nc" id="L477">							m_BayesNet.clearUndoStack();</span>
							
<span class="nc" id="L479">							String[] options = new String[8];</span>
<span class="nc" id="L480">							options[0] = &quot;-N&quot;;</span>
<span class="nc" id="L481">							options[1] = &quot;&quot; + jTfNrOfNodes.getText();</span>
<span class="nc" id="L482">							options[2] = &quot;-A&quot;;</span>
<span class="nc" id="L483">							options[3] = &quot;&quot; + jTfNrOfArcs.getText();</span>
<span class="nc" id="L484">							options[4] = &quot;-C&quot;;</span>
<span class="nc" id="L485">							options[5] = &quot;&quot; + jTfCardinality.getText();</span>
<span class="nc" id="L486">							options[6] = &quot;-S&quot;;</span>
<span class="nc" id="L487">							options[7] = &quot;&quot; + jTfSeed.getText();</span>
<span class="nc" id="L488">							generator.setOptions(options);</span>
<span class="nc" id="L489">							generator.generateRandomNetwork();</span>
							// Convert to EditableBayesNet
							// This ensures the getOptions() called by GenericObjectEditor to get the correct result.
<span class="nc" id="L492">							BIFReader bifReader = new BIFReader();</span>
<span class="nc" id="L493">							bifReader.processString(m_BayesNet.toXMLBIF03());</span>
<span class="nc" id="L494">							m_BayesNet = new EditableBayesNet(bifReader);</span>

<span class="nc" id="L496">							updateStatus();</span>
<span class="nc" id="L497">							layoutGraph();</span>
<span class="nc" id="L498">							a_datagenerator.setEnabled(true);</span>
<span class="nc" id="L499">							m_Instances = null;;</span>
<span class="nc" id="L500">							a_learn.setEnabled(false);</span>
<span class="nc" id="L501">							a_learnCPT.setEnabled(false);</span>

<span class="nc" id="L503">							dlg.setVisible(false);</span>
<span class="nc" id="L504">						} catch (Exception e) {</span>
<span class="nc" id="L505">							e.printStackTrace();</span>
						}
<span class="nc" id="L507">					}</span>
				});

				JButton jBtCancel;
<span class="nc" id="L511">				jBtCancel = new JButton(&quot;Cancel&quot;);</span>
<span class="nc" id="L512">				jBtCancel.setMnemonic('C');</span>
<span class="nc" id="L513">				jBtCancel.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L515">						dlg.setVisible(false);</span>
<span class="nc" id="L516">					}</span>
				});
<span class="nc" id="L518">				GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="nc" id="L519">				dlg.setLayout(new GridBagLayout());</span>

<span class="nc" id="L521">				Container c = new Container();</span>
<span class="nc" id="L522">				c.setLayout(new GridBagLayout());</span>
<span class="nc" id="L523">				gbc.gridwidth = 2;</span>
<span class="nc" id="L524">				gbc.insets = new Insets(8, 0, 0, 0);</span>
<span class="nc" id="L525">				gbc.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L526">				gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L527">				gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L528">				c.add(jLbNrOfNodes, gbc);</span>
<span class="nc" id="L529">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L530">				c.add(jTfNrOfNodes, gbc);</span>
<span class="nc" id="L531">				gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L532">				c.add(jLbNrOfArcs, gbc);</span>
<span class="nc" id="L533">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L534">				c.add(jTfNrOfArcs, gbc);</span>
<span class="nc" id="L535">				gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L536">				c.add(jLbCardinality, gbc);</span>
<span class="nc" id="L537">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L538">				c.add(jTfCardinality, gbc);</span>
<span class="nc" id="L539">				gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L540">				c.add(jLbSeed, gbc);</span>
<span class="nc" id="L541">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L542">				c.add(jTfSeed, gbc);</span>

<span class="nc" id="L544">				gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L545">				dlg.add(c, gbc);</span>
<span class="nc" id="L546">				dlg.add(jBtGo);</span>
<span class="nc" id="L547">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L548">				dlg.add(jBtCancel);</span>
			}
<span class="nc" id="L550">			dlg.pack();</span>
<span class="nc" id="L551">			dlg.setLocation(100, 100);</span>
<span class="nc" id="L552">			dlg.setVisible(true);</span>
<span class="nc" id="L553">			dlg.setSize(dlg.getPreferredSize());</span>
<span class="nc" id="L554">			dlg.setVisible(false);</span>
<span class="nc" id="L555">			dlg.setVisible(true);</span>
<span class="nc" id="L556">			dlg.repaint();</span>
<span class="nc" id="L557">		} // actionPerformed</span>
	} // class ActionGenerate

	class ActionGenerateData extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038911085935516L;

		public ActionGenerateData() {
<span class="nc" id="L565">			super(&quot;Generate Data&quot;, &quot;Generate Random Instances from Network&quot;, &quot;generate.data&quot;, &quot;ctrl D&quot;);</span>
<span class="nc" id="L566">		} // c'tor</span>

<span class="nc" id="L568">		int m_nNrOfInstances = 100;</span>

<span class="nc" id="L570">		int m_nSeed = 1234;</span>

<span class="nc" id="L572">		String m_sFile = &quot;&quot;;</span>

<span class="nc" id="L574">		JDialog dlg = null;</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L577" title="All 2 branches missed.">			if (dlg == null) {</span>
<span class="nc" id="L578">				dlg = new JDialog();</span>
<span class="nc" id="L579">				dlg.setTitle(&quot;Generate Random Data Options&quot;);</span>

<span class="nc" id="L581">				final JLabel jLbNrOfInstances = new JLabel(&quot;Nr of instances&quot;);</span>
<span class="nc" id="L582">				final JTextField jTfNrOfInstances = new JTextField(3);</span>
<span class="nc" id="L583">				jTfNrOfInstances.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L584">				jTfNrOfInstances.setText(&quot;&quot; + m_nNrOfInstances);</span>
<span class="nc" id="L585">				final JLabel jLbSeed = new JLabel(&quot;Random seed&quot;);</span>
<span class="nc" id="L586">				final JTextField jTfSeed = new JTextField(3);</span>
<span class="nc" id="L587">				jTfSeed.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L588">				jTfSeed.setText(&quot;&quot; + m_nSeed);</span>
<span class="nc" id="L589">				final JLabel jLbFile = new JLabel(&quot;Output file (optional)&quot;);</span>
<span class="nc" id="L590">				final JTextField jTfFile = new JTextField(12);</span>
<span class="nc" id="L591">				jTfFile.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L592">				jTfFile.setText(m_sFile);</span>

				JButton jBtGo;
<span class="nc" id="L595">				jBtGo = new JButton(&quot;Generate Data&quot;);</span>

<span class="nc" id="L597">				jBtGo.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
						try {
<span class="nc" id="L600">							String tmpfilename = &quot;tmp.bif.file.xml&quot;;</span>
<span class="nc" id="L601">							BayesNetGenerator generator = new BayesNetGenerator();</span>
<span class="nc" id="L602">							String[] options = new String[4];</span>
<span class="nc" id="L603">							options[0] = &quot;-M&quot;;</span>
<span class="nc" id="L604">							options[1] = &quot;&quot; + jTfNrOfInstances.getText();</span>
<span class="nc" id="L605">							options[2] = &quot;-F&quot;;</span>
<span class="nc" id="L606">							options[3] = tmpfilename;</span>
<span class="nc" id="L607">							FileWriter outfile = new FileWriter(tmpfilename);</span>
<span class="nc" id="L608">							StringBuffer text = new StringBuffer();</span>
<span class="nc bnc" id="L609" title="All 2 branches missed.">							if (m_marginCalculator == null) {</span>
<span class="nc" id="L610">								m_marginCalculator = new MarginCalculator();</span>
<span class="nc" id="L611">								m_marginCalculator.calcMargins(m_BayesNet);</span>
							}
<span class="nc" id="L613">							text.append(m_marginCalculator.toXMLBIF03());</span>
<span class="nc" id="L614">							outfile.write(text.toString());</span>
<span class="nc" id="L615">							outfile.close();</span>

<span class="nc" id="L617">							generator.setOptions(options);</span>
<span class="nc" id="L618">							generator.generateRandomNetwork();</span>
<span class="nc" id="L619">							generator.generateInstances();</span>
<span class="nc" id="L620">							m_Instances = generator.m_Instances;</span>
<span class="nc" id="L621">							a_learn.setEnabled(true);</span>
<span class="nc" id="L622">							a_learnCPT.setEnabled(true);</span>

<span class="nc" id="L624">							m_sFile = jTfFile.getText();</span>
<span class="nc bnc" id="L625" title="All 4 branches missed.">							if (m_sFile != null &amp;&amp; !m_sFile.equals(&quot;&quot;)) {</span>
<span class="nc" id="L626">								AbstractFileSaver saver = ConverterUtils.getSaverForFile(m_sFile);</span>
								// no idea what the format is, so let's save it as ARFF file
<span class="nc bnc" id="L628" title="All 2 branches missed.">								if (saver == null)</span>
<span class="nc" id="L629">									saver = new ArffSaver();</span>
<span class="nc" id="L630">								saver.setFile(new File(m_sFile));</span>
<span class="nc" id="L631">								saver.setInstances(m_Instances);</span>
<span class="nc" id="L632">								saver.writeBatch();</span>
							}

<span class="nc" id="L635">						} catch (Exception e) {</span>
<span class="nc" id="L636">							e.printStackTrace();</span>
						}
<span class="nc" id="L638">						dlg.setVisible(false);</span>
<span class="nc" id="L639">					}</span>
				});

<span class="nc" id="L642">				JButton jBtFile = new JButton(&quot;Browse&quot;);</span>
<span class="nc" id="L643">				jBtFile.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L645">						ConverterFileChooser fc = new ConverterFileChooser(System.getProperty(&quot;user.dir&quot;));</span>
<span class="nc" id="L646">						fc.setDialogTitle(&quot;Save Instances As&quot;);</span>
<span class="nc" id="L647">						int rval = fc.showSaveDialog(GUI.this);</span>

<span class="nc bnc" id="L649" title="All 2 branches missed.">						if (rval == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L650">							String filename = fc.getSelectedFile().toString();</span>
<span class="nc" id="L651">							jTfFile.setText(filename);</span>
						}
<span class="nc" id="L653">						dlg.setVisible(true);</span>
<span class="nc" id="L654">					}</span>
				});
				JButton jBtCancel;
<span class="nc" id="L657">				jBtCancel = new JButton(&quot;Cancel&quot;);</span>
<span class="nc" id="L658">				jBtCancel.setMnemonic('C');</span>
<span class="nc" id="L659">				jBtCancel.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L661">						dlg.setVisible(false);</span>
<span class="nc" id="L662">					}</span>
				});
<span class="nc" id="L664">				GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="nc" id="L665">				dlg.setLayout(new GridBagLayout());</span>

<span class="nc" id="L667">				Container c = new Container();</span>
<span class="nc" id="L668">				c.setLayout(new GridBagLayout());</span>
<span class="nc" id="L669">				gbc.gridwidth = 2;</span>
<span class="nc" id="L670">				gbc.insets = new Insets(8, 0, 0, 0);</span>
<span class="nc" id="L671">				gbc.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L672">				gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L673">				gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L674">				c.add(jLbNrOfInstances, gbc);</span>
<span class="nc" id="L675">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L676">				c.add(jTfNrOfInstances, gbc);</span>
<span class="nc" id="L677">				gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L678">				c.add(jLbSeed, gbc);</span>
<span class="nc" id="L679">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L680">				c.add(jTfSeed, gbc);</span>
<span class="nc" id="L681">				gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L682">				c.add(jLbFile, gbc);</span>
<span class="nc" id="L683">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L684">				c.add(jTfFile, gbc);</span>
<span class="nc" id="L685">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L686">				c.add(jBtFile, gbc);</span>

<span class="nc" id="L688">				gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L689">				dlg.add(c, gbc);</span>
<span class="nc" id="L690">				dlg.add(jBtGo);</span>
<span class="nc" id="L691">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L692">				dlg.add(jBtCancel);</span>
			}
<span class="nc" id="L694">			dlg.setLocation(100, 100);</span>
<span class="nc" id="L695">			dlg.setVisible(true);</span>
<span class="nc" id="L696">			dlg.setSize(dlg.getPreferredSize());</span>
<span class="nc" id="L697">			dlg.setVisible(false);</span>
<span class="nc" id="L698">			dlg.setVisible(true);</span>
<span class="nc" id="L699">			dlg.repaint();</span>

<span class="nc" id="L701">		} // actionPerformed</span>
	} // class ActionGenerateData

	class ActionLearn extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038911085935516L;

		public ActionLearn() {
<span class="nc" id="L709">			super(&quot;Learn Network&quot;, &quot;Learn Bayesian Network&quot;, &quot;learn&quot;, &quot;ctrl L&quot;);</span>
<span class="nc" id="L710">			setEnabled(false);</span>
<span class="nc" id="L711">		} // c'tor</span>

<span class="nc" id="L713">		JDialog dlg = null;</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L716" title="All 2 branches missed.">			if (dlg == null) {</span>
<span class="nc" id="L717">				dlg = new JDialog();</span>
<span class="nc" id="L718">				dlg.setTitle(&quot;Learn Bayesian Network&quot;);</span>

<span class="nc" id="L720">				final JButton jBtOptions = new JButton(&quot;Options&quot;);</span>
<span class="nc" id="L721">				jBtOptions.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
						//m_BayesNet = new EditableBayesNet();
						try {
<span class="nc" id="L725">							GenericObjectEditor.registerEditors();</span>
<span class="nc" id="L726">							GenericObjectEditor ce = new GenericObjectEditor(true);</span>
<span class="nc" id="L727">							ce.setClassType(weka.classifiers.Classifier.class);</span>
<span class="nc" id="L728">							ce.setValue(m_BayesNet);</span>

							PropertyDialog pd;
<span class="nc bnc" id="L731" title="All 2 branches missed.">							if (PropertyDialog.getParentDialog(GUI.this) != null)</span>
<span class="nc" id="L732">								pd = new PropertyDialog(PropertyDialog.getParentDialog(GUI.this), ce, 100, 100);</span>
							else
<span class="nc" id="L734">								pd = new PropertyDialog(PropertyDialog.getParentFrame(GUI.this), ce, 100, 100);</span>
<span class="nc" id="L735">							pd.addWindowListener(new WindowAdapter() {</span>
								public void windowClosing(WindowEvent e) {
<span class="nc" id="L737">									PropertyEditor pe = ((PropertyDialog) e.getSource()).getEditor();</span>
<span class="nc" id="L738">									Object c = (Object) pe.getValue();</span>
<span class="nc" id="L739">									String options = &quot;&quot;;</span>
<span class="nc bnc" id="L740" title="All 2 branches missed.">									if (c instanceof OptionHandler) {</span>
<span class="nc" id="L741">										options = Utils.joinOptions(((OptionHandler) c).getOptions());</span>
										try {
<span class="nc" id="L743">											m_BayesNet.setOptions(((OptionHandler) c).getOptions());</span>
<span class="nc" id="L744">										} catch (Exception e2) {</span>
<span class="nc" id="L745">											e2.printStackTrace();</span>
										}
									}
<span class="nc" id="L748">									System.out.println(c.getClass().getName() + &quot; &quot; + options);</span>
<span class="nc" id="L749">									System.exit(0);</span>
<span class="nc" id="L750">								}</span>
							});
<span class="nc" id="L752">							pd.setVisible(true);</span>
<span class="nc" id="L753">						} catch (Exception ex) {</span>
<span class="nc" id="L754">							ex.printStackTrace();</span>
<span class="nc" id="L755">							System.err.println(ex.getMessage());</span>
						}
<span class="nc" id="L757">						m_BayesNet.clearUndoStack();</span>
<span class="nc" id="L758">						a_undo.setEnabled(false);</span>
<span class="nc" id="L759">						a_redo.setEnabled(false);</span>
<span class="nc" id="L760">					}</span>
				});

<span class="nc" id="L763">				final JTextField jTfOptions = new JTextField(40);</span>
<span class="nc" id="L764">				jTfOptions.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L765">				jTfOptions.setText(&quot;&quot; + Utils.joinOptions(m_BayesNet.getOptions()));</span>

				JButton jBtGo;
<span class="nc" id="L768">				jBtGo = new JButton(&quot;Learn&quot;);</span>

<span class="nc" id="L770">				jBtGo.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
						try {
<span class="nc" id="L773">							m_BayesNet.buildClassifier(m_Instances);</span>
<span class="nc" id="L774">							layoutGraph();</span>
<span class="nc" id="L775">							updateStatus();</span>
<span class="nc" id="L776">							m_BayesNet.clearUndoStack();</span>

<span class="nc" id="L778">							dlg.setVisible(false);</span>
<span class="nc" id="L779">						} catch (Exception e) {</span>
<span class="nc" id="L780">							e.printStackTrace();</span>
						}
<span class="nc" id="L782">						dlg.setVisible(false);</span>
<span class="nc" id="L783">					}</span>
				});

				JButton jBtCancel;
<span class="nc" id="L787">				jBtCancel = new JButton(&quot;Cancel&quot;);</span>
<span class="nc" id="L788">				jBtCancel.setMnemonic('C');</span>
<span class="nc" id="L789">				jBtCancel.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L791">						dlg.setVisible(false);</span>
<span class="nc" id="L792">					}</span>
				});
<span class="nc" id="L794">				GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="nc" id="L795">				dlg.setLayout(new GridBagLayout());</span>

<span class="nc" id="L797">				Container c = new Container();</span>
<span class="nc" id="L798">				c.setLayout(new GridBagLayout());</span>
<span class="nc" id="L799">				gbc.gridwidth = 2;</span>
<span class="nc" id="L800">				gbc.insets = new Insets(8, 0, 0, 0);</span>
<span class="nc" id="L801">				gbc.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L802">				gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L803">				gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L804">				c.add(jBtOptions, gbc);</span>
<span class="nc" id="L805">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L806">				c.add(jTfOptions, gbc);</span>

<span class="nc" id="L808">				gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L809">				dlg.add(c, gbc);</span>
<span class="nc" id="L810">				dlg.add(jBtGo);</span>
<span class="nc" id="L811">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L812">				dlg.add(jBtCancel);</span>
			}
<span class="nc" id="L814">			dlg.setLocation(100, 100);</span>
<span class="nc" id="L815">			dlg.setVisible(true);</span>
<span class="nc" id="L816">			dlg.setSize(dlg.getPreferredSize());</span>
<span class="nc" id="L817">			dlg.setVisible(false);</span>
<span class="nc" id="L818">			dlg.setVisible(true);</span>
<span class="nc" id="L819">			dlg.repaint();</span>
<span class="nc" id="L820">		} // actionPerformed</span>
	} // class ActionLearn

	class ActionLearnCPT extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2022211085935516L;

		public ActionLearnCPT() {
<span class="nc" id="L828">			super(&quot;Learn CPT&quot;, &quot;Learn conditional probability tables&quot;, &quot;learncpt&quot;, &quot;&quot;);</span>
<span class="nc" id="L829">			setEnabled(false);</span>
<span class="nc" id="L830">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L833" title="All 2 branches missed.">			if (m_Instances == null) {</span>
<span class="nc" id="L834">				JOptionPane.showMessageDialog(null, &quot;Select instances to learn from first (menu Tools/Set Data)&quot;);</span>
<span class="nc" id="L835">				return;</span>
			}
			try {
<span class="nc" id="L838">				m_BayesNet.setData(m_Instances);</span>
<span class="nc" id="L839">			} catch (Exception e) {</span>
<span class="nc" id="L840">				JOptionPane.showMessageDialog(null, &quot;Data set is not compatible with network.\n&quot;+e.getMessage() + &quot;\nChoose other instances (menu Tools/Set Data)&quot;);</span>
<span class="nc" id="L841">				return;</span>
			}
			try {
<span class="nc" id="L844">				m_BayesNet.estimateCPTs();</span>
<span class="nc" id="L845">				m_BayesNet.clearUndoStack();</span>
<span class="nc" id="L846">			} catch (Exception e) {</span>
<span class="nc" id="L847">				e.printStackTrace();</span>
			}
<span class="nc" id="L849">			updateStatus();</span>
<span class="nc" id="L850">		} // actionPerformed</span>
	} // class ActionLearnCPT

	class ActionSetData extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038911085935519L;

		public ActionSetData() {
<span class="nc" id="L858">			super(&quot;Set Data&quot;, &quot;Set Data File&quot;, &quot;setdata&quot;, &quot;ctrl A&quot;);</span>
<span class="nc" id="L859">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L862">			ConverterFileChooser fc = new ConverterFileChooser(System.getProperty(&quot;user.dir&quot;));</span>
<span class="nc" id="L863">			fc.setDialogTitle(&quot;Set Data File&quot;);</span>
<span class="nc" id="L864">			int rval = fc.showOpenDialog(GUI.this);</span>

<span class="nc bnc" id="L866" title="All 2 branches missed.">			if (rval == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L867">				AbstractFileLoader loader = fc.getLoader();</span>
				try {
<span class="nc bnc" id="L869" title="All 2 branches missed.">					if (loader != null)</span>
<span class="nc" id="L870">					  m_Instances = loader.getDataSet();</span>
<span class="nc bnc" id="L871" title="All 2 branches missed.">					if (m_Instances.classIndex() == -1)</span>
<span class="nc" id="L872">					  m_Instances.setClassIndex(m_Instances.numAttributes() - 1);</span>
<span class="nc" id="L873">					a_learn.setEnabled(true);</span>
<span class="nc" id="L874">					a_learnCPT.setEnabled(true);</span>
<span class="nc" id="L875">					repaint();</span>
<span class="nc" id="L876">				} catch (Exception e) {</span>
<span class="nc" id="L877">					e.printStackTrace();</span>
				}
			}
<span class="nc" id="L880">		}</span>
	} // class ActionSetData

	class ActionUndo extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -3038910085935519L;

		public ActionUndo() {
<span class="nc" id="L888">			super(&quot;Undo&quot;, &quot;Undo&quot;, &quot;undo&quot;, &quot;ctrl Z&quot;);</span>
<span class="nc" id="L889">			setEnabled(false);</span>
<span class="nc" id="L890">		} // c'tor</span>

		public boolean isEnabled() {
<span class="nc" id="L893">			return m_BayesNet.canUndo();</span>
		}

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L897">			String sMsg = m_BayesNet.undo();</span>
<span class="nc" id="L898">			m_jStatusBar.setText(&quot;Undo action performed: &quot; + sMsg);</span>
			//if (!sMsg.equals(&quot;&quot;)) {
			//	JOptionPane.showMessageDialog(null, sMsg, &quot;Undo action successful&quot;, JOptionPane.INFORMATION_MESSAGE);
			//}
<span class="nc" id="L902">			a_redo.setEnabled(m_BayesNet.canRedo());</span>
<span class="nc" id="L903">			a_undo.setEnabled(m_BayesNet.canUndo());</span>
<span class="nc" id="L904">			m_Selection.clear();</span>
<span class="nc" id="L905">			updateStatus();</span>
<span class="nc" id="L906">			repaint();</span>
<span class="nc" id="L907">		}</span>
	} // ActionUndo
	
	class ActionRedo extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -4038910085935519L;

		public ActionRedo() {
<span class="nc" id="L915">			super(&quot;Redo&quot;, &quot;Redo&quot;, &quot;redo&quot;, &quot;ctrl Y&quot;);</span>
<span class="nc" id="L916">			setEnabled(false);</span>
<span class="nc" id="L917">		} // c'tor</span>

		public boolean isEnabled() {
<span class="nc" id="L920">			return m_BayesNet.canRedo();</span>
		}

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L924">			String sMsg = m_BayesNet.redo();</span>
<span class="nc" id="L925">			m_jStatusBar.setText(&quot;Redo action performed: &quot; + sMsg);</span>
			//if (!sMsg.equals(&quot;&quot;)) {
			//	JOptionPane.showMessageDialog(null, sMsg, &quot;Redo action successful&quot;, JOptionPane.INFORMATION_MESSAGE);
			//}
<span class="nc" id="L929">			m_Selection.clear();</span>
<span class="nc" id="L930">			updateStatus();</span>
<span class="nc" id="L931">			repaint();</span>
<span class="nc" id="L932">		}</span>
	} // ActionRedo

	class ActionAddNode extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038910085935519L;

		public ActionAddNode() {
<span class="nc" id="L940">			super(&quot;Add Node&quot;, &quot;Add Node&quot;, &quot;addnode&quot;, &quot;&quot;);</span>
<span class="nc" id="L941">		} // c'tor</span>

<span class="nc" id="L943">		JDialog dlg = null;</span>

<span class="nc" id="L945">		JTextField jTfName = new JTextField(20);</span>

<span class="nc" id="L947">		JTextField jTfCard = new JTextField(3);</span>

<span class="nc" id="L949">		int m_X = Integer.MAX_VALUE;</span>
		int m_Y;
		public void addNode(int nX, int nY) {
<span class="nc" id="L952">			m_X = nX;</span>
<span class="nc" id="L953">			m_Y = nY;</span>
<span class="nc" id="L954">			addNode();</span>
<span class="nc" id="L955">		} // addNode</span>
		
		void addNode() {
<span class="nc bnc" id="L958" title="All 2 branches missed.">			if (dlg == null) {</span>
<span class="nc" id="L959">				dlg = new JDialog();</span>
<span class="nc" id="L960">				dlg.setTitle(&quot;Add node&quot;);</span>
<span class="nc" id="L961">				JLabel jLbName = new JLabel(&quot;Name&quot;);</span>
<span class="nc" id="L962">				jTfName.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L963">				JLabel jLbCard = new JLabel(&quot;Cardinality&quot;);</span>
<span class="nc" id="L964">				jTfCard.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L965">				jTfCard.setText(&quot;2&quot;);</span>

				JButton jBtCancel;
<span class="nc" id="L968">				jBtCancel = new JButton(&quot;Cancel&quot;);</span>
<span class="nc" id="L969">				jBtCancel.setMnemonic('C');</span>
<span class="nc" id="L970">				jBtCancel.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L972">						dlg.setVisible(false);</span>
<span class="nc" id="L973">					}</span>
				});
<span class="nc" id="L975">				JButton jBtOk = new JButton(&quot;Ok&quot;);</span>
<span class="nc" id="L976">				jBtOk.setMnemonic('O');</span>
<span class="nc" id="L977">				jBtOk.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L979">						String sName = jTfName.getText();</span>
<span class="nc bnc" id="L980" title="All 2 branches missed.">						if (sName.length() &lt;= 0) {</span>
<span class="nc" id="L981">							JOptionPane.showMessageDialog(null, &quot;Name should have at least one character&quot;);</span>
<span class="nc" id="L982">							return;</span>
						}
<span class="nc" id="L984">						int nCard = new Integer(jTfCard.getText()).intValue();</span>
<span class="nc bnc" id="L985" title="All 2 branches missed.">						if (nCard &lt;= 1) {</span>
<span class="nc" id="L986">							JOptionPane.showMessageDialog(null, &quot;Cardinality should be larger than 1&quot;);</span>
<span class="nc" id="L987">							return;</span>
						}
						try {
<span class="nc bnc" id="L990" title="All 2 branches missed.">							if (m_X &lt; Integer.MAX_VALUE) {</span>
<span class="nc" id="L991">								m_BayesNet.addNode(sName, nCard, m_X, m_Y);</span>
							} else {
<span class="nc" id="L993">								m_BayesNet.addNode(sName, nCard);</span>
							}
<span class="nc" id="L995">						    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L996">							a_undo.setEnabled(true);</span>
<span class="nc" id="L997">							a_redo.setEnabled(false);</span>
							//GraphNode n = new GraphNode(&quot;id&quot; + m_nodes.size(), sName);
							//n.probs = m_BayesNet.getDistribution(sName);
							//n.outcomes = m_BayesNet.getValues(sName);
							//n.x = 100 + m_nodes.size() * 10;
							//n.y = 100 + m_nodes.size() * 10;
							//m_nodes.addElement(n);
<span class="nc" id="L1004">						} catch (Exception e) {</span>
<span class="nc" id="L1005">							e.printStackTrace();</span>
						}
<span class="nc" id="L1007">						repaint();</span>
<span class="nc" id="L1008">						dlg.setVisible(false);</span>
<span class="nc" id="L1009">					}</span>
				});
<span class="nc" id="L1011">				dlg.setLayout(new GridLayout(3, 2, 10, 10));</span>
<span class="nc" id="L1012">				dlg.add(jLbName);</span>
<span class="nc" id="L1013">				dlg.add(jTfName);</span>
<span class="nc" id="L1014">				dlg.add(jLbCard);</span>
<span class="nc" id="L1015">				dlg.add(jTfCard);</span>
<span class="nc" id="L1016">				dlg.add(jBtOk);</span>
<span class="nc" id="L1017">				dlg.add(jBtCancel);</span>
<span class="nc" id="L1018">				dlg.setSize(dlg.getPreferredSize());</span>
			}
<span class="nc" id="L1020">			jTfName.setText(&quot;Node&quot; + (m_BayesNet.getNrOfNodes() + 1));</span>
<span class="nc" id="L1021">			dlg.setVisible(true);</span>
<span class="nc" id="L1022">		} // addNode</span>
		
		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1025">			m_X = Integer.MAX_VALUE;</span>
<span class="nc" id="L1026">			addNode();</span>
<span class="nc" id="L1027">		}</span>
	} // class ActionAddNode

	class ActionDeleteNode extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038912085935519L;

		public ActionDeleteNode() {
<span class="nc" id="L1035">			super(&quot;Delete Node&quot;, &quot;Delete Node&quot;, &quot;delnode&quot;, &quot;DELETE&quot;);</span>
<span class="nc" id="L1036">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L1039" title="All 2 branches missed.">			if (m_Selection.getSelected().size() &gt; 0) {</span>
<span class="nc" id="L1040">				m_BayesNet.deleteSelection(m_Selection.getSelected());</span>
<span class="nc" id="L1041">			    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L1042">				m_Selection.clear();</span>
<span class="nc" id="L1043">				updateStatus();</span>
<span class="nc" id="L1044">				repaint();</span>
			} else {
<span class="nc" id="L1046">				String[] options = new String[m_BayesNet.getNrOfNodes()];</span>
<span class="nc bnc" id="L1047" title="All 2 branches missed.">				for (int i = 0; i &lt; options.length; i++) {</span>
<span class="nc" id="L1048">					options[i] = m_BayesNet.getNodeName(i);</span>
				}
<span class="nc" id="L1050">				String sResult = (String) JOptionPane.showInputDialog(null, &quot;Select node to delete&quot;, &quot;Nodes&quot;, 0, null,</span>
<span class="nc" id="L1051">						options, options[0]);</span>
<span class="nc bnc" id="L1052" title="All 4 branches missed.">				if (sResult != null &amp;&amp; !sResult.equals(&quot;&quot;)) {</span>
<span class="nc" id="L1053">					int iNode = m_BayesNet.getNode2(sResult);</span>
<span class="nc" id="L1054">					deleteNode(iNode);</span>
				}
			}
<span class="nc" id="L1057">		}</span>
	} // class ActionDeleteNode

	class ActionCopyNode extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038732085935519L;

		public ActionCopyNode() {
<span class="nc" id="L1065">			super(&quot;Copy&quot;, &quot;Copy Nodes&quot;, &quot;copy&quot;, &quot;ctrl C&quot;);</span>
<span class="nc" id="L1066">		} // c'tor</span>
		
		public ActionCopyNode(String sName, String sToolTipText, String sIcon, String sAcceleratorKey) {
<span class="nc" id="L1069">			super(sName, sToolTipText, sIcon, sAcceleratorKey);</span>
<span class="nc" id="L1070">		} // c'rot</span>
		
		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1073">			copy();</span>
<span class="nc" id="L1074">		}</span>
		
		public void copy() {
<span class="nc" id="L1077">			String sXML = m_BayesNet.toXMLBIF03(m_Selection.getSelected());</span>
<span class="nc" id="L1078">			m_clipboard.setText(sXML);</span>
<span class="nc" id="L1079">		} // copy</span>
	} // class ActionCopyNode

	class ActionCutNode extends ActionCopyNode {
		/** for serialization */
		private static final long serialVersionUID = -2038822085935519L;

		public ActionCutNode() {
<span class="nc" id="L1087">			super(&quot;Cut&quot;, &quot;Cut Nodes&quot;, &quot;cut&quot;, &quot;ctrl X&quot;);</span>
<span class="nc" id="L1088">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1091">			copy();</span>
<span class="nc" id="L1092">			m_BayesNet.deleteSelection(m_Selection.getSelected());</span>
<span class="nc" id="L1093">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L1094">			m_Selection.clear();</span>
<span class="nc" id="L1095">			a_undo.setEnabled(true);</span>
<span class="nc" id="L1096">			a_redo.setEnabled(false);</span>
<span class="nc" id="L1097">			repaint();</span>
<span class="nc" id="L1098">		}</span>
	} // class ActionCutNode

	class ActionPasteNode extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038732085935519L;

		public ActionPasteNode() {
<span class="nc" id="L1106">			super(&quot;Paste&quot;, &quot;Paste Nodes&quot;, &quot;paste&quot;, &quot;ctrl V&quot;);</span>
<span class="nc" id="L1107">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
			try {
<span class="nc" id="L1111">				m_BayesNet.paste(m_clipboard.getText());</span>
<span class="nc" id="L1112">				updateStatus();</span>
<span class="nc" id="L1113">			    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L1114">			} catch (Exception e) {</span>
<span class="nc" id="L1115">				e.printStackTrace();</span>
			}
<span class="nc" id="L1117">		}</span>
		public boolean isEnabled() {
<span class="nc" id="L1119">			return m_clipboard.hasText();</span>
		}
	} // class ActionPasteNode

	class ActionSelectAll extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038642085935519L;

		public ActionSelectAll() {
<span class="nc" id="L1128">			super(&quot;Select All&quot;, &quot;Select All Nodes&quot;, &quot;selectall&quot;, &quot;ctrl A&quot;);</span>
<span class="nc" id="L1129">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1132">			m_Selection.selectAll();</span>
<span class="nc" id="L1133">			repaint();</span>
<span class="nc" id="L1134">		}</span>
	} // class ActionSelectAll

	class ActionExport extends MyAction {
<span class="nc" id="L1138">		boolean m_bIsExporting = false;		</span>
		/** for serialization */
		private static final long serialVersionUID = -3027642085935519L;

		public ActionExport() {
<span class="nc" id="L1143">			super(&quot;Export&quot;, &quot;Export to graphics file&quot;, &quot;export&quot;, &quot;&quot;);</span>
<span class="nc" id="L1144">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1147">			m_bIsExporting = true;</span>
<span class="nc" id="L1148">			m_GraphPanel.saveComponent();</span>
<span class="nc" id="L1149">			m_bIsExporting = false;</span>
<span class="nc" id="L1150">			repaint();</span>
<span class="nc" id="L1151">		}</span>
<span class="nc" id="L1152">		public boolean isExporting() {return m_bIsExporting;}</span>
	} // class ActionExport

	class ActionAlignLeft extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -3138642085935519L;

		public ActionAlignLeft() {
<span class="nc" id="L1160">			super(&quot;Align Left&quot;, &quot;Align Left&quot;, &quot;alignleft&quot;, &quot;&quot;);</span>
<span class="nc" id="L1161">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1164">			m_BayesNet.alignLeft(m_Selection.getSelected());</span>
<span class="nc" id="L1165">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L1166">			a_undo.setEnabled(true);</span>
<span class="nc" id="L1167">			a_redo.setEnabled(false);</span>
<span class="nc" id="L1168">			repaint();</span>
<span class="nc" id="L1169">		}</span>
	} // class ActionAlignLeft
	
	class ActionAlignRight extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -4238642085935519L;

		public ActionAlignRight() {
<span class="nc" id="L1177">			super(&quot;Align Right&quot;, &quot;Align Right&quot;, &quot;alignright&quot;, &quot;&quot;);</span>
<span class="nc" id="L1178">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1181">			m_BayesNet.alignRight(m_Selection.getSelected());</span>
<span class="nc" id="L1182">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L1183">			a_undo.setEnabled(true);</span>
<span class="nc" id="L1184">			a_redo.setEnabled(false);</span>
<span class="nc" id="L1185">			repaint();</span>
<span class="nc" id="L1186">		}</span>
	} // class ActionAlignRight

	class ActionAlignTop extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -5338642085935519L;

		public ActionAlignTop() {
<span class="nc" id="L1194">			super(&quot;Align Top&quot;, &quot;Align Top&quot;, &quot;aligntop&quot;, &quot;&quot;);</span>
<span class="nc" id="L1195">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1198">			m_BayesNet.alignTop(m_Selection.getSelected());</span>
<span class="nc" id="L1199">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L1200">			a_undo.setEnabled(true);</span>
<span class="nc" id="L1201">			a_redo.setEnabled(false);</span>
<span class="nc" id="L1202">			repaint();</span>
<span class="nc" id="L1203">		}</span>
	} // class ActionAlignTop

	class ActionAlignBottom extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -6438642085935519L;

		public ActionAlignBottom() {
<span class="nc" id="L1211">			super(&quot;Align Bottom&quot;, &quot;Align Bottom&quot;, &quot;alignbottom&quot;, &quot;&quot;);</span>
<span class="nc" id="L1212">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1215">			m_BayesNet.alignBottom(m_Selection.getSelected());</span>
<span class="nc" id="L1216">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L1217">			a_undo.setEnabled(true);</span>
<span class="nc" id="L1218">			a_redo.setEnabled(false);</span>
<span class="nc" id="L1219">			repaint();</span>
<span class="nc" id="L1220">		}</span>
	} // class ActionAlignBottom

	class ActionCenterHorizontal extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -7538642085935519L;

		public ActionCenterHorizontal() {
<span class="nc" id="L1228">			super(&quot;Center Horizontal&quot;, &quot;Center Horizontal&quot;, &quot;centerhorizontal&quot;, &quot;&quot;);</span>
<span class="nc" id="L1229">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1232">			m_BayesNet.centerHorizontal(m_Selection.getSelected());</span>
<span class="nc" id="L1233">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L1234">			a_undo.setEnabled(true);</span>
<span class="nc" id="L1235">			a_redo.setEnabled(false);</span>
<span class="nc" id="L1236">			repaint();</span>
<span class="nc" id="L1237">		}</span>
	} // class ActionCenterHorizontal

	class ActionCenterVertical extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -8638642085935519L;

		public ActionCenterVertical() {
<span class="nc" id="L1245">			super(&quot;Center Vertical&quot;, &quot;Center Vertical&quot;, &quot;centervertical&quot;, &quot;&quot;);</span>
<span class="nc" id="L1246">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1249">			m_BayesNet.centerVertical(m_Selection.getSelected());</span>
<span class="nc" id="L1250">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L1251">			a_undo.setEnabled(true);</span>
<span class="nc" id="L1252">			a_redo.setEnabled(false);</span>
<span class="nc" id="L1253">			repaint();</span>
<span class="nc" id="L1254">		}</span>
	} // class ActionCenterVertical

	class ActionSpaceHorizontal extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -9738642085935519L;

		public ActionSpaceHorizontal() {
<span class="nc" id="L1262">			super(&quot;Space Horizontal&quot;, &quot;Space Horizontal&quot;, &quot;spacehorizontal&quot;, &quot;&quot;);</span>
<span class="nc" id="L1263">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1266">			m_BayesNet.spaceHorizontal(m_Selection.getSelected());</span>
<span class="nc" id="L1267">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L1268">			a_undo.setEnabled(true);</span>
<span class="nc" id="L1269">			a_redo.setEnabled(false);</span>
<span class="nc" id="L1270">			repaint();</span>
<span class="nc" id="L1271">		}</span>
	} // class ActionSpaceHorizontal

	class ActionSpaceVertical extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -838642085935519L;

		public ActionSpaceVertical() {
<span class="nc" id="L1279">			super(&quot;Space Vertical&quot;, &quot;Space Vertical&quot;, &quot;spacevertical&quot;, &quot;&quot;);</span>
<span class="nc" id="L1280">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1283">			m_BayesNet.spaceVertical(m_Selection.getSelected());</span>
<span class="nc" id="L1284">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L1285">			a_undo.setEnabled(true);</span>
<span class="nc" id="L1286">			a_redo.setEnabled(false);</span>
<span class="nc" id="L1287">			repaint();</span>
<span class="nc" id="L1288">		}</span>
	} // class ActionSpaceVertical

	class ActionAddArc extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038913085935519L;

		public ActionAddArc() {
<span class="nc" id="L1296">			super(&quot;Add Arc&quot;, &quot;Add Arc&quot;, &quot;addarc&quot;, &quot;&quot;);</span>
<span class="nc" id="L1297">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
			try {
<span class="nc" id="L1301">				String[] options = new String[m_BayesNet.getNrOfNodes()];</span>
<span class="nc bnc" id="L1302" title="All 2 branches missed.">				for (int i = 0; i &lt; options.length; i++) {</span>
<span class="nc" id="L1303">					options[i] = m_BayesNet.getNodeName(i);</span>
				}
<span class="nc" id="L1305">				String sChild = (String) JOptionPane.showInputDialog(null, &quot;Select child node&quot;, &quot;Nodes&quot;, 0, null,</span>
<span class="nc" id="L1306">						options, options[0]);</span>
<span class="nc bnc" id="L1307" title="All 4 branches missed.">				if (sChild == null || sChild.equals(&quot;&quot;)) {</span>
<span class="nc" id="L1308">					return;</span>
				}
<span class="nc" id="L1310">				int iChild = m_BayesNet.getNode(sChild);</span>
<span class="nc" id="L1311">				addArcInto(iChild);</span>
<span class="nc" id="L1312">			} catch (Exception e) {</span>
<span class="nc" id="L1313">				e.printStackTrace();</span>
			}
<span class="nc" id="L1315">		}</span>
	} // class ActionAddArc

	class ActionDeleteArc extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038914085935519L;

		public ActionDeleteArc() {
<span class="nc" id="L1323">			super(&quot;Delete Arc&quot;, &quot;Delete Arc&quot;, &quot;delarc&quot;, &quot;&quot;);</span>
<span class="nc" id="L1324">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1327">			int nEdges = 0;</span>
<span class="nc bnc" id="L1328" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc" id="L1329">				nEdges += m_BayesNet.getNrOfParents(iNode);</span>
			}
<span class="nc" id="L1331">			String[] options = new String[nEdges];</span>
<span class="nc" id="L1332">			int i = 0;</span>
<span class="nc bnc" id="L1333" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc bnc" id="L1334" title="All 2 branches missed.">				for (int iParent = 0; iParent &lt; m_BayesNet.getNrOfParents(iNode); iParent++) {</span>
<span class="nc" id="L1335">					int nParent = m_BayesNet.getParent(iNode, iParent);</span>
<span class="nc" id="L1336">					String sEdge = m_BayesNet.getNodeName(nParent);</span>
<span class="nc" id="L1337">					sEdge += &quot; -&gt; &quot;;</span>
<span class="nc" id="L1338">					sEdge += m_BayesNet.getNodeName(iNode);</span>
<span class="nc" id="L1339">					options[i++] = sEdge;</span>
				}
				
			}
<span class="nc" id="L1343">			deleteArc(options);</span>
<span class="nc" id="L1344">		}</span>
	} // class ActionDeleteArc

	class ActionNew extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038911085935515L;

		public ActionNew() {
<span class="nc" id="L1352">			super(&quot;New&quot;, &quot;New Network&quot;, &quot;new&quot;, &quot;&quot;);</span>
<span class="nc" id="L1353">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1356">			m_sFileName = &quot;&quot;;</span>
<span class="nc" id="L1357">			m_BayesNet = new EditableBayesNet(true);</span>
<span class="nc" id="L1358">			updateStatus();</span>
<span class="nc" id="L1359">			layoutGraph();</span>
<span class="nc" id="L1360">			a_datagenerator.setEnabled(false);</span>
<span class="nc" id="L1361">			m_BayesNet.clearUndoStack();</span>
<span class="nc" id="L1362">		    m_jStatusBar.setText(&quot;New Network&quot;);</span>
<span class="nc" id="L1363">			m_Selection = new Selection();</span>
<span class="nc" id="L1364">			repaint();</span>
<span class="nc" id="L1365">		}</span>
	} // class ActionNew

	class ActionLoad extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038911085935515L;

		public ActionLoad() {
<span class="nc" id="L1373">			super(&quot;Load&quot;, &quot;Load Graph&quot;, &quot;open&quot;, &quot;ctrl O&quot;);</span>
<span class="nc" id="L1374">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1377">			JFileChooser fc = new JFileChooser(System.getProperty(&quot;user.dir&quot;));</span>
<span class="nc" id="L1378">			ExtensionFileFilter ef1 = new ExtensionFileFilter(&quot;.arff&quot;, &quot;ARFF files&quot;);</span>
<span class="nc" id="L1379">			ExtensionFileFilter ef2 = new ExtensionFileFilter(&quot;.xml&quot;, &quot;XML BIF files&quot;);</span>
<span class="nc" id="L1380">			fc.addChoosableFileFilter(ef1);</span>
<span class="nc" id="L1381">			fc.addChoosableFileFilter(ef2);</span>
<span class="nc" id="L1382">			fc.setDialogTitle(&quot;Load Graph&quot;);</span>
<span class="nc" id="L1383">			int rval = fc.showOpenDialog(GUI.this);</span>

<span class="nc bnc" id="L1385" title="All 2 branches missed.">			if (rval == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L1386">				String sFileName = fc.getSelectedFile().toString();</span>
<span class="nc bnc" id="L1387" title="All 2 branches missed.">				if (sFileName.endsWith(ef1.getExtensions()[0])) {</span>
<span class="nc" id="L1388">					initFromArffFile(sFileName);</span>
				} else {
					try {
<span class="nc" id="L1391">						readBIFFromFile(sFileName);</span>
<span class="nc" id="L1392">					} catch (Exception e) {</span>
<span class="nc" id="L1393">						e.printStackTrace();</span>
					}
				}
<span class="nc" id="L1396">			    m_jStatusBar.setText(&quot;Loaded &quot; + sFileName);</span>
<span class="nc" id="L1397">			    updateStatus();</span>
			}
<span class="nc" id="L1399">		}</span>
	} // class ActionLoad
	
	
	class ActionViewStatusbar extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -20389330812354L;

		public ActionViewStatusbar() {
<span class="nc" id="L1408">			super(&quot;View statusbar&quot;, &quot;View statusbar&quot;, &quot;statusbar&quot;, &quot;&quot;);</span>
<span class="nc" id="L1409">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L1412" title="All 2 branches missed.">			m_jStatusBar.setVisible(!m_jStatusBar.isVisible());</span>
<span class="nc" id="L1413">		} // actionPerformed</span>
	} // class ActionViewStatusbar

	class ActionViewToolbar extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -20389110812354L;

		public ActionViewToolbar() {
<span class="nc" id="L1421">			super(&quot;View toolbar&quot;, &quot;View toolbar&quot;, &quot;toolbar&quot;, &quot;&quot;);</span>
<span class="nc" id="L1422">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L1425" title="All 2 branches missed.">			m_jTbTools.setVisible(!m_jTbTools.isVisible());</span>
<span class="nc" id="L1426">		} // actionPerformed</span>
	} // class ActionViewToolbar

	class ActionSave extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -20389110859355156L;

		public ActionSave() {
<span class="nc" id="L1434">			super(&quot;Save&quot;, &quot;Save Graph&quot;, &quot;save&quot;, &quot;ctrl S&quot;);</span>
<span class="nc" id="L1435">		} // c'tor</span>

		public ActionSave(String sName, String sToolTipText, String sIcon, String sAcceleratorKey) {
<span class="nc" id="L1438">			super(sName, sToolTipText, sIcon, sAcceleratorKey);</span>
<span class="nc" id="L1439">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L1442" title="All 2 branches missed.">			if (!m_sFileName.equals(&quot;&quot;)) {</span>
<span class="nc" id="L1443">				saveFile(m_sFileName);</span>
<span class="nc" id="L1444">				m_BayesNet.isSaved();</span>
<span class="nc" id="L1445">			    m_jStatusBar.setText(&quot;Saved as &quot; + m_sFileName);</span>
			} else {
<span class="nc bnc" id="L1447" title="All 2 branches missed.">				if (saveAs()) {</span>
<span class="nc" id="L1448">					m_BayesNet.isSaved();</span>
<span class="nc" id="L1449">				    m_jStatusBar.setText(&quot;Saved as &quot; + m_sFileName);					</span>
				}
			}
<span class="nc" id="L1452">		} // actionPerformed</span>


<span class="nc" id="L1455">		ExtensionFileFilter ef1 = new ExtensionFileFilter(&quot;.xml&quot;, &quot;XML BIF files&quot;);</span>

		boolean saveAs() {
<span class="nc" id="L1458">			JFileChooser fc = new JFileChooser(System.getProperty(&quot;user.dir&quot;));</span>
<span class="nc" id="L1459">			fc.addChoosableFileFilter(ef1);</span>
<span class="nc" id="L1460">			fc.setDialogTitle(&quot;Save Graph As&quot;);</span>
<span class="nc bnc" id="L1461" title="All 2 branches missed.">			if (!m_sFileName.equals(&quot;&quot;)) {</span>
				// can happen on actionQuit
<span class="nc" id="L1463">				fc.setSelectedFile(new File(m_sFileName));</span>
			}
<span class="nc" id="L1465">			int rval = fc.showSaveDialog(GUI.this);</span>

<span class="nc bnc" id="L1467" title="All 2 branches missed.">			if (rval == JFileChooser.APPROVE_OPTION) {</span>
				// System.out.println(&quot;Saving to file \&quot;&quot;+
				// f.getAbsoluteFile().toString()+&quot;\&quot;&quot;);
<span class="nc" id="L1470">				String sFileName = fc.getSelectedFile().toString();</span>
<span class="nc bnc" id="L1471" title="All 2 branches missed.">				if (!sFileName.endsWith(&quot;.xml&quot;))</span>
<span class="nc" id="L1472">					sFileName = sFileName.concat(&quot;.xml&quot;);</span>
<span class="nc" id="L1473">				saveFile(sFileName);</span>
<span class="nc" id="L1474">				return true;</span>
			}
<span class="nc" id="L1476">			return false;</span>
		} // saveAs

		protected void saveFile(String sFileName) {
		    try {
<span class="nc" id="L1481">		        FileWriter outfile = new FileWriter(sFileName);</span>
<span class="nc" id="L1482">		        outfile.write(m_BayesNet.toXMLBIF03());</span>
<span class="nc" id="L1483">		        outfile.close();</span>
<span class="nc" id="L1484">				m_sFileName = sFileName;</span>
<span class="nc" id="L1485">			    m_jStatusBar.setText(&quot;Saved as &quot; + m_sFileName);</span>
		      }
<span class="nc" id="L1487">		      catch(IOException e) { </span>
<span class="nc" id="L1488">		    	  e.printStackTrace(); </span>
		      }
<span class="nc" id="L1490">		  } // saveFile</span>
	} // class ActionSave
	
	class ActionSaveAs extends ActionSave {
		/** for serialization */
		private static final long serialVersionUID = -20389110859354L;

		public ActionSaveAs() {
<span class="nc" id="L1498">			super(&quot;Save As&quot;, &quot;Save Graph As&quot;, &quot;saveas&quot;, &quot;&quot;);</span>
<span class="nc" id="L1499">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1502">			saveAs();</span>
<span class="nc" id="L1503">		} // actionPerformed</span>
	} // class ActionSaveAs

	class ActionPrint extends ActionSave {
		/** for serialization */
		private static final long serialVersionUID = -20389001859354L;
<span class="nc" id="L1509">		boolean m_bIsPrinting = false;</span>
		public ActionPrint() {
<span class="nc" id="L1511">			super(&quot;Print&quot;, &quot;Print Graph&quot;, &quot;print&quot;, &quot;ctrl P&quot;);</span>
<span class="nc" id="L1512">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1515">		    PrinterJob printJob = PrinterJob.getPrinterJob();</span>
<span class="nc" id="L1516">		    printJob.setPrintable(m_GraphPanel);</span>
<span class="nc bnc" id="L1517" title="All 2 branches missed.">		    if (printJob.printDialog())</span>
		      try { 
<span class="nc" id="L1519">		  		m_bIsPrinting = true;</span>
<span class="nc" id="L1520">		        printJob.print();</span>
<span class="nc" id="L1521">				m_bIsPrinting = false;</span>
<span class="nc" id="L1522">		      } catch(PrinterException pe) {</span>
<span class="nc" id="L1523">		        m_jStatusBar.setText(&quot;Error printing: &quot; + pe);</span>
<span class="nc" id="L1524">				m_bIsPrinting = false;</span>
		      }
<span class="nc" id="L1526">			    m_jStatusBar.setText(&quot;Print&quot;);</span>
<span class="nc" id="L1527">		} // actionPerformed</span>
<span class="nc" id="L1528">		public boolean isPrinting() {return m_bIsPrinting;}</span>

	} // class ActionPrint

	class ActionQuit extends ActionSave {
		/** for serialization */
		private static final long serialVersionUID = -2038911085935515L;

		public ActionQuit() {
<span class="nc" id="L1537">			super(&quot;Exit&quot;, &quot;Exit Program&quot;, &quot;exit&quot;, &quot;&quot;);</span>
<span class="nc" id="L1538">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L1541" title="All 2 branches missed.">			if (m_BayesNet.isChanged()) {</span>
<span class="nc" id="L1542">				int result = JOptionPane.showConfirmDialog(null, &quot;Network changed. Do you want to save it?&quot;, &quot;Save before closing?&quot;, JOptionPane.YES_NO_CANCEL_OPTION);</span>
<span class="nc bnc" id="L1543" title="All 2 branches missed.">				if (result == JOptionPane.CANCEL_OPTION) {</span>
<span class="nc" id="L1544">					return;</span>
				}
<span class="nc bnc" id="L1546" title="All 2 branches missed.">				if (result == JOptionPane.YES_OPTION) {</span>
<span class="nc bnc" id="L1547" title="All 2 branches missed.">					if (!saveAs()) {</span>
<span class="nc" id="L1548">						return;</span>
					}
				}
			}
<span class="nc" id="L1552">			System.exit(0);</span>
<span class="nc" id="L1553">		}</span>
	} // class ActionQuit

	class ActionHelp extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -20389110859354L;

		public ActionHelp() {
<span class="nc" id="L1561">			super(&quot;Help&quot;, &quot;Bayesian Network Workbench Help&quot;, &quot;help&quot;, &quot;&quot;);</span>
<span class="nc" id="L1562">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1565">			JOptionPane.showMessageDialog(null, &quot;See Weka Homepage\nhttp://www.cs.waikato.ac.nz/ml&quot;, &quot;Help Message&quot;,</span>
<span class="nc" id="L1566">					JOptionPane.PLAIN_MESSAGE);</span>
<span class="nc" id="L1567">		}</span>
	} // class ActionHelp

	class ActionAbout extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -20389110859353L;

		public ActionAbout() {
<span class="nc" id="L1575">			super(&quot;About&quot;, &quot;Help about&quot;, &quot;about&quot;, &quot;&quot;);</span>
<span class="nc" id="L1576">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1579">			JOptionPane.showMessageDialog(null, &quot;Bayesian Network Workbench\nPart of Weka\n2007&quot;, &quot;About Message&quot;,</span>
<span class="nc" id="L1580">					JOptionPane.PLAIN_MESSAGE);</span>
<span class="nc" id="L1581">		}</span>
	} // class ActionAbout

	class ActionZoomIn extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -2038911085935515L;

		public ActionZoomIn() {
<span class="nc" id="L1589">			super(&quot;Zoom in&quot;, &quot;Zoom in&quot;, &quot;zoomin&quot;, &quot;+&quot;);</span>
<span class="nc" id="L1590">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1593">			int i = 0, s = (int) (m_fScale * 100);</span>
<span class="nc bnc" id="L1594" title="All 2 branches missed.">			if (s &lt; 300)</span>
<span class="nc" id="L1595">				i = s / 25;</span>
<span class="nc bnc" id="L1596" title="All 2 branches missed.">			else if (s &lt; 700)</span>
<span class="nc" id="L1597">				i = 6 + s / 50;</span>
			else
<span class="nc" id="L1599">				i = 13 + s / 100;</span>

<span class="nc bnc" id="L1601" title="All 2 branches missed.">			if (s &gt;= 999) {</span>
<span class="nc" id="L1602">				setEnabled(false);</span>
<span class="nc" id="L1603">				return;</span>
<span class="nc bnc" id="L1604" title="All 2 branches missed.">			} else if (s &gt;= 10) {</span>
<span class="nc bnc" id="L1605" title="All 2 branches missed.">				if (i &gt;= 22) {</span>
<span class="nc" id="L1606">					setEnabled(false);</span>
				}
<span class="nc bnc" id="L1608" title="All 4 branches missed.">				if (s == 10 &amp;&amp; !a_zoomout.isEnabled()) {</span>
<span class="nc" id="L1609">					a_zoomout.setEnabled(true);</span>
				}
<span class="nc" id="L1611">				m_jTfZoom.setText(m_nZoomPercents[i + 1] + &quot;%&quot;);</span>
<span class="nc" id="L1612">				m_fScale = m_nZoomPercents[i + 1] / 100D;</span>
			} else {
<span class="nc bnc" id="L1614" title="All 2 branches missed.">				if (!a_zoomout.isEnabled())</span>
<span class="nc" id="L1615">					a_zoomout.setEnabled(true);</span>
<span class="nc" id="L1616">				m_jTfZoom.setText(m_nZoomPercents[0] + &quot;%&quot;);</span>
<span class="nc" id="L1617">				m_fScale = m_nZoomPercents[0] / 100D;</span>
			}
<span class="nc" id="L1619">			setAppropriateSize();</span>
<span class="nc" id="L1620">			m_GraphPanel.repaint();</span>
<span class="nc" id="L1621">			m_GraphPanel.invalidate();</span>
<span class="nc" id="L1622">			m_jScrollPane.revalidate();</span>
<span class="nc" id="L1623">		    m_jStatusBar.setText(&quot;Zooming in&quot;);</span>
<span class="nc" id="L1624">		}</span>
	} // class ActionZoomIn

	class ActionZoomOut extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -203891108593551L;

		public ActionZoomOut() {
<span class="nc" id="L1632">			super(&quot;Zoom out&quot;, &quot;Zoom out&quot;, &quot;zoomout&quot;, &quot;-&quot;);</span>
<span class="nc" id="L1633">		} // c'tor</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1636">			int i = 0, s = (int) (m_fScale * 100);</span>
<span class="nc bnc" id="L1637" title="All 2 branches missed.">			if (s &lt; 300)</span>
<span class="nc" id="L1638">				i = (int) Math.ceil(s / 25D);</span>
<span class="nc bnc" id="L1639" title="All 2 branches missed.">			else if (s &lt; 700)</span>
<span class="nc" id="L1640">				i = 6 + (int) Math.ceil(s / 50D);</span>
			else
<span class="nc" id="L1642">				i = 13 + (int) Math.ceil(s / 100D);</span>

<span class="nc bnc" id="L1644" title="All 2 branches missed.">			if (s &lt;= 10) {</span>
<span class="nc" id="L1645">				setEnabled(false);</span>
<span class="nc bnc" id="L1646" title="All 2 branches missed.">			} else if (s &lt; 999) {</span>
<span class="nc bnc" id="L1647" title="All 2 branches missed.">				if (i &lt;= 1) {</span>
<span class="nc" id="L1648">					setEnabled(false);</span>
				}
<span class="nc" id="L1650">				m_jTfZoom.setText(m_nZoomPercents[i - 1] + &quot;%&quot;);</span>
<span class="nc" id="L1651">				m_fScale = m_nZoomPercents[i - 1] / 100D;</span>
			} else {
<span class="nc bnc" id="L1653" title="All 2 branches missed.">				if (!a_zoomin.isEnabled())</span>
<span class="nc" id="L1654">					a_zoomin.setEnabled(true);</span>
<span class="nc" id="L1655">				m_jTfZoom.setText(m_nZoomPercents[22] + &quot;%&quot;);</span>
<span class="nc" id="L1656">				m_fScale = m_nZoomPercents[22] / 100D;</span>
			}
<span class="nc" id="L1658">			setAppropriateSize();</span>
<span class="nc" id="L1659">			m_GraphPanel.repaint();</span>
<span class="nc" id="L1660">			m_GraphPanel.invalidate();</span>
<span class="nc" id="L1661">			m_jScrollPane.revalidate();</span>
<span class="nc" id="L1662">		    m_jStatusBar.setText(&quot;Zooming out&quot;);</span>
<span class="nc" id="L1663">		}</span>
	} // class ActionZoomOut

	class ActionLayout extends MyAction {
		/** for serialization */
		private static final long serialVersionUID = -203891108593551L;

		public ActionLayout() {
<span class="nc" id="L1671">			super(&quot;Layout&quot;, &quot;Layout Graph&quot;, &quot;layout&quot;, &quot;ctrl L&quot;);</span>
<span class="nc" id="L1672">		} // c'tor</span>

<span class="nc" id="L1674">		JDialog dlg = null;</span>

		public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L1677" title="All 2 branches missed.">			if (dlg == null) {</span>
<span class="nc" id="L1678">				dlg = new JDialog();</span>
<span class="nc" id="L1679">				dlg.setTitle(&quot;Graph Layout Options&quot;);</span>
<span class="nc" id="L1680">				final JCheckBox jCbCustomNodeSize = new JCheckBox(&quot;Custom Node Size&quot;);</span>
<span class="nc" id="L1681">				final JLabel jLbNodeWidth = new JLabel(&quot;Width&quot;);</span>
<span class="nc" id="L1682">				final JLabel jLbNodeHeight = new JLabel(&quot;Height&quot;);</span>

<span class="nc" id="L1684">				m_jTfNodeWidth.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L1685">				m_jTfNodeWidth.setText(&quot;&quot; + m_nNodeWidth);</span>
<span class="nc" id="L1686">				m_jTfNodeHeight.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L1687">				m_jTfNodeHeight.setText(&quot;&quot; + m_nNodeHeight);</span>
<span class="nc" id="L1688">				jLbNodeWidth.setEnabled(false);</span>
<span class="nc" id="L1689">				m_jTfNodeWidth.setEnabled(false);</span>
<span class="nc" id="L1690">				jLbNodeHeight.setEnabled(false);</span>
<span class="nc" id="L1691">				m_jTfNodeHeight.setEnabled(false);</span>

<span class="nc" id="L1693">				jCbCustomNodeSize.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L1695" title="All 2 branches missed.">						if (((JCheckBox) ae.getSource()).isSelected()) {</span>
<span class="nc" id="L1696">							jLbNodeWidth.setEnabled(true);</span>
<span class="nc" id="L1697">							m_jTfNodeWidth.setEnabled(true);</span>
<span class="nc" id="L1698">							jLbNodeHeight.setEnabled(true);</span>
<span class="nc" id="L1699">							m_jTfNodeHeight.setEnabled(true);</span>
						} else {
<span class="nc" id="L1701">							jLbNodeWidth.setEnabled(false);</span>
<span class="nc" id="L1702">							m_jTfNodeWidth.setEnabled(false);</span>
<span class="nc" id="L1703">							jLbNodeHeight.setEnabled(false);</span>
<span class="nc" id="L1704">							m_jTfNodeHeight.setEnabled(false);</span>
<span class="nc" id="L1705">							setAppropriateSize();</span>
<span class="nc" id="L1706">							setAppropriateNodeSize();</span>
						}
<span class="nc" id="L1708">					}</span>
				});
				JButton jBtLayout;
<span class="nc" id="L1711">				jBtLayout = new JButton(&quot;Layout Graph&quot;);</span>
<span class="nc" id="L1712">				jBtLayout.setMnemonic('L');</span>

<span class="nc" id="L1714">				jBtLayout.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
						int tmpW, tmpH;

<span class="nc bnc" id="L1718" title="All 2 branches missed.">						if (jCbCustomNodeSize.isSelected()) {</span>
							try {
<span class="nc" id="L1720">								tmpW = Integer.parseInt(m_jTfNodeWidth.getText());</span>
<span class="nc" id="L1721">							} catch (NumberFormatException ne) {</span>
<span class="nc" id="L1722">								JOptionPane.showMessageDialog(GUI.this.getParent(),</span>
<span class="nc" id="L1723">										&quot;Invalid integer entered for node width.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L1724">								tmpW = m_nNodeWidth;</span>
<span class="nc" id="L1725">								m_jTfNodeWidth.setText(&quot;&quot; + m_nNodeWidth);</span>

							}
							try {
<span class="nc" id="L1729">								tmpH = Integer.parseInt(m_jTfNodeHeight.getText());</span>
<span class="nc" id="L1730">							} catch (NumberFormatException ne) {</span>
<span class="nc" id="L1731">								JOptionPane.showMessageDialog(GUI.this.getParent(),</span>
<span class="nc" id="L1732">										&quot;Invalid integer entered for node height.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L1733">								tmpH = m_nNodeHeight;</span>
<span class="nc" id="L1734">								m_jTfNodeWidth.setText(&quot;&quot; + m_nNodeHeight);</span>
							}

<span class="nc bnc" id="L1737" title="All 4 branches missed.">							if (tmpW != m_nNodeWidth || tmpH != m_nNodeHeight) {</span>
<span class="nc" id="L1738">								m_nNodeWidth = tmpW;</span>
<span class="nc" id="L1739">								m_nPaddedNodeWidth = m_nNodeWidth + PADDING;</span>
<span class="nc" id="L1740">								m_nNodeHeight = tmpH;</span>
							}
						}
						// JButton bt = (JButton) ae.getSource();
						// bt.setEnabled(false);
<span class="nc" id="L1745">						dlg.setVisible(false);</span>
<span class="nc" id="L1746">						updateStatus();</span>
<span class="nc" id="L1747">						layoutGraph();</span>
<span class="nc" id="L1748">					    m_jStatusBar.setText(&quot;Laying out Bayes net&quot;);</span>
<span class="nc" id="L1749">					}</span>
				});
				JButton jBtCancel;
<span class="nc" id="L1752">				jBtCancel = new JButton(&quot;Cancel&quot;);</span>
<span class="nc" id="L1753">				jBtCancel.setMnemonic('C');</span>
<span class="nc" id="L1754">				jBtCancel.addActionListener(new ActionListener() {</span>
					public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1756">						dlg.setVisible(false);</span>
<span class="nc" id="L1757">					}</span>
				});
<span class="nc" id="L1759">				GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="nc" id="L1760">				dlg.setLayout(new GridBagLayout());</span>
				//dlg.add(m_le.getControlPanel());

<span class="nc" id="L1763">				Container c = new Container();</span>
<span class="nc" id="L1764">				c.setLayout(new GridBagLayout());</span>

<span class="nc" id="L1766">				gbc.gridwidth = 1;</span>
<span class="nc" id="L1767">				gbc.insets = new Insets(8, 0, 0, 0);</span>
<span class="nc" id="L1768">				gbc.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L1769">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L1770">				c.add(jCbCustomNodeSize, gbc);</span>
<span class="nc" id="L1771">				gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L1772">				c.add(jLbNodeWidth, gbc);</span>
<span class="nc" id="L1773">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L1774">				c.add(m_jTfNodeWidth, gbc);</span>
<span class="nc" id="L1775">				gbc.gridwidth = GridBagConstraints.RELATIVE;</span>
<span class="nc" id="L1776">				c.add(jLbNodeHeight, gbc);</span>
<span class="nc" id="L1777">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L1778">				c.add(m_jTfNodeHeight, gbc);</span>
<span class="nc" id="L1779">				gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L1780">				dlg.add(c, gbc);</span>
<span class="nc" id="L1781">				dlg.add(jBtLayout);</span>
<span class="nc" id="L1782">				gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L1783">				dlg.add(jBtCancel);</span>
			}
<span class="nc" id="L1785">			dlg.setLocation(100, 100);</span>
<span class="nc" id="L1786">			dlg.setVisible(true);</span>
<span class="nc" id="L1787">			dlg.setSize(dlg.getPreferredSize());</span>
<span class="nc" id="L1788">			dlg.setVisible(false);</span>
<span class="nc" id="L1789">			dlg.setVisible(true);</span>
<span class="nc" id="L1790">			dlg.repaint();</span>
<span class="nc" id="L1791">		}</span>
	} // class ActionLayout

	/**
	 * Constructor&lt;br&gt;
	 * Sets up the gui and initializes all the other previously uninitialized
	 * variables.
	 */
<span class="nc" id="L1799">	public GUI() {</span>
<span class="nc" id="L1800">		m_GraphPanel = new GraphPanel();</span>
<span class="nc" id="L1801">		m_jScrollPane = new JScrollPane(m_GraphPanel);</span>

		// creating a new layout engine and adding this class as its listener
		// to receive layoutComplete events
	
<span class="nc" id="L1806">		m_jTfZoom = new JTextField(&quot;100%&quot;);</span>
<span class="nc" id="L1807">		m_jTfZoom.setMinimumSize(m_jTfZoom.getPreferredSize());</span>
<span class="nc" id="L1808">		m_jTfZoom.setHorizontalAlignment(JTextField.CENTER);</span>
<span class="nc" id="L1809">		m_jTfZoom.setToolTipText(&quot;Zoom&quot;);</span>

<span class="nc" id="L1811">		m_jTfZoom.addActionListener(new ActionListener() {</span>
			public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1813">				JTextField jt = (JTextField) ae.getSource();</span>
				try {
<span class="nc" id="L1815">					int i = -1;</span>
<span class="nc" id="L1816">					i = jt.getText().indexOf('%');</span>
<span class="nc bnc" id="L1817" title="All 2 branches missed.">					if (i == -1)</span>
<span class="nc" id="L1818">						i = Integer.parseInt(jt.getText());</span>
					else
<span class="nc" id="L1820">						i = Integer.parseInt(jt.getText().substring(0, i));</span>

<span class="nc bnc" id="L1822" title="All 2 branches missed.">					if (i &lt;= 999)</span>
<span class="nc" id="L1823">						m_fScale = i / 100D;</span>

<span class="nc" id="L1825">					jt.setText((int) (m_fScale * 100) + &quot;%&quot;);</span>
<span class="nc bnc" id="L1826" title="All 2 branches missed.">					if (m_fScale &gt; 0.1) {</span>
<span class="nc bnc" id="L1827" title="All 2 branches missed.">						if (!a_zoomout.isEnabled())</span>
<span class="nc" id="L1828">							a_zoomout.setEnabled(true);</span>
					} else
<span class="nc" id="L1830">						a_zoomout.setEnabled(false);</span>
<span class="nc bnc" id="L1831" title="All 2 branches missed.">					if (m_fScale &lt; 9.99) {</span>
<span class="nc bnc" id="L1832" title="All 2 branches missed.">						if (!a_zoomin.isEnabled())</span>
<span class="nc" id="L1833">							a_zoomin.setEnabled(true);</span>
					} else
<span class="nc" id="L1835">						a_zoomin.setEnabled(false);</span>
<span class="nc" id="L1836">					setAppropriateSize();</span>
					// m_GraphPanel.clearBuffer();
<span class="nc" id="L1838">					m_GraphPanel.repaint();</span>
<span class="nc" id="L1839">					m_GraphPanel.invalidate();</span>
<span class="nc" id="L1840">					m_jScrollPane.revalidate();</span>
<span class="nc" id="L1841">				} catch (NumberFormatException ne) {</span>
<span class="nc" id="L1842">					JOptionPane.showMessageDialog(GUI.this.getParent(),</span>
<span class="nc" id="L1843">							&quot;Invalid integer entered for zoom.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L1844">					jt.setText((m_fScale * 100) + &quot;%&quot;);</span>
				}
<span class="nc" id="L1846">			}</span>
		});

<span class="nc" id="L1849">		GridBagConstraints gbc = new GridBagConstraints();</span>

<span class="nc" id="L1851">		final JPanel p = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L1852">		p.setBorder(BorderFactory.createCompoundBorder(BorderFactory.createTitledBorder(&quot;ExtraControls&quot;), BorderFactory</span>
<span class="nc" id="L1853">				.createEmptyBorder(4, 4, 4, 4)));</span>
<span class="nc" id="L1854">		p.setPreferredSize(new Dimension(0, 0));</span>

<span class="nc" id="L1856">		m_jTbTools = new JToolBar();</span>
<span class="nc" id="L1857">		m_jTbTools.setFloatable(false);</span>
<span class="nc" id="L1858">		m_jTbTools.setLayout(new GridBagLayout());</span>
<span class="nc" id="L1859">		gbc.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L1860">		gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L1861">		gbc.insets = new Insets(0, 0, 0, 0);</span>
<span class="nc" id="L1862">		m_jTbTools.add(p, gbc);</span>
<span class="nc" id="L1863">		gbc.gridwidth = 1;</span>


<span class="nc" id="L1866">		m_jTbTools.add(a_new);</span>
<span class="nc" id="L1867">		m_jTbTools.add(a_save);</span>
<span class="nc" id="L1868">		m_jTbTools.add(a_load);</span>
<span class="nc" id="L1869">		m_jTbTools.addSeparator(new Dimension(2, 2));</span>
<span class="nc" id="L1870">		m_jTbTools.add(a_cutnode);</span>
<span class="nc" id="L1871">		m_jTbTools.add(a_copynode);</span>
<span class="nc" id="L1872">		m_jTbTools.add(a_pastenode);</span>
<span class="nc" id="L1873">		m_jTbTools.addSeparator(new Dimension(2, 2));</span>
<span class="nc" id="L1874">		m_jTbTools.add(a_undo);</span>
<span class="nc" id="L1875">		m_jTbTools.add(a_redo);</span>
<span class="nc" id="L1876">		m_jTbTools.addSeparator(new Dimension(2, 2));</span>
<span class="nc" id="L1877">		m_jTbTools.add(a_alignleft);</span>
<span class="nc" id="L1878">		m_jTbTools.add(a_alignright);</span>
<span class="nc" id="L1879">		m_jTbTools.add(a_aligntop);</span>
<span class="nc" id="L1880">		m_jTbTools.add(a_alignbottom);</span>
<span class="nc" id="L1881">		m_jTbTools.add(a_centerhorizontal);</span>
<span class="nc" id="L1882">		m_jTbTools.add(a_centervertical);</span>
<span class="nc" id="L1883">		m_jTbTools.add(a_spacehorizontal);</span>
<span class="nc" id="L1884">		m_jTbTools.add(a_spacevertical);</span>

		
<span class="nc" id="L1887">		m_jTbTools.addSeparator(new Dimension(2, 2));</span>
<span class="nc" id="L1888">		m_jTbTools.add(a_zoomin);</span>

<span class="nc" id="L1890">		gbc.fill = GridBagConstraints.VERTICAL;</span>
<span class="nc" id="L1891">		gbc.weighty = 1;</span>
<span class="nc" id="L1892">		JPanel p2 = new JPanel(new BorderLayout());</span>
<span class="nc" id="L1893">		p2.setPreferredSize(m_jTfZoom.getPreferredSize());</span>
<span class="nc" id="L1894">		p2.setMinimumSize(m_jTfZoom.getPreferredSize());</span>
<span class="nc" id="L1895">		p2.add(m_jTfZoom, BorderLayout.CENTER);</span>
<span class="nc" id="L1896">		m_jTbTools.add(p2, gbc);</span>
<span class="nc" id="L1897">		gbc.weighty = 0;</span>
<span class="nc" id="L1898">		gbc.fill = GridBagConstraints.NONE;</span>

<span class="nc" id="L1900">		m_jTbTools.add(a_zoomout);</span>
<span class="nc" id="L1901">		m_jTbTools.addSeparator(new Dimension(2, 2));</span>

		// jTbTools.add(jBtExtraControls, gbc);
<span class="nc" id="L1904">		m_jTbTools.add(a_layout);</span>
<span class="nc" id="L1905">		m_jTbTools.addSeparator(new Dimension(4, 2));</span>
<span class="nc" id="L1906">		gbc.weightx = 1;</span>
<span class="nc" id="L1907">		gbc.fill = GridBagConstraints.BOTH;</span>
		//jTbTools.add(m_layoutEngine.getProgressBar(), gbc);
<span class="nc" id="L1909">		m_jStatusBar = new JLabel(&quot;Status bar&quot;);</span>

<span class="nc" id="L1911">		this.setLayout(new BorderLayout());</span>
<span class="nc" id="L1912">		this.add(m_jTbTools, BorderLayout.NORTH);</span>
<span class="nc" id="L1913">		this.add(m_jScrollPane, BorderLayout.CENTER);</span>
<span class="nc" id="L1914">		this.add(m_jStatusBar, BorderLayout.SOUTH);</span>

<span class="nc" id="L1916">		updateStatus();</span>
<span class="nc" id="L1917">		a_datagenerator.setEnabled(false);</span>
		
<span class="nc" id="L1919">		makeMenuBar();</span>
<span class="nc" id="L1920">	}</span>
	
	/**
	 * Get the menu bar for this application.
	 * 
	 * @return the menu bar
	 */
	public JMenuBar getMenuBar() {
<span class="nc" id="L1928">	  return m_menuBar;</span>
	}
	
	private void makeMenuBar() {
<span class="nc" id="L1932">          m_menuBar = new JMenuBar();</span>
<span class="nc" id="L1933">          JMenu fileMenu = new JMenu(&quot;File&quot;);</span>
<span class="nc" id="L1934">          fileMenu.setMnemonic('F');</span>

<span class="nc" id="L1936">          m_menuBar.add(fileMenu);</span>
<span class="nc" id="L1937">          fileMenu.add(a_new);</span>
<span class="nc" id="L1938">          fileMenu.add(a_load);</span>
<span class="nc" id="L1939">          fileMenu.add(a_save);</span>
<span class="nc" id="L1940">          fileMenu.add(a_saveas);</span>
<span class="nc" id="L1941">          fileMenu.addSeparator();</span>
<span class="nc" id="L1942">          fileMenu.add(a_print);</span>
<span class="nc" id="L1943">          fileMenu.add(a_export);</span>
<span class="nc" id="L1944">          fileMenu.addSeparator();</span>
<span class="nc" id="L1945">          fileMenu.add(a_quit);</span>
<span class="nc" id="L1946">          JMenu editMenu = new JMenu(&quot;Edit&quot;);</span>
<span class="nc" id="L1947">          editMenu.setMnemonic('E');</span>
<span class="nc" id="L1948">          m_menuBar.add(editMenu);</span>
<span class="nc" id="L1949">          editMenu.add(a_undo);</span>
<span class="nc" id="L1950">          editMenu.add(a_redo);</span>
<span class="nc" id="L1951">          editMenu.addSeparator();</span>
<span class="nc" id="L1952">          editMenu.add(a_selectall);</span>
<span class="nc" id="L1953">          editMenu.add(a_delnode);</span>
<span class="nc" id="L1954">          editMenu.add(a_cutnode);</span>
<span class="nc" id="L1955">          editMenu.add(a_copynode);</span>
<span class="nc" id="L1956">          editMenu.add(a_pastenode);</span>
<span class="nc" id="L1957">          editMenu.addSeparator();</span>
<span class="nc" id="L1958">          editMenu.add(a_addnode);</span>
<span class="nc" id="L1959">          editMenu.add(a_addarc);</span>
<span class="nc" id="L1960">          editMenu.add(a_delarc);</span>
<span class="nc" id="L1961">          editMenu.addSeparator();</span>
<span class="nc" id="L1962">          editMenu.add(a_alignleft);</span>
<span class="nc" id="L1963">          editMenu.add(a_alignright);</span>
<span class="nc" id="L1964">          editMenu.add(a_aligntop);</span>
<span class="nc" id="L1965">          editMenu.add(a_alignbottom);</span>
<span class="nc" id="L1966">          editMenu.add(a_centerhorizontal);</span>
<span class="nc" id="L1967">          editMenu.add(a_centervertical);</span>
<span class="nc" id="L1968">          editMenu.add(a_spacehorizontal);</span>
<span class="nc" id="L1969">          editMenu.add(a_spacevertical);</span>

<span class="nc" id="L1971">          JMenu toolMenu = new JMenu(&quot;Tools&quot;);</span>
<span class="nc" id="L1972">          toolMenu.setMnemonic('T');</span>
<span class="nc" id="L1973">          toolMenu.add(a_networkgenerator);</span>
<span class="nc" id="L1974">          toolMenu.add(a_datagenerator);</span>
<span class="nc" id="L1975">          toolMenu.add(a_datasetter);</span>
<span class="nc" id="L1976">          toolMenu.add(a_learn);</span>
<span class="nc" id="L1977">          toolMenu.add(a_learnCPT);</span>
<span class="nc" id="L1978">          toolMenu.addSeparator();</span>
<span class="nc" id="L1979">          toolMenu.add(a_layout);</span>
<span class="nc" id="L1980">          toolMenu.addSeparator();</span>
<span class="nc" id="L1981">          final JCheckBoxMenuItem viewMargins = new JCheckBoxMenuItem(&quot;Show Margins&quot;, false);</span>
<span class="nc" id="L1982">          viewMargins.addActionListener(new ActionListener() {</span>
                  public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1984">                          boolean bPrev = m_bViewMargins; </span>
<span class="nc" id="L1985">                          m_bViewMargins = viewMargins.getState();</span>
<span class="nc bnc" id="L1986" title="All 4 branches missed.">                          if (bPrev == false &amp;&amp; viewMargins.getState() == true) {</span>
<span class="nc" id="L1987">                                  updateStatus();</span>
                          }
<span class="nc" id="L1989">                          repaint();</span>
<span class="nc" id="L1990">                  }</span>
          });
<span class="nc" id="L1992">          toolMenu.add(viewMargins);</span>
<span class="nc" id="L1993">          final JCheckBoxMenuItem viewCliques = new JCheckBoxMenuItem(&quot;Show Cliques&quot;, false);</span>
<span class="nc" id="L1994">          viewCliques.addActionListener(new ActionListener() {</span>
                  public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L1996">                          boolean bPrev = m_bViewCliques; </span>
<span class="nc" id="L1997">                          m_bViewCliques = viewCliques.getState();</span>
<span class="nc bnc" id="L1998" title="All 4 branches missed.">                          if (bPrev == false &amp;&amp; viewCliques.getState() == true) {</span>
<span class="nc" id="L1999">                                  updateStatus();</span>
                          }
<span class="nc" id="L2001">                          repaint();</span>
<span class="nc" id="L2002">                  }</span>
          });
<span class="nc" id="L2004">          toolMenu.add(viewCliques);</span>

<span class="nc" id="L2006">          m_menuBar.add(toolMenu);</span>
<span class="nc" id="L2007">          JMenu viewMenu = new JMenu(&quot;View&quot;);</span>
<span class="nc" id="L2008">          viewMenu.setMnemonic('V');</span>
<span class="nc" id="L2009">          m_menuBar.add(viewMenu);</span>
<span class="nc" id="L2010">          viewMenu.add(a_zoomin);</span>
<span class="nc" id="L2011">          viewMenu.add(a_zoomout);</span>
<span class="nc" id="L2012">          viewMenu.addSeparator();</span>
<span class="nc" id="L2013">          viewMenu.add(a_viewtoolbar);</span>
<span class="nc" id="L2014">          viewMenu.add(a_viewstatusbar);</span>

<span class="nc" id="L2016">          JMenu helpMenu = new JMenu(&quot;Help&quot;);</span>
<span class="nc" id="L2017">          helpMenu.setMnemonic('H');</span>
<span class="nc" id="L2018">          m_menuBar.add(helpMenu);</span>
<span class="nc" id="L2019">          helpMenu.add(a_help);</span>
<span class="nc" id="L2020">          helpMenu.add(a_about);</span>
<span class="nc" id="L2021">	}</span>

	/**
	 * This method sets the node size that is appropriate considering the
	 * maximum label size that is present. It is used internally when custom
	 * node size checkbox is unchecked.
	 */
	protected void setAppropriateNodeSize() {
		int strWidth;
<span class="nc" id="L2030">		FontMetrics fm = this.getFontMetrics(this.getFont());</span>
<span class="nc" id="L2031">		int nMaxStringWidth = DEFAULT_NODE_WIDTH;</span>
<span class="nc bnc" id="L2032" title="All 2 branches missed.">		if (nMaxStringWidth == 0)</span>
<span class="nc bnc" id="L2033" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc" id="L2034">				strWidth = fm.stringWidth(m_BayesNet.getNodeName(iNode));</span>
<span class="nc bnc" id="L2035" title="All 2 branches missed.">				if (strWidth &gt; nMaxStringWidth)</span>
<span class="nc" id="L2036">					nMaxStringWidth = strWidth;</span>
			}
<span class="nc" id="L2038">		m_nNodeWidth = nMaxStringWidth + 4;</span>
<span class="nc" id="L2039">		m_nPaddedNodeWidth = m_nNodeWidth + PADDING;</span>
<span class="nc" id="L2040">		m_jTfNodeWidth.setText(&quot;&quot; + m_nNodeWidth);</span>

<span class="nc" id="L2042">		m_nNodeHeight = 2 * fm.getHeight();</span>
<span class="nc" id="L2043">		m_jTfNodeHeight.setText(&quot;&quot; + m_nNodeHeight);</span>
<span class="nc" id="L2044">	}</span>

	/**
	 * Sets the preferred size for m_GraphPanel GraphPanel to the minimum size that is
	 * neccessary to display the graph.
	 */
	public void setAppropriateSize() {
<span class="nc" id="L2051">		int maxX = 0, maxY = 0;</span>

<span class="nc" id="L2053">		m_GraphPanel.setScale(m_fScale, m_fScale);</span>

<span class="nc bnc" id="L2055" title="All 2 branches missed.">		for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc" id="L2056">			int nPosX = m_BayesNet.getPositionX(iNode); </span>
<span class="nc" id="L2057">			int nPosY = m_BayesNet.getPositionY(iNode); </span>
<span class="nc bnc" id="L2058" title="All 2 branches missed.">			if (maxX &lt; nPosX)</span>
<span class="nc" id="L2059">				maxX = nPosX + 100;</span>
<span class="nc bnc" id="L2060" title="All 2 branches missed.">			if (maxY &lt; nPosY)</span>
<span class="nc" id="L2061">				maxY = nPosY;</span>
		}
<span class="nc" id="L2063">		m_GraphPanel.setPreferredSize(new Dimension((int) ((maxX + m_nPaddedNodeWidth + 2) * m_fScale),</span>
<span class="nc" id="L2064">				(int) ((maxY + m_nNodeHeight + 2) * m_fScale)));</span>
<span class="nc" id="L2065">		m_GraphPanel.revalidate();</span>
<span class="nc" id="L2066">	} // setAppropriateSize</span>

	/**
	 * This method is an implementation for LayoutCompleteEventListener class.
	 * It sets the size appropriate for m_GraphPanel GraphPanel and and revalidates it's
	 * container JScrollPane once a LayoutCompleteEvent is received from the
	 * LayoutEngine. Also, it updates positions of the Bayesian network stored
	 * in m_BayesNet.
	 */
	public void layoutCompleted(LayoutCompleteEvent le) {
<span class="nc" id="L2076">		LayoutEngine layoutEngine  = m_layoutEngine; // (LayoutEngine) le.getSource();</span>
<span class="nc" id="L2077">		FastVector nPosX = new FastVector(m_BayesNet.getNrOfNodes());</span>
<span class="nc" id="L2078">		FastVector nPosY = new FastVector(m_BayesNet.getNrOfNodes());</span>
<span class="nc bnc" id="L2079" title="All 2 branches missed.">		for (int iNode = 0; iNode &lt; layoutEngine.getNodes().size(); iNode++) {</span>
<span class="nc" id="L2080">			GraphNode gNode = (GraphNode) layoutEngine.getNodes().elementAt(iNode);</span>
<span class="nc bnc" id="L2081" title="All 2 branches missed.">			if (gNode.nodeType == GraphNode.NORMAL) {</span>
<span class="nc" id="L2082">				nPosX.addElement(gNode.x);</span>
<span class="nc" id="L2083">				nPosY.addElement(gNode.y);</span>
			}
		}
<span class="nc" id="L2086">		m_BayesNet.layoutGraph(nPosX, nPosY);</span>
<span class="nc" id="L2087">		m_jStatusBar.setText(&quot;Graph layed out&quot;);</span>
<span class="nc" id="L2088">		a_undo.setEnabled(true);</span>
<span class="nc" id="L2089">		a_redo.setEnabled(false);</span>
<span class="nc" id="L2090">		setAppropriateSize();</span>
<span class="nc" id="L2091">		m_GraphPanel.invalidate();</span>
<span class="nc" id="L2092">		m_jScrollPane.revalidate();</span>
<span class="nc" id="L2093">		m_GraphPanel.repaint();</span>
<span class="nc" id="L2094">	} // layoutCompleted</span>


	/**
	 * BIF reader&lt;br&gt;
	 * Reads a graph description in XMLBIF03 from an file
	 * with name sFileName
	 */
	public void readBIFFromFile(String sFileName) throws BIFFormatException, IOException {
<span class="nc" id="L2103">		m_sFileName = sFileName;</span>
		try {

<span class="nc" id="L2106">			BIFReader bayesNet = new BIFReader();</span>
<span class="nc" id="L2107">			bayesNet.processFile(sFileName);</span>
<span class="nc" id="L2108">			m_BayesNet = new EditableBayesNet(bayesNet);</span>
<span class="nc" id="L2109">			updateStatus();</span>
<span class="nc bnc" id="L2110" title="All 2 branches missed.">			a_datagenerator.setEnabled(m_BayesNet.getNrOfNodes() &gt; 0);</span>
<span class="nc" id="L2111">			m_BayesNet.clearUndoStack();</span>
<span class="nc" id="L2112">		} catch (Exception ex) {</span>
<span class="nc" id="L2113">			ex.printStackTrace();</span>
<span class="nc" id="L2114">			return;</span>
		}

<span class="nc" id="L2117">		setAppropriateNodeSize();</span>
<span class="nc" id="L2118">		setAppropriateSize();</span>
<span class="nc" id="L2119">	} // readBIFFromFile</span>

	/* read arff file from file sFileName 
	 * and start new Bayesian network with nodes 
	 * representing attributes in data set.
	 */
	void initFromArffFile(String sFileName) {
		try {
<span class="nc" id="L2127">			Instances instances = new Instances(new FileReader(sFileName));</span>
<span class="nc" id="L2128">			m_BayesNet = new EditableBayesNet(instances);</span>
<span class="nc" id="L2129">			m_Instances = instances;</span>
<span class="nc" id="L2130">			a_learn.setEnabled(true);</span>
<span class="nc" id="L2131">			a_learnCPT.setEnabled(true);</span>
<span class="nc" id="L2132">			setAppropriateNodeSize();</span>
<span class="nc" id="L2133">			setAppropriateSize();</span>
<span class="nc" id="L2134">		} catch (Exception ex) {</span>
<span class="nc" id="L2135">			ex.printStackTrace();</span>
<span class="nc" id="L2136">			return;</span>
		}
<span class="nc" id="L2138">	} // initFromArffFile</span>
	
	/**
	 * The panel which contains the actual Bayeian network.
	 */
	private class GraphPanel extends PrintablePanel implements Printable {

		/** for serialization */
		private static final long serialVersionUID = -3562813603236753173L;

		/** node drawing modes */
		final static int HIGHLIGHTED = 1;
		final static int NORMAL = 0;

		public GraphPanel() {
<span class="nc" id="L2153">			super();</span>
<span class="nc" id="L2154">			this.addMouseListener(new GraphVisualizerMouseListener());</span>
<span class="nc" id="L2155">			this.addMouseMotionListener(new GraphVisualizerMouseMotionListener());</span>
<span class="nc" id="L2156">			this.setToolTipText(&quot;&quot;);</span>
<span class="nc" id="L2157">		} // c'tor</span>

		/* For showing instructions when hovering over a node
		 *  (non-Javadoc)
		 * @see javax.swing.JComponent#getToolTipText(java.awt.event.MouseEvent)
		 */
		public String getToolTipText(MouseEvent me) {
			int x, y;
			Rectangle r;
<span class="nc" id="L2166">			x = y  = 0;</span>

<span class="nc" id="L2168">			r = new Rectangle(0, 0, (int) (m_nPaddedNodeWidth * m_fScale), (int) (m_nNodeHeight * m_fScale));</span>
<span class="nc" id="L2169">			x += me.getX();</span>
<span class="nc" id="L2170">			y += me.getY();</span>
			
<span class="nc bnc" id="L2172" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc" id="L2173">				r.x = (int) (m_BayesNet.getPositionX(iNode) * m_fScale);</span>
<span class="nc" id="L2174">				r.y = (int) (m_BayesNet.getPositionY(iNode) * m_fScale);</span>
<span class="nc bnc" id="L2175" title="All 2 branches missed.">				if (r.contains(x, y)) {</span>
<span class="nc" id="L2176">					return m_BayesNet.getNodeName(iNode) + &quot; (right click to manipulate this node)&quot;;</span>
				}
			}
<span class="nc" id="L2179">			return null;</span>
		} // getToolTipText

		/* Code for showing the graph in the panel.
		 *  (non-Javadoc)
		 * @see javax.swing.JComponent#paintComponent(java.awt.Graphics)
		 */
		public void paintComponent(Graphics gr) {
<span class="nc" id="L2187">			Graphics2D g = (Graphics2D) gr;</span>
<span class="nc" id="L2188">			RenderingHints rh = new RenderingHints(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span>
<span class="nc" id="L2189">			rh.put(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_SPEED);</span>
<span class="nc" id="L2190">			g.setRenderingHints(rh);</span>
<span class="nc" id="L2191">			g.scale(m_fScale, m_fScale);</span>
<span class="nc" id="L2192">			Rectangle r = g.getClipBounds();</span>
<span class="nc" id="L2193">			g.clearRect(r.x, r.y, r.width, r.height);</span>

<span class="nc bnc" id="L2195" title="All 2 branches missed.">			if (m_bViewCliques) {</span>
<span class="nc" id="L2196">				m_nClique = 1;</span>
<span class="nc" id="L2197">				viewCliques(g, m_marginCalculator.m_root);</span>
			}			
<span class="nc bnc" id="L2199" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc" id="L2200">				drawNode(g, iNode, NORMAL);</span>
			}
<span class="nc bnc" id="L2202" title="All 4 branches missed.">			if (!a_export.isExporting() &amp;&amp; !a_print.isPrinting()) {</span>
<span class="nc" id="L2203">				m_Selection.draw(g);</span>
			}
<span class="nc bnc" id="L2205" title="All 2 branches missed.">			if (m_nSelectedRect != null) {</span>
<span class="nc" id="L2206">				g.drawRect((int)(m_nSelectedRect.x/ m_fScale), </span>
<span class="nc" id="L2207">						(int)(m_nSelectedRect.y/ m_fScale), </span>
<span class="nc" id="L2208">						(int)(m_nSelectedRect.width/ m_fScale), </span>
<span class="nc" id="L2209">						(int)(m_nSelectedRect.height/ m_fScale));</span>
			}
<span class="nc" id="L2211">		} // paintComponent</span>

		/** number of the clique being drawn. Used for selecting the color of the clique */
<span class="nc" id="L2214">		int m_nClique = 1;</span>

		/* draws cliques in junction tree. 
		 * 
		 */
		void viewCliques(Graphics g, JunctionTreeNode node) {
<span class="nc" id="L2220">					int [] nodes = node.m_nNodes;</span>
<span class="nc" id="L2221">					g.setColor(</span>
<span class="nc" id="L2222">							new Color(m_nClique % 7 * 256 /7, </span>
<span class="nc" id="L2223">							(m_nClique % 2 * 256 / 2),</span>
<span class="nc" id="L2224">							(m_nClique % 3 * 256 / 3))</span>
							);
<span class="nc" id="L2226">					int dX = m_nPaddedNodeWidth / 2 + m_nClique;</span>
<span class="nc" id="L2227">					int dY = m_nNodeHeight / 2;</span>
<span class="nc" id="L2228">					int nPosX = 0;</span>
<span class="nc" id="L2229">					int nPosY = 0;</span>
<span class="nc" id="L2230">					String sStr = &quot;&quot;;</span>
<span class="nc bnc" id="L2231" title="All 2 branches missed.">					for (int j = 0; j &lt; nodes.length; j++) {</span>
<span class="nc" id="L2232">						nPosX += m_BayesNet.getPositionX(nodes[j]);</span>
<span class="nc" id="L2233">						nPosY += m_BayesNet.getPositionY(nodes[j]);</span>
<span class="nc" id="L2234">						sStr += &quot; &quot; + nodes[j];</span>
<span class="nc bnc" id="L2235" title="All 2 branches missed.">						for (int k = j+1; k &lt; nodes.length; k++) {</span>
<span class="nc" id="L2236">							g.drawLine(</span>
<span class="nc" id="L2237">									m_BayesNet.getPositionX(nodes[j]) + dX,</span>
<span class="nc" id="L2238">									m_BayesNet.getPositionY(nodes[j]) + dY,</span>
<span class="nc" id="L2239">									m_BayesNet.getPositionX(nodes[k]) + dX,</span>
<span class="nc" id="L2240">									m_BayesNet.getPositionY(nodes[k]) + dY</span>
									);
						}
					}
<span class="nc" id="L2244">					m_nClique++;</span>
<span class="nc" id="L2245">					nPosX /= nodes.length;</span>
<span class="nc" id="L2246">					nPosY /= nodes.length;</span>
<span class="nc" id="L2247">					g.drawString(&quot;Clique &quot; + m_nClique + &quot;(&quot;+sStr+&quot;)&quot;, nPosX, nPosY);</span>
<span class="nc bnc" id="L2248" title="All 2 branches missed.">					for (int iChild = 0; iChild &lt; node.m_children.size(); iChild++) {</span>
<span class="nc" id="L2249">						viewCliques(g, (JunctionTreeNode) node.m_children.elementAt(iChild));</span>
					}
<span class="nc" id="L2251">		} // viewCliques</span>
		
		
		/* Draw a node with index iNode on Graphics g at position
		 * Drawing mode can be NORMAL or HIGHLIGHTED.
		 */
		protected void drawNode(Graphics g, int iNode, int mode) {
<span class="nc" id="L2258">			int nPosX = m_BayesNet.getPositionX(iNode);</span>
<span class="nc" id="L2259">			int nPosY = m_BayesNet.getPositionY(iNode);</span>
<span class="nc" id="L2260">			g.setColor(this.getBackground().darker().darker());</span>
<span class="nc" id="L2261">			FontMetrics fm = getFontMetrics(getFont());</span>
			
<span class="nc bnc" id="L2263" title="All 2 branches missed.">			if (mode == HIGHLIGHTED) {</span>
<span class="nc" id="L2264">				g.setXORMode(Color.green); // g.setColor(Color.green);</span>
			}
<span class="nc" id="L2266">			g.fillOval(nPosX + m_nPaddedNodeWidth - m_nNodeWidth - (m_nPaddedNodeWidth - m_nNodeWidth) / 2, nPosY,</span>
<span class="nc" id="L2267">					m_nNodeWidth, m_nNodeHeight);</span>
<span class="nc" id="L2268">			g.setColor(Color.white);</span>
<span class="nc bnc" id="L2269" title="All 2 branches missed.">			if (mode == HIGHLIGHTED) {</span>
<span class="nc" id="L2270">				g.setXORMode(Color.red);</span>
			}

			// Draw the node's label if it can fit inside the node's
			// current width otherwise just display its node nr
			// if it can fit in node's current width
<span class="nc bnc" id="L2276" title="All 2 branches missed.">			if (fm.stringWidth(m_BayesNet.getNodeName(iNode)) &lt;= m_nNodeWidth) {</span>
<span class="nc" id="L2277">				g.drawString(m_BayesNet.getNodeName(iNode), nPosX + m_nPaddedNodeWidth / 2</span>
<span class="nc" id="L2278">						- fm.stringWidth(m_BayesNet.getNodeName(iNode)) / 2, nPosY + m_nNodeHeight / 2</span>
<span class="nc" id="L2279">						+ fm.getHeight() / 2 - 2);</span>
<span class="nc bnc" id="L2280" title="All 2 branches missed.">			} else if (fm.stringWidth(&quot;&quot; + iNode) &lt;= m_nNodeWidth) {</span>
<span class="nc" id="L2281">				g.drawString(&quot;&quot; + iNode, nPosX + m_nPaddedNodeWidth / 2 - fm.stringWidth(&quot;&quot; + iNode) / 2, </span>
<span class="nc" id="L2282">						nPosY + m_nNodeHeight / 2 + fm.getHeight() / 2 - 2);</span>
			}

<span class="nc bnc" id="L2285" title="All 2 branches missed.">			if (mode == HIGHLIGHTED) {</span>
<span class="nc" id="L2286">				g.setXORMode(Color.green);</span>
			}

<span class="nc bnc" id="L2289" title="All 2 branches missed.">			if (m_bViewMargins) {</span>
<span class="nc bnc" id="L2290" title="All 2 branches missed.">				if (m_BayesNet.getEvidence(iNode) &lt; 0) {</span>
<span class="nc" id="L2291">					g.setColor(new Color(0, 128, 0));</span>
				} else {
<span class="nc" id="L2293">					g.setColor(new Color(128, 0, 0));</span>
				}
<span class="nc" id="L2295">				double[] P = m_BayesNet.getMargin(iNode);</span>
<span class="nc bnc" id="L2296" title="All 2 branches missed.">				for (int iValue = 0; iValue &lt; P.length; iValue++) {</span>
<span class="nc" id="L2297">					String sP = P[iValue] + &quot;&quot;;</span>
<span class="nc bnc" id="L2298" title="All 2 branches missed.">					if (sP.charAt(0) == '0') {</span>
<span class="nc" id="L2299">						sP = sP.substring(1);</span>
					}
<span class="nc bnc" id="L2301" title="All 2 branches missed.">					if (sP.length() &gt; 5) {</span>
<span class="nc" id="L2302">						sP = sP.substring(1, 5);</span>
					}
<span class="nc" id="L2304">					g.fillRect(nPosX + m_nPaddedNodeWidth, nPosY + iValue * 10 + 2, (int) (P[iValue] * 100), 8);</span>
<span class="nc" id="L2305">					g.drawString(m_BayesNet.getNodeValue(iNode, iValue) + &quot; &quot; + sP, nPosX + m_nPaddedNodeWidth</span>
<span class="nc" id="L2306">							+ (int) (P[iValue] * 100), nPosY + iValue * 10 + 10);</span>

				}
			}
<span class="nc bnc" id="L2310" title="All 2 branches missed.">			if (m_bViewCliques) {</span>
<span class="nc" id="L2311">					return;</span>
			}
<span class="nc" id="L2313">			g.setColor(Color.black);</span>
			// Drawing all incoming edges into the node,
<span class="nc bnc" id="L2315" title="All 2 branches missed.">			for (int iParent = 0; iParent &lt; m_BayesNet.getNrOfParents(iNode); iParent++) {</span>
<span class="nc" id="L2316">				int nParent = m_BayesNet.getParent(iNode, iParent);</span>
<span class="nc" id="L2317">				int nPosX1 = nPosX + m_nPaddedNodeWidth / 2;</span>
<span class="nc" id="L2318">				int nPosY1 = nPosY + m_nNodeHeight;</span>
<span class="nc" id="L2319">				int nPosX2 = m_BayesNet.getPositionX(nParent);</span>
<span class="nc" id="L2320">				int nPosY2 = m_BayesNet.getPositionY(nParent);</span>
<span class="nc" id="L2321">				int nPosX2b = nPosX2 + m_nPaddedNodeWidth / 2;</span>
<span class="nc" id="L2322">				int nPosY2b = nPosY2;</span>

<span class="nc" id="L2324">				double phi = Math.atan2((nPosX2b - nPosX1 + 0.0) * m_nNodeHeight, (nPosY2b - nPosY1 + 0.0) * m_nNodeWidth);</span>
<span class="nc" id="L2325">				nPosX1 = (int) (nPosX + m_nPaddedNodeWidth / 2 + Math.sin(phi) * m_nNodeWidth / 2);</span>
<span class="nc" id="L2326">				nPosY1 = (int) (nPosY + m_nNodeHeight / 2 + Math.cos(phi) * m_nNodeHeight / 2);</span>
<span class="nc" id="L2327">				nPosX2b = (int) (nPosX2 + m_nPaddedNodeWidth / 2 - Math.sin(phi) * m_nNodeWidth / 2);</span>
<span class="nc" id="L2328">				nPosY2b = (int) (nPosY2 + m_nNodeHeight / 2 - Math.cos(phi) * m_nNodeHeight / 2);</span>
<span class="nc" id="L2329">				drawArrow(g, nPosX2b, nPosY2b, nPosX1, nPosY1);</span>
			}
<span class="nc bnc" id="L2331" title="All 2 branches missed.">			if (mode == HIGHLIGHTED) {</span>
<span class="nc" id="L2332">			FastVector children = m_BayesNet.getChildren(iNode);</span>
<span class="nc bnc" id="L2333" title="All 2 branches missed.">			for (int iChild = 0; iChild &lt; children.size(); iChild++) {</span>
<span class="nc" id="L2334">				int nChild = (Integer) children.elementAt(iChild);</span>
<span class="nc" id="L2335">				int nPosX1 = nPosX + m_nPaddedNodeWidth / 2;</span>
<span class="nc" id="L2336">				int nPosY1 = nPosY;</span>
<span class="nc" id="L2337">				int nPosX2 = m_BayesNet.getPositionX(nChild);</span>
<span class="nc" id="L2338">				int nPosY2 = m_BayesNet.getPositionY(nChild);</span>
<span class="nc" id="L2339">				int nPosX2b = nPosX2 + m_nPaddedNodeWidth / 2;</span>
<span class="nc" id="L2340">				int nPosY2b = nPosY2 + m_nNodeHeight;</span>

<span class="nc" id="L2342">				double phi = Math.atan2((nPosX2b - nPosX1 + 0.0) * m_nNodeHeight, (nPosY2b - nPosY1 + 0.0) * m_nNodeWidth);</span>
<span class="nc" id="L2343">				nPosX1 = (int) (nPosX + m_nPaddedNodeWidth / 2 + Math.sin(phi) * m_nNodeWidth / 2);</span>
<span class="nc" id="L2344">				nPosY1 = (int) (nPosY + m_nNodeHeight / 2 + Math.cos(phi) * m_nNodeHeight / 2);</span>
<span class="nc" id="L2345">				nPosX2b = (int) (nPosX2 + m_nPaddedNodeWidth / 2 - Math.sin(phi) * m_nNodeWidth / 2);</span>
<span class="nc" id="L2346">				nPosY2b = (int) (nPosY2 + m_nNodeHeight / 2 - Math.cos(phi) * m_nNodeHeight / 2);</span>
<span class="nc" id="L2347">				drawArrow(g, nPosX1, nPosY1, nPosX2b, nPosY2b);</span>
			}
			}
<span class="nc" id="L2350">		} // drawNode</span>

		
		/**
		 * This method draws an arrow on a line from (x1,y1) to (x2,y2). The
		 * arrow head is seated on (x2,y2) and is in the direction of the line.
		 * If the arrow is needed to be drawn in the opposite direction then
		 * simply swap the order of (x1, y1) and (x2, y2) when calling this
		 * function.
		 */
		protected void drawArrow(Graphics g, int nPosX1, int nPosY1, int nPosX2, int nPosY2) {
<span class="nc" id="L2361">			g.drawLine(nPosX1, nPosY1, nPosX2, nPosY2);</span>

<span class="nc bnc" id="L2363" title="All 2 branches missed.">			if (nPosX1 == nPosX2) {</span>
<span class="nc bnc" id="L2364" title="All 2 branches missed.">				if (nPosY1 &lt; nPosY2) {</span>
<span class="nc" id="L2365">					g.drawLine(nPosX2, nPosY2, nPosX2 + 4, nPosY2 - 8);</span>
<span class="nc" id="L2366">					g.drawLine(nPosX2, nPosY2, nPosX2 - 4, nPosY2 - 8);</span>
				} else {
<span class="nc" id="L2368">					g.drawLine(nPosX2, nPosY2, nPosX2 + 4, nPosY2 + 8);</span>
<span class="nc" id="L2369">					g.drawLine(nPosX2, nPosY2, nPosX2 - 4, nPosY2 + 8);</span>
				}
			} else {
				// theta=line's angle from base, beta=angle of arrow's side from
				// line
<span class="nc" id="L2374">				double hyp = 0, base = 0, perp = 0, theta, beta;</span>
<span class="nc" id="L2375">				int nPosX3 = 0, nPosY3 = 0;</span>

<span class="nc bnc" id="L2377" title="All 2 branches missed.">				if (nPosX2 &lt; nPosX1) {</span>
<span class="nc" id="L2378">					base = nPosX1 - nPosX2;</span>
<span class="nc" id="L2379">					hyp = Math.sqrt((nPosX2 - nPosX1) * (nPosX2 - nPosX1) + (nPosY2 - nPosY1) * (nPosY2 - nPosY1));</span>
<span class="nc" id="L2380">					theta = Math.acos(base / hyp);</span>
				} else { // x1&gt;x2 as we already checked x1==x2 before
<span class="nc" id="L2382">					base = nPosX1 - nPosX2;</span>
<span class="nc" id="L2383">					hyp = Math.sqrt((nPosX2 - nPosX1) * (nPosX2 - nPosX1) + (nPosY2 - nPosY1) * (nPosY2 - nPosY1));</span>
<span class="nc" id="L2384">					theta = Math.acos(base / hyp);</span>
				}
<span class="nc" id="L2386">				beta = 30 * Math.PI / 180;</span>

<span class="nc" id="L2388">				hyp = 8;</span>
<span class="nc" id="L2389">				base = Math.cos(theta - beta) * hyp;</span>
<span class="nc" id="L2390">				perp = Math.sin(theta - beta) * hyp;</span>

<span class="nc" id="L2392">				nPosX3 = (int) (nPosX2 + base);</span>
<span class="nc bnc" id="L2393" title="All 2 branches missed.">				if (nPosY1 &lt; nPosY2)</span>
<span class="nc" id="L2394">					nPosY3 = (int) (nPosY2 - perp);</span>
				else
<span class="nc" id="L2396">					nPosY3 = (int) (nPosY2 + perp);</span>

<span class="nc" id="L2398">				g.drawLine(nPosX2, nPosY2, nPosX3, nPosY3);</span>

<span class="nc" id="L2400">				base = Math.cos(theta + beta) * hyp;</span>
<span class="nc" id="L2401">				perp = Math.sin(theta + beta) * hyp;</span>

<span class="nc" id="L2403">				nPosX3 = (int) (nPosX2 + base);</span>
<span class="nc bnc" id="L2404" title="All 2 branches missed.">				if (nPosY1 &lt; nPosY2)</span>
<span class="nc" id="L2405">					nPosY3 = (int) (nPosY2 - perp);</span>
				else
<span class="nc" id="L2407">					nPosY3 = (int) (nPosY2 + perp);</span>
<span class="nc" id="L2408">				g.drawLine(nPosX2, nPosY2, nPosX3, nPosY3);</span>
			}
<span class="nc" id="L2410">		} // drawArrow</span>

		/**
		 * This method highlights a given node and all its incoming and outgoing arcs
		 */
		public void highLight(int iNode) {
<span class="nc" id="L2416">			Graphics2D g = (Graphics2D) this.getGraphics();</span>
<span class="nc" id="L2417">			RenderingHints rh = new RenderingHints(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span>
<span class="nc" id="L2418">			rh.put(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_SPEED);</span>
<span class="nc" id="L2419">			g.setRenderingHints(rh);</span>
<span class="nc" id="L2420">			g.setPaintMode();</span>
<span class="nc" id="L2421">			g.scale(m_fScale, m_fScale);</span>
<span class="nc" id="L2422">			drawNode(g, iNode, HIGHLIGHTED);</span>
<span class="nc" id="L2423">		} // highlight</span>

	    /** implementation of Printable, used for printing
	     * @see Printable
	     */
		public int print(Graphics g, PageFormat pageFormat, int pageIndex) {
<span class="nc bnc" id="L2429" title="All 2 branches missed.">	          if (pageIndex &gt; 0) {</span>
<span class="nc" id="L2430">	            return(NO_SUCH_PAGE);</span>
	          } else {
<span class="nc" id="L2432">	            Graphics2D g2d = (Graphics2D)g;</span>
<span class="nc" id="L2433">	            g2d.translate(pageFormat.getImageableX(), pageFormat.getImageableY());</span>
<span class="nc" id="L2434">	            double fHeight = pageFormat.getImageableHeight();</span>
<span class="nc" id="L2435">	            double fWidth = pageFormat.getImageableWidth();</span>
<span class="nc" id="L2436">	            int xMax = 1;</span>
<span class="nc" id="L2437">	            int yMax = 1;</span>
<span class="nc bnc" id="L2438" title="All 2 branches missed.">	            for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc bnc" id="L2439" title="All 2 branches missed.">	            	if (xMax &lt; m_BayesNet.getPositionX(iNode)) {</span>
<span class="nc" id="L2440">	            		xMax = m_BayesNet.getPositionX(iNode);</span>
	            	}
<span class="nc bnc" id="L2442" title="All 2 branches missed.">	            	if (yMax &lt; m_BayesNet.getPositionY(iNode)) {</span>
<span class="nc" id="L2443">	            		yMax = m_BayesNet.getPositionY(iNode);</span>
	            	}
	            }
<span class="nc" id="L2446">	            double fCurrentScale = m_fScale;</span>
<span class="nc" id="L2447">	            xMax += m_nPaddedNodeWidth + 100;</span>
<span class="nc bnc" id="L2448" title="All 2 branches missed.">	            if (fWidth/xMax &lt; fHeight/yMax) {</span>
<span class="nc" id="L2449">	            	m_fScale = fWidth/xMax; </span>
	            } else {
<span class="nc" id="L2451">	            	m_fScale = fHeight/yMax;</span>
	            }
	            
	            // Turn off double buffering
<span class="nc" id="L2455">	            paint(g2d);</span>
<span class="nc" id="L2456">	            m_fScale = fCurrentScale;</span>
	            // Turn double buffering back on
<span class="nc" id="L2458">	            return(PAGE_EXISTS);</span>
	          }
	        } // print
				
	} // class GraphPanel

	/**
	 * Table Model for the Table for editing CPTs
	 */
	private class GraphVisualizerTableModel extends AbstractTableModel {

		/** for serialization */
		private static final long serialVersionUID = -4789813491347366596L;
		/** labels for the columns */
		final String [] m_sColumnNames;
		/** probability table data **/
		final double [][] m_fProbs;
		/** nr of node for currently editted CPT */
		int m_iNode;

<span class="nc" id="L2478">		public GraphVisualizerTableModel(int iNode) {</span>
<span class="nc" id="L2479">			m_iNode = iNode;</span>
<span class="nc" id="L2480">			double [][] probs = m_BayesNet.getDistribution(iNode);</span>
<span class="nc" id="L2481">			m_fProbs = new double[probs.length][probs[0].length];</span>
<span class="nc bnc" id="L2482" title="All 2 branches missed.">			for (int i = 0; i &lt; probs.length; i++) {</span>
<span class="nc bnc" id="L2483" title="All 2 branches missed.">				for (int j = 0; j &lt; probs[0].length; j++) {</span>
<span class="nc" id="L2484">					m_fProbs[i][j] = probs[i][j];</span>
				}
			}
<span class="nc" id="L2487">			m_sColumnNames = m_BayesNet.getValues(iNode);</span>
<span class="nc" id="L2488">		} // c'tor</span>

		/** method that generates random CPTs
		 */
		public void randomize() {
<span class="nc" id="L2493">			int nProbs = m_fProbs[0].length;</span>
<span class="nc" id="L2494">			Random random = new Random();</span>
<span class="nc bnc" id="L2495" title="All 2 branches missed.">			for (int i = 0; i &lt; m_fProbs.length; i++) {</span>
				// get random nrs
<span class="nc bnc" id="L2497" title="All 2 branches missed.">				for (int j = 0; j &lt; nProbs-1; j++) {</span>
<span class="nc" id="L2498">					m_fProbs[i][j] = random.nextDouble();</span>
				}
				// sort
<span class="nc bnc" id="L2501" title="All 2 branches missed.">				for (int j = 0; j &lt; nProbs-1; j++) {</span>
<span class="nc bnc" id="L2502" title="All 2 branches missed.">					for (int k = j+1; k &lt; nProbs-1; k++) {</span>
<span class="nc bnc" id="L2503" title="All 2 branches missed.">						if (m_fProbs[i][j] &gt; m_fProbs[i][k]) {</span>
<span class="nc" id="L2504">							double h = m_fProbs[i][j]; </span>
<span class="nc" id="L2505">							m_fProbs[i][j] = m_fProbs[i][k];</span>
<span class="nc" id="L2506">							m_fProbs[i][k] = h;</span>
						}
					}
				}
<span class="nc" id="L2510">				double sum = m_fProbs[i][0];</span>
<span class="nc bnc" id="L2511" title="All 2 branches missed.">				for (int j = 1; j &lt; nProbs-1; j++) {</span>
<span class="nc" id="L2512">					m_fProbs[i][j] = m_fProbs[i][j] - sum;</span>
<span class="nc" id="L2513">					sum += m_fProbs[i][j]; </span>
				}
<span class="nc" id="L2515">				m_fProbs[i][nProbs - 1] = 1.0 - sum;</span>
			}
<span class="nc" id="L2517">		} // randomize</span>
		
<span class="nc" id="L2519">		public void setData() {}</span>

		/** return nr of colums */
		public int getColumnCount() {
<span class="nc" id="L2523">			return m_sColumnNames.length;</span>
		}

		/** return nr of rows */
		public int getRowCount() {
<span class="nc" id="L2528">			return m_fProbs.length;</span>
		}

		/** return name of specified colum 
		 * @param iCol index of the column
		 */
		public String getColumnName(int iCol) {
<span class="nc" id="L2535">			return m_sColumnNames[iCol];</span>
		}
		/** return data point 
		 * @param iRow index of row in table
		 * @param iCol index of column in table
		 */
		public Object getValueAt(int iRow, int iCol) {
<span class="nc" id="L2542">			return new Double(m_fProbs[iRow][iCol]);</span>
		}

		/** Set data point, assigns value to CPT entry
		 * specified by row and column. The remainder of the
		 * CPT is normalized so that the values add up to 1.
		 * IF a value below zero of over 1 is given, no changes
		 * take place.
		 * @param oProb data point
		 * @param iRow index of row in table
		 * @param iCol index of column in table
		 */
		public void setValueAt(Object oProb, int iRow, int iCol) {
<span class="nc" id="L2555">			Double fProb = (Double) oProb;</span>
<span class="nc bnc" id="L2556" title="All 4 branches missed.">			if (fProb &lt; 0 || fProb &gt; 1) {</span>
<span class="nc" id="L2557">				return;</span>
			}
<span class="nc" id="L2559">			m_fProbs[iRow][iCol] = (double) fProb;</span>
<span class="nc" id="L2560">			double sum = 0;</span>
<span class="nc bnc" id="L2561" title="All 2 branches missed.">			for (int i = 0; i &lt; m_fProbs[iRow].length; i++) {</span>
<span class="nc" id="L2562">				sum += m_fProbs[iRow][i];</span>
			}

<span class="nc bnc" id="L2565" title="All 2 branches missed.">			if (sum &gt; 1) {</span>
				// handle overflow
<span class="nc" id="L2567">				int i = m_fProbs[iRow].length - 1;</span>
<span class="nc bnc" id="L2568" title="All 2 branches missed.">				while (sum &gt; 1) {</span>
<span class="nc bnc" id="L2569" title="All 2 branches missed.">					if (i != iCol) {</span>
<span class="nc bnc" id="L2570" title="All 2 branches missed.">						if (m_fProbs[iRow][i] &gt; sum - 1) {</span>
<span class="nc" id="L2571">							m_fProbs[iRow][i] -= sum - 1;</span>
<span class="nc" id="L2572">							sum = 1;</span>
						} else {
<span class="nc" id="L2574">							sum -= m_fProbs[iRow][i];</span>
<span class="nc" id="L2575">							m_fProbs[iRow][i] = 0;</span>
						}
					}
<span class="nc" id="L2578">					i--;</span>
				}
			} else {
				// handle underflow
<span class="nc" id="L2582">				int i = m_fProbs[iRow].length - 1;</span>
<span class="nc bnc" id="L2583" title="All 2 branches missed.">				while (sum &lt; 1) {</span>
<span class="nc bnc" id="L2584" title="All 2 branches missed.">					if (i != iCol) {</span>
<span class="nc" id="L2585">						m_fProbs[iRow][i] += 1 - sum;</span>
<span class="nc" id="L2586">						sum = 1;</span>
					}
<span class="nc" id="L2588">					i--;</span>
				}

			}
<span class="nc" id="L2592">			validate();</span>
<span class="nc" id="L2593">		} // setData</span>

		/*
		 * JTable uses this method to determine the default renderer/ editor for
		 * each cell.
		 */
		public Class getColumnClass(int c) {
<span class="nc" id="L2600">			return getValueAt(0, c).getClass();</span>
		}

		/*
		 * Implemented this to make sure the table is uneditable.
		 */
		public boolean isCellEditable(int row, int col) {
<span class="nc" id="L2607">			return true;</span>
		}
	} // class GraphVisualizerTableModel

	/**
	 * Listener class for processing mouseClicked
	 */
<span class="nc" id="L2614">	private class GraphVisualizerMouseListener extends MouseAdapter {</span>

		/** A left mouseclick on a node adds node to selection (depending
		 * on shift and ctrl keys).
		 * A right mouseclick on a node pops up menu with actions to be
		 * performed on the node.
		 * A right mouseclick outside another node pops up menu.
		 */
		public void mouseClicked(MouseEvent me) {
			int x, y;

<span class="nc" id="L2625">			Rectangle r = new Rectangle(0, 0, (int) (m_nPaddedNodeWidth * m_fScale), (int) (m_nNodeHeight * m_fScale));</span>
<span class="nc" id="L2626">			x = me.getX();</span>
<span class="nc" id="L2627">			y = me.getY();</span>

<span class="nc bnc" id="L2629" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc" id="L2630">				r.x = (int) (m_BayesNet.getPositionX(iNode) * m_fScale);</span>
<span class="nc" id="L2631">				r.y = (int) (m_BayesNet.getPositionY(iNode) * m_fScale);</span>
<span class="nc bnc" id="L2632" title="All 2 branches missed.">				if (r.contains(x, y)) {</span>
<span class="nc" id="L2633">					m_nCurrentNode = iNode;					</span>
<span class="nc bnc" id="L2634" title="All 2 branches missed.">					if (me.getButton() == MouseEvent.BUTTON3) {</span>
<span class="nc" id="L2635">						handleRightNodeClick(me);</span>
					}
<span class="nc bnc" id="L2637" title="All 2 branches missed.">					if (me.getButton() == MouseEvent.BUTTON1) {</span>
<span class="nc bnc" id="L2638" title="All 2 branches missed.">						if ((me.getModifiersEx() &amp; MouseEvent.CTRL_DOWN_MASK) != 0) {</span>
<span class="nc" id="L2639">							m_Selection.toggleSelection(m_nCurrentNode);</span>
<span class="nc bnc" id="L2640" title="All 2 branches missed.">						} else if ((me.getModifiersEx() &amp; MouseEvent.SHIFT_DOWN_MASK) != 0) {</span>
<span class="nc" id="L2641">							m_Selection.addToSelection(m_nCurrentNode);</span>
						} else {
<span class="nc" id="L2643">							m_Selection.clear();</span>
<span class="nc" id="L2644">							m_Selection.addToSelection(m_nCurrentNode);</span>
						}
<span class="nc" id="L2646">						repaint();</span>
					}
<span class="nc" id="L2648">					return;</span>
				}
			}
<span class="nc bnc" id="L2651" title="All 2 branches missed.">			if (me.getButton() == MouseEvent.BUTTON3) {</span>
<span class="nc" id="L2652">				handleRightClick(me, (int)(x/m_fScale), (int)(y/m_fScale));</span>
			}
<span class="nc" id="L2654">		} // mouseClicked</span>
		
		/* update selection
		 *  (non-Javadoc)
		 * @see java.awt.event.MouseListener#mouseReleased(java.awt.event.MouseEvent)
		 */
		public void mouseReleased(MouseEvent me) {
<span class="nc bnc" id="L2661" title="All 2 branches missed.">	    	if (m_nSelectedRect != null) {</span>
<span class="nc bnc" id="L2662" title="All 2 branches missed.">				if ((me.getModifiersEx() &amp; MouseEvent.CTRL_DOWN_MASK) != 0) {</span>
<span class="nc" id="L2663">					m_Selection.toggleSelection(m_nSelectedRect);</span>
<span class="nc bnc" id="L2664" title="All 2 branches missed.">				} else if ((me.getModifiersEx() &amp; MouseEvent.SHIFT_DOWN_MASK) != 0) {</span>
<span class="nc" id="L2665">					m_Selection.addToSelection(m_nSelectedRect);</span>
				} else {
<span class="nc" id="L2667">					m_Selection.clear();</span>
<span class="nc" id="L2668">		    		m_Selection.addToSelection(m_nSelectedRect);</span>
				}
<span class="nc" id="L2670">	    		m_nSelectedRect = null;</span>
<span class="nc" id="L2671">	    		repaint();</span>
	    	}
<span class="nc" id="L2673">	    } // mouseReleased</span>

		/** position clicked on */
<span class="nc" id="L2676">	    int m_nPosX = 0, m_nPosY = 0;</span>
	    
	    /* pop up menu with actions that apply in general or to selection (if any exists)
	     */
	    void handleRightClick(MouseEvent me, int nPosX, int nPosY) {
	
<span class="nc" id="L2682">			ActionListener act = new ActionListener() {</span>
				public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L2684" title="All 2 branches missed.">					if (ae.getActionCommand().equals(&quot;Add node&quot;)) {</span>
<span class="nc" id="L2685">						a_addnode.addNode(m_nPosX, m_nPosY);</span>
<span class="nc" id="L2686">						return;</span>
					}
<span class="nc" id="L2688">					repaint();</span>
<span class="nc" id="L2689">				}</span>
			};
<span class="nc" id="L2691">			JPopupMenu popupMenu = new JPopupMenu(&quot;Choose a value&quot;);</span>

<span class="nc" id="L2693">			JMenuItem addNodeItem = new JMenuItem(&quot;Add node&quot;);</span>
<span class="nc" id="L2694">			addNodeItem.addActionListener(act);</span>
<span class="nc" id="L2695">			popupMenu.add(addNodeItem);</span>

<span class="nc" id="L2697">			FastVector selected = m_Selection.getSelected();</span>
<span class="nc" id="L2698">			JMenu addArcMenu = new JMenu(&quot;Add parent&quot;);</span>
<span class="nc" id="L2699">			popupMenu.add(addArcMenu);</span>
<span class="nc bnc" id="L2700" title="All 2 branches missed.">			if (selected.size() == 0) {</span>
<span class="nc" id="L2701">				addArcMenu.setEnabled(false);</span>
			} else {
<span class="nc" id="L2703">			int nNodes = m_BayesNet.getNrOfNodes();</span>
<span class="nc" id="L2704">			boolean[] isNotAllowedAsParent = new boolean[nNodes];</span>
			// prevent it being a parent of itself
<span class="nc bnc" id="L2706" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; selected.size(); iNode++) {</span>
<span class="nc" id="L2707">				isNotAllowedAsParent[(Integer) selected.elementAt(iNode)] = true;</span>
			}
			// prevent a descendant being a parent, since it introduces cycles
<span class="nc bnc" id="L2710" title="All 2 branches missed.">			for (int i = 0; i &lt; nNodes; i++) {</span>
<span class="nc bnc" id="L2711" title="All 2 branches missed.">				for (int iNode = 0; iNode &lt; nNodes; iNode++) {</span>
<span class="nc bnc" id="L2712" title="All 2 branches missed.">					for (int iParent = 0; iParent &lt; m_BayesNet.getNrOfParents(iNode); iParent++) {</span>
<span class="nc bnc" id="L2713" title="All 2 branches missed.">						if (isNotAllowedAsParent[m_BayesNet.getParent(iNode, iParent)]) {</span>
<span class="nc" id="L2714">							isNotAllowedAsParent[iNode] = true;</span>
						}
					}
				}
			}
			// prevent nodes that are already a parent
<span class="nc bnc" id="L2720" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; selected.size(); iNode++) {</span>
<span class="nc" id="L2721">				int nNode = (Integer) selected.elementAt(iNode);</span>
<span class="nc bnc" id="L2722" title="All 2 branches missed.">				for (int iParent = 0; iParent &lt; m_BayesNet.getNrOfParents(nNode); iParent++) {</span>
<span class="nc" id="L2723">					isNotAllowedAsParent[m_BayesNet.getParent(nNode, iParent)] = true;</span>
				}
			}
<span class="nc" id="L2726">			ActionListener addParentAction = new ActionListener() {</span>
				public void actionPerformed(ActionEvent ae) {
					try {
<span class="nc" id="L2729">						m_BayesNet.addArc(ae.getActionCommand(), m_Selection.getSelected());</span>
<span class="nc" id="L2730">						m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L2731">						updateStatus();</span>
<span class="nc" id="L2732">					} catch (Exception e) {</span>
<span class="nc" id="L2733">						e.printStackTrace();</span>
					}
<span class="nc" id="L2735">				}</span>
			};
			// count nr of remaining candidates
<span class="nc" id="L2738">			int nCandidates = 0;</span>
<span class="nc bnc" id="L2739" title="All 2 branches missed.">			for (int i = 0; i &lt; nNodes; i++) {</span>
<span class="nc bnc" id="L2740" title="All 2 branches missed.">				if (!isNotAllowedAsParent[i]) {</span>
<span class="nc" id="L2741">					JMenuItem item = new JMenuItem(m_BayesNet.getNodeName(i));</span>
<span class="nc" id="L2742">					item.addActionListener(addParentAction);</span>
<span class="nc" id="L2743">					addArcMenu.add(item);</span>
<span class="nc" id="L2744">					nCandidates++;</span>
				}
			}
<span class="nc bnc" id="L2747" title="All 2 branches missed.">			if (nCandidates == 0) {</span>
<span class="nc" id="L2748">				addArcMenu.setEnabled(false);</span>
			}
			}
<span class="nc" id="L2751">			m_nPosX = nPosX;</span>
<span class="nc" id="L2752">			m_nPosY = nPosY;</span>
<span class="nc" id="L2753">			popupMenu.setLocation(me.getX(), me.getY());</span>
<span class="nc" id="L2754">			popupMenu.show(m_GraphPanel, me.getX(), me.getY());</span>
<span class="nc" id="L2755">	    } // handleRightClick</span>
		
	    /* pop up menu with actions that apply to node that was clicked on
	     */
	    void handleRightNodeClick(MouseEvent me) {
<span class="nc" id="L2760">			m_Selection.clear();</span>
<span class="nc" id="L2761">			repaint();</span>
<span class="nc" id="L2762">			ActionListener renameValueAction = new ActionListener() {</span>
				public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L2764">					renameValue(m_nCurrentNode, ae.getActionCommand());</span>
<span class="nc" id="L2765">				}</span>
			};
<span class="nc" id="L2767">			ActionListener delValueAction = new ActionListener() {</span>
				public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L2769">					delValue(m_nCurrentNode, ae.getActionCommand());</span>
<span class="nc" id="L2770">				}</span>
			};
<span class="nc" id="L2772">			ActionListener addParentAction = new ActionListener() {</span>
				public void actionPerformed(ActionEvent ae) {
					try {
<span class="nc" id="L2775">						m_BayesNet.addArc(ae.getActionCommand(), m_BayesNet.getNodeName(m_nCurrentNode));</span>
<span class="nc" id="L2776">						m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L2777">						updateStatus();</span>
<span class="nc" id="L2778">					} catch (Exception e) {</span>
<span class="nc" id="L2779">						e.printStackTrace();</span>
					}
<span class="nc" id="L2781">				}</span>
			};
<span class="nc" id="L2783">			ActionListener delParentAction = new ActionListener() {</span>
				public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L2785">					deleteArc(m_nCurrentNode, ae.getActionCommand());</span>
<span class="nc" id="L2786">				}</span>
			};
<span class="nc" id="L2788">			ActionListener delChildAction = new ActionListener() {</span>
				public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L2790">					deleteArc(ae.getActionCommand(), m_nCurrentNode);</span>
<span class="nc" id="L2791">				}</span>
			};
<span class="nc" id="L2793">			ActionListener setAvidenceAction = new ActionListener() {</span>
				public void actionPerformed(ActionEvent ae) {
					try {
<span class="nc" id="L2796">						String [] outcomes = m_BayesNet.getValues(m_nCurrentNode);</span>
<span class="nc" id="L2797">						int iValue = 0;</span>
<span class="nc bnc" id="L2798" title="All 4 branches missed.">						while (iValue &lt; outcomes.length &amp;&amp; !outcomes[iValue].equals(ae.getActionCommand())) {</span>
<span class="nc" id="L2799">							iValue++;</span>
						}

<span class="nc bnc" id="L2802" title="All 2 branches missed.">						if (iValue == outcomes.length) {</span>
<span class="nc" id="L2803">							iValue = -1;</span>
						}
<span class="nc bnc" id="L2805" title="All 2 branches missed.">						if (iValue &lt; outcomes.length) {</span>
<span class="nc" id="L2806">						    m_jStatusBar.setText(&quot;Set evidence for &quot; + m_BayesNet.getNodeName(m_nCurrentNode));</span>
<span class="nc bnc" id="L2807" title="All 4 branches missed.">								if (m_BayesNet.getEvidence(m_nCurrentNode) &lt; 0 &amp;&amp; iValue &gt;= 0) {</span>
<span class="nc" id="L2808">									m_BayesNet.setEvidence(m_nCurrentNode, iValue);</span>
<span class="nc" id="L2809">									m_marginCalculatorWithEvidence.setEvidence(m_nCurrentNode, iValue);</span>
								} else {
<span class="nc" id="L2811">									m_BayesNet.setEvidence(m_nCurrentNode, iValue);</span>
<span class="nc" id="L2812">									SerializedObject so = new SerializedObject(m_marginCalculator);</span>
<span class="nc" id="L2813">									m_marginCalculatorWithEvidence = (MarginCalculator) so.getObject();</span>
<span class="nc bnc" id="L2814" title="All 2 branches missed.">									for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc bnc" id="L2815" title="All 2 branches missed.">										if (m_BayesNet.getEvidence(iNode) &gt;= 0) {</span>
<span class="nc" id="L2816">											m_marginCalculatorWithEvidence.setEvidence(iNode, m_BayesNet.getEvidence(iNode));</span>
										}
									}
								}
<span class="nc bnc" id="L2820" title="All 2 branches missed.">							for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc" id="L2821">								m_BayesNet.setMargin(iNode, m_marginCalculatorWithEvidence.getMargin(iNode));</span>
							}
						}
<span class="nc" id="L2824">						} catch (Exception e) {</span>
<span class="nc" id="L2825">							e.printStackTrace();</span>
						}
<span class="nc" id="L2827">						repaint();</span>
<span class="nc" id="L2828">				}</span>
			};
			
<span class="nc" id="L2831">			ActionListener act = new ActionListener() {</span>
				public void actionPerformed(ActionEvent ae) {
<span class="nc bnc" id="L2833" title="All 2 branches missed.">					if (ae.getActionCommand().equals(&quot;Rename&quot;)) {</span>
<span class="nc" id="L2834">						renameNode(m_nCurrentNode);</span>
<span class="nc" id="L2835">						return;</span>
					}
<span class="nc bnc" id="L2837" title="All 2 branches missed.">					if (ae.getActionCommand().equals(&quot;Add parent&quot;)) {</span>
<span class="nc" id="L2838">						addArcInto(m_nCurrentNode);</span>
<span class="nc" id="L2839">						return;</span>
					}
<span class="nc bnc" id="L2841" title="All 2 branches missed.">					if (ae.getActionCommand().equals(&quot;Add value&quot;)) {</span>
<span class="nc" id="L2842">						addValue();</span>
<span class="nc" id="L2843">						return;</span>
					}
<span class="nc bnc" id="L2845" title="All 2 branches missed.">					if (ae.getActionCommand().equals(&quot;Delete node&quot;)) {</span>
<span class="nc" id="L2846">						deleteNode(m_nCurrentNode);</span>
<span class="nc" id="L2847">						return;</span>
					}
<span class="nc bnc" id="L2849" title="All 2 branches missed.">					if (ae.getActionCommand().equals(&quot;Edit CPT&quot;)) {</span>
<span class="nc" id="L2850">						editCPT(m_nCurrentNode);</span>
<span class="nc" id="L2851">						return;</span>
					}
<span class="nc" id="L2853">					repaint();</span>
<span class="nc" id="L2854">				}</span>
			};
			try {
<span class="nc" id="L2857">			JPopupMenu popupMenu = new JPopupMenu(&quot;Choose a value&quot;);</span>

<span class="nc" id="L2859">			JMenu setEvidenceMenu = new JMenu(&quot;Set evidence&quot;);</span>
<span class="nc" id="L2860">			String [] outcomes = m_BayesNet.getValues(m_nCurrentNode);</span>
<span class="nc bnc" id="L2861" title="All 2 branches missed.">			for (int iValue = 0; iValue &lt; outcomes.length; iValue++) {</span>
<span class="nc" id="L2862">				JMenuItem item = new JMenuItem(outcomes[iValue]);</span>
<span class="nc" id="L2863">				item.addActionListener(setAvidenceAction);</span>
<span class="nc" id="L2864">				setEvidenceMenu.add(item);</span>
			}
<span class="nc" id="L2866">			setEvidenceMenu.addSeparator();</span>
<span class="nc" id="L2867">			JMenuItem item = new JMenuItem(&quot;Clear&quot;);</span>
<span class="nc" id="L2868">			item.addActionListener(setAvidenceAction);</span>
<span class="nc" id="L2869">			setEvidenceMenu.add(item);</span>
<span class="nc" id="L2870">			popupMenu.add(setEvidenceMenu);</span>

<span class="nc" id="L2872">			setEvidenceMenu.setEnabled(m_bViewMargins);</span>

<span class="nc" id="L2874">			popupMenu.addSeparator();</span>

<span class="nc" id="L2876">			JMenuItem renameItem = new JMenuItem(&quot;Rename&quot;);</span>
<span class="nc" id="L2877">			renameItem.addActionListener(act);</span>
<span class="nc" id="L2878">			popupMenu.add(renameItem);</span>

<span class="nc" id="L2880">			JMenuItem delNodeItem = new JMenuItem(&quot;Delete node&quot;);</span>
<span class="nc" id="L2881">			delNodeItem.addActionListener(act);</span>
<span class="nc" id="L2882">			popupMenu.add(delNodeItem);</span>

<span class="nc" id="L2884">			JMenuItem editCPTItem = new JMenuItem(&quot;Edit CPT&quot;);</span>
<span class="nc" id="L2885">			editCPTItem.addActionListener(act);</span>
<span class="nc" id="L2886">			popupMenu.add(editCPTItem);</span>

<span class="nc" id="L2888">			popupMenu.addSeparator();</span>
			
<span class="nc" id="L2890">			JMenu addArcMenu = new JMenu(&quot;Add parent&quot;);</span>
<span class="nc" id="L2891">			popupMenu.add(addArcMenu);</span>
<span class="nc" id="L2892">			int nNodes = m_BayesNet.getNrOfNodes();</span>
<span class="nc" id="L2893">			boolean[] isNotAllowedAsParent = new boolean[nNodes];</span>
			// prevent it being a parent of itself
<span class="nc" id="L2895">			isNotAllowedAsParent[m_nCurrentNode] = true;</span>
			// prevent a descendant being a parent, since it introduces cycles
<span class="nc bnc" id="L2897" title="All 2 branches missed.">			for (int i = 0; i &lt; nNodes; i++) {</span>
<span class="nc bnc" id="L2898" title="All 2 branches missed.">				for (int iNode = 0; iNode &lt; nNodes; iNode++) {</span>
<span class="nc bnc" id="L2899" title="All 2 branches missed.">					for (int iParent = 0; iParent &lt; m_BayesNet.getNrOfParents(iNode); iParent++) {</span>
<span class="nc bnc" id="L2900" title="All 2 branches missed.">						if (isNotAllowedAsParent[m_BayesNet.getParent(iNode, iParent)]) {</span>
<span class="nc" id="L2901">							isNotAllowedAsParent[iNode] = true;</span>
						}
					}
				}
			}
			// prevent nodes that are already a parent
<span class="nc bnc" id="L2907" title="All 2 branches missed.">			for (int iParent = 0; iParent &lt; m_BayesNet.getNrOfParents(m_nCurrentNode); iParent++) {</span>
<span class="nc" id="L2908">				isNotAllowedAsParent[m_BayesNet.getParent(m_nCurrentNode, iParent)] = true;</span>
			}
			// count nr of remaining candidates
<span class="nc" id="L2911">			int nCandidates = 0;</span>
<span class="nc bnc" id="L2912" title="All 2 branches missed.">			for (int i = 0; i &lt; nNodes; i++) {</span>
<span class="nc bnc" id="L2913" title="All 2 branches missed.">				if (!isNotAllowedAsParent[i]) {</span>
<span class="nc" id="L2914">					item = new JMenuItem(m_BayesNet.getNodeName(i));</span>
<span class="nc" id="L2915">					item.addActionListener(addParentAction);</span>
<span class="nc" id="L2916">					addArcMenu.add(item);</span>
<span class="nc" id="L2917">					nCandidates++;</span>
				}
			}
<span class="nc bnc" id="L2920" title="All 2 branches missed.">			if (nCandidates == 0) {</span>
<span class="nc" id="L2921">				addArcMenu.setEnabled(false);</span>
			}
									
<span class="nc" id="L2924">			JMenu delArcMenu = new JMenu(&quot;Delete parent&quot;);</span>
<span class="nc" id="L2925">			popupMenu.add(delArcMenu);</span>
<span class="nc bnc" id="L2926" title="All 2 branches missed.">			if (m_BayesNet.getNrOfParents(m_nCurrentNode) == 0) {</span>
<span class="nc" id="L2927">				delArcMenu.setEnabled(false);</span>
			}
<span class="nc bnc" id="L2929" title="All 2 branches missed.">			for (int iParent = 0; iParent &lt; m_BayesNet.getNrOfParents(m_nCurrentNode); iParent++) {</span>
<span class="nc" id="L2930">				item = new JMenuItem(m_BayesNet.getNodeName(m_BayesNet.getParent(m_nCurrentNode, iParent)));</span>
<span class="nc" id="L2931">				item.addActionListener(delParentAction);</span>
<span class="nc" id="L2932">				delArcMenu.add(item);</span>
			}
<span class="nc" id="L2934">			JMenu delChildMenu = new JMenu(&quot;Delete child&quot;);</span>
<span class="nc" id="L2935">			popupMenu.add(delChildMenu);</span>
<span class="nc" id="L2936">			FastVector nChildren = m_BayesNet.getChildren(m_nCurrentNode); </span>
<span class="nc bnc" id="L2937" title="All 2 branches missed.">			if (nChildren.size() == 0) {</span>
<span class="nc" id="L2938">				delChildMenu.setEnabled(false);</span>
			}
<span class="nc bnc" id="L2940" title="All 2 branches missed.">			for (int iChild = 0; iChild &lt; nChildren.size(); iChild++) {</span>
<span class="nc" id="L2941">				item = new JMenuItem(m_BayesNet.getNodeName((Integer) nChildren.elementAt(iChild)));</span>
<span class="nc" id="L2942">				item.addActionListener(delChildAction);</span>
<span class="nc" id="L2943">				delChildMenu.add(item);</span>
			}

<span class="nc" id="L2946">			popupMenu.addSeparator();</span>

<span class="nc" id="L2948">			JMenuItem addValueItem = new JMenuItem(&quot;Add value&quot;);</span>
<span class="nc" id="L2949">			addValueItem.addActionListener(act);</span>
<span class="nc" id="L2950">			popupMenu.add(addValueItem);</span>

<span class="nc" id="L2952">			JMenu renameValue = new JMenu(&quot;Rename value&quot;);</span>
<span class="nc" id="L2953">			popupMenu.add(renameValue);</span>
<span class="nc bnc" id="L2954" title="All 2 branches missed.">			for (int iValue = 0; iValue &lt; outcomes.length; iValue++) {</span>
<span class="nc" id="L2955">				item = new JMenuItem(outcomes[iValue]);</span>
<span class="nc" id="L2956">				item.addActionListener(renameValueAction);</span>
<span class="nc" id="L2957">				renameValue.add(item);</span>
			}

<span class="nc" id="L2960">			JMenu delValue = new JMenu(&quot;Delete value&quot;);</span>
<span class="nc" id="L2961">			popupMenu.add(delValue);</span>
<span class="nc bnc" id="L2962" title="All 2 branches missed.">			if (m_BayesNet.getCardinality(m_nCurrentNode) &lt;= 2) {</span>
<span class="nc" id="L2963">				delValue.setEnabled(false);</span>
			}
<span class="nc bnc" id="L2965" title="All 2 branches missed.">			for (int iValue = 0; iValue &lt; outcomes.length; iValue++) {</span>
<span class="nc" id="L2966">				JMenuItem delValueItem = new JMenuItem(outcomes[iValue]);</span>
<span class="nc" id="L2967">				delValueItem.addActionListener(delValueAction);</span>
<span class="nc" id="L2968">				delValue.add(delValueItem);</span>
			}
			
<span class="nc" id="L2971">			popupMenu.setLocation(me.getX(), me.getY());</span>
<span class="nc" id="L2972">			popupMenu.show(m_GraphPanel, me.getX(), me.getY());</span>
<span class="nc" id="L2973">			} catch (Exception e) {</span>
<span class="nc" id="L2974">				e.printStackTrace();</span>
			}
<span class="nc" id="L2976">		} // handleRightNodeClick</span>
	} // class GraphVisualizerMouseListener

	/**
	 * private class for handling mouseMoved events to highlight nodes if the
	 * the mouse is moved on one, move it around or move selection around
	 */
<span class="nc" id="L2983">	private class GraphVisualizerMouseMotionListener extends MouseMotionAdapter {</span>

		/* last node moved over. Used for turning highlight on and off */
<span class="nc" id="L2986">		int m_nLastNode = -1;</span>
		/* current mouse position clicked */
		int m_nPosX, m_nPosY;

		/* identify the node under the mouse
		 * @returns node index of node under mouse, or -1 if there is no such node 
		 */
		int getGraphNode(MouseEvent me) {
<span class="nc" id="L2994">			m_nPosX = m_nPosY  = 0;</span>

<span class="nc" id="L2996">			Rectangle r = new Rectangle(0, 0, (int) (m_nPaddedNodeWidth * m_fScale), (int) (m_nNodeHeight * m_fScale));</span>
<span class="nc" id="L2997">			m_nPosX += me.getX();</span>
<span class="nc" id="L2998">			m_nPosY += me.getY();</span>

<span class="nc bnc" id="L3000" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {				</span>
<span class="nc" id="L3001">				r.x = (int) (m_BayesNet.getPositionX(iNode) * m_fScale);</span>
<span class="nc" id="L3002">				r.y = (int) (m_BayesNet.getPositionY(iNode) * m_fScale);</span>
<span class="nc bnc" id="L3003" title="All 2 branches missed.">				if (r.contains(m_nPosX, m_nPosY)) {</span>
<span class="nc" id="L3004">					return iNode;</span>
				}
			}
<span class="nc" id="L3007">			return -1;</span>
		} // getGraphNode

		/* handle mouse dragging event
		 *  (non-Javadoc)
		 * @see java.awt.event.MouseMotionListener#mouseDragged(java.awt.event.MouseEvent)
		 */
		public void mouseDragged(MouseEvent me) {
<span class="nc bnc" id="L3015" title="All 2 branches missed.">			if (m_nSelectedRect != null) {</span>
<span class="nc" id="L3016">				m_nSelectedRect.width = me.getPoint().x - m_nSelectedRect.x;</span>
<span class="nc" id="L3017">				m_nSelectedRect.height = me.getPoint().y - m_nSelectedRect.y;</span>
<span class="nc" id="L3018">				repaint();</span>
<span class="nc" id="L3019">				return;</span>
			}
<span class="nc" id="L3021">			int iNode = getGraphNode(me);</span>
<span class="nc bnc" id="L3022" title="All 2 branches missed.">			if (iNode &gt;= 0) {</span>
<span class="nc bnc" id="L3023" title="All 2 branches missed.">				if (m_Selection.getSelected().size() &gt; 0) {</span>
<span class="nc bnc" id="L3024" title="All 2 branches missed.">					if (m_Selection.getSelected().contains(iNode)) {</span>
<span class="nc" id="L3025">						m_BayesNet.setPosition(iNode, (int) ((m_nPosX / m_fScale - m_nPaddedNodeWidth / 2)),</span>
<span class="nc" id="L3026">							(int) ((m_nPosY / m_fScale - m_nNodeHeight / 2)), m_Selection.getSelected());</span>
					} else {
<span class="nc" id="L3028">						m_Selection.clear();</span>
<span class="nc" id="L3029">						m_BayesNet.setPosition(iNode, (int) ((m_nPosX / m_fScale - m_nPaddedNodeWidth / 2)),</span>
<span class="nc" id="L3030">								(int) ((m_nPosY / m_fScale - m_nNodeHeight / 2)));</span>
					}
<span class="nc" id="L3032">					repaint();</span>
				} else {
<span class="nc" id="L3034">					m_BayesNet.setPosition(iNode, (int) ((m_nPosX / m_fScale - m_nPaddedNodeWidth / 2)),</span>
<span class="nc" id="L3035">						(int) ((m_nPosY / m_fScale - m_nNodeHeight / 2)));</span>
				}
<span class="nc" id="L3037">			    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L3038">				a_undo.setEnabled(true);</span>
<span class="nc" id="L3039">				a_redo.setEnabled(false);</span>
<span class="nc" id="L3040">				m_GraphPanel.highLight(iNode);</span>
			}
<span class="nc bnc" id="L3042" title="All 2 branches missed.">			if (iNode &lt; 0) {</span>
<span class="nc bnc" id="L3043" title="All 2 branches missed.">				if (m_nLastNode &gt;= 0) {</span>
<span class="nc" id="L3044">					m_GraphPanel.repaint();</span>
<span class="nc" id="L3045">					m_nLastNode = -1;</span>
				} else {
<span class="nc" id="L3047">					m_nSelectedRect = new Rectangle(me.getPoint().x, me.getPoint().y, 1, 1);</span>
<span class="nc" id="L3048">					m_GraphPanel.repaint();</span>
				}
			}
<span class="nc" id="L3051">		} // mouseDragged</span>
		
		/* handles mouse move event
		 *  (non-Javadoc)
		 * @see java.awt.event.MouseMotionListener#mouseMoved(java.awt.event.MouseEvent)
		 */
		public void mouseMoved(MouseEvent me) {
<span class="nc" id="L3058">			int iNode = getGraphNode(me);</span>
<span class="nc bnc" id="L3059" title="All 2 branches missed.">			if (iNode &gt;= 0) {</span>
<span class="nc bnc" id="L3060" title="All 2 branches missed.">				if (iNode != m_nLastNode) {</span>
<span class="nc" id="L3061">					m_GraphPanel.highLight(iNode);</span>
<span class="nc bnc" id="L3062" title="All 2 branches missed.">					if (m_nLastNode &gt;= 0) {</span>
<span class="nc" id="L3063">						m_GraphPanel.highLight(m_nLastNode);</span>
					}
<span class="nc" id="L3065">					m_nLastNode = iNode;</span>
				}
			}
<span class="nc bnc" id="L3068" title="All 4 branches missed.">			if (iNode &lt; 0 &amp;&amp; m_nLastNode &gt;= 0) {</span>
<span class="nc" id="L3069">				m_GraphPanel.repaint();</span>
<span class="nc" id="L3070">				m_nLastNode = -1;</span>
			}
<span class="nc" id="L3072">		} // mouseMoved</span>
		
	} // class GraphVisualizerMouseMotionListener

	/* apply graph layout algorithm to Bayesian network 
	 */
	void layoutGraph() {
<span class="nc bnc" id="L3079" title="All 2 branches missed.">		if (m_BayesNet.getNrOfNodes() == 0) {</span>
<span class="nc" id="L3080">			return;</span>
		}
		try {
<span class="nc" id="L3083">			FastVector m_nodes = new FastVector();</span>
<span class="nc" id="L3084">			FastVector m_edges = new FastVector();</span>
<span class="nc" id="L3085">			BIFParser bp = new BIFParser(m_BayesNet.toXMLBIF03(), m_nodes, m_edges);</span>
<span class="nc" id="L3086">			bp.parse();</span>
<span class="nc" id="L3087">			updateStatus();</span>
<span class="nc" id="L3088">			m_layoutEngine = new HierarchicalBCEngine(m_nodes, m_edges, m_nPaddedNodeWidth, m_nNodeHeight);</span>
<span class="nc" id="L3089">			m_layoutEngine.addLayoutCompleteEventListener(this);</span>
<span class="nc" id="L3090">			m_layoutEngine.layoutGraph();</span>
<span class="nc" id="L3091">		} catch (Exception e) {</span>
<span class="nc" id="L3092">			e.printStackTrace();</span>
		}
<span class="nc" id="L3094">	} // layoutGraph</span>
	
	/* Update status of various items that need regular updating
	 * such as enabled status of some menu items, marginal distributions
	 * if shown, repainting of graph.
	 */
	void updateStatus() {
<span class="nc" id="L3101">		a_undo.setEnabled(m_BayesNet.canUndo());</span>
<span class="nc" id="L3102">		a_redo.setEnabled(m_BayesNet.canRedo());</span>

<span class="nc bnc" id="L3104" title="All 2 branches missed.">		a_datagenerator.setEnabled(m_BayesNet.getNrOfNodes() &gt; 0);</span>

<span class="nc bnc" id="L3106" title="All 4 branches missed.">		if (!m_bViewMargins &amp;&amp; !m_bViewCliques) {</span>
<span class="nc" id="L3107">			repaint();</span>
<span class="nc" id="L3108">			return;</span>
		}

		try {
<span class="nc" id="L3112">			m_marginCalculator = new MarginCalculator();</span>
<span class="nc" id="L3113">			m_marginCalculator.calcMargins(m_BayesNet);</span>
<span class="nc" id="L3114">			SerializedObject so = new SerializedObject(m_marginCalculator);</span>
<span class="nc" id="L3115">			m_marginCalculatorWithEvidence = (MarginCalculator) so.getObject();</span>
<span class="nc bnc" id="L3116" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc bnc" id="L3117" title="All 2 branches missed.">				if (m_BayesNet.getEvidence(iNode) &gt;= 0) {</span>
<span class="nc" id="L3118">					m_marginCalculatorWithEvidence.setEvidence(iNode, m_BayesNet.getEvidence(iNode));</span>
				}
			}
<span class="nc bnc" id="L3121" title="All 2 branches missed.">			for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {</span>
<span class="nc" id="L3122">				m_BayesNet.setMargin(iNode, m_marginCalculatorWithEvidence.getMargin(iNode));</span>
			}
<span class="nc" id="L3124">		} catch (Exception e) {</span>
<span class="nc" id="L3125">			e.printStackTrace();</span>
		}
<span class="nc" id="L3127">		repaint();</span>
<span class="nc" id="L3128">	} // updateStatus</span>

	/* add arc with node iChild as child. 
	 * This pops up a selection list with potential parents for the child.
	 * All decendants and current parents are excluded from the list as is
	 * the child node itself.
	 * @param iChild index of the node for which to add an arc
	 */
	void addArcInto(int iChild) {
<span class="nc" id="L3137">		String sChild = m_BayesNet.getNodeName(iChild);</span>
		try {
<span class="nc" id="L3139">			int nNodes = m_BayesNet.getNrOfNodes();</span>
<span class="nc" id="L3140">			boolean[] isNotAllowedAsParent = new boolean[nNodes];</span>
			// prevent it being a parent of itself
<span class="nc" id="L3142">			isNotAllowedAsParent[iChild] = true;</span>
			// prevent a descendant being a parent, since it introduces cycles
<span class="nc bnc" id="L3144" title="All 2 branches missed.">			for (int i = 0; i &lt; nNodes; i++) {</span>
<span class="nc bnc" id="L3145" title="All 2 branches missed.">				for (int iNode = 0; iNode &lt; nNodes; iNode++) {</span>
<span class="nc bnc" id="L3146" title="All 2 branches missed.">					for (int iParent = 0; iParent &lt; m_BayesNet.getNrOfParents(iNode); iParent++) {</span>
<span class="nc bnc" id="L3147" title="All 2 branches missed.">						if (isNotAllowedAsParent[m_BayesNet.getParent(iNode, iParent)]) {</span>
<span class="nc" id="L3148">							isNotAllowedAsParent[iNode] = true;</span>
						}
					}
				}
			}
			// prevent nodes that are already a parent
<span class="nc bnc" id="L3154" title="All 2 branches missed.">			for (int iParent = 0; iParent &lt; m_BayesNet.getNrOfParents(iChild); iParent++) {</span>
<span class="nc" id="L3155">				isNotAllowedAsParent[m_BayesNet.getParent(iChild, iParent)] = true;</span>
			}
			// count nr of remaining candidates
<span class="nc" id="L3158">			int nCandidates = 0;</span>
<span class="nc bnc" id="L3159" title="All 2 branches missed.">			for (int i = 0; i &lt; nNodes; i++) {</span>
<span class="nc bnc" id="L3160" title="All 2 branches missed.">				if (!isNotAllowedAsParent[i]) {</span>
<span class="nc" id="L3161">					nCandidates++;</span>
				}
			}
<span class="nc bnc" id="L3164" title="All 2 branches missed.">			if (nCandidates == 0) {</span>
<span class="nc" id="L3165">				JOptionPane.showMessageDialog(null, &quot;No potential parents available for this node (&quot; + sChild</span>
<span class="nc" id="L3166">						+ &quot;). Choose another node as child node.&quot;);</span>
<span class="nc" id="L3167">				return;</span>
			}
<span class="nc" id="L3169">			String[] options = new String[nCandidates];</span>
<span class="nc" id="L3170">			int k = 0;</span>
<span class="nc bnc" id="L3171" title="All 2 branches missed.">			for (int i = 0; i &lt; nNodes; i++) {</span>
<span class="nc bnc" id="L3172" title="All 2 branches missed.">				if (!isNotAllowedAsParent[i]) {</span>
<span class="nc" id="L3173">					options[k++] = m_BayesNet.getNodeName(i);</span>
				}
			}
<span class="nc" id="L3176">			String sParent = (String) JOptionPane.showInputDialog(null, &quot;Select parent node for &quot; + sChild, &quot;Nodes&quot;, 0,</span>
<span class="nc" id="L3177">					null, options, options[0]);</span>
<span class="nc bnc" id="L3178" title="All 4 branches missed.">			if (sParent == null || sParent.equals(&quot;&quot;)) {</span>
<span class="nc" id="L3179">				return;</span>
			}
			// update all data structures
<span class="nc" id="L3182">			m_BayesNet.addArc(sParent, sChild);</span>
<span class="nc" id="L3183">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L3184">		    updateStatus();</span>
<span class="nc" id="L3185">		} catch (Exception e) {</span>
<span class="nc" id="L3186">			e.printStackTrace();</span>
		}
<span class="nc" id="L3188">	} // addArcInto</span>

	/* deletes arc from node with name sParent into child with index iChild
	 * 
	 */
	void deleteArc(int iChild, String sParent) {
		try {
<span class="nc" id="L3195">			m_BayesNet.deleteArc(m_BayesNet.getNode(sParent), iChild);</span>
<span class="nc" id="L3196">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L3197">		} catch (Exception e) {</span>
<span class="nc" id="L3198">			e.printStackTrace();</span>
		}
<span class="nc" id="L3200">		updateStatus();</span>
<span class="nc" id="L3201">	} // deleteArc</span>
	
	/* deletes arc from node with index iParent into child with name sChild
	 * 
	 */
	void deleteArc(String sChild, int iParent) {
		try {
<span class="nc" id="L3208">			m_BayesNet.deleteArc(iParent, m_BayesNet.getNode(sChild));</span>
<span class="nc" id="L3209">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L3210">		} catch (Exception e) {</span>
<span class="nc" id="L3211">			e.printStackTrace();</span>
		}
<span class="nc" id="L3213">		updateStatus();</span>
<span class="nc" id="L3214">	} // deleteArc</span>

	/* deletes arc. Pops up list of arcs listed in 'options' as 
	 * &quot;&lt;Node1&gt; -&gt; &lt;Node2&gt;&quot;.
	 */
	void deleteArc(String[] options) {
<span class="nc" id="L3220">		String sResult = (String) JOptionPane.showInputDialog(null, &quot;Select arc to delete&quot;, &quot;Arcs&quot;, 0, null, options,</span>
<span class="nc" id="L3221">				options[0]);</span>
<span class="nc bnc" id="L3222" title="All 4 branches missed.">		if (sResult != null &amp;&amp; !sResult.equals(&quot;&quot;)) {</span>
<span class="nc" id="L3223">			int nPos = sResult.indexOf(&quot; -&gt; &quot;);</span>
<span class="nc" id="L3224">			String sParent = sResult.substring(0, nPos);</span>
<span class="nc" id="L3225">			String sChild = sResult.substring(nPos + 4);</span>
			try {
<span class="nc" id="L3227">				m_BayesNet.deleteArc(sParent, sChild);</span>
<span class="nc" id="L3228">			    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L3229">			} catch (Exception e) {</span>
<span class="nc" id="L3230">				e.printStackTrace();</span>
			}
<span class="nc" id="L3232">			updateStatus();</span>
		}
<span class="nc" id="L3234">	} // deleteArc</span>

	/* Rename node with index nTargetNode.
	 * Pops up window that allwos for entering a new name.
	 */
	void renameNode(int nTargetNode) {
<span class="nc" id="L3240">		String sName = (String) JOptionPane.showInputDialog(null, m_BayesNet.getNodeName(nTargetNode), &quot;New name for node&quot;,</span>
<span class="nc" id="L3241">				JOptionPane.OK_CANCEL_OPTION);</span>
<span class="nc bnc" id="L3242" title="All 4 branches missed.">		if (sName == null || sName.equals(&quot;&quot;)) {</span>
<span class="nc" id="L3243">			return;</span>
		}
		try {
<span class="nc bnc" id="L3246" title="All 2 branches missed.">			while (m_BayesNet.getNode2(sName) &gt;= 0) {</span>
<span class="nc" id="L3247">				sName = (String) JOptionPane.showInputDialog(null, &quot;Cannot rename to &quot; + sName</span>
<span class="nc" id="L3248">						+ &quot;.\nNode with that name already exists.&quot;);</span>
<span class="nc bnc" id="L3249" title="All 4 branches missed.">				if (sName == null || sName.equals(&quot;&quot;)) {</span>
<span class="nc" id="L3250">					return;</span>
				}
			}
<span class="nc" id="L3253">			m_BayesNet.setNodeName(nTargetNode, sName);</span>
<span class="nc" id="L3254">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L3255">		} catch (Exception e) {</span>
<span class="nc" id="L3256">			e.printStackTrace();</span>
		}
<span class="nc" id="L3258">		repaint();</span>
<span class="nc" id="L3259">	} // renameNode</span>

	/* Rename value with name sValeu of a node with index nTargetNode.
	 * Pops up window that allows entering a new name.
	 */
	void renameValue(int nTargetNode, String sValue) {
<span class="nc" id="L3265">		String sNewValue = (String) JOptionPane.showInputDialog(null, &quot;New name for value &quot; + sValue, &quot;Node &quot;</span>
<span class="nc" id="L3266">				+ m_BayesNet.getNodeName(nTargetNode), JOptionPane.OK_CANCEL_OPTION);</span>
<span class="nc bnc" id="L3267" title="All 4 branches missed.">		if (sNewValue == null || sNewValue.equals(&quot;&quot;)) {</span>
<span class="nc" id="L3268">			return;</span>
		}
<span class="nc" id="L3270">		m_BayesNet.renameNodeValue(nTargetNode, sValue, sNewValue);</span>
<span class="nc" id="L3271">	    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L3272">		a_undo.setEnabled(true);</span>
<span class="nc" id="L3273">		a_redo.setEnabled(false);</span>
<span class="nc" id="L3274">		repaint();</span>
<span class="nc" id="L3275">	} // renameValue</span>

	/* delete a single node with index iNode */
	void deleteNode(int iNode) {
		try {
<span class="nc" id="L3280">			m_BayesNet.deleteNode(iNode);</span>
<span class="nc" id="L3281">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L3282">		} catch (Exception e) {</span>
<span class="nc" id="L3283">			e.printStackTrace();</span>
		}
<span class="nc" id="L3285">		updateStatus();</span>
<span class="nc" id="L3286">	} // deleteNode</span>

	/* Add a value to currently selected node.
	 * Shows window that allows to enter the name of the value. 
	 */
	void addValue() {
		//GraphNode n = (GraphNode) m_nodes.elementAt(m_nCurrentNode);
<span class="nc" id="L3293">		String sValue = &quot;Value&quot; + (m_BayesNet.getCardinality(m_nCurrentNode) + 1);</span>
<span class="nc" id="L3294">		String sNewValue = (String) JOptionPane.showInputDialog(null, &quot;New value &quot; + sValue, &quot;Node &quot; + m_BayesNet.getNodeName(m_nCurrentNode),</span>
<span class="nc" id="L3295">				JOptionPane.OK_CANCEL_OPTION);</span>
<span class="nc bnc" id="L3296" title="All 4 branches missed.">		if (sNewValue == null || sNewValue.equals(&quot;&quot;)) {</span>
<span class="nc" id="L3297">			return;</span>
		}
		try {
<span class="nc" id="L3300">			m_BayesNet.addNodeValue(m_nCurrentNode, sNewValue);</span>
<span class="nc" id="L3301">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
			//n.outcomes = m_BayesNet.getValues(m_nCurrentNode);
			//for (int iNode = 0; iNode &lt; m_BayesNet.getNrOfNodes(); iNode++) {
			//	n = (GraphNode) m_nodes.elementAt(iNode);
			//	n.probs = m_BayesNet.getDistribution(iNode);
			//}
<span class="nc" id="L3307">		} catch (Exception e) {</span>
<span class="nc" id="L3308">			e.printStackTrace();</span>
		}
<span class="nc" id="L3310">		updateStatus();</span>
<span class="nc" id="L3311">	} // addValue</span>

	/* remove value with name sValue from the node with index nTargetNode
	 */
	void delValue(int nTargetNode, String sValue) {
		try {
<span class="nc" id="L3317">			m_BayesNet.delNodeValue(nTargetNode, sValue);</span>
<span class="nc" id="L3318">		    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L3319">		} catch (Exception e) {</span>
<span class="nc" id="L3320">			e.printStackTrace();</span>
		}
<span class="nc" id="L3322">		updateStatus();</span>
<span class="nc" id="L3323">	} // delValue</span>

	/* Edits CPT of node with index nTargetNode. 
	 * Pops up table with probability table that the user can change or just view.
	 */
	void editCPT(int nTargetNode) {
<span class="nc" id="L3329">		m_nCurrentNode = nTargetNode;</span>
<span class="nc" id="L3330">		final GraphVisualizerTableModel tm = new GraphVisualizerTableModel(nTargetNode);</span>

<span class="nc" id="L3332">		JTable jTblProbs = new JTable(tm); </span>

<span class="nc" id="L3334">		JScrollPane js = new JScrollPane(jTblProbs);</span>

<span class="nc" id="L3336">		int nParents = m_BayesNet.getNrOfParents(nTargetNode);</span>
<span class="nc bnc" id="L3337" title="All 2 branches missed.">		if (nParents &gt; 0) {</span>
<span class="nc" id="L3338">			GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="nc" id="L3339">			JPanel jPlRowHeader = new JPanel(new GridBagLayout());</span>

			// indices of the parent nodes in the Vector
<span class="nc" id="L3342">			int[] idx = new int[nParents];</span>
			// max length of values of each parent
<span class="nc" id="L3344">			int[] lengths = new int[nParents];</span>

			// Adding labels for rows
<span class="nc" id="L3347">			gbc.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L3348">			gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L3349">			gbc.insets = new Insets(0, 1, 0, 0);</span>
<span class="nc" id="L3350">			int addNum = 0, temp = 0;</span>
<span class="nc" id="L3351">			boolean dark = false;</span>
			while (true) {
<span class="nc" id="L3353">				gbc.gridwidth = 1;</span>
<span class="nc bnc" id="L3354" title="All 2 branches missed.">				for (int k = 0; k &lt; nParents; k++) {</span>
<span class="nc" id="L3355">					int iParent2 = m_BayesNet.getParent(nTargetNode, k); </span>
<span class="nc" id="L3356">					JLabel lb = new JLabel(m_BayesNet.getValueName(iParent2,idx[k]));</span>
<span class="nc" id="L3357">					lb.setFont(new Font(&quot;Dialog&quot;, Font.PLAIN, 12));</span>
<span class="nc" id="L3358">					lb.setOpaque(true);</span>
<span class="nc" id="L3359">					lb.setBorder(BorderFactory.createEmptyBorder(1, 2, 1, 1));</span>
<span class="nc" id="L3360">					lb.setHorizontalAlignment(JLabel.CENTER);</span>
<span class="nc bnc" id="L3361" title="All 2 branches missed.">					if (dark) {</span>
<span class="nc" id="L3362">						lb.setBackground(lb.getBackground().darker());</span>
<span class="nc" id="L3363">						lb.setForeground(Color.white);</span>
					} else
<span class="nc" id="L3365">						lb.setForeground(Color.black);</span>

<span class="nc" id="L3367">					temp = lb.getPreferredSize().width;</span>
<span class="nc" id="L3368">					lb.setPreferredSize(new Dimension(temp, jTblProbs.getRowHeight()));</span>
<span class="nc bnc" id="L3369" title="All 2 branches missed.">					if (lengths[k] &lt; temp)</span>
<span class="nc" id="L3370">						lengths[k] = temp;</span>
<span class="nc" id="L3371">					temp = 0;</span>

<span class="nc bnc" id="L3373" title="All 2 branches missed.">					if (k == nParents - 1) {</span>
<span class="nc" id="L3374">						gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc bnc" id="L3375" title="All 2 branches missed.">						dark = (dark == true) ? false : true;</span>
					}
<span class="nc" id="L3377">					jPlRowHeader.add(lb, gbc);</span>
<span class="nc" id="L3378">					addNum++;</span>
				}

<span class="nc bnc" id="L3381" title="All 2 branches missed.">				for (int k = nParents - 1; k &gt;= 0; k--) {</span>
<span class="nc" id="L3382">					int iParent2 = m_BayesNet.getParent(m_nCurrentNode, k);</span>
<span class="nc bnc" id="L3383" title="All 4 branches missed.">					if (idx[k] == m_BayesNet.getCardinality(iParent2) - 1 &amp;&amp; k != 0) {</span>
<span class="nc" id="L3384">						idx[k] = 0;</span>
<span class="nc" id="L3385">						continue;</span>
					} else {
<span class="nc" id="L3387">						idx[k]++;</span>
<span class="nc" id="L3388">						break;</span>
					}
				}

<span class="nc" id="L3392">				int iParent2 = m_BayesNet.getParent(m_nCurrentNode, 0);</span>
<span class="nc bnc" id="L3393" title="All 2 branches missed.">				if (idx[0] == m_BayesNet.getCardinality(iParent2)) {</span>
<span class="nc" id="L3394">					JLabel lb = (JLabel) jPlRowHeader.getComponent(addNum - 1);</span>
<span class="nc" id="L3395">					jPlRowHeader.remove(addNum - 1);</span>
<span class="nc" id="L3396">					lb.setPreferredSize(new Dimension(lb.getPreferredSize().width, jTblProbs</span>
<span class="nc" id="L3397">							.getRowHeight()));</span>
<span class="nc" id="L3398">					gbc.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L3399">					gbc.weighty = 1;</span>
<span class="nc" id="L3400">					jPlRowHeader.add(lb, gbc);</span>
<span class="nc" id="L3401">					gbc.weighty = 0;</span>
					break;
				}
			}

<span class="nc" id="L3406">			gbc.gridwidth = 1;</span>
			// The following panel contains the names of the
			// parents
			// and is displayed above the row names to identify
			// which value belongs to which parent
<span class="nc" id="L3411">			JPanel jPlRowNames = new JPanel(new GridBagLayout());</span>
<span class="nc bnc" id="L3412" title="All 2 branches missed.">			for (int j = 0; j &lt; nParents; j++) {</span>
				JLabel lb2;
<span class="nc" id="L3414">				JLabel lb1 = new JLabel(m_BayesNet.getNodeName(m_BayesNet.getParent(nTargetNode, j)));</span>
<span class="nc" id="L3415">				lb1.setBorder(BorderFactory.createEmptyBorder(1, 2, 1, 1));</span>
<span class="nc" id="L3416">				Dimension tempd = lb1.getPreferredSize();</span>
<span class="nc bnc" id="L3417" title="All 2 branches missed.">				if (tempd.width &lt; lengths[j]) {</span>
<span class="nc" id="L3418">					lb1.setPreferredSize(new Dimension(lengths[j], tempd.height));</span>
<span class="nc" id="L3419">					lb1.setHorizontalAlignment(JLabel.CENTER);</span>
<span class="nc" id="L3420">					lb1.setMinimumSize(new Dimension(lengths[j], tempd.height));</span>
<span class="nc bnc" id="L3421" title="All 2 branches missed.">				} else if (tempd.width &gt; lengths[j]) {</span>
<span class="nc" id="L3422">					lb2 = (JLabel) jPlRowHeader.getComponent(j);</span>
<span class="nc" id="L3423">					lb2.setPreferredSize(new Dimension(tempd.width, lb2.getPreferredSize().height));</span>
				}
<span class="nc" id="L3425">				jPlRowNames.add(lb1, gbc);</span>
			}
<span class="nc" id="L3427">			js.setRowHeaderView(jPlRowHeader);</span>
<span class="nc" id="L3428">			js.setCorner(JScrollPane.UPPER_LEFT_CORNER, jPlRowNames);</span>
		}

<span class="nc" id="L3431">		final JDialog dlg = new JDialog((Frame) GUI.this.getTopLevelAncestor(),</span>
<span class="nc" id="L3432">				&quot;Probability Distribution Table For &quot; + m_BayesNet.getNodeName(nTargetNode), true);</span>
<span class="nc" id="L3433">		dlg.setSize(500, 400);</span>
<span class="nc" id="L3434">		dlg.setLocation(GUI.this.getLocation().x + GUI.this.getWidth() / 2</span>
<span class="nc" id="L3435">				- 250, GUI.this.getLocation().y + GUI.this.getHeight() / 2</span>
<span class="nc" id="L3436">				- 200);</span>

<span class="nc" id="L3438">		dlg.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L3439">		dlg.getContentPane().add(js, BorderLayout.CENTER);</span>

<span class="nc" id="L3441">		JButton jBtRandomize = new JButton(&quot;Randomize&quot;);</span>
<span class="nc" id="L3442">		jBtRandomize.setMnemonic('R');</span>
<span class="nc" id="L3443">		jBtRandomize.addActionListener(new ActionListener() {</span>
			public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L3445">				tm.randomize();</span>
<span class="nc" id="L3446">				dlg.repaint();</span>
<span class="nc" id="L3447">			}</span>
		});
		
<span class="nc" id="L3450">		JButton jBtOk = new JButton(&quot;Ok&quot;);</span>
<span class="nc" id="L3451">		jBtOk.setMnemonic('O');</span>
<span class="nc" id="L3452">		jBtOk.addActionListener(new ActionListener() {</span>
			public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L3454">				tm.setData();</span>
				try {
<span class="nc" id="L3456">					m_BayesNet.setDistribution(m_nCurrentNode, tm.m_fProbs);</span>
<span class="nc" id="L3457">				    m_jStatusBar.setText(m_BayesNet.lastActionMsg());</span>
<span class="nc" id="L3458">					updateStatus();</span>
<span class="nc" id="L3459">				} catch (Exception e) {</span>
<span class="nc" id="L3460">					e.printStackTrace();</span>
				}
<span class="nc" id="L3462">				dlg.setVisible(false);</span>
<span class="nc" id="L3463">			}</span>
		});
<span class="nc" id="L3465">		JButton jBtCancel = new JButton(&quot;Cancel&quot;);</span>
<span class="nc" id="L3466">		jBtCancel.setMnemonic('C');</span>
<span class="nc" id="L3467">		jBtCancel.addActionListener(new ActionListener() {</span>
			public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L3469">				dlg.setVisible(false);</span>
<span class="nc" id="L3470">			}</span>
		});
<span class="nc" id="L3472">		Container c = new Container();</span>
<span class="nc" id="L3473">		c.setLayout(new GridBagLayout());</span>
<span class="nc" id="L3474">		c.add(jBtRandomize);</span>
<span class="nc" id="L3475">		c.add(jBtOk);</span>
<span class="nc" id="L3476">		c.add(jBtCancel);</span>

<span class="nc" id="L3478">		dlg.getContentPane().add(c, BorderLayout.SOUTH);</span>
<span class="nc" id="L3479">		dlg.setVisible(true);</span>
<span class="nc" id="L3480">	} // editCPT</span>

	/**
	 * Main method. Builds up menus and reads from file if one is specified.
	 */
	public static void main(String[] args) {

<span class="nc" id="L3487">		weka.core.logging.Logger.log(weka.core.logging.Logger.Level.INFO, &quot;Logging started&quot;);</span>
	    
<span class="nc" id="L3489">		LookAndFeel.setLookAndFeel();</span>
		
<span class="nc" id="L3491">		JFrame jf = new JFrame(&quot;Bayes Network Editor&quot;);</span>
<span class="nc" id="L3492">		final GUI g = new GUI();</span>
<span class="nc" id="L3493">		JMenuBar menuBar = g.getMenuBar();</span>

<span class="nc bnc" id="L3495" title="All 2 branches missed.">		if (args.length&gt;0) {</span>
			try {
<span class="nc" id="L3497">				g.readBIFFromFile(args[0]);</span>
<span class="nc" id="L3498">			} catch (IOException ex) {</span>
<span class="nc" id="L3499">				ex.printStackTrace();</span>
<span class="nc" id="L3500">			} catch (BIFFormatException bf) {</span>
<span class="nc" id="L3501">				bf.printStackTrace();</span>
<span class="nc" id="L3502">				System.exit(-1);</span>
			}
		}




<span class="nc" id="L3509">	        jf.setJMenuBar(menuBar);		</span>
<span class="nc" id="L3510">		jf.getContentPane().add(g);</span>
<span class="nc" id="L3511">		jf.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="nc" id="L3512">		jf.setSize(800, 600);</span>
<span class="nc" id="L3513">		jf.setVisible(true);</span>
<span class="nc" id="L3514">		g.m_Selection.updateGUI();</span>
<span class="nc" id="L3515">		GenericObjectEditor.registerEditors();</span>
<span class="nc" id="L3516">	} // main</span>
	
} // end of class
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>