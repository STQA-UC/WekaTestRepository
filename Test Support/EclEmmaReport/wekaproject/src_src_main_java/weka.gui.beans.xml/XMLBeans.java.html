<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>XMLBeans.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Nov 28, 2015 2:34:31 PM)</a> &gt; <a href="../../index.html" class="el_group">wekaproject</a> &gt; <a href="../index.html" class="el_bundle">src/src/main/java</a> &gt; <a href="index.source.html" class="el_package">weka.gui.beans.xml</a> &gt; <span class="el_source">XMLBeans.java</span></div><h1>XMLBeans.java</h1><pre class="source lang-java linenums">/*
 *    This program is free software; you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation; either version 2 of the License, or
 *    (at your option) any later version.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with this program; if not, write to the Free Software
 *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 * XMLBeans.java
 * Copyright (C) 2005 University of Waikato, Hamilton, New Zealand
 */

package weka.gui.beans.xml;

import weka.core.converters.ConverterUtils;
import weka.core.xml.XMLBasicSerialization;
import weka.core.xml.XMLDocument;
import weka.core.Environment;
import weka.core.EnvironmentHandler;
import weka.gui.beans.BeanConnection;
import weka.gui.beans.BeanInstance;
import weka.gui.beans.BeanVisual;
import weka.gui.beans.MetaBean;
import weka.gui.beans.Visible;
import weka.gui.beans.BeanCommon;

import java.awt.Color;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.Point;
import java.beans.BeanInfo;
import java.beans.EventSetDescriptor;
import java.beans.Introspector;
import java.beans.beancontext.BeanContextSupport;
import java.io.File;
import java.util.Enumeration;
import java.util.Hashtable;
import java.util.StringTokenizer;
import java.util.Vector;

import javax.swing.JComponent;
import javax.swing.JPanel;
import javax.swing.plaf.ColorUIResource;
import javax.swing.plaf.FontUIResource;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.NodeList;

/**
 * This class serializes and deserializes a KnowledgeFlow setup to and fro XML.
 * &lt;br&gt;
 * 
 * @author FracPete (fracpete at waikato dot ac dot nz)
 * @version $Revision: 7411 $
 */
public class XMLBeans 
  extends XMLBasicSerialization {

  /** the value of the id property */
  public final static String VAL_ID = &quot;id&quot;;

  /** the value of the x property */
  public final static String VAL_X = &quot;x&quot;;

  /** the value of the y property */
  public final static String VAL_Y = &quot;y&quot;;

  /** the value of the bean property */
  public final static String VAL_BEAN = &quot;bean&quot;;

  /** the value of the customName property */
  public final static String VAL_CUSTOM_NAME = &quot;custom_name&quot;;
 
  /** the value of the source property */
  public final static String VAL_SOURCEID = &quot;source_id&quot;;
 
  /** the value of the target property */
  public final static String VAL_TARGETID = &quot;target_id&quot;;
  
  /** the value of the eventname property */
  public final static String VAL_EVENTNAME = &quot;eventname&quot;;
  
  /** the value of the hidden property */
  public final static String VAL_HIDDEN = &quot;hidden&quot;;
  
  /** the value of the file property */
  public final static String VAL_FILE = &quot;file&quot;;
  
  /** the value of the dir property */
  public final static String VAL_DIR = &quot;dir&quot;;
  
  /** the value of the prefix property */
  public final static String VAL_PREFIX = &quot;prefix&quot;;

  public final static String VAL_RELATIVE_PATH = &quot;useRelativePath&quot;;
  
  /** the value of the options property */
  public final static String VAL_OPTIONS = &quot;options&quot;;
  
  /** the value of the saver property */
  public final static String VAL_SAVER = &quot;wrappedAlgorithm&quot;;
  
  /** the value of the loader property */
  public final static String VAL_LOADER = &quot;wrappedAlgorithm&quot;;
  
  /** the value of the text property */
  public final static String VAL_TEXT = &quot;text&quot;;
  
  /** the value of the beanContext property */
  public final static String VAL_BEANCONTEXT = &quot;beanContext&quot;;

  /** the value of the width property */
  public final static String VAL_WIDTH = &quot;width&quot;;

  /** the value of the height property */
  public final static String VAL_HEIGHT = &quot;height&quot;;

  /** the value of the red property */
  public final static String VAL_RED = &quot;red&quot;;

  /** the value of the green property */
  public final static String VAL_GREEN = &quot;green&quot;;
  
  /** the value of the blue property */
  public final static String VAL_BLUE = &quot;blue&quot;;

  /** the value of the value property */
  public final static String VAL_NAME = &quot;name&quot;;

  /** the value of the style property */
  public final static String VAL_STYLE = &quot;style&quot;;
 
  /** the value of the location property */
  public final static String VAL_LOCATION = &quot;location&quot;;
 
  /** the value of the size property */
  public final static String VAL_SIZE = &quot;size&quot;;
 
  /** the value of the color property */
  public final static String VAL_COLOR = &quot;color&quot;;
  
  /** the value of the font property */
  public final static String VAL_FONT = &quot;font&quot;;
  
  /** the value of the iconpath property */
  public final static String VAL_ICONPATH = &quot;iconPath&quot;;
  
  /** the value of the animatedIconPath property */
  public final static String VAL_ANIMATEDICONPATH = &quot;animatedIconPath&quot;;
  
  /** the value of the associatedConnections property */
  public final static String VAL_ASSOCIATEDCONNECTIONS = &quot;associatedConnections&quot;;
  
  /** the value of the input property */
  public final static String VAL_INPUTS = &quot;inputs&quot;;
  
  /** the value of the input id property */
  public final static String VAL_INPUTSID = &quot;inputs_id&quot;;
  
  /** the value of the outputs id property */
  public final static String VAL_OUTPUTS = &quot;outputs&quot;;
  
  /** the value of the outputs property */
  public final static String VAL_OUTPUTSID = &quot;outputs_id&quot;;
  
  /** the value of the subFlow property */
  public final static String VAL_SUBFLOW = &quot;subFlow&quot;;
  
  /** the value of the originalCoords property */
  public final static String VAL_ORIGINALCOORDS = &quot;originalCoords&quot;;
  
  /** the value of the relationNameForFilename property (Saver) */
  public final static String VAL_RELATIONNAMEFORFILENAME = &quot;relationNameForFilename&quot;;

  /** the index in the Vector, where the BeanInstances are stored 
   * (Instances and Connections are stored in a Vector and then serialized) */
  public final static int INDEX_BEANINSTANCES = 0;

  /** the index in the Vector, where the BeanConnections are stored
  * (Instances and Connections are stored in a Vector and then serialized) */
  public final static int INDEX_BEANCONNECTIONS = 1;
  
  /** the component that manages the layout of the beans */
  protected JComponent m_BeanLayout;
  
  /** keeps track of the BeanInstances read so far, used for the BeanConnections */
  protected Vector m_BeanInstances;
  
  /** keeps track of the BeanInstances read so far, used for the BeanConnections */
  protected Vector m_BeanInstancesID;

  /** whether to ignore the BeanConnection */
  protected boolean m_IgnoreBeanConnections;
  
  /** the current MetaBean (for the BeanConnections) */
  protected MetaBean m_CurrentMetaBean;

  /** the identifier for regular BeanConnections */
  protected final static String REGULAR_CONNECTION = &quot;regular_connection&quot;;
  
  /** the relation between Bean and connection, MetaBean BeanConnections
   * are stored under the reference of the MetaBean, regular connections 
   * are stored under REGULAR_CONNECTION. The relation has the following 
   * format (is a string): sourcePos,targetPos,event,hidden
   * @see #REGULAR_CONNECTION */
  protected Hashtable m_BeanConnectionRelation;
  
  /** the data that is about to be read/written contains a complete layout 
   * @see #m_DataType */
  public final static int DATATYPE_LAYOUT = 0;
  
  /** the data that is about to be read/written contains user-components, i.e., 
   * Metabeans 
   * @see #m_DataType */
  public final static int DATATYPE_USERCOMPONENTS = 1;
  
  /** the type of data that is be read/written
   * @see #DATATYPE_LAYOUT
   * @see #DATATYPE_USERCOMPONENTS */
<span class="nc" id="L230">  protected int m_DataType = DATATYPE_LAYOUT;</span>
  
  /** the beancontext to use for loading from XML and the beancontext is
   * null in the bean */
<span class="nc" id="L234">  protected BeanContextSupport m_BeanContextSupport = null;</span>
  
  /**
   * initializes the serialization for layouts
   * 
   * @param layout      the component that manages the layout
   * @param context     the bean context support to use
   * @throws Exception  if initialization fails
   */
  public XMLBeans(JComponent layout, BeanContextSupport context) throws Exception {
<span class="nc" id="L244">    this(layout, context, DATATYPE_LAYOUT);</span>
<span class="nc" id="L245">  }</span>
  
  /**
   * initializes the serialization for different types of data
   * 
   * @param layout      the component that manages the layout
   * @param context     the bean context support to use
   * @param datatype    the type of data to read/write
   * @throws Exception  if initialization fails
   */
  public XMLBeans(JComponent layout, BeanContextSupport context, int datatype) throws Exception {
<span class="nc" id="L256">    super();</span>
    
<span class="nc" id="L258">    m_BeanLayout = layout;</span>
<span class="nc" id="L259">    m_BeanContextSupport = context;</span>
<span class="nc" id="L260">    setDataType(datatype);</span>
<span class="nc" id="L261">  }</span>
  
  /**
   * sets what kind of data is to be read/written
   * @param value       the type of data
   * @see #m_DataType
   */
  public void setDataType(int value) {
<span class="nc bnc" id="L269" title="All 2 branches missed.">    if (value == DATATYPE_LAYOUT)</span>
<span class="nc" id="L270">      m_DataType = value;</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">    else if (value == DATATYPE_USERCOMPONENTS)</span>
<span class="nc" id="L272">      m_DataType = value;</span>
    else
<span class="nc" id="L274">      System.out.println(Messages.getInstance().getString(&quot;XMLBeans_SetDataType_DataType_Text_Front&quot;) + value + Messages.getInstance().getString(&quot;XMLBeans_SetDataType_DataType_Text_End&quot;));</span>
<span class="nc" id="L275">  }</span>
  
  /**
   * returns the type of data that is to be read/written
   * @return the type of data
   * @see #m_DataType
   */
  public int getDataType() {
<span class="nc" id="L283">    return m_DataType;</span>
  }

  /**
   * generates internally a new XML document and clears also the IgnoreList and
   * the mappings for the Read/Write-Methods
   * 
   * @throws Exception if something goes wrong
   */
  public void clear() throws Exception {
    Vector&lt;String&gt;	classnames;
    int			i;
    
<span class="nc" id="L296">    super.clear();</span>
    
    // ignore: suppress unnecessary GUI stuff 
    // needs to be checked for new Java versions (might introduce new properties) 
    // - works with Java 1.5
<span class="nc" id="L301">    m_Properties.addIgnored(&quot;UI&quot;);</span>
<span class="nc" id="L302">    m_Properties.addIgnored(&quot;actionMap&quot;);</span>
<span class="nc" id="L303">    m_Properties.addIgnored(&quot;alignmentX&quot;);</span>
<span class="nc" id="L304">    m_Properties.addIgnored(&quot;alignmentY&quot;);</span>
<span class="nc" id="L305">    m_Properties.addIgnored(&quot;autoscrolls&quot;);</span>
<span class="nc" id="L306">    m_Properties.addIgnored(&quot;background&quot;);</span>
<span class="nc" id="L307">    m_Properties.addIgnored(&quot;border&quot;);</span>
<span class="nc" id="L308">    m_Properties.addIgnored(&quot;componentPopupMenu&quot;);</span>
<span class="nc" id="L309">    m_Properties.addIgnored(&quot;debugGraphicsOptions&quot;);</span>
<span class="nc" id="L310">    m_Properties.addIgnored(&quot;doubleBuffered&quot;);</span>
<span class="nc" id="L311">    m_Properties.addIgnored(&quot;enabled&quot;);</span>
<span class="nc" id="L312">    m_Properties.addIgnored(&quot;focusCycleRoot&quot;);</span>
<span class="nc" id="L313">    m_Properties.addIgnored(&quot;focusTraversalPolicy&quot;);</span>
<span class="nc" id="L314">    m_Properties.addIgnored(&quot;focusTraversalPolicyProvider&quot;);</span>
<span class="nc" id="L315">    m_Properties.addIgnored(&quot;focusable&quot;);</span>
<span class="nc" id="L316">    m_Properties.addIgnored(&quot;font&quot;);</span>
<span class="nc" id="L317">    m_Properties.addIgnored(&quot;foreground&quot;);</span>
<span class="nc" id="L318">    m_Properties.addIgnored(&quot;inheritsPopupMenu&quot;);</span>
<span class="nc" id="L319">    m_Properties.addIgnored(&quot;inputVerifier&quot;);</span>
<span class="nc" id="L320">    m_Properties.addIgnored(&quot;layout&quot;);</span>
<span class="nc" id="L321">    m_Properties.addIgnored(&quot;locale&quot;);</span>
<span class="nc" id="L322">    m_Properties.addIgnored(&quot;maximumSize&quot;);</span>
<span class="nc" id="L323">    m_Properties.addIgnored(&quot;minimumSize&quot;);</span>
<span class="nc" id="L324">    m_Properties.addIgnored(&quot;nextFocusableComponent&quot;);</span>
<span class="nc" id="L325">    m_Properties.addIgnored(&quot;opaque&quot;);</span>
<span class="nc" id="L326">    m_Properties.addIgnored(&quot;preferredSize&quot;);</span>
<span class="nc" id="L327">    m_Properties.addIgnored(&quot;requestFocusEnabled&quot;);</span>
<span class="nc" id="L328">    m_Properties.addIgnored(&quot;toolTipText&quot;);</span>
<span class="nc" id="L329">    m_Properties.addIgnored(&quot;transferHandler&quot;);</span>
<span class="nc" id="L330">    m_Properties.addIgnored(&quot;verifyInputWhenFocusTarget&quot;);</span>
<span class="nc" id="L331">    m_Properties.addIgnored(&quot;visible&quot;);</span>

    // special ignore
<span class="nc" id="L334">    m_Properties.addIgnored(&quot;size&quot;);  // otherwise you get an endless loop with Dimension!</span>
<span class="nc" id="L335">    m_Properties.addIgnored(&quot;location&quot;);  // otherwise you get an endless loop with Point!</span>

    // allow
<span class="nc" id="L338">    m_Properties.addAllowed(weka.gui.beans.BeanInstance.class, &quot;x&quot;);</span>
<span class="nc" id="L339">    m_Properties.addAllowed(weka.gui.beans.BeanInstance.class, &quot;y&quot;);</span>
<span class="nc" id="L340">    m_Properties.addAllowed(weka.gui.beans.BeanInstance.class, &quot;bean&quot;);</span>
<span class="nc" id="L341">    m_Properties.addAllowed(weka.gui.beans.Saver.class, &quot;wrappedAlgorithm&quot;);</span>
<span class="nc" id="L342">    m_Properties.addAllowed(weka.gui.beans.Loader.class, &quot;wrappedAlgorithm&quot;);</span>
<span class="nc" id="L343">    m_Properties.addAllowed(weka.gui.beans.Saver.class, &quot;relationNameForFilename&quot;);</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">    if (getDataType() == DATATYPE_LAYOUT)</span>
<span class="nc" id="L345">      m_Properties.addAllowed(weka.gui.beans.Loader.class, &quot;beanContext&quot;);</span>
    else
<span class="nc" id="L347">      m_Properties.addIgnored(weka.gui.beans.Loader.class, &quot;beanContext&quot;);   // TODO: more classes???</span>
<span class="nc" id="L348">    m_Properties.addAllowed(weka.gui.beans.Filter.class, &quot;filter&quot;);</span>
<span class="nc" id="L349">    m_Properties.addAllowed(weka.gui.beans.Associator.class, &quot;associator&quot;);</span>
<span class="nc" id="L350">    m_Properties.addAllowed(weka.gui.beans.Classifier.class, &quot;wrappedAlgorithm&quot;);</span>
<span class="nc" id="L351">    m_Properties.addAllowed(weka.gui.beans.Clusterer.class, &quot;wrappedAlgorithm&quot;);</span>
<span class="nc" id="L352">    m_Properties.addAllowed(weka.gui.beans.Classifier.class, &quot;executionSlots&quot;);</span>

<span class="nc" id="L354">    m_Properties.addAllowed(weka.classifiers.Classifier.class, &quot;debug&quot;);</span>
<span class="nc" id="L355">    m_Properties.addAllowed(weka.classifiers.Classifier.class, &quot;options&quot;);</span>
<span class="nc" id="L356">    m_Properties.addAllowed(weka.filters.Filter.class, &quot;options&quot;);</span>
<span class="nc" id="L357">    m_Properties.addAllowed(weka.associations.Associator.class, &quot;options&quot;);</span>
<span class="nc" id="L358">    m_Properties.addAllowed(weka.clusterers.Clusterer.class, &quot;options&quot;);</span>
    
<span class="nc" id="L360">    m_Properties.addAllowed(weka.core.converters.DatabaseSaver.class, &quot;options&quot;);</span>
<span class="nc" id="L361">    m_Properties.addAllowed(weka.core.converters.DatabaseLoader.class, &quot;options&quot;);</span>
<span class="nc" id="L362">    m_Properties.addAllowed(weka.core.converters.TextDirectoryLoader.class, &quot;options&quot;);</span>

    // we assume that classes implementing SplitEvaluator also implement OptionHandler
<span class="nc" id="L365">    m_Properties.addAllowed(weka.experiment.SplitEvaluator.class, &quot;options&quot;);</span>
    // we assume that classes implementing ResultProducer also implement OptionHandler
<span class="nc" id="L367">    m_Properties.addAllowed(weka.experiment.ResultProducer.class, &quot;options&quot;);</span>

    // read/write methods
<span class="nc" id="L370">    m_CustomMethods.register(this, Color.class, &quot;Color&quot;);</span>
<span class="nc" id="L371">    m_CustomMethods.register(this, Dimension.class, &quot;Dimension&quot;);</span>
<span class="nc" id="L372">    m_CustomMethods.register(this, Font.class, &quot;Font&quot;);</span>
<span class="nc" id="L373">    m_CustomMethods.register(this, Point.class, &quot;Point&quot;);</span>
<span class="nc" id="L374">    m_CustomMethods.register(this, ColorUIResource.class, &quot;ColorUIResource&quot;);</span>
<span class="nc" id="L375">    m_CustomMethods.register(this, FontUIResource.class, &quot;FontUIResource&quot;);</span>

<span class="nc" id="L377">    m_CustomMethods.register(this, weka.gui.beans.BeanInstance.class, &quot;BeanInstance&quot;);</span>
<span class="nc" id="L378">    m_CustomMethods.register(this, weka.gui.beans.BeanConnection.class, &quot;BeanConnection&quot;);</span>
<span class="nc" id="L379">    m_CustomMethods.register(this, weka.gui.beans.BeanVisual.class, &quot;BeanVisual&quot;);</span>
<span class="nc" id="L380">    m_CustomMethods.register(this, weka.gui.beans.Saver.class, &quot;BeanSaver&quot;);</span>
<span class="nc" id="L381">    m_CustomMethods.register(this, weka.gui.beans.MetaBean.class, &quot;MetaBean&quot;);</span>

<span class="nc" id="L383">    classnames = ConverterUtils.getFileLoaders();</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">    for (i = 0; i &lt; classnames.size(); i++)</span>
<span class="nc" id="L385">      m_CustomMethods.register(this, Class.forName(classnames.get(i)), &quot;Loader&quot;);</span>
<span class="nc" id="L386">    classnames = ConverterUtils.getFileSavers();</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">    for (i = 0; i &lt; classnames.size(); i++)</span>
<span class="nc" id="L388">      m_CustomMethods.register(this, Class.forName(classnames.get(i)), &quot;Saver&quot;);</span>
    
    // other variables
<span class="nc" id="L391">    m_BeanInstances          = null;</span>
<span class="nc" id="L392">    m_BeanInstancesID        = null;</span>
<span class="nc" id="L393">    m_CurrentMetaBean        = null;</span>
<span class="nc" id="L394">    m_IgnoreBeanConnections  = true;</span>
<span class="nc" id="L395">    m_BeanConnectionRelation = null;</span>
<span class="nc" id="L396">  }</span>
  
  /**
   * traverses over all BeanInstances (or MetaBeans) and stores them in a vector 
   * (recurses into MetaBeans, since the sub-BeanInstances are not visible)
   * @param list       the BeanInstances/MetaBeans to traverse
   */
  protected void addBeanInstances(Vector list) {
    int             i;
    BeanInstance    beaninst;
    
<span class="nc bnc" id="L407" title="All 2 branches missed.">    for (i = 0; i &lt; list.size(); i++) {</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">      if (list.get(i) instanceof BeanInstance) {</span>
<span class="nc" id="L409">        beaninst = (BeanInstance) list.get(i);</span>
        
<span class="nc" id="L411">        m_BeanInstancesID.add(new Integer(m_BeanInstances.size()));</span>
<span class="nc" id="L412">        m_BeanInstances.add(beaninst);</span>
        
<span class="nc bnc" id="L414" title="All 2 branches missed.">        if (beaninst.getBean() instanceof MetaBean)</span>
<span class="nc" id="L415">          addBeanInstances(((MetaBean) beaninst.getBean()).getBeansInSubFlow());</span>
      }
<span class="nc bnc" id="L417" title="All 2 branches missed.">      else if (list.get(i) instanceof MetaBean) {</span>
<span class="nc" id="L418">        addBeanInstances(((MetaBean) list.get(i)).getBeansInSubFlow());</span>
      }
      else {
<span class="nc" id="L421">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_SetDataType_AddBeanInstances_Text_Front&quot;) + list.get(i) + Messages.getInstance().getString(&quot;XMLBeans_SetDataType_AddBeanInstances_Text_End&quot;));</span>
      }
    }
<span class="nc" id="L424">  }</span>
  
  /**
   * enables derived classes to due some pre-processing on the objects, that's
   * about to be serialized. Right now it only returns the object.
   * 
   * @param o the object that is serialized into XML
   * @return the possibly altered object
   * @throws Exception if post-processing fails
   */
  protected Object writePreProcess(Object o) throws Exception {
<span class="nc" id="L435">    o = super.writePreProcess(o);</span>
    
    // gather all BeanInstances, also the ones in MetaBeans
<span class="nc" id="L438">    m_BeanInstances   = new Vector();</span>
<span class="nc" id="L439">    m_BeanInstancesID = new Vector();</span>
    
<span class="nc bnc" id="L441" title="All 3 branches missed.">    switch (getDataType()) {</span>
      case DATATYPE_LAYOUT:
<span class="nc" id="L443">        addBeanInstances(BeanInstance.getBeanInstances());</span>
<span class="nc" id="L444">        break;</span>

      case DATATYPE_USERCOMPONENTS:
<span class="nc" id="L447">        addBeanInstances((Vector) o);</span>
<span class="nc" id="L448">        break;</span>
        
      default:
<span class="nc" id="L451">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_WritePreProcess_Text_Front&quot;) + getDataType() + Messages.getInstance().getString(&quot;XMLBeans_WritePreProcess_Text_End&quot;));</span>
        break;
    }
    
<span class="nc" id="L455">    return o;</span>
  }
  
  /**
   * enables derived classes to add other properties to the DOM tree, e.g.
   * ones that do not apply to the get/set convention of beans. only implemented
   * with empty method body.
   * 
   * @param o the object that is serialized into XML
   * @throws Exception if post-processing fails
   */
  protected void writePostProcess(Object o) throws Exception {
    Element         root;
    NodeList        list;
    Element         conns;
    Element         child;
    int             i;

    // since not all BeanConnections get saved to XML (e.g., MetaBeans in the 
    // UserToolBar) if one saves a layout, the numbering in the Vector of the 
    // BeanConnections is not correct. The &quot;name&quot; attribute of the nodes has
    // to be modified
<span class="nc bnc" id="L477" title="All 2 branches missed.">    if (getDataType() == DATATYPE_LAYOUT) {</span>
<span class="nc" id="L478">      root  = m_Document.getDocument().getDocumentElement();</span>
<span class="nc" id="L479">      conns = (Element) root.getChildNodes().item(INDEX_BEANCONNECTIONS);</span>
<span class="nc" id="L480">      list  = conns.getChildNodes();</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">      for (i = 0; i &lt; list.getLength(); i++) {</span>
<span class="nc" id="L482">        child = (Element) list.item(i);</span>
<span class="nc" id="L483">        child.setAttribute(ATT_NAME, &quot;&quot; + i);</span>
      }
    }
<span class="nc" id="L486">  }</span>
  
  /**
   * additional pre-processing can happen in derived classes before the 
   * actual reading from XML (working on the raw XML). right now it does 
   * nothing with the document, only empties the help-vector for the
   * BeanInstances and reads the IDs for the BeanInstances, s.t. the correct
   * references can be set again
   * 
   * @param document the document to pre-process
   * @return the processed object
   * @throws Exception if post-processing fails
   * @see #m_BeanInstances
   */
  protected Document readPreProcess(Document document) throws Exception {
    NodeList        list;
    int             i;
    Element         node;
    String          clsName;
    Vector          children;
    int             id;
    int             n;
    Element         child;
    
<span class="nc" id="L510">    m_BeanInstances   = new Vector();</span>
<span class="nc" id="L511">    m_BeanInstancesID = new Vector();</span>
    
    // get all BeanInstance nodes
<span class="nc" id="L514">    list    = document.getElementsByTagName(&quot;*&quot;);</span>
<span class="nc" id="L515">    clsName = BeanInstance.class.getName();</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">    for (i = 0; i &lt; list.getLength(); i++) {</span>
<span class="nc" id="L517">      node = (Element) list.item(i);</span>
      
      // is it a BeanInstance?
<span class="nc bnc" id="L520" title="All 2 branches missed.">      if (node.getAttribute(ATT_CLASS).equals(clsName)) {</span>
<span class="nc" id="L521">        children = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L522">        id       = m_BeanInstancesID.size();</span>
        
        // get id-tag (if available)
<span class="nc bnc" id="L525" title="All 2 branches missed.">        for (n = 0; n &lt; children.size(); n++) {</span>
<span class="nc" id="L526">          child = (Element) children.get(n);</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">          if (child.getAttribute(ATT_NAME).equals(VAL_ID))</span>
<span class="nc" id="L528">            id = readIntFromXML((Element) child);</span>
        }
        
<span class="nc" id="L531">        m_BeanInstancesID.add(new Integer(id));</span>
      }
    }
    
<span class="nc" id="L535">    m_BeanInstances.setSize(m_BeanInstancesID.size());</span>
    
    // set MetaBean to null
<span class="nc" id="L538">    m_CurrentMetaBean = null;</span>

    // no BeanConnections -&gt; see readPostProcess(Object)
<span class="nc" id="L541">    m_IgnoreBeanConnections = true;</span>
    
    // reset BeanConnection-Relations
<span class="nc" id="L544">    m_BeanConnectionRelation = new Hashtable();</span>
    
<span class="nc" id="L546">    return document;</span>
  }
  
  /**
   * puts the given BeanConnection onto the next null in the given Vector,
   * or at the end of the list, if no null is found.
   * (during the de-serializing, no BeanConnections are set, only nulls)
   * @param conn      the connection to add to the list
   * @param list      the list to add the BeanConnection to
   */
  protected void setBeanConnection(BeanConnection conn, Vector list) {
    int         i;
    boolean     added;
    
<span class="nc" id="L560">    added = false;</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">    for (i = 0; i &lt; list.size(); i++) {</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">      if (list.get(i) == null) {</span>
<span class="nc" id="L563">        list.set(i, conn);</span>
<span class="nc" id="L564">        added = true;</span>
<span class="nc" id="L565">        break;</span>
      }
    }
    
<span class="nc bnc" id="L569" title="All 2 branches missed.">    if (!added)</span>
<span class="nc" id="L570">      list.add(conn);</span>
<span class="nc" id="L571">  }</span>
  
  /**
   * generates a connection based on the given parameters
   * @param sourcePos the source position in the m_BeanInstances vector
   * @param targetPos the target position in the m_BeanInstances vector
   * @param event the name of the event, i.e., the connection
   * @param hidden true if the connection is hidden
   * @return the generated BeanConnection
   * @throws Exception if something goes wrong
   */
  protected BeanConnection createBeanConnection(int sourcePos, int targetPos, String event, boolean hidden) throws Exception {
    BeanConnection          result;
    BeanInfo                compInfo;
    EventSetDescriptor[]    esds;
    int                     i;
    BeanInstance            instSource;
    BeanInstance            instTarget;

<span class="nc" id="L590">    result = null;</span>
    
    // was there a connection?
<span class="nc bnc" id="L593" title="All 4 branches missed.">    if ( (sourcePos == -1) || (targetPos == -1) )</span>
<span class="nc" id="L594">      return result;</span>
    
<span class="nc" id="L596">    instSource = (BeanInstance) m_BeanInstances.get(sourcePos);</span>
<span class="nc" id="L597">    instTarget = (BeanInstance) m_BeanInstances.get(targetPos);</span>
    
<span class="nc" id="L599">    compInfo = Introspector.getBeanInfo(((BeanInstance) m_BeanInstances.get(sourcePos)).getBean().getClass());</span>
<span class="nc" id="L600">    esds     = compInfo.getEventSetDescriptors();</span>

<span class="nc bnc" id="L602" title="All 2 branches missed.">    for (i = 0; i &lt; esds.length; i++) {</span>
<span class="nc bnc" id="L603" title="All 2 branches missed.">      if (esds[i].getName().equals(event)) {</span>
<span class="nc" id="L604">        result = new BeanConnection(instSource, instTarget, esds[i]);</span>
<span class="nc" id="L605">        ((BeanConnection) result).setHidden(hidden);</span>
<span class="nc" id="L606">        break;</span>
      }
    }
    
<span class="nc" id="L610">    return result;</span>
  }
  
  /**
   * rebuilds all the connections for a certain key in the hashtable.
   * for the ones being part of a MetaBean, no new instance is built, but only
   * the reference to the actual BeanConnection set.
   * @param deserialized    the deserialized knowledgeflow
   * @param key             the key of the hashtable to rebuild all connections for
   * @throws Exception if something goes wrong
   */
  protected void rebuildBeanConnections(Vector deserialized, Object key) throws Exception {
    int                     i;
    int                     n;
    int                     sourcePos;
    int                     targetPos;
    String                  event;
    boolean                 hidden;
    Vector                  conns;
    BeanConnection          conn;
    StringTokenizer         tok;
    Vector                  beanconns;

<span class="nc" id="L633">    conns = (Vector) m_BeanConnectionRelation.get(key);</span>
    
    // no connections?
<span class="nc bnc" id="L636" title="All 2 branches missed.">    if (conns == null)</span>
<span class="nc" id="L637">      return;</span>
    
<span class="nc bnc" id="L639" title="All 2 branches missed.">    for (n = 0; n &lt; conns.size(); n++) {</span>
<span class="nc" id="L640">      tok       = new StringTokenizer(conns.get(n).toString(), &quot;,&quot;);</span>
<span class="nc" id="L641">      conn      = null;</span>
<span class="nc" id="L642">      sourcePos = Integer.parseInt(tok.nextToken());</span>
<span class="nc" id="L643">      targetPos = Integer.parseInt(tok.nextToken());</span>
<span class="nc" id="L644">      event     = tok.nextToken();</span>
<span class="nc" id="L645">      hidden    = stringToBoolean(tok.nextToken());</span>

      // regular connection? -&gt; new instance
      // or MetaBean from user toolbar
<span class="nc bnc" id="L649" title="All 4 branches missed.">      if ( (!(key instanceof MetaBean)) || (getDataType() == DATATYPE_USERCOMPONENTS)) {</span>
<span class="nc" id="L650">        conn = createBeanConnection(sourcePos, targetPos, event, hidden);</span>
      }
      // MetaBean? -&gt; find BeanConnection 
      else {
<span class="nc" id="L654">        beanconns = BeanConnection.getConnections();</span>
        
<span class="nc bnc" id="L656" title="All 2 branches missed.">        for (i = 0; i &lt; beanconns.size(); i++) {</span>
<span class="nc" id="L657">          conn = (BeanConnection) beanconns.get(i);</span>
<span class="nc bnc" id="L658" title="All 2 branches missed.">          if (    (conn.getSource() == (BeanInstance) m_BeanInstances.get(sourcePos))</span>
<span class="nc bnc" id="L659" title="All 2 branches missed.">               &amp;&amp; (conn.getTarget() == (BeanInstance) m_BeanInstances.get(targetPos))</span>
<span class="nc bnc" id="L660" title="All 2 branches missed.">               &amp;&amp; (conn.getEventName().equals(event)) ) {</span>
<span class="nc" id="L661">            break;</span>
          }
<span class="nc" id="L663">          conn = null;</span>
        }
      }
      
      // add the connection to the corresponding list/MetaBean
<span class="nc bnc" id="L668" title="All 2 branches missed.">      if (key instanceof MetaBean)</span>
<span class="nc" id="L669">        setBeanConnection(conn, ((MetaBean) key).getAssociatedConnections());</span>
      else
<span class="nc" id="L671">        setBeanConnection(conn, (Vector) deserialized.get(INDEX_BEANCONNECTIONS));</span>
    }
<span class="nc" id="L673">  }</span>
  
  /**
   * removes the given meta beans from the layout, since they're only listed
   * in the user toolbar
   * 
   * @param metabeans         the list of MetaBeans in the user toolbar
   */
  protected void removeUserToolBarBeans(Vector metabeans) {
    int           i;
    int           n;
    MetaBean      meta;
    Vector        subflow;
    BeanInstance  beaninst;
    
<span class="nc bnc" id="L688" title="All 2 branches missed.">    for (i = 0; i &lt; metabeans.size(); i++) {</span>
<span class="nc" id="L689">      meta    = (MetaBean) metabeans.get(i);</span>
<span class="nc" id="L690">      subflow = meta.getSubFlow();</span>
      
<span class="nc bnc" id="L692" title="All 2 branches missed.">      for (n = 0; n &lt; subflow.size(); n++) {</span>
<span class="nc" id="L693">        beaninst = (BeanInstance) subflow.get(n);</span>
<span class="nc" id="L694">        beaninst.removeBean(m_BeanLayout);</span>
      }
    }
<span class="nc" id="L697">  }</span>
  
  /**
   * additional post-processing can happen in derived classes after reading 
   * from XML. re-builds the BeanConnections.
   * 
   * @param o the object to perform some additional processing on
   * @return the processed object
   * @throws Exception if post-processing fails
   */
  protected Object readPostProcess(Object o) throws Exception {
    Enumeration             enm;
    Vector                  deserialized;
    Object                  key;

<span class="nc" id="L712">    deserialized = (Vector) super.readPostProcess(o);</span>
    
    // rebuild the actual connections
<span class="nc" id="L715">    rebuildBeanConnections(deserialized, REGULAR_CONNECTION);</span>

    // rebuild the references in the MetaBeans
<span class="nc" id="L718">    enm = m_BeanConnectionRelation.keys();</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">    while (enm.hasMoreElements()) {</span>
<span class="nc" id="L720">      key = enm.nextElement();</span>
      
      // skip the regular connections
<span class="nc bnc" id="L723" title="All 2 branches missed.">      if (!(key instanceof MetaBean))</span>
<span class="nc" id="L724">        continue;</span>
      
<span class="nc" id="L726">      rebuildBeanConnections(deserialized, key);</span>
    }

    // remove MetaBean and subflow from BeanInstance (not part of the flow!)
<span class="nc bnc" id="L730" title="All 2 branches missed.">    if (getDataType() == DATATYPE_USERCOMPONENTS)</span>
<span class="nc" id="L731">      removeUserToolBarBeans(deserialized);</span>
    
<span class="nc" id="L733">    return deserialized;</span>
  }

  /**
   * returns the relation for the given MetaBean, for the regular connections,
   * null has to be used
   * @param meta      the MetaBean (or null for regular connections) to retrieve
   *                  the connections for
   * @return          the associated connections
   * @see #REGULAR_CONNECTION
   */
  protected Vector getBeanConnectionRelation(MetaBean meta) {
    Vector      result;
    Object      key;
    
<span class="nc bnc" id="L748" title="All 2 branches missed.">    if (meta == null)</span>
<span class="nc" id="L749">      key = REGULAR_CONNECTION;</span>
    else
<span class="nc" id="L751">      key = meta;</span>
    
    // not yet in there?
<span class="nc bnc" id="L754" title="All 2 branches missed.">    if (!m_BeanConnectionRelation.containsKey(key)) {</span>
<span class="nc" id="L755">      m_BeanConnectionRelation.put(key, new Vector());</span>
    }

<span class="nc" id="L758">    result = (Vector) m_BeanConnectionRelation.get(key);</span>
    
<span class="nc" id="L760">    return result;</span>
  }
  
  /**
   * adds the given connection-relation for the specified MetaBean (or null in 
   * case of regular connections)
   * @param meta        the MetaBean (or null for regular connections) to add
   *                    the relationship for
   * @param connection  the connection relation to add
   */
  protected void addBeanConnectionRelation(MetaBean meta, String connection) {
    Vector      relations;
    Object      key;
    
<span class="nc" id="L774">    relations = getBeanConnectionRelation(meta);</span>
    
    // add relation
<span class="nc" id="L777">    relations.add(connection);</span>
    
    // update
<span class="nc bnc" id="L780" title="All 2 branches missed.">    if (meta == null)</span>
<span class="nc" id="L781">      key = REGULAR_CONNECTION;</span>
    else
<span class="nc" id="L783">      key = meta;</span>
<span class="nc" id="L784">    m_BeanConnectionRelation.put(key, relations);</span>
<span class="nc" id="L785">  }</span>
  
  /**
   * adds the given Color to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeColor(Element parent, Object o, String name)
    throws Exception {
    
    Element     node;
    Color       color;

    // for debugging only
<span class="nc bnc" id="L803" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L804">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L806">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L808">    color = (Color) o;</span>
<span class="nc" id="L809">    node  = addElement(parent, name, color.getClass().getName(), false);</span>

<span class="nc" id="L811">    writeIntToXML(node, color.getRed(), VAL_RED);</span>
<span class="nc" id="L812">    writeIntToXML(node, color.getGreen(), VAL_GREEN);</span>
<span class="nc" id="L813">    writeIntToXML(node, color.getBlue(), VAL_BLUE);</span>
    
<span class="nc" id="L815">    return node;</span>
  }

  /**
   * builds the Color from the given DOM node.
   * 
   * @param node the associated XML node
   * @return the instance created from the XML description
   * @throws Exception if instantiation fails
   */
  public Object readColor(Element node) throws Exception {
    Object      result;
    Vector      children;
    Element     child;
    int         i;
    int         red;
    int         green;
    int         blue;
    String      name;

    // for debugging only
<span class="nc bnc" id="L836" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L837">       trace(new Throwable(), node.getAttribute(ATT_NAME));</span>

<span class="nc" id="L839">    m_CurrentNode = node;</span>
    
<span class="nc" id="L841">    result   = null;</span>
<span class="nc" id="L842">    children = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L843">    red      = 0;</span>
<span class="nc" id="L844">    green    = 0;</span>
<span class="nc" id="L845">    blue     = 0;</span>

<span class="nc bnc" id="L847" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++) {</span>
<span class="nc" id="L848">      child = (Element) children.get(i);</span>
<span class="nc" id="L849">      name  = child.getAttribute(ATT_NAME);</span>

<span class="nc bnc" id="L851" title="All 2 branches missed.">      if (name.equals(VAL_RED))</span>
<span class="nc" id="L852">        red = readIntFromXML(child);</span>
<span class="nc bnc" id="L853" title="All 2 branches missed.">      else if (name.equals(VAL_GREEN))</span>
<span class="nc" id="L854">        green = readIntFromXML(child);</span>
<span class="nc bnc" id="L855" title="All 2 branches missed.">      else if (name.equals(VAL_BLUE))</span>
<span class="nc" id="L856">        blue = readIntFromXML(child);</span>
      else
<span class="nc" id="L858">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_ReadColor_Text_First&quot;) + name</span>
<span class="nc" id="L859">            + Messages.getInstance().getString(&quot;XMLBeans_ReadColor_Text_Second&quot;) + node.getAttribute(ATT_NAME) + </span>
<span class="nc" id="L860">            Messages.getInstance().getString(&quot;XMLBeans_ReadColor_Text_Third&quot;));</span>
    }
    
<span class="nc" id="L863">    result = new Color(red, green, blue);</span>

<span class="nc" id="L865">    return result;</span>
  }

  /**
   * adds the given Dimension to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeDimension(Element parent, Object o, String name)
      throws Exception {
    
    Element     node;
    Dimension   dim;

    // for debugging only
<span class="nc bnc" id="L884" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L885">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L887">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L889">    dim = (Dimension) o;</span>
<span class="nc" id="L890">    node = addElement(parent, name, dim.getClass().getName(), false);</span>

<span class="nc" id="L892">    writeDoubleToXML(node, dim.getWidth(), VAL_WIDTH);</span>
<span class="nc" id="L893">    writeDoubleToXML(node, dim.getHeight(), VAL_HEIGHT);</span>
    
<span class="nc" id="L895">    return node;</span>
  }

  /**
   * builds the Dimension from the given DOM node.
   * 
   * @param node the associated XML node
   * @return the instance created from the XML description
   * @throws Exception if instantiation fails
   */
  public Object readDimension(Element node) throws Exception {
    Object      result;
    Vector      children;
    Element     child;
    int         i;
    double      width;
    double      height;
    String      name;

    // for debugging only
<span class="nc bnc" id="L915" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L916">       trace(new Throwable(), node.getAttribute(ATT_NAME));</span>

<span class="nc" id="L918">    m_CurrentNode = node;</span>
    
<span class="nc" id="L920">    result   = null;</span>
<span class="nc" id="L921">    children = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L922">    width    = 0;</span>
<span class="nc" id="L923">    height   = 0;</span>

<span class="nc bnc" id="L925" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++) {</span>
<span class="nc" id="L926">      child = (Element) children.get(i);</span>
<span class="nc" id="L927">      name  = child.getAttribute(ATT_NAME);</span>

<span class="nc bnc" id="L929" title="All 2 branches missed.">      if (name.equals(VAL_WIDTH))</span>
<span class="nc" id="L930">        width = readDoubleFromXML(child);</span>
<span class="nc bnc" id="L931" title="All 2 branches missed.">      else if (name.equals(VAL_HEIGHT))</span>
<span class="nc" id="L932">        height = readDoubleFromXML(child);</span>
      else
<span class="nc" id="L934">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_ReadDimension_Text_First&quot;) + name</span>
<span class="nc" id="L935">            + Messages.getInstance().getString(&quot;XMLBeans_ReadDimension_Text_Second&quot;) + node.getAttribute(ATT_NAME) + Messages.getInstance().getString(&quot;XMLBeans_ReadDimension_Text_Third&quot;));</span>
    }
    
<span class="nc" id="L938">    result = new Dimension();</span>
<span class="nc" id="L939">    ((Dimension) result).setSize(width, height);</span>

<span class="nc" id="L941">    return result;</span>
  }

  /**
   * adds the given Font to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeFont(Element parent, Object o, String name)
      throws Exception {
    
    Element     node;
    Font        font;

    // for debugging only
<span class="nc bnc" id="L960" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L961">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L963">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L965">    font = (Font) o;</span>
<span class="nc" id="L966">    node = addElement(parent, name, font.getClass().getName(), false);</span>

<span class="nc" id="L968">    invokeWriteToXML(node, font.getName(), VAL_NAME);</span>
<span class="nc" id="L969">    writeIntToXML(node, font.getStyle(), VAL_STYLE);</span>
<span class="nc" id="L970">    writeIntToXML(node, font.getSize(), VAL_SIZE);</span>
    
<span class="nc" id="L972">    return node;</span>
  }

  /**
   * builds the Font from the given DOM node.
   * 
   * @param node the associated XML node
   * @return the instance created from the XML description
   * @throws Exception if instantiation fails
   */
  public Object readFont(Element node) throws Exception {
    Object      result;
    Vector      children;
    Element     child;
    int         i;
    int         style;
    int         size;
    String      name;
    String      fontname;

    // for debugging only
<span class="nc bnc" id="L993" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L994">       trace(new Throwable(), node.getAttribute(ATT_NAME));</span>

<span class="nc" id="L996">    m_CurrentNode = node;</span>
    
<span class="nc" id="L998">    result   = null;</span>
<span class="nc" id="L999">    children = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L1000">    fontname = &quot;&quot;;</span>
<span class="nc" id="L1001">    style    = 0;</span>
<span class="nc" id="L1002">    size     = 0;</span>

<span class="nc bnc" id="L1004" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++) {</span>
<span class="nc" id="L1005">      child = (Element) children.get(i);</span>
<span class="nc" id="L1006">      name  = child.getAttribute(ATT_NAME);</span>

<span class="nc bnc" id="L1008" title="All 2 branches missed.">      if (name.equals(VAL_NAME))</span>
<span class="nc" id="L1009">        name = (String) invokeReadFromXML(child);</span>
<span class="nc bnc" id="L1010" title="All 2 branches missed.">      else if (name.equals(VAL_STYLE))</span>
<span class="nc" id="L1011">        style = readIntFromXML(child);</span>
<span class="nc bnc" id="L1012" title="All 2 branches missed.">      else if (name.equals(VAL_SIZE))</span>
<span class="nc" id="L1013">        size = readIntFromXML(child);</span>
      else
<span class="nc" id="L1015">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_ReadFont_Text_First&quot;) + name</span>
<span class="nc" id="L1016">            + Messages.getInstance().getString(&quot;XMLBeans_ReadFont_Text_Second&quot;) + node.getAttribute(ATT_NAME) + Messages.getInstance().getString(&quot;XMLBeans_ReadFont_Text_Third&quot;));</span>
    }
    
<span class="nc" id="L1019">    result = new Font(fontname, style, size);</span>

<span class="nc" id="L1021">    return result;</span>
  }

  /**
   * adds the given Point to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writePoint(Element parent, Object o, String name)
      throws Exception {
    
    Element     node;
    Point       p;

    // for debugging only
<span class="nc bnc" id="L1040" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1041">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L1043">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L1045">    p    = (Point) o;</span>
<span class="nc" id="L1046">    node = addElement(parent, name, p.getClass().getName(), false);</span>

<span class="nc" id="L1048">    writeDoubleToXML(node, p.getX(), VAL_X);</span>
<span class="nc" id="L1049">    writeDoubleToXML(node, p.getY(), VAL_Y);</span>
    
<span class="nc" id="L1051">    return node;</span>
  }

  /**
   * builds the Point from the given DOM node.
   * 
   * @param node the associated XML node
   * @return the instance created from the XML description
   * @throws Exception if instantiation fails
   */
  public Object readPoint(Element node) throws Exception {
    Object      result;
    Vector      children;
    Element     child;
    int         i;
    double      x;
    double      y;
    String      name;

    // for debugging only
<span class="nc bnc" id="L1071" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1072">       trace(new Throwable(), node.getAttribute(ATT_NAME));</span>

<span class="nc" id="L1074">    m_CurrentNode = node;</span>
    
<span class="nc" id="L1076">    result   = null;</span>
<span class="nc" id="L1077">    children = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L1078">    x        = 0;</span>
<span class="nc" id="L1079">    y        = 0;</span>

<span class="nc bnc" id="L1081" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++) {</span>
<span class="nc" id="L1082">      child = (Element) children.get(i);</span>
<span class="nc" id="L1083">      name  = child.getAttribute(ATT_NAME);</span>

<span class="nc bnc" id="L1085" title="All 2 branches missed.">      if (name.equals(VAL_X))</span>
<span class="nc" id="L1086">        x = readDoubleFromXML(child);</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">      else if (name.equals(VAL_Y))</span>
<span class="nc" id="L1088">        y = readDoubleFromXML(child);</span>
      else
<span class="nc" id="L1090">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_ReadPoint_Text_First&quot;) + name</span>
<span class="nc" id="L1091">            + Messages.getInstance().getString(&quot;XMLBeans_ReadPoint_Text_Second&quot;) + node.getAttribute(ATT_NAME) </span>
<span class="nc" id="L1092">            + Messages.getInstance().getString(&quot;XMLBeans_ReadPoint_Text_Third&quot;));</span>
    }
    
<span class="nc" id="L1095">    result = new Point();</span>
<span class="nc" id="L1096">    ((Point) result).setLocation(x, y);</span>

<span class="nc" id="L1098">    return result;</span>
  }

  /**
   * adds the given ColorUIResource to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeColorUIResource(Element parent, Object o, String name)
      throws Exception {
    
    Element           node;
    ColorUIResource   resource;

    // for debugging only
<span class="nc bnc" id="L1117" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1118">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L1120">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L1122">    resource = (ColorUIResource) o;</span>
<span class="nc" id="L1123">    node     = addElement(parent, name, resource.getClass().getName(), false);</span>
<span class="nc" id="L1124">    invokeWriteToXML(node, new Color(resource.getRGB()), VAL_COLOR);</span>
    
<span class="nc" id="L1126">    return node;</span>
  }

  /**
   * builds the ColorUIResource from the given DOM node.
   * 
   * @param node the associated XML node
   * @return the instance created from the XML description
   * @throws Exception if instantiation fails
   */
  public Object readColorUIResource(Element node) throws Exception {
    Object      result;
    Vector      children;
    Element     child;
    int         i;
    String      name;
    Color       color;

    // for debugging only
<span class="nc bnc" id="L1145" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1146">       trace(new Throwable(), node.getAttribute(ATT_NAME));</span>

<span class="nc" id="L1148">    m_CurrentNode = node;</span>
    
<span class="nc" id="L1150">    result   = null;</span>
<span class="nc" id="L1151">    children = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L1152">    color    = null;</span>

<span class="nc bnc" id="L1154" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++) {</span>
<span class="nc" id="L1155">      child = (Element) children.get(i);</span>
<span class="nc" id="L1156">      name  = child.getAttribute(ATT_NAME);</span>

<span class="nc bnc" id="L1158" title="All 2 branches missed.">      if (name.equals(VAL_COLOR))</span>
<span class="nc" id="L1159">        color = (Color) invokeReadFromXML(child);</span>
      else
<span class="nc" id="L1161">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_ReadColorUIResource_Text_First&quot;) + name</span>
<span class="nc" id="L1162">            + Messages.getInstance().getString(&quot;XMLBeans_ReadColorUIResource_Text_Second&quot;) + node.getAttribute(ATT_NAME)</span>
<span class="nc" id="L1163">            + Messages.getInstance().getString(&quot;XMLBeans_ReadColorUIResource_Text_Third&quot;));</span>
    }
    
<span class="nc" id="L1166">    result = new ColorUIResource(color);</span>

<span class="nc" id="L1168">    return result;</span>
  }

  /**
   * adds the given FontUIResource to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeFontUIResource(Element parent, Object o, String name)
      throws Exception {
    
    Element           node;
    FontUIResource    resource;

    // for debugging only
<span class="nc bnc" id="L1187" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1188">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L1190">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L1192">    resource = (FontUIResource) o;</span>
<span class="nc" id="L1193">    node     = addElement(parent, name, resource.getClass().getName(), false);</span>
<span class="nc" id="L1194">    invokeWriteToXML(node, new Font(resource.getName(), resource.getStyle(), resource.getSize()), VAL_COLOR);</span>
    
<span class="nc" id="L1196">    return node;</span>
  }

  /**
   * builds the FontUIResource from the given DOM node.
   * 
   * @param node the associated XML node
   * @return the instance created from the XML description
   * @throws Exception if instantiation fails
   */
  public Object readFontUIResource(Element node) throws Exception {
    Object      result;
    Vector      children;
    Element     child;
    int         i;
    String      name;
    Font        font;

    // for debugging only
<span class="nc bnc" id="L1215" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1216">       trace(new Throwable(), node.getAttribute(ATT_NAME));</span>

<span class="nc" id="L1218">    m_CurrentNode = node;</span>
    
<span class="nc" id="L1220">    result   = null;</span>
<span class="nc" id="L1221">    children = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L1222">    font     = null;</span>

<span class="nc bnc" id="L1224" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++) {</span>
<span class="nc" id="L1225">      child = (Element) children.get(i);</span>
<span class="nc" id="L1226">      name  = child.getAttribute(ATT_NAME);</span>

<span class="nc bnc" id="L1228" title="All 2 branches missed.">      if (name.equals(VAL_FONT))</span>
<span class="nc" id="L1229">        font = (Font) invokeReadFromXML(child);</span>
      else
<span class="nc" id="L1231">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_ReadFontUIResource_Text_First&quot;) + name</span>
<span class="nc" id="L1232">            + Messages.getInstance().getString(&quot;XMLBeans_ReadFontUIResource_Text_Second&quot;) + node.getAttribute(ATT_NAME)</span>
<span class="nc" id="L1233">            + Messages.getInstance().getString(&quot;XMLBeans_ReadFontUIResource_Text_Third&quot;));</span>
    }
    
<span class="nc" id="L1236">    result = new FontUIResource(font);</span>

<span class="nc" id="L1238">    return result;</span>
  }

  /**
   * adds the given BeanInstance to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeBeanInstance(Element parent, Object o, String name)
      throws Exception {
    
    Element         node;
    BeanInstance    beaninst;

    // for debugging only
<span class="nc bnc" id="L1257" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1258">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L1260">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L1262">    beaninst = (BeanInstance) o;</span>
<span class="nc" id="L1263">    node     = addElement(parent, name, beaninst.getClass().getName(), false);</span>

<span class="nc" id="L1265">    writeIntToXML(node, m_BeanInstances.indexOf(beaninst), VAL_ID);</span>
<span class="nc" id="L1266">    writeIntToXML(node, beaninst.getX() + beaninst.getWidth()  / 2, VAL_X);   // x is thought to be in the center?</span>
<span class="nc" id="L1267">    writeIntToXML(node, beaninst.getY() + beaninst.getHeight() / 2, VAL_Y);   // y is thought to be in the center?</span>
<span class="nc bnc" id="L1268" title="All 2 branches missed.">    if (beaninst.getBean() instanceof BeanCommon) {</span>
      // write the custom name of this bean
<span class="nc" id="L1270">      String custName = ((BeanCommon)beaninst.getBean()).getCustomName();</span>
<span class="nc" id="L1271">      invokeWriteToXML(node, custName, VAL_CUSTOM_NAME);</span>
    }
<span class="nc" id="L1273">    invokeWriteToXML(node, beaninst.getBean(), VAL_BEAN);</span>
    
<span class="nc" id="L1275">    return node;</span>
  }

  /**
   * builds the BeanInstance from the given DOM node.
   * 
   * @param node the associated XML node
   * @return the instance created from the XML description
   * @throws Exception if instantiation fails
   */
  public Object readBeanInstance(Element node) throws Exception {
    Object          result;
    Vector          children;
    Element         child;
    String          name;
    int             i;
    int             x;
    int             y;
    int             id;
    Object          bean;
    BeanVisual      visual;
    BeanInstance    beaninst;

    // for debugging only
<span class="nc bnc" id="L1299" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1300">       trace(new Throwable(), node.getAttribute(ATT_NAME));</span>

<span class="nc" id="L1302">    m_CurrentNode = node;</span>
    
<span class="nc" id="L1304">    result   = null;</span>
<span class="nc" id="L1305">    children = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L1306">    id       = -1;</span>
<span class="nc" id="L1307">    x        = 0;</span>
<span class="nc" id="L1308">    y        = 0;</span>
<span class="nc" id="L1309">    bean     = null;</span>
<span class="nc" id="L1310">    String customName = null;</span>

<span class="nc bnc" id="L1312" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++) {</span>
<span class="nc" id="L1313">      child = (Element) children.get(i);</span>
<span class="nc" id="L1314">      name  = child.getAttribute(ATT_NAME);</span>

<span class="nc bnc" id="L1316" title="All 2 branches missed.">      if (name.equals(VAL_ID)) {</span>
<span class="nc" id="L1317">        id = readIntFromXML(child);</span>
<span class="nc bnc" id="L1318" title="All 2 branches missed.">      } else if (name.equals(VAL_X)) {</span>
<span class="nc" id="L1319">        x = readIntFromXML(child);</span>
<span class="nc bnc" id="L1320" title="All 2 branches missed.">      } else if (name.equals(VAL_Y)) {</span>
<span class="nc" id="L1321">        y = readIntFromXML(child);</span>
<span class="nc bnc" id="L1322" title="All 2 branches missed.">      } else if (name.equals(VAL_CUSTOM_NAME)) {</span>
<span class="nc" id="L1323">        customName = (String)invokeReadFromXML(child);</span>
<span class="nc bnc" id="L1324" title="All 2 branches missed.">      } else if (name.equals(VAL_BEAN)) {</span>
<span class="nc" id="L1325">        bean = invokeReadFromXML(child);</span>
      } else {
<span class="nc" id="L1327">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_ReadBeanInstance_Text_First&quot;) + name</span>
<span class="nc" id="L1328">            + Messages.getInstance().getString(&quot;XMLBeans_ReadBeanInstance_Text_Second&quot;) + node.getAttribute(ATT_NAME)</span>
<span class="nc" id="L1329">            + Messages.getInstance().getString(&quot;XMLBeans_ReadBeanInstance_Text_Third&quot;));</span>
      }
    }
    
<span class="nc" id="L1333">    result   = new BeanInstance(m_BeanLayout, bean, x, y);</span>
<span class="nc" id="L1334">    beaninst = (BeanInstance) result;</span>
    
    // set parent of BeanVisual
<span class="nc bnc" id="L1337" title="All 2 branches missed.">    if (beaninst.getBean() instanceof weka.gui.beans.Visible) {</span>
<span class="nc" id="L1338">      visual = ((Visible) beaninst.getBean()).getVisual();</span>
<span class="nc" id="L1339">      visual.setSize(visual.getPreferredSize());</span>
<span class="nc bnc" id="L1340" title="All 2 branches missed.">      if (visual.getParent() == null) {</span>
<span class="nc" id="L1341">        ((JPanel) beaninst.getBean()).add(visual);</span>
      }
    }

<span class="nc bnc" id="L1345" title="All 2 branches missed.">    if (beaninst.getBean() instanceof BeanCommon &amp;&amp;</span>
<span class="nc bnc" id="L1346" title="All 2 branches missed.">        customName != null) {</span>
<span class="nc" id="L1347">      ((BeanCommon)beaninst.getBean()).setCustomName(customName);</span>
    }
    
    // no IDs -&gt; get next null position
<span class="nc bnc" id="L1351" title="All 2 branches missed.">    if (id == -1) {</span>
<span class="nc bnc" id="L1352" title="All 2 branches missed.">      for (i = 0; i &lt; m_BeanInstances.size(); i++) {</span>
<span class="nc bnc" id="L1353" title="All 2 branches missed.">        if (m_BeanInstances.get(i) == null) {</span>
<span class="nc" id="L1354">          id = ((Integer) m_BeanInstancesID.get(i)).intValue();</span>
<span class="nc" id="L1355">          break;</span>
        }
      }
    }
    // get position for id
<span class="nc" id="L1360">    i = m_BeanInstancesID.indexOf(new Integer(id));</span>

    // keep track of the BeanInstances for reading the connections later on
<span class="nc" id="L1363">    m_BeanInstances.set(i, result);</span>

    // no current MetaBean
<span class="nc" id="L1366">    m_CurrentMetaBean = null;</span>
    
<span class="nc" id="L1368">    return result;</span>
  }

  /**
   * adds the given BeanConncetion to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeBeanConnection(Element parent, Object o, String name)
    throws Exception {
    
    Element           node;
    BeanConnection    beanconn;
    int               source;
    int               target;
    int               sourcePos;
    int               targetPos;

    // for debugging only
<span class="nc bnc" id="L1391" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1392">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L1394">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L1396">    beanconn = (BeanConnection) o;</span>
<span class="nc" id="L1397">    node     = null;</span>

    // get position
<span class="nc" id="L1400">    sourcePos = m_BeanInstances.indexOf(beanconn.getSource());</span>
<span class="nc" id="L1401">    targetPos = m_BeanInstances.indexOf(beanconn.getTarget());</span>
    
    // get id (if Connection is from a Bean in the UserToolBar, it's not listed! -&gt; ignore it)
<span class="nc bnc" id="L1404" title="All 4 branches missed.">    if ( (sourcePos &gt; -1) &amp;&amp; (targetPos &gt; -1) ) {</span>
<span class="nc" id="L1405">      source = ((Integer) m_BeanInstancesID.get(sourcePos)).intValue();</span>
<span class="nc" id="L1406">      target = ((Integer) m_BeanInstancesID.get(targetPos)).intValue();</span>
    }
    else {
<span class="nc" id="L1409">       source = -1;</span>
<span class="nc" id="L1410">       target = -1;</span>
    }
    
    // connection exists in the layout?
<span class="nc bnc" id="L1414" title="All 4 branches missed.">    if ( (source &gt; -1) &amp;&amp; (target &gt; -1) ) {</span>
<span class="nc" id="L1415">      node = addElement(parent, name, beanconn.getClass().getName(), false);</span>
  
<span class="nc" id="L1417">      writeIntToXML(node, source, VAL_SOURCEID);</span>
<span class="nc" id="L1418">      writeIntToXML(node, target, VAL_TARGETID);</span>
<span class="nc" id="L1419">      invokeWriteToXML(node, beanconn.getEventName(), VAL_EVENTNAME);</span>
<span class="nc" id="L1420">      writeBooleanToXML(node, beanconn.isHidden(), VAL_HIDDEN);</span>
    }
    
<span class="nc" id="L1423">    return node;</span>
  }

  /**
   * builds the BeanConnection from the given DOM node.
   * 
   * @param node the associated XML node
   * @return the instance created from the XML description
   * @throws Exception if instantiation fails
   */
  public Object readBeanConnection(Element node) throws Exception {
    Object                  result;
    Vector                  children;
    Element                 child;
    String                  name;
    int                     i;
    int                     source;
    int                     target;
    int                     sourcePos;
    int                     targetPos;
    String                  event;
    boolean                 hidden;

    // for debugging only
<span class="nc bnc" id="L1447" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1448">       trace(new Throwable(), node.getAttribute(ATT_NAME));</span>

<span class="nc" id="L1450">    m_CurrentNode = node;</span>
    
<span class="nc" id="L1452">    result   = null;</span>
<span class="nc" id="L1453">    children = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L1454">    source   = 0;</span>
<span class="nc" id="L1455">    target   = 0;</span>
<span class="nc" id="L1456">    event    = &quot;&quot;;</span>
<span class="nc" id="L1457">    hidden   = false;</span>

<span class="nc bnc" id="L1459" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++) {</span>
<span class="nc" id="L1460">      child = (Element) children.get(i);</span>
<span class="nc" id="L1461">      name  = child.getAttribute(ATT_NAME);</span>

<span class="nc bnc" id="L1463" title="All 2 branches missed.">      if (name.equals(VAL_SOURCEID))</span>
<span class="nc" id="L1464">        source = readIntFromXML(child);</span>
<span class="nc bnc" id="L1465" title="All 2 branches missed.">      else if (name.equals(VAL_TARGETID))</span>
<span class="nc" id="L1466">        target = readIntFromXML(child);</span>
<span class="nc bnc" id="L1467" title="All 2 branches missed.">      else if (name.equals(VAL_EVENTNAME))</span>
<span class="nc" id="L1468">        event = (String) invokeReadFromXML(child);</span>
<span class="nc bnc" id="L1469" title="All 2 branches missed.">      else if (name.equals(VAL_HIDDEN))</span>
<span class="nc" id="L1470">        hidden = readBooleanFromXML(child);</span>
      else
<span class="nc" id="L1472">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_ReadBeanConnection_Text_First&quot;) + name</span>
<span class="nc" id="L1473">            + Messages.getInstance().getString(&quot;XMLBeans_ReadBeanConnection_Text_Second&quot;) + node.getAttribute(ATT_NAME) </span>
<span class="nc" id="L1474">            + Messages.getInstance().getString(&quot;XMLBeans_ReadBeanConnection_Text_Third&quot;));</span>
    }

    // get position of id
<span class="nc" id="L1478">    sourcePos = m_BeanInstancesID.indexOf(new Integer(source));</span>
<span class="nc" id="L1479">    targetPos = m_BeanInstancesID.indexOf(new Integer(target));</span>
    
    // do we currently ignore the connections?
    // Note: necessary because of the MetaBeans
<span class="nc bnc" id="L1483" title="All 2 branches missed.">    if (m_IgnoreBeanConnections) {</span>
<span class="nc" id="L1484">      addBeanConnectionRelation(m_CurrentMetaBean, sourcePos + &quot;,&quot; + targetPos + &quot;,&quot; + event + &quot;,&quot; + hidden);</span>
<span class="nc" id="L1485">      return result;</span>
    }

    // generate it normally
<span class="nc" id="L1489">    result = createBeanConnection(sourcePos, targetPos, event, hidden);</span>

<span class="nc" id="L1491">    return result;</span>
  }
  
  /**
   * adds the given Loader (a bean) to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeBeanLoader(Element parent, Object o, String name)
      throws Exception {
    
    Element                 node;
    weka.gui.beans.Loader   loader;

    // for debugging only
<span class="nc bnc" id="L1510" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1511">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L1513">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L1515">    loader = (weka.gui.beans.Loader) o;</span>
<span class="nc" id="L1516">    node   = addElement(parent, name, loader.getClass().getName(), false);</span>

<span class="nc" id="L1518">    invokeWriteToXML(node, loader.getLoader(), VAL_LOADER);</span>
<span class="nc" id="L1519">    invokeWriteToXML(node, loader.getBeanContext(), VAL_BEANCONTEXT);</span>
    
<span class="nc" id="L1521">    return node;</span>
  }

  /**
   * adds the given Saver (a bean) to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeBeanSaver(Element parent, Object o, String name)
      throws Exception {
    
    Element                 node;
    weka.gui.beans.Saver    saver;

    // for debugging only
<span class="nc bnc" id="L1540" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1541">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L1543">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L1545">    saver = (weka.gui.beans.Saver) o;</span>
<span class="nc" id="L1546">    node   = addElement(parent, name, saver.getClass().getName(), false);</span>
<span class="nc" id="L1547">    invokeWriteToXML(node, saver.getRelationNameForFilename(), VAL_RELATIONNAMEFORFILENAME);</span>

<span class="nc" id="L1549">    invokeWriteToXML(node, saver.getSaverTemplate(), VAL_SAVER);</span>
    
<span class="nc" id="L1551">    return node;</span>
  }
  
  /**
   * adds the given Loader to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeLoader(Element parent, Object o, String name)
      throws Exception {
    
    Element                       node;
    weka.core.converters.Loader   loader;
    File                          file;
    boolean                       known;

    // for debugging only
<span class="nc bnc" id="L1572" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1573">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L1575">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L1577">    loader = (weka.core.converters.Loader) o;</span>
<span class="nc" id="L1578">    node   = addElement(parent, name, loader.getClass().getName(), false);</span>
<span class="nc" id="L1579">    known  = true;</span>
<span class="nc" id="L1580">    file   = null;</span>

    // file
<span class="nc bnc" id="L1583" title="All 2 branches missed.">    if (loader instanceof weka.core.converters.AbstractFileLoader)</span>
<span class="nc" id="L1584">      file = ((weka.core.converters.AbstractFileLoader) loader).retrieveFile();</span>
    else
<span class="nc" id="L1586">      known = false;</span>

<span class="nc bnc" id="L1588" title="All 2 branches missed.">    if (!known)</span>
<span class="nc" id="L1589">      System.out.println(Messages.getInstance().getString(&quot;XMLBeans_WriteLoader_Text_First&quot;) + loader.getClass().getName() </span>
<span class="nc" id="L1590">    		  + Messages.getInstance().getString(&quot;XMLBeans_WriteLoader_Text_Second&quot;));</span>

<span class="nc" id="L1592">    Boolean relativeB = null;</span>
<span class="nc bnc" id="L1593" title="All 2 branches missed.">    if (loader instanceof weka.core.converters.FileSourcedConverter) {</span>
<span class="nc" id="L1594">      boolean relative = ((weka.core.converters.FileSourcedConverter)loader).getUseRelativePath();</span>
<span class="nc" id="L1595">      relativeB = new Boolean(relative);</span>
    }
    
    // only save it, if it's a real file!
<span class="nc bnc" id="L1599" title="All 4 branches missed.">    if ( (file == null) || (file.isDirectory()) ) {</span>
<span class="nc" id="L1600">      invokeWriteToXML(node, &quot;&quot;, VAL_FILE);</span>
    } else {
<span class="nc" id="L1602">      boolean notAbsolute = </span>
<span class="nc bnc" id="L1603" title="All 2 branches missed.">        (((weka.core.converters.AbstractFileLoader) loader).getUseRelativePath() ||</span>
<span class="nc bnc" id="L1604" title="All 2 branches missed.">        (loader instanceof EnvironmentHandler </span>
<span class="nc bnc" id="L1605" title="All 2 branches missed.">            &amp;&amp; Environment.containsEnvVariables(file.getPath())));</span>
      
<span class="nc bnc" id="L1607" title="All 2 branches missed.">      String path = (notAbsolute)</span>
<span class="nc" id="L1608">        ? file.getPath()</span>
<span class="nc" id="L1609">        : file.getAbsolutePath();</span>
      // Replace any windows file separators with forward slashes (Java under windows can
      // read paths with forward slashes (apparantly)
<span class="nc" id="L1612">      path = path.replace('\\', '/');</span>
<span class="nc" id="L1613">      invokeWriteToXML(node, path, VAL_FILE);</span>
    }
<span class="nc bnc" id="L1615" title="All 2 branches missed.">    if (relativeB != null) {</span>
<span class="nc" id="L1616">      invokeWriteToXML(node, relativeB.toString(), VAL_RELATIVE_PATH);</span>
    }
    
<span class="nc" id="L1619">    return node;</span>
  }

  /**
   * builds the Loader from the given DOM node.
   * 
   * @param node the associated XML node
   * @return the instance created from the XML description
   * @throws Exception if instantiation fails
   */
  public Object readLoader(Element node) throws Exception {
    Object      result;
    Vector      children;
    Element     child;
    int         i;
    String      name;
    String      file;
    File        fl;

    // for debugging only
<span class="nc bnc" id="L1639" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1640">       trace(new Throwable(), node.getAttribute(ATT_NAME));</span>

<span class="nc" id="L1642">    m_CurrentNode = node;</span>
    
<span class="nc" id="L1644">    result   = Class.forName(node.getAttribute(ATT_CLASS)).newInstance();</span>
<span class="nc" id="L1645">    children = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L1646">    file     = &quot;&quot;;</span>
<span class="nc" id="L1647">    Object relativeB = null;</span>
<span class="nc" id="L1648">    boolean relative = false;</span>

<span class="nc bnc" id="L1650" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++) {</span>
<span class="nc" id="L1651">      child = (Element) children.get(i);</span>
<span class="nc" id="L1652">      name  = child.getAttribute(ATT_NAME);</span>

<span class="nc bnc" id="L1654" title="All 2 branches missed.">      if (name.equals(VAL_FILE)) {</span>
<span class="nc" id="L1655">        file = (String) invokeReadFromXML(child);</span>
<span class="nc bnc" id="L1656" title="All 2 branches missed.">      } else if (name.equals(VAL_RELATIVE_PATH)) {</span>
<span class="nc" id="L1657">        relativeB = readFromXML(child);</span>
<span class="nc bnc" id="L1658" title="All 2 branches missed.">        if (relativeB instanceof Boolean) {</span>
<span class="nc" id="L1659">          relative = ((Boolean)relativeB).booleanValue();</span>
        }
      } else {
<span class="nc" id="L1662">        readFromXML(result, name, child);</span>
      }
    }

<span class="nc bnc" id="L1666" title="All 2 branches missed.">    if (result instanceof weka.core.converters.FileSourcedConverter) {</span>
<span class="nc" id="L1667">      ((weka.core.converters.FileSourcedConverter)result).setUseRelativePath(relative);</span>
    }

<span class="nc bnc" id="L1670" title="All 2 branches missed.">    if (file.equals(&quot;&quot;))</span>
<span class="nc" id="L1671">      file = null;</span>

    // set file only, if it exists
<span class="nc bnc" id="L1674" title="All 2 branches missed.">    if (file != null) {</span>
<span class="nc" id="L1675">      String tempFile = file;</span>

<span class="nc" id="L1677">      boolean containsEnv = false;</span>
<span class="nc" id="L1678">      containsEnv = Environment.containsEnvVariables(file);</span>
      
<span class="nc" id="L1680">      fl = new File(file);      </span>
      // only test for existence if the path does not contain environment vars
      // (trust that after they are resolved that everything is hunky dory)
<span class="nc bnc" id="L1683" title="All 4 branches missed.">      if (containsEnv || fl.exists()) {</span>
<span class="nc" id="L1684">        ((weka.core.converters.AbstractFileLoader) result).setSource(new File(file));</span>
      } else {
<span class="nc" id="L1686">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_ReadLoader_Text_Front&quot;) + tempFile </span>
<span class="nc" id="L1687">        		+ Messages.getInstance().getString(&quot;XMLBeans_ReadLoader_Text_End&quot;));</span>
      }
    }
    
<span class="nc" id="L1691">    return result;</span>
  }

  /**
   * adds the given Saver to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeSaver(Element parent, Object o, String name)
      throws Exception {
    
    Element                     node;
    weka.core.converters.Saver  saver;
    File                        file;
    String			prefix;
    String			dir;
    boolean                     known;

    // for debugging only
<span class="nc bnc" id="L1714" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1715">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L1717">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L1719">    saver  = (weka.core.converters.Saver) o;</span>
<span class="nc" id="L1720">    node   = addElement(parent, name, saver.getClass().getName(), false);</span>
<span class="nc" id="L1721">    known  = true;</span>
<span class="nc" id="L1722">    file   = null;</span>
<span class="nc" id="L1723">    prefix = &quot;&quot;;</span>
<span class="nc" id="L1724">    dir    = &quot;&quot;;</span>

    // file
<span class="nc bnc" id="L1727" title="All 2 branches missed.">    if (saver instanceof weka.core.converters.AbstractFileSaver) {</span>
<span class="nc" id="L1728">      file   = ((weka.core.converters.AbstractFileSaver) saver).retrieveFile();</span>
<span class="nc" id="L1729">      prefix = ((weka.core.converters.AbstractFileSaver) saver).filePrefix();</span>
<span class="nc" id="L1730">      dir    = ((weka.core.converters.AbstractFileSaver) saver).retrieveDir();</span>
      // Replace any windows file separators with forward slashes (Java under windows can
      // read paths with forward slashes (apparantly)
<span class="nc" id="L1733">      dir = dir.replace('\\', '/');</span>
    }
    else {
<span class="nc" id="L1736">      known = false;</span>
    }
    
<span class="nc bnc" id="L1739" title="All 2 branches missed.">    if (!known)</span>
<span class="nc" id="L1740">      System.out.println(Messages.getInstance().getString(&quot;XMLBeans_WriteSaver_Text_Front&quot;) + saver.getClass().getName() </span>
<span class="nc" id="L1741">    		  + Messages.getInstance().getString(&quot;XMLBeans_WriteSaver_Text_End&quot;));</span>

<span class="nc" id="L1743">    Boolean relativeB = null;</span>
<span class="nc bnc" id="L1744" title="All 2 branches missed.">    if (saver instanceof weka.core.converters.FileSourcedConverter) {</span>
<span class="nc" id="L1745">      boolean relative = ((weka.core.converters.FileSourcedConverter)saver).getUseRelativePath();</span>
<span class="nc" id="L1746">      relativeB = new Boolean(relative);</span>
    }
    

//    if ( (file == null) || (file.isDirectory()) ) {
<span class="nc" id="L1751">      invokeWriteToXML(node, &quot;&quot;,     VAL_FILE);</span>
<span class="nc" id="L1752">      invokeWriteToXML(node, dir,    VAL_DIR);</span>
<span class="nc" id="L1753">      invokeWriteToXML(node, prefix, VAL_PREFIX);</span>
/*    }
    else {
      String path = (((weka.core.converters.FileSourcedConverter) saver).getUseRelativePath())
        ? file.getPath()
        : file.getAbsolutePath();
      // Replace any windows file separators with forward slashes (Java under windows can
      // read paths with forward slashes (apparantly)
      path = path.replace('\\', '/');
      invokeWriteToXML(node, path, VAL_FILE);
      invokeWriteToXML(node, dir, VAL_DIR);
      invokeWriteToXML(node, prefix, VAL_PREFIX);
    }*/

<span class="nc bnc" id="L1767" title="All 2 branches missed.">    if (relativeB != null) {</span>
<span class="nc" id="L1768">      invokeWriteToXML(node, relativeB.toString(), VAL_RELATIVE_PATH);</span>
    }
    
<span class="nc" id="L1771">    return node;</span>
  }

  /**
   * builds the Saver from the given DOM node.
   * 
   * @param node the associated XML node
   * @return the instance created from the XML description
   * @throws Exception if instantiation fails
   */
  public Object readSaver(Element node) throws Exception {
    Object      result;
    Vector      children;
    Element     child;
    int         i;
    String      name;
    String      file;
    String	dir;
    String	prefix;

    // for debugging only
<span class="nc bnc" id="L1792" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1793">       trace(new Throwable(), node.getAttribute(ATT_NAME));</span>

<span class="nc" id="L1795">    m_CurrentNode = node;</span>
    
<span class="nc" id="L1797">    result   = Class.forName(node.getAttribute(ATT_CLASS)).newInstance();</span>
<span class="nc" id="L1798">    children = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L1799">    file     = null;</span>
<span class="nc" id="L1800">    dir      = null;</span>
<span class="nc" id="L1801">    prefix   = null;</span>

<span class="nc" id="L1803">    Object relativeB = null;</span>
<span class="nc" id="L1804">    boolean relative = false;</span>

<span class="nc bnc" id="L1806" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++) {</span>
<span class="nc" id="L1807">      child = (Element) children.get(i);</span>
<span class="nc" id="L1808">      name  = child.getAttribute(ATT_NAME);</span>

<span class="nc bnc" id="L1810" title="All 2 branches missed.">      if (name.equals(VAL_FILE)) {</span>
<span class="nc" id="L1811">        file = (String) invokeReadFromXML(child);</span>
<span class="nc bnc" id="L1812" title="All 2 branches missed.">      } else if (name.equals(VAL_DIR)) {</span>
<span class="nc" id="L1813">        dir = (String) invokeReadFromXML(child);</span>
<span class="nc bnc" id="L1814" title="All 2 branches missed.">      } else if (name.equals(VAL_PREFIX)) {</span>
<span class="nc" id="L1815">        prefix = (String) invokeReadFromXML(child);</span>
<span class="nc bnc" id="L1816" title="All 2 branches missed.">      } else if (name.equals(VAL_RELATIVE_PATH)) {</span>
<span class="nc" id="L1817">        relativeB = readFromXML(child);</span>
<span class="nc bnc" id="L1818" title="All 2 branches missed.">        if (relativeB instanceof Boolean) {</span>
<span class="nc" id="L1819">          relative = ((Boolean)relativeB).booleanValue();</span>
        }
      } else {
<span class="nc" id="L1822">        readFromXML(result, name, child);</span>
      }
    }

<span class="nc bnc" id="L1826" title="All 4 branches missed.">    if ( (file != null) &amp;&amp; (file.length() == 0) )</span>
<span class="nc" id="L1827">      file = null;</span>

    // savers only get directory and prefix, not file (KnowledgeFlow sets the
    // file/destination based on the relation, dir and prefix)
<span class="nc bnc" id="L1831" title="All 4 branches missed.">    if ( (dir != null) &amp;&amp; (prefix != null) ) {</span>
<span class="nc" id="L1832">      ((weka.core.converters.AbstractFileSaver) result).setDir(dir);</span>
<span class="nc" id="L1833">      ((weka.core.converters.AbstractFileSaver) result).setFilePrefix(prefix);</span>
    }

<span class="nc bnc" id="L1836" title="All 2 branches missed.">    if (result instanceof weka.core.converters.FileSourcedConverter) {</span>
<span class="nc" id="L1837">      ((weka.core.converters.FileSourcedConverter)result).setUseRelativePath(relative);</span>
    }
    
<span class="nc" id="L1840">    return result;</span>
  }

  /**
   * adds the given BeanVisual to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeBeanVisual(Element parent, Object o, String name)
      throws Exception {
    
    Element         node;
    BeanVisual      visual;

    // for debugging only
<span class="nc bnc" id="L1859" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1860">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L1862">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L1864">    visual = (BeanVisual) o;</span>
<span class="nc" id="L1865">    node   = writeToXML(parent, o, name);</span>

    // add icon paths
<span class="nc" id="L1868">    invokeWriteToXML(node, visual.getIconPath(),         VAL_ICONPATH);</span>
<span class="nc" id="L1869">    invokeWriteToXML(node, visual.getAnimatedIconPath(), VAL_ANIMATEDICONPATH);</span>
    
<span class="nc" id="L1871">    return node;</span>
  }

  /**
   * builds the BeanVisual from the given DOM node.
   * 
   * @param node the associated XML node
   * @return the instance created from the XML description
   * @throws Exception if instantiation fails
   */
  public Object readBeanVisual(Element node) throws Exception {
    Object      result;
    Vector      children;
    Element     child;
    int         i;
    String      name;
    String      text;
    String      iconPath;
    String      animIconPath;

    // for debugging only
<span class="nc bnc" id="L1892" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1893">       trace(new Throwable(), node.getAttribute(ATT_NAME));</span>

<span class="nc" id="L1895">    m_CurrentNode = node;</span>
    
<span class="nc" id="L1897">    result       = null;</span>
<span class="nc" id="L1898">    children     = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L1899">    text         = &quot;&quot;;</span>
<span class="nc" id="L1900">    iconPath     = &quot;&quot;;</span>
<span class="nc" id="L1901">    animIconPath = &quot;&quot;;</span>

    // find text
<span class="nc bnc" id="L1904" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++) {</span>
<span class="nc" id="L1905">      child = (Element) children.get(i);</span>
<span class="nc" id="L1906">      name  = child.getAttribute(ATT_NAME);</span>

<span class="nc bnc" id="L1908" title="All 2 branches missed.">      if (name.equals(VAL_TEXT))</span>
<span class="nc" id="L1909">        text = (String) invokeReadFromXML(child);</span>
<span class="nc bnc" id="L1910" title="All 2 branches missed.">      else if (name.equals(VAL_ICONPATH))</span>
<span class="nc" id="L1911">        iconPath = (String) invokeReadFromXML(child);</span>
<span class="nc bnc" id="L1912" title="All 2 branches missed.">      else if (name.equals(VAL_ANIMATEDICONPATH))</span>
<span class="nc" id="L1913">        animIconPath = (String) invokeReadFromXML(child);</span>
    }

<span class="nc" id="L1916">    result = new BeanVisual(text, iconPath, animIconPath);</span>
    
    // set rest of properties
<span class="nc bnc" id="L1919" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++)</span>
<span class="nc" id="L1920">      readFromXML(result, node.getAttribute(ATT_NAME), (Element) children.get(i));</span>
    
<span class="nc" id="L1922">    return result;</span>
  }
  
  /**
   * returns the IDs for the given BeanInstances, i.e., the stored IDs
   * in m_BeanInstancesID, based on m_BeanInstances
   * 
   * @param beans       the beans to retrieve the IDs for
   * @return            the IDs for the given BeanInstances
   * @see #m_BeanInstances
   * @see #m_BeanInstancesID
   */
  protected Vector getIDsForBeanInstances(Vector beans) {
    Vector        result;
    int           i;
    int           pos;
    
<span class="nc" id="L1939">    result = new Vector();</span>

<span class="nc bnc" id="L1941" title="All 2 branches missed.">    for (i = 0; i &lt; beans.size(); i++) {</span>
<span class="nc" id="L1942">      pos = m_BeanInstances.indexOf(beans.get(i));</span>
<span class="nc" id="L1943">      result.add(m_BeanInstancesID.get(pos));</span>
    }
    
<span class="nc" id="L1946">    return result;</span>
  }
  
  /**
   * adds the given MetaBean to a DOM structure.
   * 
   * @param parent the parent of this object, e.g. the class this object is a member of
   * @param o the Object to describe in XML
   * @param name the name of the object
   * @return the node that was created
   * @throws Exception if the DOM creation fails
   */
  public Element writeMetaBean(Element parent, Object o, String name)
      throws Exception {
    
    Element         node;
    MetaBean        meta;

    // for debugging only
<span class="nc bnc" id="L1965" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L1966">       trace(new Throwable(), name);</span>
    
<span class="nc" id="L1968">    m_CurrentNode = parent;</span>
    
<span class="nc" id="L1970">    meta = (MetaBean) o;</span>
<span class="nc" id="L1971">    node = writeToXML(parent, o, name);</span>

<span class="nc" id="L1973">    invokeWriteToXML(node, getIDsForBeanInstances(meta.getBeansInInputs()), VAL_INPUTSID);</span>
<span class="nc" id="L1974">    invokeWriteToXML(node, getIDsForBeanInstances(meta.getBeansInOutputs()), VAL_OUTPUTSID);</span>
    
<span class="nc" id="L1976">    return node;</span>
  }
  
  /**
   * returns a vector with references to BeanInstances according to the IDs
   * in the given Vector.
   * @param ids       contains the IDs of the BeanInstances
   * @return          the corresponding BeanInstances
   * @see #m_BeanInstances
   * @see #m_BeanInstancesID
   */
  protected Vector getBeanInstancesForIDs(Vector ids) {
    Vector        result;
    int           i;
    int           pos;
    
<span class="nc" id="L1992">    result = new Vector();</span>
    
<span class="nc bnc" id="L1994" title="All 2 branches missed.">    for (i = 0; i &lt; ids.size(); i++) {</span>
<span class="nc" id="L1995">      pos = m_BeanInstancesID.indexOf(ids.get(i));</span>
<span class="nc" id="L1996">      result.add(m_BeanInstances.get(pos));</span>
    }
    
<span class="nc" id="L1999">    return result;</span>
  }

  /**
   * builds the MetaBean from the given DOM node.
   * 
   * @param node the associated XML node
   * @return the instance created from the XML description
   * @throws Exception if instantiation fails
   */
  public Object readMetaBean(Element node) throws Exception {
    Object          result;
    Vector          children;
    Element         child;
    int             i;
    String          name;
    Vector          inputs;
    Vector          outputs;
    Vector          coords;
    MetaBean        bean;

    // for debugging only
<span class="nc bnc" id="L2021" title="All 2 branches missed.">    if (DEBUG)</span>
<span class="nc" id="L2022">       trace(new Throwable(), node.getAttribute(ATT_NAME));</span>

<span class="nc" id="L2024">    m_CurrentNode = node;</span>
    
<span class="nc" id="L2026">    result   = new MetaBean();</span>
<span class="nc" id="L2027">    children = XMLDocument.getChildTags(node);</span>
<span class="nc" id="L2028">    inputs   = new Vector();</span>
<span class="nc" id="L2029">    outputs  = new Vector();</span>
<span class="nc" id="L2030">    coords   = new Vector();</span>
    
    // the current MetaBean
<span class="nc" id="L2033">    m_CurrentMetaBean = (MetaBean) result;</span>

<span class="nc bnc" id="L2035" title="All 2 branches missed.">    for (i = 0; i &lt; children.size(); i++) {</span>
<span class="nc" id="L2036">      child = (Element) children.get(i);</span>
<span class="nc" id="L2037">      name  = child.getAttribute(ATT_NAME);</span>

<span class="nc bnc" id="L2039" title="All 2 branches missed.">      if (name.equals(VAL_ASSOCIATEDCONNECTIONS))</span>
<span class="nc" id="L2040">        ((MetaBean) result).setAssociatedConnections((Vector) invokeReadFromXML(child));</span>
<span class="nc bnc" id="L2041" title="All 2 branches missed.">      else if (name.equals(VAL_INPUTSID))</span>
<span class="nc" id="L2042">        inputs = (Vector) invokeReadFromXML(child);</span>
<span class="nc bnc" id="L2043" title="All 2 branches missed.">      else if (name.equals(VAL_OUTPUTSID))</span>
<span class="nc" id="L2044">        outputs = (Vector) invokeReadFromXML(child);</span>
<span class="nc bnc" id="L2045" title="All 2 branches missed.">      else if (name.equals(VAL_SUBFLOW))</span>
<span class="nc" id="L2046">        ((MetaBean) result).setSubFlow((Vector) invokeReadFromXML(child));</span>
<span class="nc bnc" id="L2047" title="All 2 branches missed.">      else if (name.equals(VAL_ORIGINALCOORDS))</span>
<span class="nc" id="L2048">        coords = (Vector) invokeReadFromXML(child);</span>
<span class="nc bnc" id="L2049" title="All 2 branches missed.">      else if (name.equals(VAL_INPUTS))</span>
<span class="nc" id="L2050">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_ReadMetaBean_Input_Text_Front&quot;) + name + Messages.getInstance().getString(&quot;XMLBeans_ReadMetaBean_Input_Text_End&quot;));</span>
<span class="nc bnc" id="L2051" title="All 2 branches missed.">      else if (name.equals(VAL_OUTPUTS))</span>
<span class="nc" id="L2052">        System.out.println(Messages.getInstance().getString(&quot;XMLBeans_ReadMetaBean_Output_Text_Front&quot;) + name + Messages.getInstance().getString(&quot;XMLBeans_ReadMetaBean_Output_Text_End&quot;));</span>
      else
<span class="nc" id="L2054">        readFromXML(result, name, child);</span>
    }

<span class="nc" id="L2057">    bean = (MetaBean) result;</span>
    
    // set inputs and outputs, after the beans have been instantiated
<span class="nc" id="L2060">    bean.setInputs(getBeanInstancesForIDs(inputs));</span>
<span class="nc" id="L2061">    bean.setOutputs(getBeanInstancesForIDs(outputs));</span>
<span class="nc" id="L2062">    bean.setOriginalCoords(coords);</span>
    
<span class="nc" id="L2064">    return result;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>AllTests (Nov 28, 2015 2:34:31 PM)</div></body></html>